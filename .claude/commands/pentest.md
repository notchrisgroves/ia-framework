---
name: pentest
description: Security testing with Director/Mentor/Demo modes
---

# /pentest - Penetration Testing Engagement

Execute security testing engagements with prompt-chained workflow enforcement.

**Agent:** security
**Skill:** security-testing
**Output:** `output/engagements/pentests/{target}-{YYYY-MM}/`

---

## ğŸš¨ WORKFLOW ENFORCEMENT

**This command uses prompt chaining with mandatory gates.**

**You MUST:**
1. Load `commands/pentest/00-WORKFLOW.md` to determine current phase
2. Execute ONLY the current phase prompt
3. Verify gate before proceeding to next phase
4. CHECK SCOPE before EVERY test (not once - EVERY time)

**NEVER skip phases. NEVER test without authorization.**

---

## Phase Overview

```
Phase 1: EXPLORE â†’ Gate: SCOPE.md validated, attack surface mapped
Phase 2: PLAN â†’ Gate: TEST-PLAN.md approved by user
Phase 3: CODE â†’ Gate: All tests executed, findings documented
Phase 4: QA â†’ Gate: All findings validated, qa-review.json complete
Phase 5: COMMIT â†’ Gate: Report complete, close-loop decided
```

**Prompts:** `commands/pentest/prompts/01-EXPLORE.md` through `05-COMMIT.md`

---

## Quick Start

```
/pentest
```

**To start:**
1. Read `00-WORKFLOW.md` for phase detection logic
2. Check engagement folder for existing files
3. Load appropriate phase prompt from `prompts/`
4. Execute phase, verify gate, proceed

---

## When to Use

âœ… **Use /pentest when:**
- Bug bounty testing on HackerOne/authorized programs
- Vulnerability assessments on authorized targets
- Learning penetration testing (Mentor mode)
- Quick tool validation (Demo mode)
- Full professional pentests (Director mode)

âŒ **Don't use if:** Need automated scanning only â†’ use `/vuln-scan`

---

## Workflow

1. **Context Collection** - Prompts gather mode, target type, scope source
2. **Validation** - Verify scope files, API access, authorization
3. **Agent Execution** - Route to security agent with security-testing skill
4. **Deliverables** - Generate in `output/engagements/pentests/{target}-{YYYY-MM}/`

**Estimated time:**
- Demo: 15-30 minutes
- Director: 4-12 hours
- Mentor: +20-30% (includes checkpoints)

---

## Context Prompts

### Engagement Mode

**Question:** "What type of engagement is this?"

**Options:**
- **Director (Production)** - Full professional pentest, complete deliverables
- **Mentor (Learning)** - Interactive with teaching checkpoints
- **Demo (Testing)** - Quick tool/infrastructure validation

**Default:** Director

---

### Target Type

**Question:** "What type of target are you testing?"

**Options:**
- **HackerOne Program** - Bug bounty with API intelligence
- **Custom Target** - Manual scope (own infrastructure, client, CTF)
- **Safe Test Target** - HTB, THM, practice labs

**Default:** HackerOne Program

---

### Scope Source (Conditional)

**Show if:** Target = HackerOne OR Custom

**Question:** "How will you provide scope documentation?"

**Options:**
- **HackerOne API** - Fetch via API (requires .env credentials)
- **Manual Files** - CSV/HTML/MD in `output/engagements/pentests/`
- **Both (API + Files)** - Highest confidence (recommended)

**Default:** API (HackerOne) | Manual Files (Custom)

---

### Target Identifier

**Question:** "What is the target identifier?"

**Input:** Manual entry
- HackerOne: Program handle (e.g., "crypto")
- Custom: Domain (e.g., "acmecorp.com")
- Safe: Machine name (e.g., "hackthebox-machine")

**Default:** None (required)

---

### Audit Logging

**Question:** "Audit logging provides compliance & legal defense. Disable?"

**Options:**
- **No (Keep Enabled)** - Full logging (SOC 2, ISO 27001) - Recommended
- **Yes (Disable)** - No audit trail (practice/testing only)

**Default:** Enabled (Director/Mentor) | Disabled (Demo)

**Location:** `{engagement-dir}/audit-logs/`

---

## Validation

Before agent execution:

- [x] Engagement mode selected
- [x] Target type selected
- [x] Target identifier provided
- [x] Scope documentation exists (if not Demo):
  - API: Verify HACKERONE_USERNAME, HACKERONE_API_TOKEN in .env
  - Files: Check `output/engagements/pentests/` for scope exports
- [x] Authorization verified (Custom targets)
- [x] Output directory writable

**Error Handling:**

```
API credentials missing:
  â†’ Display: "HackerOne API credentials not found in .env"
  â†’ Suggest: "Add HACKERONE_USERNAME and HACKERONE_API_TOKEN to .env"
  â†’ Options: [Retry with Manual Files] [Abort]

No scope files:
  â†’ Display: "No scope files in output/engagements/pentests/"
  â†’ Suggest: "Export scope (CSV + HTML) to pentests directory"
  â†’ Options: [Specify file path] [Abort]

Custom target without authorization:
  â†’ Display: "âš ï¸ AUTHORIZATION REQUIRED for custom targets"
  â†’ Ask: "Do you have written authorization to test?" [Yes/No]
  â†’ If No: ABORT immediately
  â†’ If Yes: Document source, proceed
```

---

## Agent Routing

```typescript
// FLEXIBLE MODEL SELECTION (per library/model-selection-matrix.md):
//
// DEFAULT WORKFLOW: Sonnet executes, escalate strategically
//
// ULTRATHINK (Opus) - Strategic escalation points:
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ â€¢ Test plan design (attack surface mapping, prioritization) â”‚
// â”‚ â€¢ Novel attack chain reasoning                              â”‚
// â”‚ â€¢ When hitting a wall / stuck on approach                   â”‚
// â”‚ â€¢ Complex multi-target coordination                         â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//
// EXECUTION: Sonnet (default workhorse for executing test steps)
// OSINT: Perplexity (research with citations)
// QA/SECOND OPINION: Grok (adversarial review, fresh perspective when stuck)
// VALIDATION: Haiku (checklists, scope verification)

Task({
  subagent_type: "security",
  model: "sonnet",  // Default - escalate to opus/grok as needed
  prompt: `
Mode: {mode} (director/mentor/demo)
Workflow: pentest
Skill: security-testing

Context:
- Engagement Mode: {Director/Mentor/Demo}
- Target Type: {HackerOne/Custom/Safe}
- Scope Source: {API/Files/Both}
- Target: {target}
- Audit Logs: {enabled/disabled}

Files:
- Scope: {scope-file-paths-or-API}
- Output: output/engagements/pentests/{target}-{YYYY-MM}/

FLEXIBLE MODEL ESCALATION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ULTRATHINK (Opus) - Invoke for:                                 â”‚
â”‚ â€¢ Designing comprehensive test plan from scope analysis         â”‚
â”‚ â€¢ Novel attack chain identification / complex exploit paths     â”‚
â”‚ â€¢ Strategic decisions on approach when multiple options exist   â”‚
â”‚ â€¢ Breaking through blockers (stuck? escalate to deep thinking)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ EXECUTION (Sonnet) - Default for:                               â”‚
â”‚ â€¢ Running test cases from approved plan                         â”‚
â”‚ â€¢ Known vulnerability patterns (OWASP, CWE)                     â”‚
â”‚ â€¢ Documentation and evidence collection                         â”‚
â”‚ â€¢ Report writing                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ QA/INSIGHT (Grok) - Escalate for:                               â”‚
â”‚ â€¢ Second opinion when findings seem incomplete                  â”‚
â”‚ â€¢ Adversarial review of test coverage                           â”‚
â”‚ â€¢ "Why am I not finding anything?" analysis                     â”‚
â”‚ â€¢ Reasoning traces on complex technical decisions               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RESEARCH (Perplexity) - Use for:                                â”‚
â”‚ â€¢ OSINT / target intelligence gathering                         â”‚
â”‚ â€¢ Technology stack research with citations                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VALIDATION (Haiku) - Use for:                                   â”‚
â”‚ â€¢ Scope compliance checks                                       â”‚
â”‚ â€¢ Checklist verification                                        â”‚
â”‚ â€¢ Quick format/structure validation                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Instructions:
{mode-specific instructions}

Execute security-testing SKILL.md {mode} workflow.
`
})
```

**Agent loads:**
1. `agents/security.md` (via PreToolUse hook)
2. `skills/security-testing/SKILL.md` (via load-agent-skill-context hook)
3. Tools referenced in skill workflows (via tool awareness system)

---

## Output Structure

**Director/Mentor:**
```
output/engagements/pentests/{target}-{YYYY-MM}/
â”œâ”€â”€ SCOPE.md
â”œâ”€â”€ 01-scope-and-reconnaissance/
â”‚   â”œâ”€â”€ api/ (HackerOne data if applicable)
â”‚   â”œâ”€â”€ subdomain-enum.txt
â”‚   â”œâ”€â”€ port-scan-results.txt
â”‚   â””â”€â”€ technology-stack.md
â”œâ”€â”€ 02-vulnerability-scanning/
â”‚   â”œâ”€â”€ nuclei-output.txt
â”‚   â”œâ”€â”€ findings-summary.md
â”œâ”€â”€ 03-exploitation/
â”‚   â”œâ”€â”€ exploit-attempts.md
â”‚   â””â”€â”€ proof-of-concept/
â”œâ”€â”€ 04-reporting/
â”‚   â”œâ”€â”€ executive-summary.md
â”‚   â”œâ”€â”€ technical-findings.md
â”‚   â””â”€â”€ final-report.pdf
â”œâ”€â”€ audit-logs/ (if enabled)
â””â”€â”€ session-state.md
```

**Demo:**
```
output/engagements/pentests/{target}-demo-{YYYY-MM}/
â”œâ”€â”€ demo-validation.md
â”œâ”€â”€ tool-connectivity.txt
â””â”€â”€ target-responsiveness.txt
```

---

## Examples

### HackerOne Bug Bounty (Director)

```
/pentest
â†’ Mode: Director
â†’ Target: HackerOne (crypto)
â†’ Scope: Both (API + Files)
â†’ Audit: Enabled

Result: Full pentest, deliverables in pentests/crypto-2025-12/
```

### Quick Validation (Demo)

```
/pentest
â†’ Mode: Demo
â†’ Target: Safe (scanme.nmap.org)

Result: Quick validation (~3 min), confirms tool connectivity
```

---

## Related Commands

- `/vuln-scan` - Automated scanning without full pentest
- `/segmentation-test` - Network segmentation validation
- Writer skill handles report generation
- `/threat-intel` - Map findings to MITRE ATT&CK

---

## Security

**Data Privacy:**
- No scope data sent externally (except HackerOne API if selected)
- Outputs stored locally
- API credentials in .env (gitignored)
- Evidence remains local

**Authorization:**
- Custom targets require explicit authorization
- SCOPE.md validated
- Out-of-scope assets excluded
- Safe targets inherently authorized

**Execution Safety:**
- Demo uses safe targets only
- Exploitation logged for audit
- Rate limits respected
- No destructive actions without confirmation

**Legal Compliance:**
- Written authorization required (custom)
- CFAA compliance enforced
- Responsible disclosure followed
- Bug bounty rules respected

---

**Version:** 1.0
**Last Updated:** 2025-12-12
**Framework:** Intelligence Adjacent (IA)

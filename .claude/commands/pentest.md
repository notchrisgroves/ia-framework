---
name: pentest
description: Security testing with Director/Mentor/Demo modes
---

# /pentest - Penetration Testing Engagement

Execute security testing engagements with Director (production), Mentor (learning), or Demo (testing) modes.

**Agent:** security
**Skill:** security-testing
**Output:** `output/engagements/pentests/{target}-{YYYY-MM}/`

---

## Quick Start

```
/pentest
```

Collects engagement context → Validates scope → Routes to security agent

---

## When to Use

✅ **Use /pentest when:**
- Bug bounty testing on HackerOne/authorized programs
- Vulnerability assessments on authorized targets
- Learning penetration testing (Mentor mode)
- Quick tool validation (Demo mode)
- Full professional pentests (Director mode)

❌ **Don't use if:** Need automated scanning only → use `/vuln-scan`

---

## Workflow

1. **Context Collection** - Prompts gather mode, target type, scope source
2. **Validation** - Verify scope files, API access, authorization
3. **Agent Execution** - Route to security agent with security-testing skill
4. **Deliverables** - Generate in `output/engagements/pentests/{target}-{YYYY-MM}/`

**Estimated time:**
- Demo: 15-30 minutes
- Director: 4-12 hours
- Mentor: +20-30% (includes checkpoints)

---

## Context Prompts

### Engagement Mode

**Question:** "What type of engagement is this?"

**Options:**
- **Director (Production)** - Full professional pentest, complete deliverables
- **Mentor (Learning)** - Interactive with teaching checkpoints
- **Demo (Testing)** - Quick tool/infrastructure validation

**Default:** Director

---

### Target Type

**Question:** "What type of target are you testing?"

**Options:**
- **HackerOne Program** - Bug bounty with API intelligence
- **Custom Target** - Manual scope (own infrastructure, client, CTF)
- **Safe Test Target** - HTB, THM, practice labs

**Default:** HackerOne Program

---

### Scope Source (Conditional)

**Show if:** Target = HackerOne OR Custom

**Question:** "How will you provide scope documentation?"

**Options:**
- **HackerOne API** - Fetch via API (requires .env credentials)
- **Manual Files** - CSV/HTML/MD in `output/engagements/pentests/`
- **Both (API + Files)** - Highest confidence (recommended)

**Default:** API (HackerOne) | Manual Files (Custom)

---

### Target Identifier

**Question:** "What is the target identifier?"

**Input:** Manual entry
- HackerOne: Program handle (e.g., "crypto")
- Custom: Domain (e.g., "acmecorp.com")
- Safe: Machine name (e.g., "hackthebox-machine")

**Default:** None (required)

---

### Audit Logging

**Question:** "Audit logging provides compliance & legal defense. Disable?"

**Options:**
- **No (Keep Enabled)** - Full logging (SOC 2, ISO 27001) - Recommended
- **Yes (Disable)** - No audit trail (practice/testing only)

**Default:** Enabled (Director/Mentor) | Disabled (Demo)

**Location:** `{engagement-dir}/audit-logs/`

---

## Validation

Before agent execution:

- [x] Engagement mode selected
- [x] Target type selected
- [x] Target identifier provided
- [x] Scope documentation exists (if not Demo):
  - API: Verify HACKERONE_USERNAME, HACKERONE_API_TOKEN in .env
  - Files: Check `output/engagements/pentests/` for scope exports
- [x] Authorization verified (Custom targets)
- [x] Output directory writable

**Error Handling:**

```
API credentials missing:
  → Display: "HackerOne API credentials not found in .env"
  → Suggest: "Add HACKERONE_USERNAME and HACKERONE_API_TOKEN to .env"
  → Options: [Retry with Manual Files] [Abort]

No scope files:
  → Display: "No scope files in output/engagements/pentests/"
  → Suggest: "Export scope (CSV + HTML) to pentests directory"
  → Options: [Specify file path] [Abort]

Custom target without authorization:
  → Display: "⚠️ AUTHORIZATION REQUIRED for custom targets"
  → Ask: "Do you have written authorization to test?" [Yes/No]
  → If No: ABORT immediately
  → If Yes: Document source, proceed
```

---

## Agent Routing

```typescript
// FLEXIBLE MODEL SELECTION (per library/model-selection-matrix.md):
//
// DEFAULT WORKFLOW: Sonnet executes, escalate strategically
//
// ULTRATHINK (Opus) - Strategic escalation points:
// ┌─────────────────────────────────────────────────────────────┐
// │ • Test plan design (attack surface mapping, prioritization) │
// │ • Novel attack chain reasoning                              │
// │ • When hitting a wall / stuck on approach                   │
// │ • Complex multi-target coordination                         │
// └─────────────────────────────────────────────────────────────┘
//
// EXECUTION: Sonnet (default workhorse for executing test steps)
// OSINT: Perplexity (research with citations)
// QA/SECOND OPINION: Grok (adversarial review, fresh perspective when stuck)
// VALIDATION: Haiku (checklists, scope verification)

Task({
  subagent_type: "security",
  model: "sonnet",  // Default - escalate to opus/grok as needed
  prompt: `
Mode: {mode} (director/mentor/demo)
Workflow: pentest
Skill: security-testing

Context:
- Engagement Mode: {Director/Mentor/Demo}
- Target Type: {HackerOne/Custom/Safe}
- Scope Source: {API/Files/Both}
- Target: {target}
- Audit Logs: {enabled/disabled}

Files:
- Scope: {scope-file-paths-or-API}
- Output: output/engagements/pentests/{target}-{YYYY-MM}/

FLEXIBLE MODEL ESCALATION:
┌─────────────────────────────────────────────────────────────────┐
│ ULTRATHINK (Opus) - Invoke for:                                 │
│ • Designing comprehensive test plan from scope analysis         │
│ • Novel attack chain identification / complex exploit paths     │
│ • Strategic decisions on approach when multiple options exist   │
│ • Breaking through blockers (stuck? escalate to deep thinking)  │
├─────────────────────────────────────────────────────────────────┤
│ EXECUTION (Sonnet) - Default for:                               │
│ • Running test cases from approved plan                         │
│ • Known vulnerability patterns (OWASP, CWE)                     │
│ • Documentation and evidence collection                         │
│ • Report writing                                                │
├─────────────────────────────────────────────────────────────────┤
│ QA/INSIGHT (Grok) - Escalate for:                               │
│ • Second opinion when findings seem incomplete                  │
│ • Adversarial review of test coverage                           │
│ • "Why am I not finding anything?" analysis                     │
│ • Reasoning traces on complex technical decisions               │
├─────────────────────────────────────────────────────────────────┤
│ RESEARCH (Perplexity) - Use for:                                │
│ • OSINT / target intelligence gathering                         │
│ • Technology stack research with citations                      │
├─────────────────────────────────────────────────────────────────┤
│ VALIDATION (Haiku) - Use for:                                   │
│ • Scope compliance checks                                       │
│ • Checklist verification                                        │
│ • Quick format/structure validation                             │
└─────────────────────────────────────────────────────────────────┘

Instructions:
{mode-specific instructions}

Execute security-testing SKILL.md {mode} workflow.
`
})
```

**Agent loads:**
1. `agents/security.md` (via PreToolUse hook)
2. `skills/security-testing/SKILL.md` (via load-agent-skill-context hook)
3. Tools referenced in skill workflows (via tool awareness system)

---

## Output Structure

**Director/Mentor:**
```
output/engagements/pentests/{target}-{YYYY-MM}/
├── SCOPE.md
├── 01-scope-and-reconnaissance/
│   ├── api/ (HackerOne data if applicable)
│   ├── subdomain-enum.txt
│   ├── port-scan-results.txt
│   └── technology-stack.md
├── 02-vulnerability-scanning/
│   ├── nuclei-output.txt
│   ├── findings-summary.md
├── 03-exploitation/
│   ├── exploit-attempts.md
│   └── proof-of-concept/
├── 04-reporting/
│   ├── executive-summary.md
│   ├── technical-findings.md
│   └── final-report.pdf
├── audit-logs/ (if enabled)
└── session-state.md
```

**Demo:**
```
output/engagements/pentests/{target}-demo-{YYYY-MM}/
├── demo-validation.md
├── tool-connectivity.txt
└── target-responsiveness.txt
```

---

## Examples

### HackerOne Bug Bounty (Director)

```
/pentest
→ Mode: Director
→ Target: HackerOne (crypto)
→ Scope: Both (API + Files)
→ Audit: Enabled

Result: Full pentest, deliverables in pentests/crypto-2025-12/
```

### Quick Validation (Demo)

```
/pentest
→ Mode: Demo
→ Target: Safe (scanme.nmap.org)

Result: Quick validation (~3 min), confirms tool connectivity
```

---

## Related Commands

- `/vuln-scan` - Automated scanning without full pentest
- `/segmentation-test` - Network segmentation validation
- Writer skill handles report generation
- `/threat-intel` - Map findings to MITRE ATT&CK

---

## Security

**Data Privacy:**
- No scope data sent externally (except HackerOne API if selected)
- Outputs stored locally
- API credentials in .env (gitignored)
- Evidence remains local

**Authorization:**
- Custom targets require explicit authorization
- SCOPE.md validated
- Out-of-scope assets excluded
- Safe targets inherently authorized

**Execution Safety:**
- Demo uses safe targets only
- Exploitation logged for audit
- Rate limits respected
- No destructive actions without confirmation

**Legal Compliance:**
- Written authorization required (custom)
- CFAA compliance enforced
- Responsible disclosure followed
- Bug bounty rules respected

---

**Version:** 1.0
**Last Updated:** 2025-12-12
**Framework:** Intelligence Adjacent (IA)

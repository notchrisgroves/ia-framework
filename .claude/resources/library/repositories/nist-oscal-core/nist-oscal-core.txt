Directory structure:
└── usnistgov-oscal/
    ├── README.md
    ├── CODE_OF_CONDUCT.md
    ├── CONTRIBUTING.md
    ├── LICENSE.md
    ├── README_validations.md
    ├── USERS.md
    ├── versioning-and-branching.md
    ├── decisions/
    │   ├── 0001-record-architecture-decisions.md
    │   ├── 0002-communicating-nist-oscal-events-to-the-public.md
    │   ├── 0003-github-labels-decluttering.md
    │   ├── 0004-issue-triage.md
    │   ├── 0005-repository-reorganization.md
    │   ├── 0006-source-metaschema-xxes.md
    │   ├── 0007-implementation-agnostic-tests.md
    │   ├── 0008-oscal-content-management.md
    │   ├── 0009-tutorials-system-lifecycle.md
    │   └── adr_template.md
    ├── src/
    │   ├── file-naming-conventions.md
    │   ├── metaschema/
    │   │   ├── readme.md
    │   │   ├── doc-identity-notes.md
    │   │   ├── metaschema-author.css
    │   │   ├── metaschema-browser.xsl
    │   │   ├── oscal_assessment-common_metaschema.xml
    │   │   ├── oscal_assessment-plan_metaschema.xml
    │   │   ├── oscal_assessment-results_metaschema.xml
    │   │   ├── oscal_catalog_metaschema.xml
    │   │   ├── oscal_complete_metaschema.xml
    │   │   ├── oscal_component_metaschema.xml
    │   │   ├── oscal_control-common_metaschema.xml
    │   │   ├── oscal_implementation-common_metaschema.xml
    │   │   ├── oscal_metadata_metaschema.xml
    │   │   ├── oscal_poam_metaschema.xml
    │   │   ├── oscal_profile_metaschema.xml
    │   │   ├── oscal_ssp_metaschema.xml
    │   │   └── shared-constraints/
    │   │       ├── allowed-values-component-type.ent
    │   │       ├── allowed-values-component_component_link-rel.ent
    │   │       ├── allowed-values-component_component_property-name.ent
    │   │       ├── allowed-values-component_component_service.ent
    │   │       ├── allowed-values-component_component_software.ent
    │   │       ├── allowed-values-component_inventory-item_property-name.ent
    │   │       ├── allowed-values-control-group-property-name.ent
    │   │       ├── allowed-values-property-name-asset-type-values.ent
    │   │       ├── allowed-values-responsible-roles-component-production.ent
    │   │       ├── allowed-values-responsible-roles-operations.ent
    │   │       └── allowed-values-responsible-roles-system.ent
    │   ├── release/
    │   │   ├── release-notes.md
    │   │   ├── release-readme.txt
    │   │   └── content-upgrade/
    │   │       ├── README.md
    │   │       ├── add-uuids.xsl
    │   │       ├── catalog-link-tweak.xsl
    │   │       ├── json-prop-to-props.xsl
    │   │       ├── oscal-m1-m2-update.xsl
    │   │       ├── oscal-m2-m3-elements.xsl
    │   │       ├── oscal-m2-m3-UPDATE-with-uuids.xsl
    │   │       ├── oscal-m2-m3-update.xpl
    │   │       ├── oscal-m3-rc1-elements.xsl
    │   │       ├── oscal-rc1-rc2-update.xsl
    │   │       ├── oscal-rc2-v1-0-0-update.xsl
    │   │       ├── oscal-uuid-assign.xpl
    │   │       ├── refresh-uuid.xsl
    │   │       ├── rewrite-links.xsl
    │   │       └── uuid/
    │   │           ├── random-util.xsl
    │   │           ├── reassign-uuids.xsl
    │   │           └── refresh-uuids.xsl
    │   ├── specifications/
    │   │   └── profile-resolution/
    │   │       ├── readme.md
    │   │       ├── example-checkup.sch
    │   │       ├── example-set.xspec
    │   │       ├── profile-resolution-queryset.xspec
    │   │       ├── profile-resolution-specml-files.xspec
    │   │       ├── profile-resolution-specml-requirements.xspec
    │   │       ├── profile-resolution-specml-working.xml
    │   │       ├── profile-resolution-specml.xml
    │   │       ├── profile-resolution-unit-tests.xml
    │   │       ├── requirement-tests.xspec
    │   │       ├── requirements-extract.xsl
    │   │       ├── resolution-testing.xml
    │   │       ├── spec-tester.py
    │   │       ├── spec-tests.json
    │   │       ├── unit-tests.xsd
    │   │       ├── lib/
    │   │       │   ├── build-examples-xspec.xsl
    │   │       │   ├── build-reqs-xspec.xsl
    │   │       │   ├── build-testharness.xsl
    │   │       │   ├── build-xspec.xsl
    │   │       │   ├── html-to-specml.xsl
    │   │       │   ├── illustrate-resolution.xsl
    │   │       │   ├── oscal-expected.sch
    │   │       │   ├── oscal-profile-test-helper.xsl
    │   │       │   ├── reqs-md-punchlist.xsl
    │   │       │   ├── spec-checkup.sch
    │   │       │   ├── specml-html-hugo-uswds.xsl
    │   │       │   ├── specml-html-preview.xsl
    │   │       │   ├── specml-html-static.xsl
    │   │       │   ├── specml-html-xslt1.xsl
    │   │       │   ├── specml-html-xslt3.xsl
    │   │       │   ├── specml-tidy-config.xml
    │   │       │   ├── specml-tidy.xsl
    │   │       │   ├── specml.css
    │   │       │   ├── specml.rnc
    │   │       │   ├── xspec-oxygen.css
    │   │       │   └── xspec-test-dev.sch
    │   │       ├── profile-resolution-examples/
    │   │       │   ├── assess-test-coverage.xsl
    │   │       │   ├── base-test_profile.xml
    │   │       │   ├── base2-test_profile.xml
    │   │       │   ├── broken_profile.xml
    │   │       │   ├── build-xspec.xsl
    │   │       │   ├── circular_profile.xml
    │   │       │   ├── example-set.xspec
    │   │       │   ├── exclude-call-test_profile.xml
    │   │       │   ├── full-set.xspec
    │   │       │   ├── full-test_profile.xml
    │   │       │   ├── home_profile.xml
    │   │       │   ├── import-twice_profile.xml
    │   │       │   ├── include-all-no-children-test_profile.xml
    │   │       │   ├── include-all-test_profile.xml
    │   │       │   ├── include-call-with-children-test_profile.xml
    │   │       │   ├── include-loose-param-test_profile.xml
    │   │       │   ├── include-match-test_profile.xml
    │   │       │   ├── merge-implicit-keep_profile.xml
    │   │       │   ├── merge-keep-resources_profile.xml
    │   │       │   ├── merge-keep_profile.xml
    │   │       │   ├── modify-adds_profile.xml
    │   │       │   ├── profile-element-usage-survey.html
    │   │       │   ├── scrub-testing.xspec
    │   │       │   ├── without-parent_profile.xml
    │   │       │   ├── catalogs/
    │   │       │   │   ├── abc-full_catalog.xml
    │   │       │   │   ├── abc-multiple-children_catalog.xml
    │   │       │   │   ├── abc-simple_catalog.xml
    │   │       │   │   └── xyz-tiny_catalog.xml
    │   │       │   └── output-expected/
    │   │       │       ├── base-test_profile_RESOLVED.xml
    │   │       │       ├── base2-test_profile_RESOLVED.xml
    │   │       │       ├── broken_profile_RESOLVED.xml
    │   │       │       ├── circular_profile_RESOLVED.xml
    │   │       │       ├── exclude-call-test_profile_RESOLVED.xml
    │   │       │       ├── full-test_profile_RESOLVED.xml
    │   │       │       ├── home_profile_RESOLVED.xml
    │   │       │       ├── import-twice_profile_RESOLVED.xml
    │   │       │       ├── include-all-no-children-test_profile_RESOLVED.xml
    │   │       │       ├── include-all-test_profile_RESOLVED.xml
    │   │       │       ├── include-call-with-children-test_profile_RESOLVED.xml
    │   │       │       ├── include-loose-param-test_profile_RESOLVED.xml
    │   │       │       ├── include-match-test_profile_RESOLVED.xml
    │   │       │       ├── merge-implicit-keep_profile_RESOLVED.xml
    │   │       │       ├── merge-keep-resources_profile_RESOLVED.xml
    │   │       │       ├── merge-keep_profile_RESOLVED.xml
    │   │       │       ├── modify-adds_profile_RESOLVED.xml
    │   │       │       └── without-parent_profile_RESOLVED.xml
    │   │       └── requirement-tests/
    │   │           ├── keep-everything-twice.xml
    │   │           ├── req-broken-import.xml
    │   │           ├── req-chained-all-asis.xml
    │   │           ├── req-chained-deepA.xml
    │   │           ├── req-circular_import.xml
    │   │           ├── req-circular_importer.xml
    │   │           ├── req-import-by-resource.xml
    │   │           ├── req-include-all-asis.xml
    │   │           ├── req-include-all-flat.xml
    │   │           ├── req-include-by-id.xml
    │   │           ├── req-include-by-match-empty.xml
    │   │           ├── req-include-by-match.xml
    │   │           ├── req-include-exclude1.xml
    │   │           ├── req-include-exclude2.xml
    │   │           ├── req-include-exclude3.xml
    │   │           ├── req-include-exclude4.xml
    │   │           ├── req-include-exclude5.xml
    │   │           ├── req-loose-params1.xml
    │   │           ├── req-loose-params2.xml
    │   │           ├── req-merge-keep1.xml
    │   │           ├── req-merge-keep2.xml
    │   │           ├── req-merge-usefirst1.xml
    │   │           ├── req-merge-usefirst2.xml
    │   │           ├── req-missing-resource.xml
    │   │           ├── req-modify-alter-remove-match1.xml
    │   │           ├── req-modify-alter-remove-match2.xml
    │   │           ├── req-spoofing-resource.xml
    │   │           ├── req-structure-asis1.xml
    │   │           ├── req-structure-asis2.xml
    │   │           ├── req-with-child-controls-no.xml
    │   │           ├── req-with-child-controls-none.xml
    │   │           ├── req-with-parent-controls-no1.xml
    │   │           ├── req-with-parent-controls-none.xml
    │   │           ├── req-with-parent-controls-yes1.xml
    │   │           ├── req-with-parent-controls-yes2.xml
    │   │           ├── spoofed-resource.xml
    │   │           ├── catalogs/
    │   │           │   ├── abc-crazy_catalog.xml
    │   │           │   ├── abc-full_catalog.xml
    │   │           │   ├── abc-mixed-up_catalog.xml
    │   │           │   ├── abc-simple_catalog.xml
    │   │           │   ├── busy_catalog.xml
    │   │           │   ├── loose-parameters.xml
    │   │           │   └── xyz-tiny_catalog.xml
    │   │           ├── illustrations/
    │   │           │   ├── req-include-all-asis-view.html
    │   │           │   └── req-include-by-id-view.html
    │   │           └── output-expected/
    │   │               ├── keep-everything-twice_RESOLVED.xml
    │   │               ├── req-chained-all-asis_RESOLVED.xml
    │   │               ├── req-chained-deepA_RESOLVED.xml
    │   │               ├── req-circular_import_RESOLVED.xml
    │   │               ├── req-import-by-resource_RESOLVED.xml
    │   │               ├── req-include-all-asis_RESOLVED.xml
    │   │               ├── req-include-all-flat_RESOLVED.xml
    │   │               ├── req-include-by-id_RESOLVED.xml
    │   │               ├── req-include-by-match-empty_RESOLVED.xml
    │   │               ├── req-include-by-match_RESOLVED.xml
    │   │               ├── req-include-exclude1_RESOLVED.xml
    │   │               ├── req-include-exclude2_RESOLVED.xml
    │   │               ├── req-include-exclude3_RESOLVED.xml
    │   │               ├── req-include-exclude4_RESOLVED.xml
    │   │               ├── req-include-exclude5_RESOLVED.xml
    │   │               ├── req-loose-params1_RESOLVED.xml
    │   │               ├── req-loose-params2_RESOLVED.xml
    │   │               ├── req-merge-usefirst1_RESOLVED.xml
    │   │               ├── req-merge-usefirst2_RESOLVED.xml
    │   │               ├── req-modify-alter-remove-match1_RESOLVED.xml
    │   │               ├── req-modify-alter-remove-match2_RESOLVED.xml
    │   │               ├── req-structure-asis1_RESOLVED.xml
    │   │               ├── req-structure-asis2_RESOLVED.xml
    │   │               ├── req-with-child-controls-no_RESOLVED.xml
    │   │               ├── req-with-child-controls-none_RESOLVED.xml
    │   │               ├── req-with-parent-controls-no1_RESOLVED.xml
    │   │               ├── req-with-parent-controls-none_RESOLVED.xml
    │   │               ├── req-with-parent-controls-yes1_RESOLVED.xml
    │   │               └── req-with-parent-controls-yes2_RESOLVED.xml
    │   └── utils/
    │       ├── readme.md
    │       ├── oscal-content-validator.py
    │       ├── requirements.txt
    │       ├── resolver-pipeline/
    │       │   ├── Makefile
    │       │   ├── message-handler.xsl
    │       │   ├── oscal-profile-resolve-finish.xsl
    │       │   ├── oscal-profile-resolve-functions.xsl
    │       │   ├── oscal-profile-resolve-merge.xsl
    │       │   ├── oscal-profile-resolve-metadata.xsl
    │       │   ├── oscal-profile-resolve-modify.xsl
    │       │   ├── oscal-profile-resolve-select.xsl
    │       │   ├── oscal-profile-resolve.sh
    │       │   ├── oscal-profile-RESOLVE.xsl
    │       │   ├── oscal-profile-test-helper.xsl
    │       │   ├── random-util.xsl
    │       │   ├── resolve-oscal-profile-debug.xpl
    │       │   ├── select-or-custom-merge.xsl
    │       │   ├── test-tweak.xsl
    │       │   ├── TESTING.md
    │       │   ├── uuid-method-choice.xsl
    │       │   ├── version-util.xsl
    │       │   └── testing/
    │       │       ├── pathological-profile.xml
    │       │       ├── test.sh
    │       │       ├── working-catalog.xml
    │       │       ├── 1_selected/
    │       │       │   ├── catalog-no-uuid.xml
    │       │       │   ├── catalog-nonstandard-file-name-ext.xmlcat
    │       │       │   ├── glob-rewrite.xspec
    │       │       │   ├── resource-media-type.xml
    │       │       │   ├── resource-multiple-rlinks.xml
    │       │       │   ├── select-mapping-controls.xspec
    │       │       │   ├── select-rlink.xspec
    │       │       │   └── select.xspec
    │       │       ├── 2_metadata/
    │       │       │   ├── metadata.xspec
    │       │       │   ├── random-util.xspec
    │       │       │   ├── uuid-method-choice.xspec
    │       │       │   ├── uuid-value.txt
    │       │       │   └── version-util.xspec
    │       │       ├── 3_merged/
    │       │       │   ├── merge-as-is.xspec
    │       │       │   ├── merge-combine.xspec
    │       │       │   ├── merge-custom.xspec
    │       │       │   └── merge.xspec
    │       │       ├── 4_modified/
    │       │       │   └── modify.xspec
    │       │       └── 5_finished/
    │       │           └── finish.xspec
    │       └── schematron/
    │           ├── readme.md
    │           ├── catalog.xml
    │           ├── oscal-profile.sch
    │           └── test-profile.xml
    └── .github/
        ├── ABOUT.md
        ├── CODEOWNERS
        ├── dependabot.yml
        ├── issue_template.md
        ├── PULL_REQUEST_TEMPLATE.md
        ├── ISSUE_TEMPLATE/
        │   ├── README.md
        │   ├── bug_report.yaml
        │   ├── feature_request.yaml
        │   └── question.yaml
        └── workflows/
            ├── issue-triage.yml
            ├── periodic.yml
            ├── release.yml
            └── status.yml

================================================
FILE: README.md
================================================
Error reading file with 'cp1252': 'charmap' codec can't decode byte 0x9d in position 4044: character maps to <undefined>


================================================
FILE: CODE_OF_CONDUCT.md
================================================
# Contributor Covenant Code of Conduct

## Our Pledge

In the interest of fostering an open and welcoming environment, we as contributors and maintainers pledge to making participation in our project and our community a harassment-free experience for everyone, regardless of age, body size, disability, ethnicity, gender identity and expression, level of experience, nationality, personal appearance, race, religion, or sexual identity and orientation.

## Our Standards

Examples of behavior that contributes to creating a positive environment include:

* Using welcoming and inclusive language
* Being respectful of differing viewpoints and experiences
* Gracefully accepting constructive criticism
* Focusing on what is best for the community
* Showing empathy towards other community members

Examples of unacceptable behavior by participants include:

* The use of sexualized language or imagery and unwelcome sexual attention or advances
* Trolling, insulting/derogatory comments, and personal or political attacks
* Public or private harassment
* Publishing others' private information, such as a physical or electronic address, without explicit permission
* Other conduct which could reasonably be considered inappropriate in a professional setting

## Our Responsibilities

Project maintainers are responsible for clarifying the standards of acceptable behavior and are expected to take appropriate and fair corrective action in response to any instances of unacceptable behavior.

Project maintainers have the right and responsibility to remove, edit, or reject comments, commits, code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, or to ban temporarily or permanently any contributor for other behaviors that they deem inappropriate, threatening, offensive, or harmful.

## Scope

This Code of Conduct applies both within project spaces and in public spaces when an individual is representing the project or its community. Examples of representing a project or community include using an official project e-mail address, posting via an official social media account, or acting as an appointed representative at an online or offline event. Representation of a project may be further defined and clarified by project maintainers.

## Enforcement

Instances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting the project team at oscal@nist.gov. The project team will review and investigate all complaints, and will respond in a way that it deems appropriate to the circumstances. The project team is obligated to maintain confidentiality with regard to the reporter of an incident. Further details of specific enforcement policies may be posted separately.

Project maintainers who do not follow or enforce the Code of Conduct in good faith may face temporary or permanent repercussions as determined by other members of the project's leadership.

## Attribution

This Code of Conduct is adapted from the [Contributor Covenant][homepage], version 1.4, available at [http://contributor-covenant.org/version/1/4][version]

[homepage]: http://contributor-covenant.org
[version]: http://contributor-covenant.org/version/1/4/



================================================
FILE: CONTRIBUTING.md
================================================

- [Overview](#overview)
  - [Project approach](#project-approach)
  - [Contribution options](#contribution-options)
  - [Issue reporting, triage, and handling](#issue-reporting-triage-and-handling)
  - [Communications mechanisms](#communications-mechanisms)
- [Contributing to the repository](#contributing-to-the-repository)
  - [Repository structure](#repository-structure)
- [Contributing to a Development Sprint](#contributing-to-a-development-sprint)
  - [User Stories](#user-stories)
  - [Issue Status](#issue-status)
  - [Reporting Issue Progress](#reporting-issue-progress)
- [Git Repo Checkout](#git-repo-checkout)
  - [Initializing Git submodules](#initializing-git-submodules)
  - [Configuring Submodules to Use SSH](#configuring-submodules-to-use-ssh)
  - [Updating submodules](#updating-submodules)
- [Licenses and attribution](#licenses-and-attribution)
  - [This project is in the public domain](#this-project-is-in-the-public-domain)
  - [Contributions will be released into the public domain](#contributions-will-be-released-into-the-public-domain)

# Overview

This page is for potential contributors to the OSCAL project. It provides basic information on the OSCAL project, describes the main ways people can make contributions, explains how to report issues with OSCAL, and lists pointers to additional sources of information.


## Project approach

The approach weâ€™re taking with OSCAL is agile. Weâ€™re adopting the philosophy of implementing the 20% of the functionality that solves 80% of the problem. Weâ€™re trying to focus on the core capabilities that are needed to provide the greatest amount of benefit. Because weâ€™re working on a small set of capabilities, that allows us to make very fast progress. Weâ€™re building the features that we believe solve the biggest problems, so weâ€™re providing the most value.

We track our current work items using GitHub [project cards](https://github.com/orgs/usnistgov/projects/25). The active project is typically the lowest numbered open project within the previously referenced page.

## Contribution options

The OSCAL project is producing several types of deliverables, organized into several GitHub repositories as explained [in the project page](https://pages.nist.gov/OSCAL/about/projects/).

Contributions are welcome in any of the project's repositories. For information on the project's current needs and priorities, see the project's GitHub issue tracker (discussed below). Please refer to the [guide on how to contribute to open source](https://opensource.guide/how-to-contribute/) for general information on contributing to an open source project.

## Issue reporting, triage, and handling

All requests for changes and enhancements to OSCAL are initiated through the project's [GitHub issue tracker](../../issues). To initiate a request, please [create a new issue](https://help.github.com/articles/creating-an-issue/). The following issue templates exist for creating a new issue:
* [User Story](../../issues/new?template=feature_request.md&labels=enhancement%2C+User+Story): Use to describe a new feature or capability to be added to OSCAL.
* [Defect Report](../../issues/new?template=bug_report.md&labels=bug): Use to report a problem with an existing OSCAL feature or capability.
* [Question](../../issues/new?labels=question&template=question.md): Use to ask a question about OSCAL.

The core OSCAL project team regularly reviews open issues, prioritizes their handling, and updates the issue statuses and comments as needed.

## Communications mechanisms

There are two mailing lists for the project:

- *oscal-dev@nist.gov* for communication among parties interested in contributing to the development of OSCAL or exchanging ideas. Subscribe by sending an email to [oscal-dev+subscribe@list.nist.gov](mailto:oscal-dev+subscribe@list.nist.gov). To unsubscribe send an email to [oscal-dev+unsubscribe@list.nist.gov](mailto:oscal-dev+unsubscribe@list.nist.gov).
- *oscal-updates@list.nist.gov* for low-frequency updates on the status of the OSCAL project. Subscribe by sending an email to [oscal-updates+subscribe@list.nist.gov](mailto:oscal-updates+subscribe@list.nist.gov). To unsubscribe send an email to [oscal-updates+unsubscribe@list.nist.gov](mailto:oscal-updates+unsubscribe@list.nist.gov).

# Contributing to the repository

Contributions can be made to the following branches in this repository:

- **release-\***: The release branches are used to provide patches to a major or minor version of OSCAL. The branches are named release-*major*.*minor*. You should provide changes only to the highest numbered *minor* release for a given *major* release. Patch releases are made more frequently than *major* or *minor* releases.
- **develop**: This branch is used to queue changes for the next *major*/*minor* release of OSCAL. A *major*/*minor* release will result in the creation of a new release branch, once the development has been completed and the update is to be staged for release.

More information about how [releases](../../releases) are managed in this repository can be found in the [versioning and branching guide](versioning-and-branching.md).

The OSCAL project uses a typical GitHub fork and pull request [workflow](https://guides.github.com/introduction/flow/). To establish a development environment for contributing to the OSCAL project, you must do the following:

1. Fork the OSCAL repository to your personal workspace. Please refer to the Github [guide on forking a repository](https://help.github.com/articles/fork-a-repo/) for more details.
1. Create a feature branch from the main branch for making changes. You can [create a branch in your personal repository](https://help.github.com/articles/creating-and-deleting-branches-within-your-repository/) directly on GitHub or create the branch using a Git client. For example, the ```git branch working``` command can be used to create a branch named *working*.
1. You will need to make your modifications by adding, removing, and changing the content in the branch, then staging your changes using the ```git add``` and ```git rm``` commands.
1. Once you have staged your changes, you will need to commit them. When committing, you will need to include a commit message. The commit message should describe the nature of your changes (e.g., added new feature X which supports Y). You can also reference an issue from the OSCAL repository by using the hash symbol. For example, to reference issue #34, you would include the text "#34". The full command would be: ```git commit -m "added new feature X which supports Y addressing issue #34"```.
1. Next, you must push your changes to your personal fork repo if you are individual community contributor, or optionally from this repository directly if you are a NIST OSCAL Team member. You can do this with the command: ```git push```.
1. Finally, you can [create a pull request](https://help.github.com/articles/creating-a-pull-request-from-a-fork/).
    - Please allow the NIST OSCAL maintainers to make changes to your pull request, to efficiently merge it, by selecting on your fork the setting to [always allow edits from the maintainers](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/working-with-forks/allowing-changes-to-a-pull-request-branch-created-from-a-fork).
    - Review [the OSCAL release and versioning strategy](./versioning-and-branching.md) and [choose the base branch](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/changing-the-base-branch-of-a-pull-request) accordingly. Normally, you should target the `develop` branch or a `release-x.y` as the base branch unless asked to use a different branch. Please select the appropriate branch before requesting a review from a maintainer so delays in approving your pull request are avoided.

## Repository structure

This repository consists of the following directories and files pertaining to the OSCAL project:

- [.github](.github): Contains GitHub issue and pull request templates for the OSCAL project.
- [build](build): Contains a collection of scripts, eXtensible Stylesheet Language Transformations (XSLTs), and other artifacts used to support this repository's continuous integration and continuous deployment (CI/CD) processes.
- [src](src): This includes the resources used by the NIST OSCAL Team to manage OSCAL development, including the metaschema files used to maintain the OSCAL models across all supported formats. This directory once stored source artifacts used to produce the XML, JSON, and YAML resources that were provided in this repository. These resources have been moved to the OSCAL content GitHub [repository](https://github.com/usnistgov/oscal-content/tree/main/src).
- [CODE_OF_CONDUCT.md](CODE_OF_CONDUCT.md): This file contains a code of conduct for OSCAL project contributors.
- [CONTRIBUTING.md](CONTRIBUTING.md): This file is for potential contributors to the OSCAL project. It provides basic information on the OSCAL project, describes the main ways people can make contributions, explains how to report issues with OSCAL, and lists pointers to additional sources of information. It also has instructions on establishing a development environment for contributing to the OSCAL project and using GitHub project cards to track development sprints.
- [LICENSE.md](LICENSE.md): This file contains license and copyright information for the files in the OSCAL GitHub repository.
- [USERS.md](USERS.md): This file explains which types of users are most likely to benefit from consuming available OSCAL tools and content.


# Contributing to a Development Sprint

The NIST OSCAL team is using the GitHub [project cards](https://github.com/orgs/usnistgov/projects/25) feature to track development sprints as part of the core OSCAL work stream. A typical development sprint lasts roughly a month, with some sprints lasting slightly less or more to work around major holidays or events attended by the core project team. The active sprint is typically the lowest numbered open project within the previously referenced page.

## User Stories

Each development sprint consists of a set of [user stories](../../issues?q=is%3Aopen+is%3Aissue+label%3A%22User+Story%22), that represent features, actions, or enhancements that are intended to be developed during the sprint. Each user story is based on a [template](../../issues/new?labels=User+Story%2C+enhancement&template=feature_request.md) and describes the basic problem or need to be addressed, a set of detailed goals to accomplish, any dependencies that must be addressed to start or complete the user story, and the criteria for acceptance of the contribution.

The goals in a user story will be bulleted, indicating that each goal can be worked on in parallel, or numbered, indicating that each goal must be worked on sequentially. Each goal will be assigned to one or more individuals to accomplish.

Note: A user story that is not part of a specific development sprint can still be worked on at any time by any OSCAL contributor. When a user story is not assigned to sprint, its status will not be tracked as part of our sprint management efforts, but when completed will still be considered as a possible contribution to the OSCAL project.

## Issue Status

The project cards for each sprint will be in one of the following states:

- "To do" - The user story has been assigned to the sprint, but work has not started.
- "In progress" - Work has started on the user story, but development of the issue has not completed.
- "Review in Progress" - All goals for the user story have been completed and one or more pull requests have been submitted for all associated work. The NIST team will review the pull requests to ensure that all goals and acceptance criteria have been met.
- "Reviewer Approved" - The reviewers have confirmed that all goals and acceptance criteria have been met.
- "Done" - Once the contributed work has been reviewed and the pull request has been merged, the user story will be marked as "Done".

Note: One or more pull requests must be submitted addressing all goals before an issue will be moved to the "Review in Progress" status. If any goals or acceptance criteria have not been met, then feedback will be provided as comments in the user story and the issue will be returned to the "In progress" state.

## Reporting Issue Progress

A primary goal for this repository is to be transparent in the development work we do. Providing regular updates on issue progress is important in achieving this goal. Each OSCAL contributor needs to provide periodic status updates on issues for which they have made progress on. This status will be reported as a comment to the associated issue. For a user story that is part of an OSCAL development sprint, status reports will typically be made before the close of business the day before the weekly OSCAL status meeting (typically held on Thursdays).

When reporting status, it can be useful to identify any areas that are causing difficulties or if specific decisions needed to be made by one or more individuals. To identify a specific individual for action, use "\@*user*" to reference the individual who needs to respond to the issue. This will ensure that the individual is updated with this status.


# Git Repo Checkout

To clone this repository, use the following command:

```
git clone --recurse-submodules https://github.com/usnistgov/OSCAL.git
```

## Initializing Git submodules

This GitHub repository makes use of Git submodules to mount other repositories as subdirectories.

The command above handles initializing submodule as part of the clone. To do this separately when cloning this repo for the first time, you need to initialize the submodules that this repository depends on. To do this you must execute the following command:

```
git submodule update --init
```

## Configuring Submodules to Use SSH

Some clients will make use of Git over SSH with a private SSH key for GitHub projects. For convenience, the submodules are configured to use HTTP instead of SSH. To override this default behavior, you will need to configure your Git client to use SSH instead of HTTP using the following command:

```
git config --global url."git@github.com:".insteadOf https://github.com/
```

This instructs your Git client to dynamically replace the HTTP-based URLs with the proper SSH URL when using GitHub.

## Updating submodules

Submodule contents will be periodically updated. To ensure you have the latest commits for a configured submodule, you will need to run the following command:

```
git submodule update --init --recursive
```

# Licenses and attribution

## This project is in the public domain

This project is in the worldwide public domain.

This project is in the public domain within the United States, and copyright and related rights in the work worldwide are waived through the [CC0 1.0 Universal public domain](https://creativecommons.org/publicdomain/zero/1.0/) dedication.

## Contributions will be released into the public domain

All contributions to this repository are provided under the [CC0 1.0 Universal public domain](https://creativecommons.org/publicdomain/zero/1.0/) dedication. By submitting a pull request, you are agreeing to comply with this waiver of copyright interest.



================================================
FILE: LICENSE.md
================================================
Error reading file with 'cp1252': 'charmap' codec can't decode byte 0x9d in position 1215: character maps to <undefined>


================================================
FILE: README_validations.md
================================================
# How to Validate OSCAL

## XML or JSON?

XML files use XML syntax: they are [*well-formed* by the rules of XML](https://pages.nist.gov/OSCAL/concepts/layer/validation/). If you can process your file using a conformant XML parser, the file is XML.

Well-formedness also applies to JSON and YAML and their respective parsers.

But *validating* goes beyond parsing: it tells you not only that a file can be read successfully, but also that its data structures conform to rules for a particular application of XML, JSON, or YAML. [Well-formed JSON, XML, or YAML is not necessarily valid OSCAL JSON, XML, or YAML](https://pages.nist.gov/OSCAL/concepts/layer/validation/).

If working with XML you will need an XML *schema* (or functional equivalent) to validate your OSCAL. If working with JSON or YAML, you will need a JSON schema. Normative schemas suitable for validating the various OSCAL models are [made available as part of a release](https://github.com/usnistgov/OSCAL/releases/latest/) and [can also be built locally](./build/README.md).

## What are the OSCAL models?

OSCAL comes in several different forms, with data models in JSON, XML, and YAML. Please review [this page with the status of all the models as organized into layers](https://pages.nist.gov/OSCAL/concepts/layer/#status-of-the-oscal-layers) for information about each model and the status of its respective schemas.

## OSCAL "complete" schema

Additionally, there are "complete" XML and JSON schemas, which can validate any kind of OSCAL. It is larger and more complex than the model-specific schemas and may not be as efficient, but it can be convenient to use one schema file as an entry point to validate one or more OSCAL documents without knowing the particular model in advance, whether it be a `component-definition`, `system-security-plan`, `assessment-plan`, et cetera.

## How do I apply a schema to a document to determine validity?

Schemas are built using standard schema languages that are supported by commodity tools. These tools can all apply the same schemas to the same documents, and give the same results.

For OSCAL XML, this schema syntax is [XML Schema Definition (XSD)](https://www.w3.org/TR/xmlschema-1/). For OSCAL JSON, the schema syntax is [JSON Schema](https://json-schema.org/). Many freely available, open-source, and commercial implementations are available. These schema standards are also built in to many common application frameworks and development environments.

Each tool will have its own way to provide for validation. Bindings or configurations to link documents to schemas can be maintained either inside or outside the documents themselves; many tools offer several ways to do this.

Some tools support self-contained validation functionality without full-fledged application frameworks or development environments, with tools like [`xmllint`](https://linux.die.net/man/1/xmllint/) offering command-line interfaces. Similarly, you can use the [`ajv-cli`](https://github.com/ajv-validator/ajv-cli) for JSON.

## What does success look like?

If you validate an OSCAL document with a local copy of a schema with `xmllint`, it will return results to the standard output (STDOUT) stream like so:

```
$ xmllint oscal.xml --schema oscal-schema.xsd --noout
oscal.xml validates
```

There is no detailed output, just a statement that indicates validation has been performed successfully.

If you remove the `--noout` flag from the command line, a copy of the input will be returned. This is because the utility is designed for a pipeline architecture, in which its outputs (written to `STDOUT`) can be provided as input to the next tool in the pipeline.

As for OSCAL JSON, the results from validation with AJV will look like this:

```
# Install the ajv-formats library in NodeJS runtime to avoid runtime errors.
npm install -g ajv-formats ajv-cli
ajv-cli validate -s oscal-schema.json -d oscal.json -c ajv-formats
oscal.json valid
```

## What does an error look like?

### Well-formed, but not valid
If your document is not valid, the results may look like this:

```
Element '{http://csrc.nist.gov/ns/oscal/1.0}last-modified': This element is not expected. Expected is ( {http://csrc.nist.gov/ns/oscal/1.0}title ).
test-invalid-profile.xml fails to validate
```

The important line here is the final one. However, there may be one or more messages preceding it, describing the finding of the parser that a validation rule has been violated.

### Not even well-formed

It can happen, however, that the file is not even legible to the processor ("parser"), because it is not well-formed to the syntax rules.

In such a case, XML Lint signals trouble like this:

```
test-invalid-profile.xml:10: parser error : Opening and ending tag mismatch: profile line 2 and metadata
  </metadata>
             ^
test-invalid-profile.xml:11: parser error : Extra content at the end of the document
  <merge>
  ^
```

In this case the processor reports the syntax issues it detects, to the extent possible, for a document that is not well-formed. The processor will be unable to complete validation of the document because it is not well-formed.

## What can you learn from errors?

A validation error tells you, first and foremost, that your file is incorrect in a basic way. For example, an element (data structure) may be out of place, or missing a required piece. Tools that fail to implement schema validation, misconfigured tools, data quality issues, workflow issues, or many other causes may be the cause. They also vary in how easy they are to correct. The most common problem is that the wrong schema is being used.

The most important consideration in correcting a validation error is selecting the appropriate schema and the appropriate version of that schema. OSCAL maintains backward compatibility across all schemas as expressed through [the use of semantic versioning](./versioning-and-branching.md).

A *well-formedness error*, however, tells you your file is incorrect in a more fundamental way. It is both more severe (further processing cannot continue) but also easier to address by using tools correctly. In a mature system, well-formedness errors should be rare, and when they do occur it is because preliminary checks for well-formedness were not implemented or ignored.

## How can I correct my errors?

End users will ordinarily find it easiest and best to edit a file in an OSCAL tool with a graphical user interface or a structured editor. These would be tools that are especially built or configured to support changing the file while respecting the rules of well-formedness and validating against the rules of an intended schema.

In order to build such tools and support other operations, developers may also do this work. Commercial off-the-shelf developer environments may support these basic operations for a range of formats.

Finally, XML and JSON are both based on the conventions of *plain-text* (UTF-8 in the case of JSON; any encoding your processor supports in the case of XML). As such, they can be edited in any text editor.

You should validate OSCAL documents saved to files to ensure it will work for the next operation.

## What does validation *not* tell me?

The rules expressed and enforced by a schema are limited to those that can be systematically checked by automated processes. Valid OSCAL documents are *not necessarily* "correct" with respect to the information they represent. For OSCAL, validation is an objective determination by a program, whereas "correct" remains a subjective determination based on analysis by a person. Validation ensures only that *your data is fit for further processing*; such processing can include operations to determine the data's correctness, completeness, adequacy, veracity, or anything else not defined or definable by a schema. 

## Other ways to validate?

The provided schemas are machine-generated and tested to reflect and enforce the rules of OSCAL, but they are not the only way to validate. Alternative schema technologies and schema "emulators" are conceivable and sometimes useful. Refer to the [the Metaschema repository](https://github.com/usnistgov/metaschema/) for more details on the Metaschema technology from which our schemas derive, and which can be used as a basis for alternative strategies and approaches to document validation.



================================================
FILE: USERS.md
================================================
# Documentation for users of OSCAL tools and content

The following types of users are most likely to benefit from consuming OSCAL tools and content when they are available:
 * *Operations personnel*, who will be able to rapidly verify that systems comply with organizational security requirements
 * *Security and privacy personnel*, who will be able to automatically identify problems and address them quickly before loss or damage occur; for example, a profile could be used to identify incorrect parameter values that are weakening security
 * *Auditors/assessors*, who will be able to perform audits/assessments on demand with minimal effort
 * *Policy personnel*, who will be able to better identify systemic problems that necessitate changes to organization security policy

At this time, we do not have information available on using OSCAL tools and content because the initial components of OSCAL are still under development and are not yet ready for operational use. As OSCAL development continues, we will add pointers here to examples of OSCAL content so you can get an idea for what operational OSCAL content will look like.



================================================
FILE: versioning-and-branching.md
================================================
# Versioning and Branching

This guide provides information on how [release versions](#versioning) and [branches](#branching) are handled in this repository.

- [Versioning and Branching](#versioning-and-branching)
  - [Versioning](#versioning)
  - [Branching](#branching)
  - [Git Setup](#git-setup)
- [Branching for contributors](#branching-for-contributors)
  - [Personal Working Branches](#personal-working-branches)
- [Branching for repository maintainers](#branching-for-repository-maintainers)
  - [Release Branches](#release-branches)
    - [Creating a Release Branch](#creating-a-release-branch)
    - [Releasing a Release Branch](#releasing-a-release-branch)
    - [Releasing a PATCH Revision](#releasing-a-patch-revision)
  - [Feature Branches](#feature-branches)
    - [Creating a Feature Branch](#creating-a-feature-branch)
    - [Syncing a Feature Branch with `develop`](#syncing-a-feature-branch-with-develop)
    - [Merging a Feature Branch](#merging-a-feature-branch)

## Versioning

This repository uses [semantic versioning](https://semver.org/spec/v2.0.0.html) to version [releases](../../releases).

Semantic versions are in the form of `MAJOR.MINOR.PATCH`. Given a version number, increment the:

1. MAJOR version when an incompatible model change is made,
1. MINOR version when a new optional feature is added in a backwards compatible manner, and
1. PATCH version when backwards compatible bug fixes are made.

An incompatible model change will occur when all content produced under a given MAJOR version is no longer schema valid with the new model.

A backwards compatible feature change can entail an addition to a model that adds a new construct, perhaps even deprecating an existing construct, but all previously created content is still schema valid with the new model.

Note: In rare cases, a PATCH release might contain an incompatible model change to correct a typographic error or to fix functionality that is inoperable due to a significant defect.

A PATCH release will be made more frequenly than *MAJOR* or *MINOR* releases.

## Branching

The main branches of this repository are:
- **[main](../../tree/main)** contains the current supported, production-ready release.
- **[develop](../../tree/develop)** contains the current set of development changes for the next release. New features can be [contributed](./CONTRIBUTING.md#contributing-to-the-repository) to this branch.
  - This branch is an integration branch where development code can be tested prior to promoting the code to a release.
  - This branch will be used to create a release-*major*.*minor* branch when the developed code is ready to be staged for release.
- **[nist-pages](../../tree/nist-pages)** contains the currently deployed website content, which is managed by the CI/CD process.
- **release-\*** branches, where `*` matches a MAJOR.MINOR version number, are used to support patch releases for a major or minor version of OSCAL. You should provide changes only to the highest numbered *minor* release for a given *major* release.

## Git Setup

To use this strategy, the following Git configuration is needed:

You must do all work in a personal fork of the OSCAL Git repository.

```
git remote add upstream git@github.com:usnistgov/OSCAL.git
```

# Branching for contributors

## Personal Working Branches

NIST OSCAL Team members can do work on branches in this repository or, if they so choose, do work in a fork like individual outside contributors.

All individual contributors that are not NIST OSCAL Team members will work in branches in a personal fork of this repository.

Personal branches should be named using the convention `<issue #>-brief-dashed-name`.

Once work is complete on a personal branch, the branch should be interactively rebased to tidy any commits. Then a PR should be opened against the target `feature-*` branch or the `develop` branch if the changes are to be included in the next release.

For more information on how to do this, please refer to [our contribution guide](./CONTRIBUTING.md#contributing-to-the-repository).

# Branching for repository maintainers

## Release Branches

A *release branch* is used to stage code in preparation of a new release. Refinements to code can be made in a release branch in preparation for a new release.

Release branches represent production-ready code that is near-ready for release.
- Branched off of `develop`.
- Must be merged back into `develop` as releases are made.
- Must be merged back into `main` to reflect the latest release
- Release branches will be named `release-MAJOR.MINOR`, e.g. release 1.0, release 1.1, release 2.0

### Creating a Release Branch

A release branch can be created by issuing the following Git commands:

```
git checkout -b release-1.2 develop
# TODO: need a method to bump version numbers in metaschemas and content
git commit -a -m "Bumped version number to 1.2"
git push --set-upstream upstream release-1.2
```

### Releasing a Release Branch

Once the release is ready, the release can be made using the following Git commands:

```
git checkout main
git merge --no-ff release-1.2
git tag -a v1.2.0
git push --follow-tags
```

### Releasing a PATCH Revision

Patch releases for a given MAJOR.MINOR version will be marked by annotated tags. This allows the same release branch to be used for multiple PATCH releases.

Once a patch release is ready, the release can be made using the following Git commands:

```
git checkout main
git merge --no-ff release-1.2
git tag -a v1.2.1
git push --follow-tags
```

## Feature Branches

A *feature branch* provides means to integrate a set of features that are a work in progress and the release target of a given set of features is unknown or unpredictable. Work on such a set of features can proceed independent of work targeted at the next release in `develop`.

Feature branches represent major development topics.
- Branched off of `develop`.
- Merged back into `develop` when the feature work is completed.
- Feature branches will be named `feature-*`, where the `*` is a brief dash-separated label describing the feature.

If multiple committers are working on a feature, then each committer must work in a personal branch and submit a PR to the feature branch when their work is complete.

### Creating a Feature Branch

A feature branch can be created by issuing the following Git command:

```
git checkout -b feature-NAME develop
git push --set-upstream upstream feature-NAME
```

where *feature-NAME* will follow the pattern `feature-*`.

### Syncing a Feature Branch with `develop`

It may be necessary to periodically sync a feature branch with the latest in `develop`. You can do this using the following Git commands:

```
# switch to the feature branch
git checkout feature-NAME
# get the latest from upstream
git pull --ff-only upstream feature-NAME
# get the latest from develop
git pull -r upstream develop
git push --force-with-lease upstream feature-NAME
```

### Merging a Feature Branch

The following Git commands will be used to merge a feature branch into `develop`:

```
# switch to the develop branch
git checkout develop
# merge the feature branch
git merge --no-ff feature-myfeature
# delete the feature branch once it is merged
git branch -d feature-myfeature
# push the branch to the upstream repository
git push upstream develop
```



================================================
FILE: decisions/0001-record-architecture-decisions.md
================================================
# 1. Record architecture decisions

Date: 2023-02-06

## Status

Approved

## Context

We need to record the architectural decisions made on this project.

We also need the ability to compare architecture decisions regarding OSCAL artifacts, supporting software, and website material (documentation and otherwise).

## Decision

We will use Architecture Decision Records, as described by Michael Nygard in his article ["Documenting Architecture Decisions"](http://thinkrelevance.com/blog/2011/11/15/documenting-architecture-decisions).

## Consequences

See Michael Nygard's article, linked above.



================================================
FILE: decisions/0002-communicating-nist-oscal-events-to-the-public.md
================================================
# 2. Communicating NIST's OSCAL Events to the Public

Date: 2023-02-03

## Status

Approved

## Context

The NIST OSCAL Team has necessary touchpoints with the community, among them structured and unstructured meetings with community stakeholders. Many of these meetings are events occuring at set frequencies, while others do not. In all cases, the community, past and present, has expressed the need for invitations to events that are easily accessible with the most current information possible.

## Decision

The NIST OSCAL Team will use [a public shared calendar from a service account in the Office 365 instance for NIST, as documented below](#service-account-with-published-nist-office-365-calendar). The team staff will add, change, and remove event invitations. Community members will have access to the .ics calendar invitation files in the web version. These .ics files are [iCalendar](https://en.wikipedia.org/wiki/ICalendar) files - a standard that many calendar clients support.

The NIST OSCAL Team will use the shared calendar to send invitations for public events only to [those subscribed to our mailing lists](https://pages.nist.gov/OSCAL/contact/#oscal-mailing-lists). We will not use it to send invitations to named individuals.

## Consequences

In the past, NIST staff have sent individual calendar invites from their individual accounts' calendars to specific individuals or the oscal-dev@list.nist.gov mailing list at large. Additionally, the team had published individual iCalendar (ICS) files for two of the long-standing public meetings. The latter had not been updated frequently and were out of sync until removed completely with [pull request usnistgov/OSCAL#1614](https://github.com/usnistgov/OSCAL/pull/1614). The former approach, although convenient, presents a few challenges.

1. It is difficult to quickly access one or more event invitations after they are sent.
1. Only one staff member in the team, the event's creator, can manage that event's invitation details, often when multiple staff are involved.
1. Community members often accept an invitation email via the mailing list once or several times, but not every time. They lose important updates to event details and contact us for clarification.

Therefore we need a solution that meets the following requirements for the use case of notifying community members to public meetings.

1. A system for all members of the NIST OSCAL Team to create
1. A system for all members of the NIST OSCAL Team to modify and remove existing event invitations
1. A system that allows any anonymous community member, without prior or ongoing authentication and authorization to a NIST-hosted service, to access event information
1. A system that has a standards conformant, or largely popular, calendar synchronization mechanism for authorized NIST staff and anonymous community members (iCalendar or otherwise)
1. Manage frequent changes to calendar events efficiently with short notice without waiting upon approval times by team, group, division, or lab leadership

With these high-level requirements in mind, we have several options.

## CMS for the NIST Computer Security Resource Center Website and Calendar

As part of a spike, we evaluated event management [via the content management system that published the csrc.nist.gov website, specifically the Events page](https://csrc.nist.gov/Events). Although this solution partially supports requirements 3 and 4, it does not completely support requirement 1 or 2 at all. The CMS has a permissions system that only works with one group within the respective division for those who manage the content. At this time, the NIST OSCAL Team is composed of staff from teams from two different group's in ITL's Computer Security Division, so requirements 1 and 2 are not easily achievable or unsupported based upon consultation with the web developers that maintain the system. Additionally per requirement 5, there will need to be approval for every change, imposing upon approvers for events where we have historically made frequent changes.

## NIST Main Website and the Public Events Calendar

As part of spike, we evaluated using the [CSRC CMS approach](#cms-for-the-nist-computer-security-resource-center-website-and-calendar) and selecting an option in the event creation to request it be added to [the agency-wide public calendar](https://www.nist.gov/news-events/events/calendar). This testing was very limited and had to be immediately deferred. During support consultantions with the web developers, we determined that is an integration between the CSRC CMS and a separate CMS for the [www.nist.gov website](https://www.nist.gov). We were unable to determine if the integration between the two is enabled in a test environment. As this option will publish to one location and not other, not being able to test this change causes indeterminate but high risk around requirements 1, 2, and 5.

## Sharepoint Group in NIST Office 365 Calendar

As part of this spike, we evaluated using a Sharepoint site and group for event management. We were unable to share a calendar, so this approach could not completely meet requirements 1, 2, 3, and 4.

## Service Account with Published NIST Office 365 Calendar

As part of the spike, we considered and evaluated the creation of a service account, [oscalevt@nist.gov](mailto:oscalevt@nist.gov), with permissions delegated to a private distribution group in NIST's directory containing all staff in the NIST OSCAL Team, and using a shared calendar published for anonymous access for event management. Upon testing, we confirmed that this solution best meets all three requirements.



================================================
FILE: decisions/0003-github-labels-decluttering.md
================================================
# 3. Use of Labels in OSCAL Project(s)

Date: 02/17/2023

## Status

Approved

## Context

We wish to improve communication within the team and among the community members. Labels we use in OSCAL repositories can be a part of the effort.  We have discussed a number of options around labels and we will use an ADR to capture and document our approach moving forward.

- Related to Issue [#1496](https://github.com/usnistgov/OSCAL/issues/1496)

## Decision

Existing labels were reviewed, a subset of labels is kept and new ones are defined.

The lists of labels that follow will use across OSCAL repositories.

#### General labels:

- breaking change
- community feedback needed
- developer experience
- discussion needed
- epic
- faq
- rfc
- scope: ci/cd
- scope: content
- scope: documentation
- scope: metaschema
- scope: modeling
- scope: tooling and APIs
- scope: website

#### Project-specific labels:

- model engineering
- research
- profile resolution

#### Default (GH) labels:

- bug
- duplicate
- enhancement
- help wanted
- invalid
- question
- wontfix

#### Technology-identifying labels: Used by the ```dependabot```

- dependencies
- docker
- github_actions
- java
- javascript
- go
- python
- ruby
- submodules


#### Labels to be sunset/removed

- Lunch with the Devs
- Model Review 

### Use of Labels on Issues

**Creation of Issues:**

1. When issues are created, labels will be assigned by the author.
2. When the issue is triaged, selected labels will be reviewed and adjusted as necessary, including the addition of any omitted labels.

**Consistency Across Projects**
Except for the _Project-specific labels_ all other labels shall be used per their description


## Consequences

- Too many labels, or labels that are inconsistently used, will cause confusion.
- Detail information capturing the spike that researched this ADR is available [here](https://hackmd.io/UrSjUKGiQRuiA2VJLG-Mpg)



================================================
FILE: decisions/0004-issue-triage.md
================================================
# 4. Issue Triage for OSCAL Core Projects

Date: 2023/03/03

## Status

Approved

## Context

The NIST OSCAL Team must plan work to add, change, or remove code in project repositories. We document these plans in GitHub issues, and implement the changes as specified in these issues with pull requests. Some of these issues are decided internally by the NIST OSCAL Team, others are requested by external community members. In the past and present, many issues, especially requests from external community members, are created and do not receive timely feedback. Initially or over time, it is not clear when NIST staff have officially received a request, intend to accept the work recommendation or reject it, and an approximate time window for when that work should start.

In response to this, the former technical director and a subset of the team were involved in issue triage informally. Those team members [implemented some automation to process incoming requests](https://github.com/usnistgov/OSCAL/blob/60918cd3fc5508b69b71e8691b071108dab46ec9/.github/workflows/issue-triage.yml) and assist with ongoing triage by adding them to ["Needs Triage" in the NIST OSCAL Work Board](https://github.com/orgs/usnistgov/projects/25). Subsequently, the team migrated sprint and overall backlog tracking from one version of project boards in GitHub, both the Issue Triage board and other uses in OSCAL-related projects, to [This newer cross-repository project board with other usability enhancements](https://github.com/orgs/usnistgov/projects/25/). The consequence of this change was the issue triage board, and process more generally, became more and more disjointed from the more recent process and tooling for planning work through issue management.

The NIST OSCAL Team potentially needs a more transparent (to NIST staff and the community) and resilient issue triage process, with larger team involvement, and supporting tooling to align with cross-repository project board they are to use day to day.

## Decision

The NIST OSCAL Team should perform periodic backlog refinement and integrate issue triage as part of the process to formally accept or reject work for inclusion into the backlog. To act upon this decision, the team would need to complete the following steps of a plan.

1. Document the backlog process (as minimally and clearly as possible).
1. Adjust the supporting automation to automate issues to go to [the project board](https://github.com/orgs/usnistgov/projects/25) with a triage status.
1. Decommission the old issue triage board.
1. Schedule and initiate periodic backlog refinement with the team, asynchronously or synchronolously in private meetings (to start).

## Consequences

There are several approaches based upon the current state, each with their own consequences.

### Do Nothing

If the team operates as-is, the current process and supporting issue triage board will remain disjointed. Triage meetings have not resumed, but as it stands, the number of team members involved will decrease. The whole team's awareness of issues and their prioritization will be limited and not increase. Leaving the majority of the team outside the triage process gives them time to focus on development work, but not understand the immediate or long-term context of development tasks planned.

This approach is high risk.

### End All Issue Triage

The team has currently operated for about one month without any triage process, and the current technical director performing ad hoc issue triage and backlog prioritization as time permits. The technical director can choose to disable or remove the supporting GitHub Actions automation and the board. This approach simplifies prioritization for the technical director, but at the expense of the team not understanding short, medium, and long-term context of development. Additionally, the technical directory becomes the singular bottleneck for prioritization efforts and singularly managing all context about the present and future of development work as expressed in the board.

This approach is highest risk.

### Include the Whole Team and Update Tooling

The team can be more involved in issue triage as part of [a backlog refinement process](https://www.scrum.org/resources/blog/product-backlog-refinement-explained-13). Currently, the team does not engage in periodic, formalized backlog refinement either. Moving forward, issue triage can be considered the first step to formally adding an issue or rejecting it by closing the issue. If done frequently, issue triage would only be needed periodically for new issues. If there were no new issues queued for triage between refinement sessions, the team could primarily focus on backlog refinement for the next sprint and following sprints.

From a tooling perspective, whereas the newer GitHub Projects service did not have API support for complex operations and GitHub Actions did not readily exist during the migration to the new project board, these conditions are no longer the case.

Therefore issue triage process can be formalized as part of backlog refinement, scheduled periodically for some or all team members to be involved for sufficient context. Automation can be updated to have all work requests in issues be tracked in one location, not four or more.

This effort will require a spike and some development work, but this approach is low risk in relation to the alternative approaches mentioned above.



================================================
FILE: decisions/0005-repository-reorganization.md
================================================

# Reorganization of Project Repositories and Workflows

Date: 2023/07/06

## Status

Approved

## Context

In the current sprint it was decided to attempt a rapid prototype of a work-stream-oriented approach to the repositories, compartmentalization and simplification of the CI workflows, and where possible, reducing barriers to participation in different aspects of OSCAL growth and development.

The majority of this work occurred in [OSCAL #1802](https://github.com/usnistgov/OSCAL/issues/1802).

## Decision

This is an outline of what was implemented:

---

### Public OSCAL Website

The public website will be managed in the [OSCAL-Pages Repository](https://github.com/usnistgov/OSCAL-Pages).  This portion of the website is built using Hugo and the USWDS styling.

#### Content for OSCAL repository:

In order to preserve the existing `pages.nist.gov/OSCAL` link, OSCAL-Pages will generate the website, and then publish to the OSCAL project in the `nist-pages` branch so that it will properly publish to the NIST required approach for deploying pages content.

```mermaid
graph TD;
    Init[Content Change]:::notification==>|commit| A;
    A[OSCAL-Pages]:::repo---B;
    B[/branch: main/]:::branch==>|triggers| C;
    C[[Workflow: workflow-generate-website]]:::action==>|pushes| D;
    D[OSCAL]:::repo---E;
    E[/branch: nist-pages/]:::branch==>|deploys| Z;
    Z[OSCAL Website]:::data;

    classDef repo fill:#B9E0A5,stroke:#006600,stroke-width:4,color:#000000
    classDef branch fill:#FFCE9F,stroke:#FF8000,stroke-width:4,color:#000000
    classDef action fill:#b0e3e6,stroke:#0e8088,stroke-width:4,color:#000000
    classDef notification fill:#fad9d5,stroke:#ae4132,stroke-width:4,color:#990000
    classDef data fill:#E6E6E6,stroke:#999999,stroke-width:4,color:#000000
```

#### Content in OSCAL-Pages repository:

A `published-pages` branch will also exist in OSCAL-Pages that contains the latest deployed content that is sent to the OSCAL repository.  Additionally, there is a `nist-pages` branch in the OSCAL-Pages project that contains a blank page.  This branch could be used to test a deployment of the website at `pages.nist.gov/OSCAL-Pages`, but it is important to be aware that this site could be indexed by search engines and cause confusion, as well as broken links.

---

### Public OSCAL Reference

```mermaid
graph LR;
    A[OSCAL Website]:::repo;
    B[OSCAL Reference]:::repo;

    A==>B;

    classDef repo fill:#B9E0A5,stroke:#006600,stroke-width:4,color:#000000
```

The reference portion of the OSCAL Website will move into an independent [OSCAL-Reference Repository](https://github.com/usnistgov/OSCAL-Reference).  This repository will be more complex than the basic HTML content of the OSCAL website since it generates the documentation from the OSCAL metaschema content.  Due to this complexity, and the potential of future expansion and capabilities in the developer-focused documentation, this was separated, and will be linked into the main OSCAL website.

Each tagged version of OSCAL will be published through CI.

#### Streamlined Build Process

The new reference repository operates off of one GitHub Actions Workflow that produces the documentation from `metaschema` and uses `Hugo` to publish the website. All of the scripted aspects of the model interpretation are executed using `make`, and the `Makefile` is located in the root of the repository.

`OSCAL` and `metaschema-xslt` are submodules of this repository.

---

### OSCAL GitHub Project

The most significant changes to the repositories are in the OSCAL repository. 

1. All web content and related workflows have been removed.
2. The schemas and converters that are built and committed back to the OSCAL repository have been removed and are no longer set to auto-commit.
   1. The artifact from the build is still produced and will be a part of the release.
   2. The artifact could be deployed to the reference site if the desire is to have a web accessible publication.

This does have consequences, and those are discussed below.  The benefits are that the repository is very lean and primarily contains the metaschema content and scripts to build OSCAL, as well as decision records.  This will allow developers to watch the repository with activity focused on OSCAL itself.

This also allows for separate, asyncronous streams of work across the website/education, reference content and production of OSCAL models.  It also provides more opportunity for community participation at differing levels such as web content production, model development, and improved developer documentation.


## Consequences

There are a few breaking changes to our processes:

1. We will separate one large repository into three distinct repositories.
   - Links to any content that is moved will break.
   
2. We remove the schemas and converters from the repository.  
   - Similarly to #1, this will break any links directly to this content.



## Release Approach

The current rapid prototype exists without breaking existing repositories, workflows or processes.  To cut over to the new approach, the following will need to occur:

- Website
  - The OSCAL-Reference website will need to be deployed from `main`.
  - The OSCAL-Pages website will require an update to the workflow so that it publishes to `nist-pages` branch in the OSCAL repository, rather than the `next-pages` branch.
  - Verify that the following are up to date and accessible:
      - https://pages.nist.gov/OSCAL-Reference
      - https://pages.nist.gov/OSCAL
  - Note the latest update date in the footer of each site.
      - Both should have a date that is on or after July 5, 2023.

- OSCAL
    - We should notify the public of the pending release, and the changes noted in this ADR.
        - For developers (and products) that link directly to content in the OSCAL repository, they may update their links to point to tagged releases, rather than using source files in the main branch.  Future dependencies linking directly to source code in the OSCAL repository, particularly `main`, should be discouraged since this could impact the ability of the development team to improve source code as necessary to build OSCAL.
        - Future links to schemas and converters should use release assets (see [v1.0.6](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.6) for an example of assets). We currently produce zip archives as a part of releases.  We intend to also include the schemas and converters directly in the release assets without having to extract from the zip file.  **This will be implemented in a future sprint.**
    - The release documentation should be updated to align with the changes to this branch.
    - All `Website` steps must be completed.
    - The `feature-1802-oscal-pages` branch will need to be merged to main in `OSCAL.`
    - The updated release documentation should be followed to produce a release.
    - The contents of the schemas and converters should be compared to the previous release to ensure valid output with no unexpected changes.
    



================================================
FILE: decisions/0006-source-metaschema-xxes.md
================================================
# Production of transformed source Metaschema modules without external entities (XXEs)

Date: 08/25/2023

## Status

Approved

## Context

We wish to remove or mitigate points friction encountered by NIST or community OSCAL developers producing tooling that consumes the OSCAL Metaschema module sources.

The OSCAL Metaschema modules currently use external entities to prevent duplication of constraint data.
These external entities are important for modeling ergonomics and cannot be removed until a Metaschema-native approach is stabilized, however external entities have a storied history of abuse.
So called "XML External Entity (XXE) Attacks", along with the additional complexity needed to support external entity resolution, have led to a situation where many XML parsers do not ship with XXE functionality.
This has put additional burden on OSCAL tool developers seeking to consume the source Metaschemas, who have either had to choose from the small subset of XML parsers that support external entities (if one exists for their target language at all) and inherit all additional risks that come with XXEs, or perform transformation of the source Metaschema modules before consuming them.

- Related to Issue [#1665](https://github.com/usnistgov/OSCAL/issues/1665)

## Decision

The NIST OSCAL Team should include the "resolved" Metaschema module sources as an artifact generated upon release.
Additionally, the NIST OSCAL Team should document the process for obtaining a resolved Metaschema module as part of the [streamlined build process](./0005-repository-reorganization.md#streamlined-build-process).

In the event that Metaschema stabilizes constraint imports, the NIST OSCAL Team will review this ADR and potentially determine a deprecation strategy for these generated artifacts in the relevant releases.

## Consequences

This decision will not have any breaking changes to our process, however:

1. The NIST team will be responsible for reviewing the additional artifacts before performing a release.
2. In the event that Metaschema stabilizes constraint imports, the NIST OSCAL team will have to maintain deprecated artifacts until the next major version.



================================================
FILE: decisions/0007-implementation-agnostic-tests.md
================================================
# Implementation-agnostic Testing and Test Harness

Date: 10/06/2023

## Status

Proposed

## Context

In order to support the development of OSCAL tooling, it was decided prototype a unified tool responsible for validating OSCAL implementations against specification requirements.

Currently, only profile resolution has been [formalized into a draft specification](../src/specifications/profile-resolution/profile-resolution-specml.xml).

### Existing Infrastructure

The profile resolver specification currently leverages an in-house XML format known as SpecML, which breaks down a specification into a collection of **sections**, which contain in turn a collection of **requirements**.
Each `<section/>` and `<requirement/>` has a unique `@id` attribute.

The sections and requirements are mirrored in the XSLT implementation's profile resolution unit tests.
Although crucial to the XSLT implementation, these tests are not portable and it would not be simple to use the tests in their current state to validate other implementations.

### Specification Tests

Some specifications such as [CommonMark](https://commonmark.org/) include a [test suite and testing harness](https://github.com/commonmark/commonmark-spec/tree/master/test) to make it possible for implementors to "score" their implementation's conformance to the specification.

## Decision

### SpecML

The specification format will remain unchanged for now.
There is an argument for the format to be replaced or simplified in the future, but the use of `@id` attributes for sections and requirements make linking a test to a example simple.

### Test Suite Data Format

The test suite will be described using a JSON file with a simple data format.

This file will contain a collection of objects that map to a given spec requirement via `section_id` and `requirement_id` fields.
These objects will further contain a collection of "scenario" objects, each of which containing a `description`, `source_profile_path`, `expected_catalog_path`, and a collection of `selection_expressions`.

For a given scenario, a test runner would be expected to perform profile resolution with the `source_profile_path` and compare selections of the resulting document with the `expected_catalog_path`.
The `selection_expressions` are XPath expressions, though the [test harness](#test-harness) may further constrain the XPath expression's capabilities.

Here is an example test suite made up of one requirement:

```json
[
    {
        "section_id": "import",
        "requirement_id": "req-uri-resolve",
        "scenarios": [
            {
                "description": "Check that group and control titles match, signalling that URIs have been resolved",
                "source_profile_path": "requirement-tests/req-include-all-asis.xml",
                "expected_catalog_path": "requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml",
                "selection_expressions": [
                    "./oscal:group/oscal:title",
                    "./oscal:group/oscal:control/oscal:title"
                ]
            }
        ]
    }
]
```

The development of a JSON schema for this format is left as future work.

### Test Harness

A prototype testing harness has been developed, with the capability to report a given profile resolver's compliance to a specification given a [test suite JSON file](#test-suite-data-format).

The prototype harness is built to be as simple as possible, avoiding external libraries.
Python's native XPath capabilities are limited, further constraining the capabilities of the test suite.

## Consequences

Writing specification tests for profile resolution will require significant resources, but will make profile resolution more approachable for implementors and will make changes to the specification more maintainable.

Due to the "requirement based" approach of the specification test suite, new tests can be added gradually.
Test coverage can be determined by determining which requirements do not have tests.



================================================
FILE: decisions/0008-oscal-content-management.md
================================================
# OSCAL Content Data Governance and Release Management

Date: 11/09/2023

## Status

Approved

## Context

Since 2016, the OSCAL project has iterated on methods and locations for managing example content and published catalogs. It is time that we decide whether to continue as-is or make a meaningful change to how project's OSCAL content is developed, published, and maintained.

### Key Takeaways

1. Almost all changes to OSCAL representations of the published SP 800-53A and 800-53B catalogs do not diverge from the official publication. Clear data management and governance guidelines are needed to identify which changes are acceptable OSCAL Team leadership to approve for release, and which specific changes need review and approval by the Security Engineering and Risk Management maintainers of the official SP 800-53 content.
1. By the nature of OSCAL models and relationships of document instances, the team must continue to manage published catalogs and examples that cite them together.
1. It is important that final integration testing of all OSCAL content occur with the latest pending release of OSCAL as a final integration test, even if the content is backwards compatible with an older minor or patch release for the same version.

### Background

[In September 2020](https://github.com/usnistgov/OSCAL/commit/01c0aa9b45667b25e8105160119da011471c77cb), the NIST OSCAL Team migrated SP 800-53 Revision 4, SP 800-53 Revision 5, and example content from [the core OSCAL repository](https://github.com/usnistgov/OSCAL) to the [new oscal-content repository](https://github.com/usnistgov/oscal-content). Presumably, this migration allowed the development team to manage published catalog content, and to a lesser extent examples, in a more flexible way, independent from the established release process and practices for the core OSCAL models, schemas, and supporting tooling. (However, even by that time examples reflected the real-world cross-document relationships OSCAL models support. Examples inherently reference adjacent published catalogs of the NIST SP 800-53B controls.) The NIST OSCAL Team coordinated with the [Security Engineering and Risk Management Team](https://csrc.nist.gov/Groups/Computer-Security-Division/Security-Engineering-and-Risk-Management), maintainers of NIST SP 800-53A and SP 800-53B, to publish representations of the assessment methods and respective controls in conjunction with their official publication (in PDF and alternate formats). Team members employed semi-automatic techniques for content-generation and data quality checks to coordinate finalized release of the 5.0 and 5.1 versions of the official documents with the OSCAL representation (e.g. releasing to the `main` branch in the GitHub repository). Their publication schedule is more infrequent than the OSCAL development cycle. This is an important takeaway that lead to data governance, testing, and release challenges.

### Data Management and Governance Challenges

As enhancements and bug fixes for OSCAL increased, separate of the content, in between official upstream releases of SP 800-53A and SP 800-53B, staff and community members [identified bugs and enhancements to the OSCAL representations](https://github.com/usnistgov/oscal-content/issues). In most cases, these work items would not or did not diverge from the content in the official publication version. These data quality and OSCAL-specific enhancements would or did improve the ability of technical staff using the OSCAL representation to create or improve catalog and profile automation. There has been no clear guidance on how to accept these changes, publish them, and how to identify their versions upon release. These governance questions led to an accumulation of work items that delayed publication (at this time, read: merged into the `main` branch).

### OSCAL Dependency Upgrades, Integration, and Regression Test Challenges

Due to infrequent publications of the catalogs, managed together with examples, the OSCAL submodule to provide models, generated schema, and tooling support. At the time of writing this ADR draft, [the oscal-content main branch at `a53f261`](https://github.com/usnistgov/oscal-content/tree/a53f261a946c52811c507deb4d8385d9e4794a6f) uses a version of the OSCAL models and tooling that is ostensibly from December 2022, [`51d5de2`](https://github.com/usnistgov/OSCAL/commit/51d5de22c181477e3f9cf08789c4399fff013f14), a stable commit between v1.0.4 and v1.0.5. Several attempts to smoothly upgrade this with subsequent releases of OSCAL models and supporting tooling were rolled back or never completed. Automated content conversion and schema validation failed. The team confirmed bugs in dependencies to OSCAL. Fixing these issues required months of development work. Below is a non-exhaustive list with two examples.

- [usnistgov/metaschema#235](https://github.com/usnistgov/metaschema/issues/235)
- [usnistgov/metaschema#240](https://github.com/usnistgov/metaschema/issues/240)

These bugs, and those like them, impacted conversion and validation of the examples, the published catalogs, or in some cases both. So in all cases, they stopped final publication into the oscal-content `main` branch, even as new OSCAL models were released. Specifically, fixing issues in an implementation of the Metaschema Information Modeling Framework used by OSCAL for schema generation, validation, and conversion need to not only be tested in their upstream projects, but then frequently regression tested across models with complex content present in the oscal-content repo. This manual follow-on work was a necessity to test all edge cases. It was exacerbated by the lack of frequent releases, or such problems would be caught sooner and fixed more frequently. This is a key takeaway that Metaschema and OSCAL Team's developers acknowledge, but not yet put into practice. This last line of defense is important to minimizing toil for the team.

## Decision

Moving forward, the team must commit to the following.

1. A data management and governance procedure will be added [to the OSCAL Team Wiki](https://github.com/usnistgov/OSCAL/wiki/NIST-SP-800%E2%80%9053-OSCAL-Content-Data-Governance).
1. The oscal-content repository will move to a `Makefile`-based approach for [usnistgov/oscal-content#116](https://github.com/usnistgov/oscal-content/issues/116) when [usnistgov/oscal-content#204](https://github.com/usnistgov/oscal-content/pull/204) is merged to match the same approach for the core repository enacted in [ADR 5](./0005-repository-reorganization.md). For consistency and simplicity of this new workflow, all examples, profiles, and catalogs will be developed in the [src directory](https://github.com/usnistgov/oscal-content/tree/7a079afed39b1a36a091c8d4ac939d096d42c76b/src) in OSCAL XML format only and converted later. This approach will simplify the architecture and improve efficiency of development cycles.
1. Every OSCAL model release must coincide with an oscal-content release. At a minimum, even if examples or catalogs to be published do not change any content, the team must do the following.
    - Update the OSCAL submodule to the latest tagged release.
    - All source catalogs and profiles must have their `oscal-version` and `version` incremented. Their `last-modified` and `published` timestamps must be updated, even if the updated content in that release is backwards compatible with previous major, minor, and/or patch versions.
    - All `xml-model` instructions at the top of every example, profile, and catalog instance must be updated to the complete OSCAL XML schema artifact for the release that matches the `oscal-version`.
1. The team will tag the commit with generated artifacts and mimic [the core repository's versioning, branching, and release guidelines](https://github.com/usnistgov/OSCAL/blob/f159b28948cb0034370fb819a45bfdaeaef5192a/versioning-and-branching.md), following [SemVer requirements](https://semver.org/).
1. Releases of content will be created alongside the core OSCAL repository.
1. In ADR 5, the team cited risk with the ongoing use of auto-commit automation with GitHub Actions for core OSCAL models and generated artifacts. To evaluate the best option and allow time for coordination with the community, the team will continue with auto-committing content to `main` as a publication mechanism only for the near-term future. The team will revisit this decision and potentially propose an alternative method that is more suitable in a subsequent spike and approved ADR.
1. OSCAL Team leadership will review resources and the feasibility of ongoing maintenance of the catalogs and alternative courses of action for long-term publication of NIST SP 800-53 Revision 5 catalogs.

## Consequences

Below are the consequences of the different approaches.

### Do Nothing

In the short-term, doing nothing would mean to stop publication of the content immediately. This solution would be detrimental to the community without effective analysis for alternative courses of action and approaches for usage of existing content.

### Change Nothing

If the team continues as-is by publishing content to `main` after bugs and build tooling improvements are complete, the challenges above will still sustain unnecessary risk without changes to process and tooling to support the team and its goals. Development of example content, not just publication of catalogs, will stall due to edge cases and accumulated changes in tooling that lead to many minor changes in content that must be reviewed and analyzed.

### Clarify Governance and Require Upgrades for Testing

Clear governance and frequent updates will require more periodic work for the NIST OSCAL Team, but ensure the challenges above will be less frequent and less significant.



================================================
FILE: decisions/0009-tutorials-system-lifecycle.md
================================================
# : Design simplified system lifecycle for example system in tutorials

Date: 10/31/2023

## Status

Proposed

## Context

We wish to reduce friction encountered by community members learning security automation with OSCAL through tutorials produced by the OSCAL team.
A series of OSCAL security automation tutorials would need to be centered around and driven by some system lifecycle, such as the implied lifecycle in NIST 800-37 Risk Management Framework or ISO/IEC 27005.
However, adopting a complex real-world lifecycle in the tutorials would have several disadvantages:

- Complex system lifecycles add overhead that may not be relevant to the tutorial at hand.
- Endorsing a particular lifecycle may incorrectly signal to the reader that OSCAL can only be used with that lifecycle.
- The use of a real-world lifecycle could invite disagreement over the particulars of the lifecycle that are not relevant to the tutorials.

Summarized, the lifecycle should serve the tutorials and not the other way around.

*Note: this ADR was created as part of a work item for [OSCAL#1893](https://github.com/usnistgov/OSCAL/issues/1893).*

## Decision

The NIST OSCAL team should use a simplified lifecycle in its tutorials.
The lifecycle will focus on the security automation.

This document will only contain minimally-viable details of the lifecycle.

### Proposed Lifecycle

The proposed lifcycle will be evocative of a stripped-down RMF or ISO 27005 SDLC, discarding and simplifying steps that are not immediately relevant to a tutorial.

The individual tutorials may include asides on how a given process maps to other processes such as RMF.

|RISK MGMT | Select | Implement | Assess |
| --- | --- | --- | --- |
| DEVELOPMENT |	Design | Develop | Test |

The proposed lifecycle collapses "prepare", "categorize", and "select" into ***design***, renames "implement" into ***develop***, collapses "assess" and "authorize" into ***test***, and removes "monitor".

The steps of the RMF are all important and deserve individual consideration, but are not the subject of the tutorials.

## Consequences

This decision will affect tutorials written in the future, particularly tutorials surrounding the fictional [example system](https://github.com/usnistgov/OSCAL/issues/1892).



================================================
FILE: decisions/adr_template.md
================================================
# N. Brief ADR Title

Date:

## Status

Proposed

## Context

## Decision

## Consequences



================================================
FILE: src/file-naming-conventions.md
================================================
# OSCAL File Naming Conventions

This file documents naming conventions for use with different OSCAL files in this repository.

# Table of Contents

- [OSCAL File Naming Conventions](#oscal-file-naming-conventions)
- [Table of Contents](#table-of-contents)
- [Naming OSCAL Catalog and Profile Files](#naming-oscal-catalog-and-profile-files)
    - [Catalog Example](#catalog-example)
    - [Profile Examples](#profile-examples)
- [Naming OSCAL Schema Files](#naming-oscal-schema-files)
    - [Schema Examples](#schema-examples)
- [Naming OSCAL Conversion XSL Templates](#naming-oscal-conversion-xsl-templates)
    - [Conversion XSLT Example](#conversion-xslt-example)

# Naming OSCAL Catalog and Profile Files

OSCAL catalog and profile files must be named according to the following convention:

```
{Authority}_{Source Name}[_{Source Version}][_{Specifier}][_{File Revision}]_{OSCAL Model}.{File Extension}
```

- **Authority** (*required*): The organizational owner of the content.
- **Source Name** (*required*): The proper name of the content's source.
- **Source Revision** (*optional/recommended*): The specific revision of the content's source.
- **Specifier** (optional): An additional name indicating the subject of the content.
- **File Revision** (*optional*): The specific revision of the content instance or file. The revision string should be a [semantic version](https://semver.org/).
- **OSCAL Model** (*required*): The OSCAL model used to format the file's contents. One of "catalog" or "profile".
- **File Extension** (*required*): A file extension indicating the type of the content. One of "xml" or "json".

## Catalog Example

The following file:

```
NIST_SP-800-53_rev4_catalog.xml
```

Uses the following fields:
- **Authority:** ```NIST```
- **Source Name:** ```SP-800-53```
- **Source Revision:** ```rev4```
- **Specifier:** *not used*
- **File Revision:** *not used*
- **OSCAL Model:** ```catalog```
- **File Extension:** ```xml```

## Profile Examples

The following file:

```
NIST_SP-800-53_rev4_LOW-baseline_profile.json
```

Uses the following fields:
- **Authority:** ```NIST```
- **Source Name:** ```SP-800-53```
- **Source Revision:** ```rev4```
- **Specifier:** ```LOW-baseline```
- **File Revision:** *not used*
- **OSCAL Model:** ```profile```
- **File Extension:** ```json```

The previous example uses the specifier ```LOW-baseline``` to identify that the profile is derived from the low baseline defined in SP 800-53 revision 4.

---

The following file:

```
FedRAMP_MODERATE-baseline_profile.xml
```

Uses the following fields:
- **Authority:** ```FedRAMP```
- **Source Name:** ```MODERATE-baseline```
- **Source Revision:** *not used*
- **Specifier:** *not used*
- **File Revision:** *not used*
- **OSCAL Model:** ```profile```
- **File Extension:** ```xml```

In this example, FedRAMP does not provide a specifier, since the source is sufficient to identify the specific profile represents their moderate baseline.

# Naming OSCAL Schema Files

XML and JSON schema files must be named according to the following convention:

```
oscal_{OSCAL Model}_schema[_{File Revision}].{File Extension}
```

- **OSCAL Model** (*required*): The OSCAL model used to format the file's contents. One of "catalog" or "profile".
- **File Revision** (*optional*): The specific revision of the content instance or file. If no *File Revision* is provided, then the file should be considered the latest revision. The revision string should be a [semantic version](https://semver.org/).
- **File Extension** (*required*): A file extension indicating the type of the content. One of "xsd" for XML Schema or "json" for JSON Schema.

## Schema Examples

The following XML schema for the OSCAL catalog model:

```
oscal_catalog_schema_1.0-M1.json
```

Uses the following fields:
- **OSCAL Model:** ```catalog```
- **File Revision:** 1.0-M1 (for the 1.0 Milestone 1 Release)
- **File Extension:** ```json``` (for JSON schema)

---

The following XML schema for the OSCAL Profile model:

```
oscal_profile_schema.xsd
```

Uses the following fields:
- **OSCAL Model:** ```profile```
- **File Revision:** *not used*
- **File Extension:** ```xsd``` (for XML schema)

# Naming OSCAL Conversion XSL Templates

XML and JSON schema files must be named according to the following convention:

```
oscal_{OSCAL Model}_{Source Format}-to-{Destination Format}_converter[_{File Revision}].{File Extension}
```

- **OSCAL Model** (*required*): The OSCAL model used to format the file's contents. One of "catalog" or "profile".
- **Source Format** (*required*): The format of the source file to convert from. One of "xml" or "json".
- **Destination Format** (*required*): The format of the destination file to convert to. One of "xml" or "json".
- **File Revision** (*optional*): The specific revision of the content instance or file. If no *File Revision* is provided, then the file should be considered the latest revision. The revision string should be a [semantic version](https://semver.org/).
- **File Extension** (*required*): A file extension indicating the type of the converter content. Currently, only "xsl" is provided for XSL templates.

## Conversion XSLT Example

The following XSL template converts an OSCAL catalog in JSON format to the OSCAL catalog XML format:

```
oscal_catalog_json-to-xml-converter.xsl
```

Uses the following fields:
- **OSCAL Model:** ```catalog```
- **Source Format:** ```json```
- **Destination Format:** ```xml```
- **File Revision:** *not used*
- **File Extension:** ```xslt``` (for XSL template)



================================================
FILE: src/metaschema/readme.md
================================================
# OSCAL Metaschema

An OSCAL Metaschema defines the the information structures that define an OSCAL model in a format-neutral form. Documentation about the meaning (semantics) and use of a given metaschema structure is provided on the Metaschema [website].

OSCAL Metaschemas are used to generate other OSCAL artifacts based on the metaschema description. These artifacts include:

- XML and JSON schemas, or *data models*, which are derived from the Metaschema modules and expressed as XSD and JSON Schema;
- Conversion scripts that can convert OSCAL content between the XML and JSON OSCAL formats, ensuring the resulting content is schema valid;
- XML and JSON [model documentation](https://pages.nist.gov/OSCAL/docs/schemas/) for use on the [OSCAL website](https://pages.nist.gov/OSCAL).

Use of Metaschema modules in OSCAL allows us to maintain seamless and consistent support for multiple OSCAL model formats, including XML and JSON. More information is at the [Metaschema Information Modeling Framework documentation site](https://pages.nist.gov/metaschema/).



================================================
FILE: src/metaschema/doc-identity-notes.md
================================================
To do:

Build out examples
 - catalog (pointing to its source material)
   - w/ pointer to "latest version"
   - also w/ pointer to exact same version online
 - profile
   - same, plus
   - catalog(s)

A profile showing links
  to catalog (pointing to its source material)
  PDF version (source material) of profile

title: "XYZ"
version-title: "XYZ, revision 4"

In profiles and other citing documents:

```
<resource rel="self | baseline | catalog | metaschema | documentation" href="path/to/resource">
  <title> ... </title>
  <doc-id type="...">uuid or other identifier for document</doc-id>
  <prop>Any other property or tracking info but see also meta-group
   (mirrors?)
</resource>
```

then in the metadata of any OSCAL document (catalog, profile or other)

```
<mirror media-type="zip | application-xml | json | pdf | text/html

www [media type]"
status="superseding | current | subsumed | superseded">
  <title>...</title>
  <doc-id>...</doc-id>
  <link>...</link>
  <hash href="link-to-hash">hash</hash>
</mirror>
```



`superseding` points at a "best available, updated" version elsewhere. Even without a hash literal (as the target document may be mutable), it can offer a link expected to deliver a hash, which can then be checked against a delivered resource (allowing for its nominal format).

Needless to say, there should be no expectation that a superseding version must or will be backward compatible; but its existence may be informative.

`current` means that the mirror is the "same version" or release as this file, albeit (possibly) expressed using a different notation, and that they can be compared directly to establish this. "Current" means (nominally) current with the instance and ostensibly "concurring"; so examining what is flagged as "current" is the easiest way for an auditor to see which versions of resources are referenced in an OSCAL artifact.

This kind of mirror can be used both to point to canonical or published versions of resources, and can also relate alternatives e.g. XML/JSON of "the same thing".

NB one of the tasks carried out by a complete conversion btw XML and JSON versions will have to be this bit of metadata patching.

Loading a current zip mirror with a hash is a secure way of acquiring an authorized version of a resource either directly for use or for comparison with files in cache. An XML or JSON version delivered in a zip may then be XML- or JSON-compared reliably with a local copy.

Even without the hash, pointing to XML or JSON mirrors is a convenient way to maintain a verifiable chain of authority.

`aligned` means that the mirror may be consulted as an alternative version or expression (indeed sometimes an authoritative one) of the current version, but that this claim is not practically speaking, checkable by automated means - typically we'll see this for PDF or Word versions: it means "this is the same, but that can't be reliably checked without help".

To declare alignment with Word (or ODT) documents I suggest format="zip" status="aligned".

This is also how an OSCAL version can reference its (non-OSCAL) sources when it is converted.

`subsumed` means that the mirror is a prior version, while the differences are not "significant" and backward compatibility may be expected. Presumably, again, direct comparison of resources can show the details (XML to XML, JSON to JSON or even across format boundaries).

Providing a subsumed mirror with appropriate document-identifiers can be enough to permit resolution (with a warning) to a later/better version of its catalog, when the earlier catalog is listed among the mirrors of the later one as "subsumed".

`superseded` means that the mirror is superseded by the current version, and that the differences are "significant". While this kind of mirror is provided mainly for reference, it also enables forward tracking across versions.

## content handling by format

We'll use media types of the normal sort, i.e.
application/xml
application/json
application/pdf, application/vnd.openxmlformats-officedocument.wordprocessingml.document
etc

Note that putatively comparable or "the same" XML and JSON versions can be checked against each other, given a metaschema to cast the conversion.



================================================
FILE: src/metaschema/metaschema-author.css
================================================
METASCHEMA { font-family: Calibri, Verdana, sans-serif }

* { display: block }

pre { color: darkgrey }

tag { color: black; font-family: monospace; font-size: 80%; font-weight: bold }

METASCHEMA { }

title { }

import:before      
 { content: 'import module ' oxy_urlChooser(edit, '@href', columns 60) }
 


define-assembly,
define-field,
define-flag      { margin-top: 1ex; margin-bottom: 1ex; border: thin inset black; padding: 0.5em }


define-assembly:before,
define-field:before,
define-flag:before      
 { content:
 oxy_name() 
 oxy_textfield(edit, '@name', columns, 12) 
    }

root-name:before { content: "Root name: "  }


prop:before      
 { content: 'property '
 oxy_textfield(edit, '@name', columns, 25)
 oxy_textfield(edit, '@value', columns, 30) 
    }


define-assembly[group-as]:before,
define-field[group-as]:before,
define-flag[group-as]:before      
 { content:
 oxy_name() 
 oxy_textfield(edit, '@name', columns, 12) }
define-assembly *,
define-field    *,
define-flag     *  { margin: 0em }

define-assembly > * { margin-top: 1em }

pre { padding: 0.5em; background-color: gainsboro }

define-assembly { }

define-field { }

define-flag { }

flag { }

formal-name { font-size: 120%; font-weight: bold; margin: 0.5em 0em }

description, remarks {  max-width: 60em }

remarks { border-left: thin solid black; padding-left: 1em; margin-left: 1em }
remarks p { margin-top: 1em }


example { }

prose { }


p { }

code {  display: inline; font-family: monospace }
q {  display: inline; background-color: lemonchiffon }
em, i {  display: inline; font-style: italic }
strong, b  {  display: inline; font-weight: bold }

example { background-color: lavender; white-space: pre; }

example *:before { content: '<' oxy_name() '>'; font-family: monospace; font-size: 80%  }
example *:after { content: '</' oxy_name() '>'; font-family: monospace; font-size: 80%  }

model { padding-left: 0.5em; border-left: medium solid blue; font-size: 80%; padding-right: 2em }

model model { font-size: 100%; }

flag:before { content:
 oxy_name()
  ' ref: ' oxy_textfield(edit, '@ref', columns, 12) 
   }

assembly:before, field:before {
  content:
    oxy_name() ' named '
    oxy_textfield(edit, '@ref', columns, 12) }

group-as { margin-left: 2em }

group-as:before { content: 'group as '
 oxy_textfield(edit, '@name', columns, 12) }


choice:before { content:
 'a choice between'
 }

prose:before { font-weight: bold; content:
 'prose'
 }

choice > * { margin-left: 2em }

a { display: inline; color: blue }
a:before { content: oxy_urlChooser(        
        edit, "@href",
        columns 42); }


/* CONSTRAINTS */

constraint > * { border: thin solid black; padding: 0.6em }

allowed-values:before { content: "Allowed values"
  ' level: '  oxy_combobox(edit, '@level', editable, false, values, "ERROR, WARNING" ) }

enum { margin-left: 2em; display: list-item;
       font-size: 90%; padding-left: 1em }
enum:before { content: oxy_textfield(edit, '@value', columns, 24); }

index { }
index:before {  content: "Index: "
  ' name: ' oxy_textfield(edit, '@name', columns, 24)
  ' target: ' oxy_textfield(edit, '@target', columns, 52)
  ' level: '  oxy_combobox(edit, '@level', editable, false, values, "ERROR, WARNING" ); }

key-field { margin-left: 2em }
key-field:before {  content: "Key field "
  ' target: ' oxy_textfield(edit, '@target', columns, 52)
  ' level: '  oxy_combobox(edit, '@level', editable, false, values, "ERROR, WARNING" ); }

expect { }
expect:before  {  content: "Expect "
  ' target: ' oxy_textfield(edit, '@target', columns, 52)
  ' test: '   oxy_textfield(edit, '@test', columns, 36)
  ' level: '  oxy_combobox(edit, '@level', editable, false, values, "ERROR, WARNING" ); }

index-has-key { }

index-has-key:before { content: "Index has key: "
  ' name: ' oxy_textfield(edit, '@name', columns, 24)
  ' target: ' oxy_textfield(edit, '@target', columns, 52)
  ' level: '  oxy_combobox(edit, '@level', editable, false, values, "ERROR, WARNING" ); }





================================================
FILE: src/metaschema/metaschema-browser.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:xs="http://www.w3.org/2001/XMLSchema"
                xmlns="http://www.w3.org/1999/xhtml"
                version="1.0"
                xmlns:m="http://csrc.nist.gov/ns/oscal/metaschema/1.0"
   exclude-result-prefixes="xs m">


   <xsl:template match="/">
      <html>
         <head>
            <xsl:call-template name="css"/>
         </head>
         <body>
            <xsl:apply-templates/>
         </body>
      </html>
   </xsl:template>

   <xsl:template match="m:METASCHEMA">
      <div class="METASCHEMA">
         <xsl:apply-templates/>
      </div>
   </xsl:template>

   <xsl:template match="m:METASCHEMA/m:schema-name">
      <h2 class="title">
         <xsl:apply-templates/>
      </h2>
   </xsl:template>

   <xsl:template match="m:define-flag">
      <div class="define-flag" id="{@name}">
         <h3>
            <xsl:apply-templates select="m:formal-name" mode="inline"/>:
            <xsl:apply-templates select="@name"/> flag</h3>

         <xsl:apply-templates/>
      </div>
   </xsl:template>

   <xsl:template  match="m:define-field">
      <div class="define-field" id="{@name}">
         <h3>
            <xsl:apply-templates select="m:formal-name" mode="inline"/>:
            <xsl:apply-templates select="@name"/>
            <xsl:text> field</xsl:text>
            <xsl:apply-templates select="@group-as"/>
         </h3>

         <xsl:choose>
            <xsl:when test="@as='mixed'"><p>Supports inline encoding</p></xsl:when>
            <xsl:when test="@as='boolean'"><p>True whenever given (presence signifies Boolean value)</p></xsl:when>
         </xsl:choose>
         <xsl:apply-templates select="m:formal-name | m:description"/>
         <xsl:if test="m:flag">
            <div class="model">
               <p>The <xsl:apply-templates select="@name"/> field supports:</p>
               <ul>
                  <xsl:apply-templates select="m:flag" mode="model"/>
               </ul>
            </div>

         </xsl:if>
         <xsl:apply-templates select="m:remarks"/>
         <xsl:apply-templates select="m:example"/>
      </div>
   </xsl:template>

   <xsl:template match="m:define-assembly">
      <div class="define-assembly" id="{@name}">
         <h3>
            <xsl:apply-templates select="m:formal-name" mode="inline"/>:
            <xsl:apply-templates select="@name"/>
            <xsl:text> assembly</xsl:text>
         <xsl:apply-templates select="@group-as"/>
         </h3>
         <xsl:apply-templates select="m:formal-name | m:description"/>
         <xsl:apply-templates select="m:model"/>
         <xsl:apply-templates select="m:remarks"/>
         <xsl:apply-templates select="m:example"/>
      </div>
   </xsl:template>

   <xsl:template match="@name | @named">
      <code class="name"><xsl:value-of select="."/></code>
   </xsl:template>

   <xsl:template match="@group-as">
      <xsl:text> (group as </xsl:text>
      <code>
         <xsl:value-of select="."/>
      </code>)<xsl:text/>
   </xsl:template>

   <xsl:template match="@datatype">
      <xsl:text> (datatype:  </xsl:text>
      <code>
         <xsl:value-of select="."/>
      </code>)<xsl:text/>
   </xsl:template>

   <xsl:template match="@address">
      <xsl:text> (addressable by </xsl:text>
      <code>
         <xsl:value-of select="."/>
      </code>)<xsl:text/>
   </xsl:template>

   <xsl:template match="@required">
      <i> (required)</i>
   </xsl:template>

   <xsl:template match="m:flag"/>

   <xsl:template match="m:flag" mode="model">
      <li>
         <xsl:text>Flag </xsl:text>
         <a href="#{@name}" class="name">
            <xsl:apply-templates select="@name"/>
         </a>
         <xsl:apply-templates select="@datatype"/>
         <xsl:apply-templates select="@required"/>
         <xsl:if test="not(@required)"> (<i>optional</i>)</xsl:if>
         <xsl:apply-templates select="m:description" mode="model"/>
         <xsl:apply-templates select="m:remarks" mode="model"/>
      </li>
   </xsl:template>


   <!-- Empty model elements (whether by accident or design) will be dropped. -->
   <xsl:template match="m:model[not(*)]" priority="3"/>

   <xsl:template match="m:model">
      <div class="model">
         <p>The <xsl:apply-templates select="../@name"/> assembly has the following contents <xsl:if test="count(*) > 1"> (in order)</xsl:if>:</p>
         <ul>
            <xsl:apply-templates select="../m:flag" mode="model"/>
            <xsl:apply-templates/>
         </ul>
      </div>
   </xsl:template>



   <xsl:template  match="m:assembly | m:field">
      <li>
         <xsl:text>A</xsl:text>
         <xsl:if test="not(translate(substring(@named,1,1),'AEIOUaeiuo',''))">n</xsl:if>
         <xsl:text> </xsl:text>
         <a class="name" href="#{@named}"><xsl:apply-templates select="@named"/></a>
         <xsl:value-of select="concat(' ',local-name(),' ')"/>
         <xsl:apply-templates select="." mode="cardinality"/>

         <xsl:apply-templates select="m:description" mode="model"/>
         <xsl:apply-templates select="m:remarks" mode="model"/>
      </li>
   </xsl:template>

   <xsl:template match="*" mode="cardinality"> (<i>zero or one</i>)</xsl:template>

   <xsl:template match="*[@required='yes']" mode="cardinality"> (<i>one</i>)</xsl:template>

   <xsl:template  match="m:example">
      <div class="example">
         <xsl:apply-templates select="m:description"/>
         <pre class="xml">
           <xsl:apply-templates select="*" mode="as-example"/>
         </pre>
         <xsl:apply-templates select="m:remarks"/>
      </div>
   </xsl:template>

   <xsl:template match="m:*" mode="as-example"/>

   <xsl:template match="*" mode="as-example">
      <xsl:apply-templates select="." mode="serialize"/>
   </xsl:template>


   <xsl:template match="m:code[. = /*/*/@name]">
      <a href="#{.}" class="name">
         <xsl:apply-templates/>
      </a>
   </xsl:template>


   <xsl:template name="css">
      <style type="text/css">
         html, body { background-color: lightsteelblue }

         pre { color: darkgrey }
         .tag { color: black; font-family: monospace; font-size: 80%; font-weight: bold }

         .METASCHEMA { }

         .title { }

         .define-assembly,
         .define-field,
         .define-flag      { margin-top: 1ex; margin-bottom: 1ex; border: thin inset black; padding: 0.5em }

         .define-assembly *,
         .define-field    *,
         .define-flag     *  { margin: 0em }

         .define-assembly > div { margin-top: 1em }

         pre { padding: 0.5em; background-color: gainsboro }

         .define-assembly { }

         .define-field { }

         .define-flag { }

         .flag { }

         .formal-name { font-size: 120%; font-weight: bold; font-family: sans-serif; margin: 0.5em 0em }

         .description { font-size: 90% }

         .remarks { }

         .remarks p { margin-top: 0.5em }
         // .remarks > p:first-child { margin-top: 0em }

         .model { margin-top: 1em }

         .field { }

         .fields { }

         .assembly { }

         .assemblies { }

         .choice { }

         .example { margin-top: 1em }

         .prose { }


         .p { }

         .code {  display: inline; }
         .q {  display: inline; }
         .em {  display: inline; }
         .strong {  display: inline; }

         .name { color: midnightblue; background-color: lavender;
         font-family: monospace }

         a { text-decoration:none }
         a:hover { text-decoration: underline }


      </style>
   </xsl:template>

   <xsl:template match="m:METASCHEMA/m:short-name">
      <p>The short name (file identifier) for this schema shall be <i><xsl:apply-templates/></i>. It is used internally when an
         identifier is called for, and may appear in file names of schema artifacts.</p>
   </xsl:template>

   <xsl:template match="m:description" mode="model">
      <xsl:text>: </xsl:text>
      <xsl:apply-templates/>
   </xsl:template>

   <xsl:template match="m:remarks/m:p" mode="model">
      <br class="br"/>
      <xsl:apply-templates/>
   </xsl:template>

   <xsl:template match="m:choice">
      <li class="choice">A choice between
         <ul>
           <xsl:apply-templates/>
         </ul>
      </li>
   </xsl:template>

   <xsl:template match="m:prose">
      <li class="prose">Prose contents (paragraphs and lists)</li>
   </xsl:template>

   <xsl:template  match="m:remarks">
      <div class="remarks">
         <xsl:apply-templates/>
      </div>
   </xsl:template>


   <xsl:template match="m:formal-name"/>

   <xsl:template match="m:formal-name" mode="inline">
      <b class="formal-name">
         <xsl:apply-templates/>
      </b>
   </xsl:template>

   <xsl:template match="m:description">
      <p class="description">
         <xsl:apply-templates/>
      </p>
   </xsl:template>

   <xsl:template  match="m:p">
      <p class="p">
         <xsl:apply-templates/>
      </p>
   </xsl:template>


   <xsl:template match="m:code">
      <code>
         <xsl:apply-templates/>
      </code>
   </xsl:template>

   <xsl:template match="m:q">
      <q>
         <xsl:apply-templates/>
      </q>
   </xsl:template>

   <xsl:template match="m:em | m:strong | m:b | m:i | m:u">
      <xsl:element name="{local-name()}">
         <xsl:apply-templates/>
      </xsl:element>
   </xsl:template>


   <!-- temporary, until we work by passing the xml through the converter and showing that. :-) -->
   <xsl:template match="*" mode="serialize">


      <xsl:call-template name="indent-for-pre"/>

      <code class="tag">&lt;<xsl:value-of select="name(.)"/>
         <xsl:for-each select="@*">
            <xsl:text> </xsl:text>
            <xsl:value-of select="name()"/>
            <xsl:text>="</xsl:text>
            <xsl:value-of select="."/>
            <xsl:text>"</xsl:text>
         </xsl:for-each>
         <xsl:text>&gt;</xsl:text>
      </code>

      <xsl:apply-templates mode="serialize">
         <xsl:with-param name="hot" select="boolean(text()[normalize-space(.)])"/>
      </xsl:apply-templates>

      <xsl:if test="not(text()[normalize-space(.)])">
         <xsl:call-template name="indent-for-pre">
            <xsl:with-param name="endtag" select="true()"/>
         </xsl:call-template>
      </xsl:if>
      <code class="tag">&lt;/<xsl:value-of select="name(.)"/>
         <xsl:text>&gt;</xsl:text>
      </code>
   </xsl:template>

   <xsl:template name="indent-for-pre">
      <xsl:param name="endtag" select="false()"/>
      <!-- Pretty heavy duty doing this under XSLT 1.0 -->
      <xsl:variable name="inline" select="boolean(../text()[normalize-space(.)])"/>
      <xsl:variable name="all-ancestors" select="ancestor::*"/>
      <xsl:variable name="example-ancestors" select="ancestor::m:example/ancestor::*"/>
      <xsl:variable name="depth" select="count($all-ancestors) - count($example-ancestors)"/>

      <xsl:if test="not($inline)">
         <!-- No CR for the first one -->
         <xsl:if test="boolean(preceding-sibling::*) or not(parent::m:example) or $endtag">
            <xsl:text>&#xA;</xsl:text>
         </xsl:if>
         <!-- check out the ancient method for a loop -->
         <xsl:for-each select="ancestor::*[position() &lt; $depth]">
            <xsl:text>  </xsl:text>
         </xsl:for-each>
      </xsl:if>
   </xsl:template>

   <xsl:template match="text()" mode="serialize">
      <xsl:param name="hot" select="boolean(../text()[normalize-space(.)])"/>
      <xsl:if test="$hot">
         <xsl:value-of select="."/>
      </xsl:if>
   </xsl:template>


</xsl:stylesheet>



================================================
FILE: src/metaschema/oscal_assessment-common_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<METASCHEMA xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" abstract="yes">
   <schema-name>OSCAL Assessment Layer Format -- Common Modules</schema-name>
   <schema-version>1.1.3</schema-version>
   <short-name>oscal-assessment-common</short-name>
   <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
   <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
   <remarks>
      <p>This contains all modules common to the assessment plan, assessment results, and POAM models. </p>
      <p>The root of the OSCAL Assessment Plan format is <code>assessment-plan</code>.</p>
      <p>The root of the OSCAL Assessment Results format is <code>assessment-results</code>.</p>
      <p>The root of the OSCAL Plan of Action and Milestones (POA&amp;M) format is <code>plan-of-action-and-milestones</code>.</p>
   </remarks>
   <!-- IMPORT STATEMENTS -->
   <import href="oscal_control-common_metaschema.xml"/>
   <import href="oscal_implementation-common_metaschema.xml"/>

   <!-- SSP Import -->
   <define-assembly name="import-ssp">
      <formal-name>Import System Security Plan</formal-name>
      <description>Used by the assessment plan and POA&amp;M to import information about the system.</description>
      <define-flag name="href" as-type="uri-reference" required="yes">
         <formal-name>System Security Plan Reference</formal-name>
         <description>A resolvable URL reference to the system security plan for the system being assessed.</description>
         <remarks>
            <p>This value may be one of:</p>
            <ol>
               <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
               <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
               <li>a bare URI fragment (i.e., `#uuid`) pointing to a <code>back-matter</code> resource in this or an imported document (see <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking to another OSCAL object</a>).</li>
            </ol>
         </remarks>
      </define-flag>

      <model>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
   </define-assembly>

   <define-assembly name="local-objective">
      <formal-name>Assessment-Specific Control Objective</formal-name>
      <description>A local definition of a control objective for this assessment. Uses catalog syntax for control objective and assessment actions.</description>
      <flag ref="control-id" required="yes">
         <remarks>
            <p>The specified <code>control-id</code> must be a valid value within the baseline identified by the target system's SSP via the <code>import-profile</code> statement.</p>
         </remarks>
      </flag>
      <model>
         <define-field name="description" min-occurs="0" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
            <formal-name>Objective Description</formal-name>
            <description>A human-readable description of this control objective.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <assembly ref="part" min-occurs="1" max-occurs="unbounded">
            <group-as name="parts" in-json="ARRAY" />
         </assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
      <constraint>
         <allowed-values target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
            <enum value="objective" deprecated="1.0.1">**(deprecated)** Use 'assessment-objective' instead.</enum>
            <enum value="assessment" deprecated="1.0.1">**(deprecated)** Use 'assessment-method' instead.</enum>
            <enum value="assessment-objective">The part defines an assessment objective.</enum>
            <enum value="assessment-method">The part defines an assessment method.</enum>
         </allowed-values>
         <has-cardinality target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('objective','assessment-objective')]" max-occurs="1" />
         <has-cardinality target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('assessment','assessment-method')]/prop[has-oscal-namespace(('http://csrc.nist.gov/ns/oscal','http://csrc.nist.gov/ns/rmf')) and @name='method']" min-occurs="1" max-occurs="1" />
         <has-cardinality target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('assessment','assessment-method')]/part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('objects','assessment-objects')]" min-occurs="1" max-occurs="1" />
         <has-cardinality target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('objective','assessment-objective')]/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='method-id']" min-occurs="1" />
      </constraint>
   </define-assembly>
   <define-assembly name="assessment-method">
      <formal-name>Assessment Method</formal-name>
      <description>A local definition of a control objective. Uses catalog syntax for control objective and assessment activities.</description>
      <define-flag name="uuid" required="yes" as-type="uuid">
         <formal-name>Assessment Method Universally Unique Identifier</formal-name>
         <!-- Identifier Declaration -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this assessment method elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>assessment method</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
      </define-flag>
      <model>
         <define-field name="description" min-occurs="0" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
            <formal-name>Assessment Method Description</formal-name>
            <description>A human-readable description of this assessment method.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <assembly ref="assessment-part" min-occurs="1" max-occurs="1"/>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
   </define-assembly>

   <define-assembly name="activity">
      <formal-name>Activity</formal-name>
      <description>Identifies an assessment or related process that can be performed. In the assessment plan, this is an intended activity which may be associated with an assessment task. In the assessment results, this an activity that was actually performed as part of an assessment.</description>
      <define-flag name="uuid" required="yes" as-type="uuid">
         <formal-name>Assessment Activity Universally Unique Identifier</formal-name>
         <!-- Identifier Declaration -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this assessment activity elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>activity</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
      </define-flag>
      <model>
         <define-field name="title" min-occurs="0" max-occurs="1" as-type="markup-line">
            <formal-name>Included Activity Title</formal-name>
            <description>The title for this included activity.</description>
         </define-field>
         <define-field name="description" min-occurs="1" max-occurs="1" as-type="markup-multiline" in-xml="WITH_WRAPPER">
            <formal-name>Included Activity Description</formal-name>
            <description>A human-readable description of this included activity.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <define-assembly name="step" min-occurs="0" max-occurs="unbounded">
            <formal-name>Step</formal-name>
            <description>Identifies an individual step in a series of steps related to an activity, such as an assessment test or examination procedure.</description>
            <group-as name="steps" in-json="ARRAY"/>
            <define-flag name="uuid" required="yes" as-type="uuid">
               <formal-name>Step Universally Unique Identifier</formal-name>
               <!-- Identifier Declaration -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this step elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>step</code> (in a series of steps) can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <model>
               <define-field name="title" min-occurs="0" max-occurs="1" as-type="markup-line">
                  <formal-name>Step Title</formal-name>
                  <description>The title for this step.</description>
               </define-field>
               <define-field name="description" min-occurs="1" max-occurs="1" as-type="markup-multiline" in-xml="WITH_WRAPPER">
                  <formal-name>Step Description</formal-name>
                  <description>A human-readable description of this step.</description>
               </define-field>
               <assembly ref="property" max-occurs="unbounded">
                  <group-as name="props" in-json="ARRAY"/>
               </assembly>
               <assembly ref="link" max-occurs="unbounded">
                  <group-as name="links" in-json="ARRAY"/>
               </assembly>
               <assembly ref="reviewed-controls">
                  <remarks>
                     <p>This can be optionally used to define the set of controls and control objectives that are assessed by this step.</p>
                  </remarks>
               </assembly>
               <assembly ref="responsible-role" max-occurs="unbounded">
                  <group-as name="responsible-roles" in-json="ARRAY"/>
                  <remarks>
                     <p>Identifies the roles, and optionally the parties, associated with this step that is part of an assessment activity.</p>
                  </remarks>
               </assembly>
               <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
            <constraint>
               <is-unique id="unique-step-responsible-role" target="responsible-role">
                  <key-field target="@role-id"/>
                  <remarks>
                     <p>Since multiple <code>party-uuid</code> entries can be provided, each role-id must be referenced only once.</p>
                  </remarks>
               </is-unique>
            </constraint>
         </define-assembly>
         <assembly ref="reviewed-controls">
            <use-name>related-controls</use-name>
            <remarks>
               <p>This can be optionally used to define the set of controls and control objectives that are assessed or remediated by this activity.</p>
            </remarks>
         </assembly>
         <assembly ref="responsible-role" max-occurs="unbounded">
            <group-as name="responsible-roles" in-json="ARRAY"/>
            <remarks>
               <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
            </remarks>
         </assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
      <constraint>
         <!-- TODO: Dave to double-check constraints here -->
         <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
            <enum value="method">The assessment method to use. This typically appears on parts with the name "assessment".</enum>
         </allowed-values>
         <has-cardinality target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='method']" min-occurs="1"/>
         <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='method']/@value">
            <enum value="INTERVIEW">The process of holding discussions with individuals or groups of individuals within an organization to once again, facilitate assessor understanding, achieve clarification, or obtain evidence.</enum>
            <enum value="EXAMINE">The process of reviewing, inspecting, observing, studying, or analyzing one or more assessment objects (i.e., specifications, mechanisms, or activities).</enum>
            <enum value="TEST">The process of exercising one or more assessment objects (i.e., activities or mechanisms) under specified conditions to compare actual with expected behavior.</enum>
         </allowed-values>
         <is-unique id="unique-activity-responsible-role" target="responsible-role">
            <key-field target="@role-id"/>
            <remarks>
               <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
            </remarks>
         </is-unique>
      </constraint>
   </define-assembly>

   <define-assembly name="task">
      <formal-name>Task</formal-name>
      <description>Represents a scheduled event or milestone, which may be associated with a series of assessment actions.</description>
      <define-flag name="uuid" required="yes" as-type="uuid">
         <formal-name>Task Universally Unique Identifier</formal-name>
         <!-- Identifier Declaration -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this task elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>task</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
      </define-flag>
      <define-flag name="type" required="yes" as-type="token">
         <formal-name>Task Type</formal-name>
         <description>The type of task.</description>
         <constraint>
            <allowed-values allow-other="yes">
               <enum value="milestone">The task represents a planned milestone.</enum>
               <enum value="action">The task represents a specific assessment action to be performed.</enum>
            </allowed-values>
         </constraint>
      </define-flag>

      <model>
         <define-field name="title" min-occurs="1" as-type="markup-line">
            <formal-name>Task Title</formal-name>
            <description>The title for this task.</description>
         </define-field>
         <define-field name="description" max-occurs="1" as-type="markup-multiline" in-xml="WITH_WRAPPER">
            <formal-name>Task Description</formal-name>
            <description>A human-readable description of this task.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <define-assembly name="timing">
            <formal-name>Event Timing</formal-name>
            <description>The timing under which the task is intended to occur.</description>
            <model>
               <choice>
                  <define-assembly name="on-date" min-occurs="1">
                     <formal-name>On Date Condition</formal-name>
                     <description>The task is intended to occur on the specified date.</description>
                     <define-flag name="date" as-type="date-time-with-timezone" required="yes">
                        <formal-name>On Date Condition</formal-name>
                        <description>The task must occur on the specified date.</description>
                     </define-flag>
                  </define-assembly>
                  <define-assembly name="within-date-range" min-occurs="1">
                     <formal-name>On Date Range Condition</formal-name>
                     <description>The task is intended to occur within the specified date range.</description>
                     <define-flag name="start" as-type="date-time-with-timezone" required="yes">
                        <formal-name>Start Date Condition</formal-name>
                        <description>The task must occur on or after the specified date.</description>
                     </define-flag>
                     <define-flag name="end" as-type="date-time-with-timezone" required="yes">
                        <formal-name>End Date Condition</formal-name>
                        <description>The task must occur on or before the specified date.</description>
                     </define-flag>
                  </define-assembly>
                  <define-assembly name="at-frequency" min-occurs="1">
                     <formal-name>Frequency Condition</formal-name>
                     <description>The task is intended to occur at the specified frequency.</description>
                     <define-flag name="period" as-type="positive-integer" required="yes">
                        <formal-name>Period</formal-name>
                        <description>The task must occur after the specified period has elapsed.</description>
                     </define-flag>
                     <define-flag name="unit" as-type="string" required="yes">
                        <formal-name>Time Unit</formal-name>
                        <description>The unit of time for the period.</description>
                        <constraint>
                           <allowed-values>
                              <enum value="seconds">The period is specified in seconds.</enum>
                              <enum value="minutes">The period is specified in minutes.</enum>
                              <enum value="hours">The period is specified in hours.</enum>
                              <enum value="days">The period is specified in days.</enum>
                              <enum value="months">The period is specified in calendar months.</enum>
                              <enum value="years">The period is specified in calendar years.</enum>
                           </allowed-values>
                        </constraint>
                     </define-flag>
                  </define-assembly>
               </choice>
            </model>
         </define-assembly>
         <define-assembly name="dependency" max-occurs="unbounded">
            <formal-name>Task Dependency</formal-name>
            <description>Used to indicate that a task is dependent on another task.</description>
            <group-as name="dependencies" in-json="ARRAY"/>
            <define-flag name="task-uuid" required="yes" as-type="uuid">
               <formal-name>Task Universally Unique Identifier Reference</formal-name>
               <!-- Identifier Reference -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a unique task.</description>
            </define-flag>
            <model>
               <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
         </define-assembly>
         <assembly ref="task" min-occurs="0" max-occurs="unbounded">
            <group-as name="tasks" in-json="ARRAY"/>
         </assembly>

         <define-assembly name="associated-activity" min-occurs="0" max-occurs="unbounded">
            <formal-name>Associated Activity</formal-name>
            <description>Identifies an individual activity to be performed as part of a task.</description>
            <group-as name="associated-activities" in-json="ARRAY"/>
            <define-flag name="activity-uuid" required="yes" as-type="uuid">
               <formal-name>Activity Universally Unique Identifier Reference</formal-name>
               <!-- Identifier Reference -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to an activity defined in the list of activities.</description>
            </define-flag>
            <model>
               <assembly ref="property" max-occurs="unbounded">
                  <group-as name="props" in-json="ARRAY"/>
               </assembly>
               <assembly ref="link" max-occurs="unbounded">
                  <group-as name="links" in-json="ARRAY"/>
               </assembly>
               <assembly ref="responsible-role" max-occurs="unbounded">
                  <group-as name="responsible-roles" in-json="ARRAY"/>
                  <remarks>
                     <p>Identifies the person or organization responsible for performing a specific role defined by the activity.</p>
                  </remarks>
               </assembly>
<!--               <choice>
-->                  <assembly ref="assessment-subject" min-occurs="1" max-occurs="unbounded">
                     <use-name>subject</use-name>
                     <group-as name="subjects" in-json="ARRAY"/>
                  </assembly>
<!--                  <assembly ref="assessment-subject-placeholder">
                     <use-name>subject-placeholder</use-name>
                  </assembly>
               </choice>
-->               <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
            <constraint>
               <is-unique id="unique-associated-activity-responsible-role" target="responsible-role">
                  <key-field target="@role-id"/>
                  <remarks>
                     <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
                  </remarks>
               </is-unique>
            </constraint>
         </define-assembly>
         <assembly ref="assessment-subject" max-occurs="unbounded">
            <use-name>subject</use-name>
            <group-as name="subjects" in-json="ARRAY"/>
            <remarks>
               <p>The assessment subjects that the activity was performed against.</p>
            </remarks>
         </assembly>
         <assembly ref="responsible-role" max-occurs="unbounded">
            <group-as name="responsible-roles" in-json="ARRAY"/>
            <remarks>
               <p>Identifies the person or organization responsible for performing a specific role related to the task.</p>
               <!-- todo: role id and party id scope is defined at the document level.  Refer to root object within which the data is declared for...mention resolved through imports.  Note: wh-->
            </remarks>
         </assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
   </define-assembly>

   <!-- ********** OBJECTIVES Assembly ********** -->
   <define-assembly name="reviewed-controls">
      <formal-name>Reviewed Controls and Control Objectives</formal-name>
      <description>Identifies the controls being assessed and their control objectives.</description>
      <model>
         <define-field name="description" min-occurs="0" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
            <formal-name>Control Objective Description</formal-name>
            <description>A human-readable description of control objectives.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>

         <define-assembly name="control-selection" min-occurs="1" max-occurs="unbounded">
            <formal-name>Assessed Controls</formal-name>
            <description>Identifies the controls being assessed. In the assessment plan, these are the planned controls. In the assessment results, these are the actual controls, and reflects any changes from the plan.</description>
            <group-as name="control-selections" in-json="ARRAY"/>
            <model>
               <define-field name="description" min-occurs="0" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
                  <formal-name>Assessed Controls Description</formal-name>
                  <description>A human-readable description of in-scope controls specified for assessment.</description>
               </define-field>
               <assembly ref="property" max-occurs="unbounded">
                  <group-as name="props" in-json="ARRAY"/>
               </assembly>
               <assembly ref="link" max-occurs="unbounded">
                  <group-as name="links" in-json="ARRAY"/>
               </assembly>
               <choice>
                  <assembly ref="include-all" min-occurs="1"/>
                  <assembly ref="select-control-by-id" min-occurs="1" max-occurs="unbounded">
                     <use-name>include-control</use-name>
                     <group-as name="include-controls" in-json="ARRAY"/>
                     <remarks>
                        <p>Used to select a control for inclusion by the control's identifier. Specific control statements can be selected by their statement identifier.</p>
                     </remarks>
                  </assembly>
               </choice>
               <assembly ref="select-control-by-id" max-occurs="unbounded">
                  <use-name>exclude-control</use-name>
                  <group-as name="exclude-controls" in-json="ARRAY"/>
                  <remarks>
                     <p>Used to select a control for exclusion by the control's identifier. Specific control statements can be excluded by their statement identifier.</p>
                  </remarks>
               </assembly>
               <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
            <remarks>
               <p>The <code>include-all</code>, specifies all control identified in the <strong>baseline</strong> are included in the scope if this assessment, as specified by the <code>include-profile</code> statement within the linked SSP.</p>
               <p>Any control specified within <code>exclude-controls</code> must first be within a range of explicitly included controls, via <code>include-controls</code> or <code>include-all</code>.</p>
            </remarks>
         </define-assembly>

         <define-assembly name="control-objective-selection" min-occurs="0" max-occurs="unbounded">
            <formal-name>Referenced Control Objectives</formal-name>
            <description>Identifies the control objectives of the assessment. In the assessment plan, these are the planned objectives. In the assessment results, these are the assessed objectives, and reflects any changes from the plan.</description>
            <group-as name="control-objective-selections" in-json="ARRAY"/>
            <model>
               <define-field name="description" min-occurs="0" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
                  <formal-name>Control Objectives Description</formal-name>
                  <description>A human-readable description of this collection of control objectives.</description>
               </define-field>
               <assembly ref="property" max-occurs="unbounded">
                  <group-as name="props" in-json="ARRAY"/>
               </assembly>
               <assembly ref="link" max-occurs="unbounded">
                  <group-as name="links" in-json="ARRAY"/>
               </assembly>
               <choice>
                  <assembly ref="include-all" min-occurs="1"/>
                  <assembly ref="select-objective-by-id" min-occurs="1" max-occurs="unbounded">
                     <use-name>include-objective</use-name>
                     <group-as name="include-objectives" in-json="ARRAY"/>
                     <remarks>
                        <p>Used to select a control objective for inclusion by the control objective's identifier.</p>
                     </remarks>
                  </assembly>
               </choice>
               <assembly ref="select-objective-by-id" max-occurs="unbounded">
                  <use-name>exclude-objective</use-name>
                  <group-as name="exclude-objectives" in-json="ARRAY"/>
                  <remarks>
                     <p>Used to select a control objective for exclusion by the control objective's identifier.</p>
                  </remarks>
               </assembly>
               <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
            <remarks>
               <p>The <code>include-all</code> field, specifies all control objectives for any in-scope control. In-scope controls are defined in the <code>control-selection</code>.</p>
               <p>Any control objective specified within <code>exclude-controls</code> must first be within a range of explicitly included control objectives, via <code>include-objectives</code> or <code>include-all</code>.</p>
            </remarks>
         </define-assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
      <remarks>
         <p>In the context of an assessment plan, this construct is used to identify the controls and control objectives that are to be assessed. In the context of an assessment result, this construct is used to identify the actual controls and objectives that were assessed, reflecting any changes from the plan.</p>
         <p>When resolving the selection of controls and control objectives, the following processing will occur:</p>
         <p>1. Controls will be resolved by creating a set of controls based on the control-selections by first handling the includes, and then removing any excluded controls.</p>
         <p>2. The set of control objectives will be resolved from the set of controls that was generated in the previous step. The set of control objectives is based on the control-objective-selection by first handling the includes, and then removing any excluded control objectives.</p>
      </remarks>
   </define-assembly>

   <define-assembly name="select-control-by-id" scope="local">
      <formal-name>Select Control</formal-name>
      <description>Used to select a control for inclusion/exclusion based on one or more control identifiers. A set of statement identifiers can be used to target the inclusion/exclusion to only specific control statements providing more granularity over the specific statements that are within the asessment scope.</description>
      <flag ref="control-id" required="yes"/>
      <model>
         <define-field name="statement-id" as-type="token" min-occurs="0" max-occurs="unbounded" >
            <formal-name>Include Specific Statements</formal-name>
            <description>Used to constrain the selection to only specificity identified statements.</description>
            <group-as name="statement-ids" in-json="ARRAY"/>
         </define-field>
      </model>
   </define-assembly>

   <define-assembly name="select-objective-by-id">
      <formal-name>Select Objective</formal-name>
      <description>Used to select a control objective for inclusion/exclusion based on the control objective's identifier.</description>
      <flag ref="objective-id" required="yes"/>
   </define-assembly>

   <!-- ********** ASSESSMENT SUBJECT Assembly ********** -->
   <define-assembly name="assessment-subject-placeholder">
      <formal-name>Assessment Subject Placeholder</formal-name>
      <description>Used when the assessment subjects will be determined as part of one or more other assessment activities. These assessment subjects will be recorded in the assessment results in the assessment log.</description>
      <define-flag name="uuid" required="yes" as-type="uuid">
         <formal-name>Assessment Subject Placeholder Universally Unique Identifier</formal-name>
          <!-- Identifier Declaration -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier for a set of assessment subjects that will be identified by a task or an activity that is part of a task. The locally defined <em>UUID</em> of the <code>assessment subject placeholder</code> can be used to reference the data item locally or globally (e.g., in an <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">imported OSCAL instance</a>). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
      </define-flag>
      <model>
         <define-field name="description" as-type="markup-multiline" in-xml="WITH_WRAPPER">
            <formal-name>Assessment Subject Placeholder Description</formal-name>
            <description>A human-readable description of intent of this assessment subject placeholder.</description>
         </define-field>
         <define-assembly name="source" min-occurs="1" max-occurs="unbounded">
            <formal-name>Assessment Subject Source</formal-name>
            <description>Assessment subjects will be identified while conducting the referenced activity-instance.</description>
            <group-as name="sources" in-json="ARRAY"/>
            <define-flag name="task-uuid" required="yes" as-type="uuid">
               <formal-name>Task Universally Unique Identifier</formal-name>
               <!-- Identifier Declaration -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference (in this or other OSCAL instances) an assessment activity to be performed as part of the event. The locally defined <em>UUID</em> of the <code>task</code> can be used to reference the data item locally or globally (e.g., in an <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">imported OSCAL instance</a>). This UUID should be assigned <em>per-subject</em>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
         </define-assembly>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
   </define-assembly>

   <define-assembly name="assessment-subject">
      <formal-name>Subject of Assessment</formal-name>
      <description>Identifies system elements being assessed, such as components, inventory items, and locations. In the assessment plan, this identifies a planned assessment subject. In the assessment results this is an actual assessment subject, and reflects any changes from the plan. exactly what will be the focus of this assessment. Any subjects not identified in this way are out-of-scope.</description>
      <define-flag name="type" as-type="token" required="yes">
         <formal-name>Subject Type</formal-name>
         <description>Indicates the type of assessment subject, such as a component, inventory, item, location, or party represented by this selection statement.</description>
         <constraint>
            <allowed-values allow-other="yes">
               <enum value="component">The referenced assessment subject is a component defined in the SSP, or in the <code>local-definitions</code> of an Assessment Plan or Assessment Results.</enum>
               <enum value="inventory-item">The referenced assessment subject is a inventory item defined in the SSP, or in the <code>local-definitions</code> of an Assessment Plan or Assessment Results.</enum>
               <enum value="location">The referenced assessment subject is a <code>location</code> defined in the <code>metadata</code> of the SSP, Assessment Plan, or Assessment Results.</enum>
               <enum value="party">The referenced assessment subject is a person or team to interview, who is defined as a <code>party</code> in the <code>metadata</code> of the SSP, Assessment Plan, or Assessment Results.</enum>
               <enum value="user">The referenced assessment subject is a <code>user</code> defined in the SSP, or in the <code>local-definitions</code> of an Assessment Plan or Assessment Results.</enum>
            </allowed-values>
         </constraint>
      </define-flag>
      <model>
         <define-field name="description"  min-occurs="0" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
            <formal-name>Include Subjects Description</formal-name>
            <description>A human-readable description of the collection of subjects being included in this assessment.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <choice>
            <assembly ref="include-all" min-occurs="1"/>
            <assembly ref="select-subject-by-id" min-occurs="1" max-occurs="unbounded">
               <use-name>include-subject</use-name>
               <group-as name="include-subjects" in-json="ARRAY"/>
            </assembly>
         </choice>
         <assembly ref="select-subject-by-id" min-occurs="0" max-occurs="unbounded">
            <use-name>exclude-subject</use-name>
            <group-as name="exclude-subjects" in-json="ARRAY"/>
         </assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
      <remarks>
         <p>Processing of an include/exclude pair starts with processing the include, then removing matching entries in the exclude.</p>
      </remarks>
   </define-assembly>

   <define-assembly name="select-subject-by-id">
      <formal-name>Select Assessment Subject</formal-name>
      <description>Identifies a set of assessment subjects to include/exclude by UUID.</description>
      <flag ref="subject-uuid" required="yes"/>
      <flag ref="subject-type" required="yes">
         <use-name>type</use-name>
      </flag>
      <model>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
   </define-assembly>

   <define-flag name="subject-uuid" as-type="uuid" scope="local">
      <formal-name>Subject Universally Unique Identifier Reference</formal-name>
      <!-- Identifier Reference -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a component, inventory-item, location, party, user, or resource using it's UUID.</description>
   </define-flag>

   <define-flag name="subject-type" as-type="token" scope="local">
      <formal-name>Subject Universally Unique Identifier Reference Type</formal-name>
      <description>Used to indicate the type of object pointed to by the <code>uuid-ref</code> within a subject.</description>
      <constraint>
         <allowed-values allow-other="yes">
            <enum value="component">Component</enum>
            <enum value="inventory-item">Inventory Item</enum>
            <enum value="location">Location</enum>
            <enum value="party">Interview Party</enum>
            <enum value="user">User</enum>
            <enum value="resource">Resource or Artifact</enum>
         </allowed-values>
      </constraint>
   </define-flag>

   <define-assembly name="subject-reference" scope="local">
      <formal-name>Identifies the Subject</formal-name>
      <!-- Identifier Reference -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#human-oriented">human-oriented</a> identifier reference to a resource. Use type to indicate whether the identified resource is a component, inventory item, location, user, or something else.</description>
      <flag ref="subject-uuid" required="yes"/>
      <flag ref="subject-type" required="yes">
         <use-name>type</use-name>
      </flag>
      <model>
         <define-field name="title" min-occurs="0" max-occurs="1" as-type="markup-line">
            <!-- QUESTION: Is this needed, since the title from the target can be used? -->
            <formal-name>Subject Reference Title</formal-name>
            <description>The title or name for the referenced subject.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
      <remarks>
         <p>The subject reference UUID could point to an item defined in the SSP, AP, or AR.</p>
         <p>Tools should check look for the ID in every file imported directly or indirectly.</p>
      </remarks>
   </define-assembly>

   <!-- ********** ASSET Assembly ********** -->
   <define-assembly name="assessment-assets">
      <formal-name>Assessment Assets</formal-name>
      <description>Identifies the assets used to perform this assessment, such as the assessment team, scanning tools, and assumptions.</description>
      <model>
         <assembly ref="system-component" min-occurs="0" max-occurs="unbounded">
            <use-name>component</use-name>
            <group-as name="components" in-json="ARRAY"/>
            <remarks>
               <p>Used to add any components for tools used during the assessment. These are represented here to avoid mixing with system components.</p>
               <p>The technology tools used by the assessor to perform the assessment, such as vulnerability scanners. In the assessment plan these are the intended tools. In the assessment results, these are the actual tools used, including any differences from the assessment plan.</p>
            </remarks>
         </assembly>
         <define-assembly name="assessment-platform" min-occurs="1" max-occurs="unbounded">
            <formal-name>Assessment Platform</formal-name>
            <description>Used to represent the toolset used to perform aspects of the assessment.</description>
            <group-as name="assessment-platforms" in-json="ARRAY"/>
            <define-flag name="uuid" required="yes" as-type="uuid">
               <formal-name>Assessment Platform Universally Unique Identifier</formal-name>
               <!-- Identifier Declaration -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this assessment platform elsewhere in this or other OSCAL instances. The locally defined <em>UUID</em> of the <code>assessment platform</code> can be used to reference the data item locally or globally (e.g., in an <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">imported OSCAL instance</a>). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <model>
               <define-field name="title" max-occurs="1" as-type="markup-line">
                  <formal-name>Assessment Platform Title</formal-name>
                  <description>The title or name for the assessment platform.</description>
               </define-field>
               <assembly ref="property" max-occurs="unbounded">
                  <group-as name="props" in-json="ARRAY"/>
               </assembly>
               <assembly ref="link" max-occurs="unbounded">
                  <group-as name="links" in-json="ARRAY"/>
               </assembly>
               <define-assembly name="uses-component" min-occurs="0" max-occurs="unbounded">
                  <formal-name>Uses Component</formal-name>
                  <description>The set of components that are used by the assessment platform.</description>
                  <group-as name="uses-components" in-json="ARRAY"/>
                  <define-flag required="yes" name="component-uuid" as-type="uuid">
                     <formal-name>Component Universally Unique Identifier Reference</formal-name>
                     <!-- Identifier Reference -->
                     <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a component that is implemented as part of an inventory item.</description>
                  </define-flag>
                  <model>
                     <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                     </assembly>
                     <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                     </assembly>
                     <assembly ref="responsible-party" max-occurs="unbounded">
                        <group-as name="responsible-parties" in-json="ARRAY"/>
                     </assembly>
                     <field ref="remarks" in-xml="WITH_WRAPPER"/>
                  </model>
                  <constraint>
                     <is-unique id="unique-ssp-uses-component-responsible-party" target="responsible-party">
                        <key-field target="@role-id"/>
                        <remarks>
                           <p>Since <code>responsible-party</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
                        </remarks>
                     </is-unique>
                  </constraint>
               </define-assembly>
               <field ref="remarks" in-xml="WITH_WRAPPER"/>
            </model>
         </define-assembly>
      </model>
      <constraint>
         <is-unique id="unique-ssp-assessment-assets-component" target="component">
            <key-field target="@uuid"/>
            <remarks>
               <p>Since multiple assessment <code>component</code> entries can be provided, each component must have a unique <code>uuid</code>.</p>
            </remarks>
         </is-unique>
      </constraint>
   </define-assembly>

   <!-- ********** Assemblies used within RESULTS and POA&M Items ********** -->
   <define-assembly name="finding-target">
      <formal-name>Objective Status</formal-name>
      <description>Captures an assessor's conclusions regarding the degree to which an objective is satisfied.</description>
      <define-flag name="type" as-type="string" required="yes">
         <formal-name>Finding Target Type</formal-name>
         <description>Identifies the type of the target.</description>
         <constraint>
            <allowed-values>
               <enum value="statement-id">A reference to a control statement identifier within a control.</enum>
               <enum value="objective-id">A reference to a control objective identifier within a control.</enum>
            </allowed-values>
         </constraint>
         <remarks>
            <p>The target will always be a reference to: 1) a control statement, or 2) a control objective. In the former case, there is always a single top-level statement within a control. Thus, if the entire control is targeted, this statement identifier can be used.</p>
         </remarks>
      </define-flag>
      <define-flag name="target-id" as-type="token" required="yes">
         <formal-name>Finding Target Identifier Reference</formal-name>
         <!-- Identifier Reference -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference for a specific target qualified by the <code>type</code>.</description>
      </define-flag>
      <model>
         <define-field name="title" min-occurs="0" max-occurs="1" as-type="markup-line">
            <formal-name>Objective Status Title</formal-name>
            <description>The title for this objective status.</description>
         </define-field>
         <define-field name="description" min-occurs="0" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
            <formal-name>Objective Status Description</formal-name>
            <description>A human-readable description of the assessor's conclusions regarding the degree to which an objective is satisfied.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <define-assembly name="status" min-occurs="1">
            <formal-name>Objective Status</formal-name>
            <description>A determination of if the objective is satisfied or not within a given system.</description>
            <define-flag name="state" as-type="token" required="yes">
               <formal-name>Objective Status State</formal-name>
               <description>An indication as to whether the objective is satisfied or not.</description>
            <constraint>
                  <allowed-values>
                  <enum value="satisfied">The objective has been completely satisfied.</enum>
                  <enum value="not-satisfied">The objective has not been completely satisfied, but may be partially satisfied.</enum>
               </allowed-values>
            </constraint>
            </define-flag>
            <define-flag name="reason" as-type="token">
            <formal-name>Objective Status Reason</formal-name>
            <description>The reason the objective was given it's status.</description>
            <constraint>
                  <allowed-values allow-other="yes">
                  <enum value="pass">The target system or system component satisfied all the conditions.</enum>
                  <enum value="fail">The target system or system component did not satisfy all the conditions.</enum>
                  <enum value="other">Some other event took place that is not a pass or a fail.</enum>
               </allowed-values>
            </constraint>
         <remarks>
            <p>Reason may contain any value, and should be used to communicate additional information regarding the status.</p>
         </remarks>
            </define-flag>
            <model>
               <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
         </define-assembly>
         <assembly ref="implementation-status">
            <remarks>
               <p>The <code>implementation-status</code> is used to qualify the <code>status</code> value to indicate the degree to which the control was found to be implemented.</p>
            </remarks>
         </assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
   </define-assembly>

   <define-assembly name="finding">
      <formal-name>Finding</formal-name>
      <description>Describes an individual finding.</description>
      <define-flag name="uuid" required="yes" as-type="uuid">
        <formal-name>Finding Universally Unique Identifier</formal-name>
        <!-- Identifier Declaration -->
        <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this finding in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ar-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>finding</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
      </define-flag>
      <model>
        <define-field name="title" min-occurs="1" as-type="markup-line">
          <formal-name>Finding Title</formal-name>
          <description>The title for this finding.</description>
        </define-field>
        <!-- CHANGE: Added WITH_WRAPPER to description -->
        <define-field name="description" min-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
          <formal-name>Finding Description</formal-name>
          <description>A human-readable description of this finding.</description>
        </define-field>
  
        <assembly ref="property" max-occurs="unbounded">
          <group-as name="props" in-json="ARRAY"/>
        </assembly>
        <assembly ref="link" max-occurs="unbounded">
          <group-as name="links" in-json="ARRAY"/>
        </assembly>
  
        <assembly ref="origin" max-occurs="unbounded">
          <group-as name="origins" in-json="ARRAY"/>
          <remarks>
            <p>Used to identify the individual and/or tool generated this finding.</p>
          </remarks>
        </assembly>
        <assembly ref="finding-target" min-occurs="1">
          <use-name>target</use-name>
        </assembly>
        <define-field name="implementation-statement-uuid" as-type="uuid" min-occurs="0" max-occurs="1">
          <formal-name>Implementation Statement UUID</formal-name>
          <!-- Identifier Reference -->
          <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to the implementation statement in the SSP to which this finding is related.</description>
        </define-field>
        <!-- CHANGED: replaced embedded observation with references -->
        <define-assembly name="related-observation" max-occurs="unbounded">
          <formal-name>Related Observation</formal-name>
          <description>Relates the finding to a set of referenced observations that were used to determine the finding.</description>
          <group-as name="related-observations" in-json="ARRAY"/>
          <define-flag name="observation-uuid" as-type="uuid" required="yes">
            <formal-name>Observation Universally Unique Identifier Reference</formal-name>
            <!-- Identifier Reference -->
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to an observation defined in the list of observations.</description>
          </define-flag>
        </define-assembly>
        <!-- CHANGED: replaced "risk" with new "assciated-risk" -->
        <define-assembly name="associated-risk" max-occurs="unbounded">
          <formal-name>Associated Risk</formal-name>
          <description>Relates the finding to a set of referenced risks that were used to determine the finding.</description>
          <group-as name="related-risks" in-json="ARRAY"/>
          <define-flag name="risk-uuid" as-type="uuid" required="yes">
            <formal-name>Risk Universally Unique Identifier Reference</formal-name>
            <!-- Identifier Reference -->
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a risk defined in the list of risks.</description>
          </define-flag>
        </define-assembly>
        <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
   </define-assembly>

   <define-assembly name="observation">
      <formal-name>Observation</formal-name>
      <description>Describes an individual observation.</description>
      <define-flag name="uuid" required="yes" as-type="uuid">
         <formal-name>Observation Universally Unique Identifier</formal-name>
         <!-- Identifier Declaration -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <em>cross-instance</em> scope that can be used to reference this observation elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>observation</code> can be used to reference the data item locally or globally (e.g., in an imorted OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
      </define-flag>
      <model>
         <define-field name="title" min-occurs="0" max-occurs="1" as-type="markup-line">
            <formal-name>Observation Title</formal-name>
            <description>The title for this observation.</description>
         </define-field>
         <define-field name="description" min-occurs="1" max-occurs="1" in-xml="WITH_WRAPPER"
            as-type="markup-multiline">
            <formal-name>Observation Description</formal-name>
            <description>A human-readable description of this assessment observation.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <define-field name="method" min-occurs="1" max-occurs="unbounded">
            <formal-name>Observation Method</formal-name>
            <description>Identifies how the observation was made.</description>
            <group-as name="methods" in-json="ARRAY"/>
            <constraint>
               <allowed-values target="." allow-other="yes">
                  <enum value="EXAMINE">An inspection was performed.</enum>
                  <enum value="INTERVIEW">An interview was performed.</enum>
                  <enum value="TEST">A manual or automated test was performed.</enum>
                  <enum value="UNKNOWN">This is only for use when converting historic content to OSCAL, where the conversion process cannot initially identify the appropriate method(s).</enum>
               </allowed-values>
            </constraint>
         </define-field>

         <define-field name="type" as-type="token" max-occurs="unbounded">
            <formal-name>Observation Type</formal-name>
            <description>Identifies the nature of the observation. More than one may be used to further qualify and enable filtering.</description>
            <group-as name="types" in-json="ARRAY"/>
            <constraint>
               <allowed-values target="." allow-other="yes">
                  <enum value="ssp-statement-issue">A difference between the SSP implementation statement, and actual implementation.</enum>
                  <enum value="control-objective">An observation about the status of a the associated control objective.</enum>
                  <enum value="mitigation">A mitigating factor was identified.</enum>
                  <enum value="finding">An assessment finding. Used for observations made by tools, penetration testing, and other means.</enum>
                  <enum value="historic">An observation from a past assessment, which was converted to OSCAL at a later date.</enum>
               </allowed-values>
            </constraint>
         </define-field>
         <assembly ref="origin" max-occurs="unbounded">
            <group-as name="origins" in-json="ARRAY"/>
            <remarks>
               <p>Used to identify the individual and/or tool that gathered the evidence resulting in the observation identification.</p>
            </remarks>
         </assembly>
         <assembly ref="subject-reference" min-occurs="0" max-occurs="unbounded">
            <use-name>subject</use-name>
            <group-as name="subjects" in-json="ARRAY"/>
            <remarks>
               <p>Identifies who was interviewed, or what was tested or inspected.</p>
            </remarks>
         </assembly>

         <define-assembly name="relevant-evidence" max-occurs="unbounded">
            <formal-name>Relevant Evidence</formal-name>
            <description>Links this observation to relevant evidence.</description>
            <group-as name="relevant-evidence" in-json="ARRAY"/>
            <define-flag name="href" as-type="uri-reference">
               <formal-name>Relevant Evidence Reference</formal-name>
               <description>A resolvable URL reference to relevant evidence.</description>
               <remarks>
                  <p>This value may be one of:</p>
                  <ol>
                     <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
                     <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
                     <li>a bare URI fragment (i.e., `#uuid`) pointing to a <code>back-matter</code> resource in this or an imported document (see <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking to another OSCAL object</a>).</li>
                  </ol>
               </remarks>
            </define-flag>
            <model>
               <define-field name="description" min-occurs="1" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
                  <formal-name>Relevant Evidence Description</formal-name>
                  <description>A human-readable description of this evidence.</description>
               </define-field>
               <assembly ref="property" max-occurs="unbounded">
                  <group-as name="props" in-json="ARRAY"/>
               </assembly>
               <assembly ref="link" max-occurs="unbounded">
                  <group-as name="links" in-json="ARRAY"/>
               </assembly>
               <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
         </define-assembly>
         <define-field name="collected" as-type="date-time-with-timezone" min-occurs="1" max-occurs="1">
            <formal-name>Collected Field</formal-name>
            <description>Date/time stamp identifying when the finding information was collected.</description>
         </define-field>
         <define-field name="expires" as-type="date-time-with-timezone" min-occurs="0" max-occurs="1">
            <formal-name>Expires Field</formal-name>
            <description>Date/time identifying when the finding information is out-of-date and no longer valid. Typically used with continuous assessment scenarios.</description>
         </define-field>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
<!--      <constraint>
         <!-\- TODO: review these and figure out where these go -\->
         <allowed-values target="origin/@type" allow-other="no">
            <!-\\- CHANGED: "tool" to "******" -\\->
            <enum value="tool">An assessment tool, defined in the assets section of the assessment plan or results.</enum>
            <enum value="test-method">A test method defined in the assessment-activities section of the assessment plan or results.</enum>
            <enum value="task">A task defined in the schedule of the assessment plan or results.</enum>
            <enum value="included-activity">An assessment activity defined in the assessment-activities section of the assessment plan or results.</enum>
            <enum value="other">The UUID points elsewhere in the this file or an imported file.</enum>
         </allowed-values>
      </constraint>
-->   </define-assembly>

   <define-assembly name="origin">
      <formal-name>Origin</formal-name>
      <description>Identifies the source of the finding, such as a tool, interviewed person, or activity.</description>
      <model>
         <assembly ref="origin-actor" min-occurs="1" max-occurs="unbounded">
            <use-name>actor</use-name>
            <group-as name="actors" in-json="ARRAY"/>
         </assembly>
         <assembly ref="related-task" max-occurs="unbounded">
            <group-as name="related-tasks" in-json="ARRAY"/>
         </assembly>
      </model>
   </define-assembly>

   <define-assembly name="origin-actor">
      <formal-name>Originating Actor</formal-name>
      <description>The actor that produces an observation, a finding, or a risk. One or more actor type can be used to specify a person that is using a tool.</description>
      <define-flag name="type" as-type="token" required="yes">
         <formal-name>Actor Type</formal-name>
         <description>The kind of actor.</description>
         <constraint>
            <allowed-values>
               <enum value="tool">A reference to a tool component defined with the assessment assets.</enum>
               <enum value="assessment-platform">A reference to an assessment-platform defined with the assessment assets.</enum>
               <enum value="party">A reference to a party defined within the document metadata.</enum>
            </allowed-values>
         </constraint>
      </define-flag>
      <define-flag name="actor-uuid" as-type="uuid" required="yes">
         <formal-name>Actor Universally Unique Identifier Reference</formal-name>
         <!-- Identifier Reference -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to the tool or person based on the associated type.</description>
      </define-flag>
      <define-flag name="role-id" as-type="token">
         <formal-name>Actor Role</formal-name>
         <description>For a party, this can optionally be used to specify the role the actor was performing.</description>
      </define-flag>
      <model>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
      </model>
   </define-assembly>

   <define-assembly name="related-task">
      <formal-name>Task Reference</formal-name>
      <description>Identifies an individual task for which the containing object is a consequence of.</description>
      <define-flag name="task-uuid" required="yes" as-type="uuid">
         <formal-name>Task Universally Unique Identifier Reference</formal-name>
         <!-- Identifier Reference -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a unique task.</description>
      </define-flag>
      <model>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <assembly ref="responsible-party" max-occurs="unbounded">
            <group-as name="responsible-parties" in-json="ARRAY"/>
            <remarks>
               <p>Identifies the person or organization responsible for performing a specific role defined by the activity.</p>
            </remarks>
         </assembly>
         <assembly ref="assessment-subject" max-occurs="unbounded">
            <use-name>subject</use-name>
            <group-as name="subjects" in-json="ARRAY"/>
            <remarks>
               <p>The assessment subjects that the task was performed against.</p>
            </remarks>
         </assembly>
         <define-assembly name="identified-subject">
            <formal-name>Identified Subject</formal-name>
            <description>Used to detail assessment subjects that were identfied by this task.</description>

            <define-flag name="subject-placeholder-uuid" required="yes" as-type="uuid">
               <formal-name>Assessment Subject Placeholder Universally Unique Identifier Reference</formal-name>
               <!-- Identifier Reference -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a unique assessment subject placeholder defined by this task.</description>
            </define-flag>
            <model>
               <assembly ref="assessment-subject" min-occurs="1" max-occurs="unbounded">
                  <use-name>subject</use-name>
                  <group-as name="subjects" in-json="ARRAY"/>
                  <remarks>
                     <p>The assessment subjects that the task identified, which will be used by another task through a subject-placeholder reference. Such a task will "consume" these subjects.</p>
                  </remarks>
               </assembly>
            </model>
         </define-assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
      <constraint>
         <is-unique id="unique-ssp-related-task-responsible-party" target="responsible-party">
            <key-field target="@role-id"/>
            <remarks>
               <p>Since <code>responsible-party</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
            </remarks>
         </is-unique>
      </constraint>
   </define-assembly>

   <define-field name="threat-id" as-type="uri">
      <!-- This is an id because it is an externally provided identifier -->
      <formal-name>Threat ID</formal-name>
      <description>A pointer, by ID, to an externally-defined threat.</description>
      <json-value-key>id</json-value-key>
      <define-flag name="system" as-type="uri" required="yes">
         <formal-name>Threat Type Identification System</formal-name>
         <description>Specifies the source of the threat information.</description>
         <constraint>
            <allowed-values allow-other="yes">
               <enum value="http://fedramp.gov" deprecated="1.0.3">**deprecated** The value conforms to FedRAMP definitions. This value has been deprecated; use <code>http://fedramp.gov/ns/oscal</code> instead.</enum>
               <enum value="http://fedramp.gov/ns/oscal">The value conforms to FedRAMP definitions.</enum>
            </allowed-values>
         </constraint>
         <remarks>
            <p>This value must be an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that serves as a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#use-as-a-naming-system-identifier">naming system identifier</a>.</p>
         </remarks>
      </define-flag>
      <define-flag name="href" as-type="uri-reference">
         <!-- TODO: consider deprecating this in favor of a link -->
         <formal-name>Threat Information Resource Reference</formal-name>
         <description>An optional location for the threat data, from which this ID originates.</description>
         <remarks>
            <p>This value may be one of:</p>
            <ol>
               <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
               <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
               <li>a bare URI fragment (i.e., `#uuid`) pointing to a <code>back-matter</code> resource in this or an imported document (see <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking to another OSCAL object</a>).</li>
            </ol>
         </remarks>
      </define-flag>
   </define-field>

   <define-assembly name="risk">
      <formal-name>Identified Risk</formal-name>
      <description>An identified risk.</description>
      <define-flag name="uuid" required="yes" as-type="uuid">
         <formal-name>Risk Universally Unique Identifier</formal-name>
         <!-- Identifier Declaration -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this risk elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>risk</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
      </define-flag>
      <model>
         <define-field name="title" min-occurs="1" max-occurs="1" as-type="markup-line">
            <formal-name>Risk Title</formal-name>
            <description>The title for this risk.</description>
         </define-field>
         <define-field name="description" min-occurs="1" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
            <formal-name>Risk Description</formal-name>
            <description>A human-readable summary of the identified risk, to include a statement of how the risk impacts the system.</description>
         </define-field>
         <define-field name="statement" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
            <!-- QUESTION: how is this different from description? -->
            <!-- TODO: remove this -->
            <formal-name>Risk Statement</formal-name>
            <description>An summary of impact for how the risk affects the system.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <field ref="risk-status" min-occurs="1">
            <use-name>status</use-name>
         </field>
         <assembly ref="origin" max-occurs="unbounded">
            <group-as name="origins" in-json="ARRAY"/>
            <remarks>
               <p>Used to identify the individual and/or tool that identified this risk.</p>
            </remarks>
         </assembly>
         <field ref="threat-id" min-occurs="0" max-occurs="unbounded">
            <!-- QUESTION: Should this be moved to risk? -->
            <group-as name="threat-ids" in-json="ARRAY"/>
         </field>

         <assembly ref="characterization" min-occurs="0" max-occurs="unbounded">
            <group-as name="characterizations" in-json="ARRAY"/>
         </assembly>
         <define-assembly name="mitigating-factor" max-occurs="unbounded">
            <formal-name>Mitigating Factor</formal-name>
            <description>Describes an existing mitigating factor that may affect the overall determination of the risk, with an optional link to an implementation statement in the SSP.</description>
            <group-as name="mitigating-factors" in-json="ARRAY"/>
            <define-flag name="uuid" required="yes" as-type="uuid">
               <formal-name>Mitigating Factor Universally Unique Identifier</formal-name>
               <!-- Identifier Declaration -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this mitigating factor elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>mitigating factor</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <define-flag name="implementation-uuid" as-type="uuid">
               <formal-name>Implementation UUID</formal-name>
               <!-- Identifier Declaration -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this implementation statement elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>s. The locally defined <em>UUID</em> of the <code>implementation statement</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <model>
               <define-field name="description" min-occurs="1" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
                  <formal-name>Mitigating Factor Description</formal-name>
                  <description>A human-readable description of this mitigating factor.</description>
               </define-field>
               <assembly ref="property" max-occurs="unbounded">
                  <group-as name="props" in-json="ARRAY"/>
               </assembly>
               <assembly ref="link" max-occurs="unbounded">
                  <group-as name="links" in-json="ARRAY"/>
               </assembly>
               <assembly ref="subject-reference" min-occurs="0" max-occurs="unbounded">
                  <use-name>subject</use-name>
                  <group-as name="subjects" in-json="ARRAY"/>
                  <remarks>
                     <p>Links identifiable elements of the system to this mitigating factor, such as an inventory-item or component.</p>
                  </remarks>
               </assembly>
            </model>
         </define-assembly>

         <define-field name="deadline" as-type="date-time-with-timezone">
            <formal-name>Risk Resolution Deadline</formal-name>
            <description>The date/time by which the risk must be resolved.</description>
         </define-field>

         <assembly ref="response" min-occurs="0" max-occurs="unbounded">
            <group-as name="remediations" in-json="ARRAY"/>
         </assembly>
         <define-assembly name="risk-log">
            <formal-name>Risk Log</formal-name>
            <description>A log of all risk-related tasks taken.</description>
            <model>
               <define-assembly name="entry" min-occurs="1" max-occurs="unbounded">
                  <formal-name>Risk Log Entry</formal-name>
                  <description>Identifies an individual risk response that occurred as part of managing an identified risk.</description>
                  <group-as name="entries" in-json="ARRAY"/>
                  <define-flag name="uuid" required="yes" as-type="uuid">
                     <formal-name>Risk Log Entry Universally Unique Identifier</formal-name>
                     <!-- Identifier Declaration -->
                     <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this risk log entry elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>risk log entry</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
                  </define-flag>
                  <model>
                     <define-field name="title" min-occurs="0" max-occurs="1" as-type="markup-line">
                        <formal-name>Title</formal-name>
                        <description>The title for this risk log entry.</description>
                     </define-field>
                     <define-field name="description" min-occurs="0" max-occurs="1" as-type="markup-multiline" in-xml="WITH_WRAPPER">
                        <formal-name>Risk Task Description</formal-name>
                        <description>A human-readable description of what was done regarding the risk.</description>
                     </define-field>
                     <define-field name="start" as-type="date-time-with-timezone" min-occurs="1" max-occurs="1">
                        <formal-name>Start</formal-name>
                        <description>Identifies the start date and time of the event.</description>
                     </define-field>
                     <define-field name="end" as-type="date-time-with-timezone" max-occurs="1">
                        <formal-name>End</formal-name>
                        <description>Identifies the end date and time of the event. If the event is a point in time, the start and end will be the same date and time.</description>
                     </define-field>
                     <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                     </assembly>
                     <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                     </assembly>
                     <assembly ref="logged-by" max-occurs="unbounded">
                        <group-as name="logged-by" in-json="ARRAY"/>
                     </assembly>
                     <field ref="risk-status">
                        <use-name>status-change</use-name>
                        <remarks>
                           <p>Identifies a change in risk status made resulting from the task described by this risk log entry. This allows the risk's status history to be captured as a sequence of risk log entries.</p>
                        </remarks>
                     </field>
                     <define-assembly name="related-response" max-occurs="unbounded">
                        <formal-name>Risk Response Reference</formal-name>
                        <description>Identifies an individual risk response that this log entry is for.</description>
                        <group-as name="related-responses" in-json="ARRAY"/>
                        <define-flag name="response-uuid" required="yes" as-type="uuid">
                           <formal-name>Response Universally Unique Identifier Reference</formal-name>
                           <!-- Identifier Reference -->
                           <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a unique risk response.</description>
                        </define-flag>
                        <model>
                           <assembly ref="property" max-occurs="unbounded">
                              <group-as name="props" in-json="ARRAY"/>
                           </assembly>
                           <assembly ref="link" max-occurs="unbounded">
                              <group-as name="links" in-json="ARRAY"/>
                           </assembly>
                           <assembly ref="related-task" max-occurs="unbounded">
                              <group-as name="related-tasks" in-json="ARRAY"/>
                              <remarks>
                                 <p>This is used to identify the task(s) that this log entry was generated for.</p>
                              </remarks>
                           </assembly>
                           <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
                        </model>
                     </define-assembly>
                     <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
                  </model>
                  <constraint>
                     <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="type">The type of remediation tracking entry. Can be multi-valued.</enum>
                     </allowed-values>
                     <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='type']/@value" allow-other="yes">
                        <enum value="vendor-check-in">Contacted vendor to determine the status of a pending fix to a known vulnerability.</enum>
                        <enum value="status-update">Information related to the current state of response to this risk.</enum>
                        <enum value="milestone-complete">A significant step in the response plan has been achieved.</enum>
                        <enum value="mitigation">An activity was completed that reduces the likelihood or impact of this risk.</enum>
                        <enum value="remediated">An activity was completed that eliminates the likelihood or impact of this risk.</enum>
                        <!-- QUESTION: Is this needed, since this is handled by the status field? -->
                        <enum value="closed">The risk is no longer applicable to the system.</enum>
                        <enum value="dr-submission">A deviation request was made to the authorizing official.</enum>
                        <enum value="dr-updated">A previously submitted deviation request has been modified.</enum>
                        <enum value="dr-approved">The authorizing official approved the deviation.</enum>
                        <enum value="dr-rejected">The authorizing official rejected the deviation.</enum>
                     </allowed-values>
                  </constraint>
               </define-assembly>
            </model>
         </define-assembly>

         <define-assembly name="related-observation" max-occurs="unbounded">
            <formal-name>Related Observation</formal-name>
            <description>Relates the finding to a set of referenced observations that were used to determine the finding.</description>
            <group-as name="related-observations" in-json="ARRAY"/>
            <define-flag name="observation-uuid" as-type="uuid" required="yes">
               <formal-name>Observation Universally Unique Identifier Reference</formal-name>
               <!-- Identifier Reference -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to an observation defined in the list of observations.</description>
            </define-flag>
         </define-assembly>
      </model>
      <constraint>
         <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
            <enum value="false-positive">The risk has been confirmed to be a false positive.</enum>
            <enum value="accepted">The risk has been accepted. No further action will be taken.</enum>
            <enum value="risk-adjusted">The risk has been adjusted.</enum>
            <enum value="priority">A numeric value indicating the sequence in which risks should be addressed. (Lower numbers are higher priority)</enum>
         </allowed-values>
         <matches target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='priority']/@value" datatype="integer" />
      </constraint>
   </define-assembly>

   <define-assembly name="logged-by">
      <formal-name>Logged By</formal-name>
      <description>Used to indicate who created a log entry in what role.</description>
      <define-flag name="party-uuid" as-type="uuid" required="yes">
         <formal-name>Party UUID Reference</formal-name>
         <!-- Identifier Reference -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to the party who is making the log entry.</description>
      </define-flag>
      <define-flag name="role-id" as-type="token">
         <formal-name>Actor Role</formal-name>
         <description>A point to the role-id of the role in which the party is making the log entry.</description>
      </define-flag>
   </define-assembly>

   <define-field name="risk-status" as-type="token">
      <formal-name>Risk Status</formal-name>
      <description>Describes the status of the associated risk.</description>
      <constraint>
         <allowed-values target="." allow-other="yes">
            <enum value="open">The risk has been identified.</enum>
            <enum value="investigating">The identified risk is being investigated. (Open risk)</enum>
            <enum value="remediating">Remediation activities are underway, but are not yet complete. (Open risk)</enum>
            <enum value="deviation-requested">A risk deviation, such as false positive, risk reduction, or operational requirement has been submitted for approval. (Open risk)</enum>
            <enum value="deviation-approved">A risk deviation, such as false positive, risk reduction, or operational requirement has been approved. (Open risk)</enum>
            <enum value="closed">The risk has been resolved.</enum>
         </allowed-values>
      </constraint>
   </define-field>

   <define-assembly name="characterization">
      <formal-name>Characterization</formal-name>
      <description>A collection of descriptive data about the containing object from a specific origin.</description>
      <model>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <assembly ref="origin" min-occurs="1">
            <remarks>
               <p>metadata about the specific actor that generated this descriptive data.</p>
            </remarks>
         </assembly>
         <define-assembly name="facet" min-occurs="1" max-occurs="unbounded">
            <formal-name>Facet</formal-name>
            <description>An individual characteristic that is part of a larger set produced by the same actor.</description>
            <group-as name="facets" in-json="ARRAY"/>
            <define-flag name="name" as-type="token" required="yes">
               <formal-name>Facet Name</formal-name>
               <description>The name of the risk metric within the specified system.</description>
            </define-flag>
            <define-flag name="system" as-type="uri" required="yes">
               <formal-name>Naming System</formal-name>
               <description>Specifies the naming system under which this risk metric is organized, which allows for the same names to be used in different systems controlled by different parties. This avoids the potential of a name clash.</description>
               <constraint>
                  <allowed-values allow-other="yes"><!-- Other values -->
                     <enum value="http://fedramp.gov" deprecated="1.0.3">**deprecated** The FedRAMP naming system. This has been deprecated; use <code>http://fedramp.gov/ns/oscal</code> instead.</enum>
                     <enum value="http://fedramp.gov/ns/oscal">The facet naming system defined by FedRAMP.</enum>
                     <enum value="http://csrc.nist.gov/ns/oscal">The facet naming system defined by OSCAL.</enum>
                     <enum value="http://csrc.nist.gov/ns/oscal/unknown">The facet is from an unknown taxonomy. The meaning of the name is tool or organization specific.</enum>
                     <enum value="http://cve.mitre.org">The facet naming system defined by the CVE Program.</enum>
                     <!-- To identify which CVSS values to use -->
                     <enum value="http://www.first.org/cvss/v2.0">The facet naming system for representing Common Vunerability Scoring System (CVSS) vectors as defined by the the <a href="https://www.first.org/">Forum for Incident Response and Security Teams</a> <a href="https://www.first.org/cvss/">CVSS Special Interest Group</a> (CVSS-SIG) for <a href="https://www.first.org/cvss/v2/">CVSS v2</a>.</enum>
                     <enum value="http://www.first.org/cvss/v3.0">The facet naming system for representing Common Vunerability Scoring System (CVSS) vectors as defined by the the <a href="https://www.first.org/">Forum for Incident Response and Security Teams</a> <a href="https://www.first.org/cvss/">CVSS Special Interest Group</a> (CVSS-SIG) for <a href="https://www.first.org/cvss/v3-0/">CVSS v3.0</a>.</enum>
                     <enum value="http://www.first.org/cvss/v3.1">The facet naming system for representing Common Vunerability Scoring System (CVSS) vectors as defined by the the <a href="https://www.first.org/">Forum for Incident Response and Security Teams</a> <a href="https://www.first.org/cvss/">CVSS Special Interest Group</a> (CVSS-SIG) for <a href="https://www.first.org/cvss/v3-1/">CVSS v3.1</a>.</enum>
                     <enum value="https://www.first.org/cvss/v4-0">The facet naming system for representing Common Vunerability Scoring System (CVSS) vectors as defined by the the <a href="https://www.first.org/">Forum for Incident Response and Security Teams</a> <a href="https://www.first.org/cvss/">CVSS Special Interest Group</a> (CVSS-SIG) for <a href="https://www.first.org/cvss/v4-0/">CVSS v4.0</a>.</enum>
                  </allowed-values>
               </constraint>
               <remarks>
                  <p>This value must be an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that serves as a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#use-as-a-naming-system-identifier">naming system identifier</a>.</p>
               </remarks>
            </define-flag>
            <define-flag name="value" as-type="string" required="yes">
               <formal-name>Facet Value</formal-name>
               <description>Indicates the value of the facet.</description>
            </define-flag>
            <model>
               <assembly ref="property" max-occurs="unbounded">
                  <group-as name="props" in-json="ARRAY"/>
               </assembly>
               <assembly ref="link" max-occurs="unbounded">
                  <group-as name="links" in-json="ARRAY"/>
               </assembly>
               <field ref="remarks" in-xml="WITH_WRAPPER"/>
            </model>
            <constraint>
               <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                  <enum value="state">Indicates if the facet is 'initial' as first identified, or 'adjusted' indicating that the value has be changed after some adjustments have been made (e.g., to identify residual risk).</enum>
               </allowed-values>
               <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='state']/@value"><!-- For values related to initial and residual (mitigated) risk -->
                  <enum value="initial">As first identified.</enum>
                  <enum value="adjusted">Indicates that residual risk remains after some adjustments have been made.</enum>
               </allowed-values>
               <!-- TODO: What about "vulnerability-id", "plugin-id"? Should this be added to FedRAMP? -->
               <allowed-values target="(.)[@system='http://csrc.nist.gov/ns/oscal']/@name">
                  <enum value="likelihood">General likelihood rating.</enum>
                  <enum value="impact">General impact rating.</enum>
                  <enum value="risk">General risk rating.</enum>
                  <enum value="severity">General severity rating.</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://fedramp.gov','http://fedramp.gov/ns/oscal')]/@name">
                  <enum value="likelihood">Likelihood as defined by FedRAMP. The <code>class</code> can be used to specify 'initial' and 'adjusted' risk states.</enum>
                  <enum value="impact">Impact as defined by FedRAMP. The <code>class</code> can be used to specify 'initial' and 'adjusted' risk states.</enum>
                  <enum value="risk">Risk as calculated according to FedRAMP. The <code>class</code> can be used to specify 'initial' and 'adjusted' risk states.</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://cve.mitre.org']/@name">
                  <enum value="cve-id">An identifier managed by the CVE program (see <a>https://cve.mitre.org/</a>).</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0']/@name">
                  <enum value="access-vector">Base: Access Vector</enum>
                  <enum value="access-complexity">Base: Access Complexity</enum>
                  <enum value="authentication">Base: Authentication</enum>
                  <enum value="confidentiality-impact">Base: Confidentiality Impact</enum>
                  <enum value="integrity-impact">Base: Integrity Impact</enum>
                  <enum value="availability-impact">Base: Availability Impact</enum>
                  <enum value="exploitability">Temporal: Exploitability</enum>
                  <enum value="remediation-level">Temporal: Remediation Level</enum>
                  <enum value="report-confidence">Temporal: Report Confidence</enum>
                  <enum value="collateral-damage-potential">Environmental: Collateral Damage Potential</enum>
                  <enum value="target-distribution">Environmental: Target Distribution</enum>
                  <enum value="confidentiality-requirement">Environmental: Confidentiality Requirement</enum>
                  <enum value="integrity-requirement">Environmental: Integrity Requirement</enum>
                  <enum value="availability-requirement">Environmental: Availability Requirement</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0' and @name='access-vector']/@value">
                  <enum value="local">Local</enum>
                  <enum value="adjacent-network">Network Adjacent</enum>
                  <enum value="network">Network</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0' and @name='access-complexity']/@value">
                  <enum value="high">High</enum>
                  <enum value="medium">Medium</enum>
                  <enum value="low">Low</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0' and @name='authentication']/@value">
                  <enum value="multiple">Multiple</enum>
                  <enum value="single">Single</enum>
                  <enum value="none">None</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0' and @name=('confidentiality-impact', 'integrity-impact', 'availability-impact')]/@value">
                  <enum value="none">None</enum>
                  <enum value="partial">Partial</enum>
                  <enum value="complete">Complete</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0' and @name='exploitability']/@value">
                  <enum value="unproven">Unproven</enum>
                  <enum value="proof-of-concept">Proof-of-Concept</enum>
                  <enum value="functional">Functional</enum>
                  <enum value="high">High</enum>
                  <enum value="not-defined">Not Defined</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0' and @name='remediation-level']/@value">
                  <enum value="official-fix">Official Fix</enum>
                  <enum value="temporary-fix">Temporary Fix</enum>
                  <enum value="workaround">Workaround</enum>
                  <enum value="unavailable">Unavailable</enum>
                  <enum value="not-defined">Not Defined</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0' and @name='report-confidence']/@value">
                  <enum value="unconfirmed">Unconfirmed</enum>
                  <enum value="uncorroborated">Uncorroborated</enum>
                  <enum value="confirmed">Confirmed</enum>
                  <enum value="not-defined">Not Defined</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0' and @name='collateral-damage-potential']/@value">
                  <enum value="none">None</enum>
                  <enum value="low">Low (light loss)</enum>
                  <enum value="low-medium">Low Medium</enum>
                  <enum value="medium-high">Medium High</enum>
                  <enum value="high">High (catastrophic loss)</enum>
                  <enum value="not-defined">Not Defined</enum>
               </allowed-values>
               <allowed-values target="(.)[@system='http://www.first.org/cvss/v2.0' and @name=('target-distribution', 'confidentiality-requirement', 'integrity-requirement', 'availability-requirement')]/@value">
                  <enum value="none">None</enum>
                  <enum value="low">Low</enum>
                  <enum value="medium">Medium</enum>
                  <enum value="high">High</enum>
                  <enum value="not-defined">Not Defined</enum>
               </allowed-values>

               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1')]/@name">
                  <enum value="attack-vector">Base: Attack Vector</enum>
                  <enum value="access-complexity">Base: Attack Complexity</enum>
                  <enum value="privileges-required">Base: Privileges Required</enum>
                  <enum value="user-interaction">Base: User Interaction</enum>
                  <enum value="scope">Base: Scope</enum>
                  <enum value="confidentiality-impact">Base: Confidentiality Impact</enum>
                  <enum value="integrity-impact">Base: Integrity Impact</enum>
                  <enum value="availability-impact">Base: Availability Impact</enum>
                  <enum value="exploit-code-maturity">Temporal: Exploit Code Maturity</enum>
                  <enum value="remediation-level">Temporal: Remediation Level</enum>
                  <enum value="report-confidence">Temporal: Report Confidence</enum>
                  <enum value="modified-attack-vector">Environmental: Modified Attack Vector</enum>
                  <enum value="modified-attack-complexity">Environmental: Modified Attack Complexity</enum>
                  <enum value="modified-privileges-required">Environmental: Modified Privileges Required</enum>
                  <enum value="modified-user-interaction">Environmental: Modified User Interaction</enum>
                  <enum value="modified-scope">Environmental: Modified Scope</enum>
                  <enum value="modified-confidentiality">Environmental: Modified Confidentiality</enum>
                  <enum value="modified-integrity">Environmental: Modified Integrity</enum>
                  <enum value="modified-availability">Environmental: Modified Availability</enum>
                  <enum value="confidentiality-requirement">Environmental: Confidentiality Requirement Modifier</enum>
                  <enum value="integrity-requirement">Environmental: Integrity Requirement Modifier</enum>
                  <enum value="availability-requirement">Environmental: Availability Requirement Modifier</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='access-vector']/@value">
                  <enum value="network">Network</enum>
                  <enum value="adjacent">Adjacent</enum>
                  <enum value="local">Local</enum>
                  <enum value="physical">Physical</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='access-complexity']/@value">
                  <enum value="high">High</enum>
                  <enum value="low">Low</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name=('privileges-required', 'confidentiality-impact', 'integrity-impact', 'availability-impact')]/@value">
                  <enum value="none">None</enum>
                  <enum value="low">Low</enum>
                  <enum value="high">High</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='user-interaction']/@value">
                  <enum value="none">None</enum>
                  <enum value="required">Required</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='scope']/@value">
                  <enum value="unchanged">Unchanged</enum>
                  <enum value="changed">Changed</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='exploit-code-maturity']/@value">
                  <enum value="not-defined">Not Defined</enum>
                  <enum value="unproven">Unproven</enum>
                  <enum value="proof-of-concept">Proof-of-Concept</enum>
                  <enum value="functional">Functional</enum>
                  <enum value="high">High</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='remediation-level']/@value">
                  <enum value="not-defined">Not Defined</enum>
                  <enum value="official-fix">Official Fix</enum>
                  <enum value="temporary-fix">Temporary Fix</enum>
                  <enum value="workaround">Workaround</enum>
                  <enum value="unavailable">Unavailable</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='report-confidence']/@value">
                  <enum value="not-defined">Not Defined</enum>
                  <enum value="unknown">Unknown</enum>
                  <enum value="reasonable">Reasonable</enum>
                  <enum value="confirmed">Confirmed</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name=('confidentiality-requirement', 'integrity-requirement', 'availability-requirement')]/@value">
                  <enum value="not-defined">Not Defined</enum>
                  <enum value="low">Low</enum>
                  <enum value="medium">Medium</enum>
                  <enum value="high">High</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='modified-attack-vector']/@value">
                  <enum value="not-defined">Not Defined</enum>
                  <enum value="network">Network</enum>
                  <enum value="adjacent">Adjacent</enum>
                  <enum value="local">Local</enum>
                  <enum value="physical">Physical</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='modified-attack-complexity']/@value">
                  <enum value="not-defined">Not Defined</enum>
                  <enum value="high">High</enum>
                  <enum value="low">Low</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name=('modified-privileges-required', 'modified-confidentiality', 'modified-integrity', 'modified-availability')]/@value">
                  <enum value="not-defined">Not Defined</enum>
                  <enum value="none">None</enum>
                  <enum value="low">Low</enum>
                  <enum value="high">High</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='modified-user-interaction']/@value">
                  <enum value="not-defined">Not Defined</enum>
                  <enum value="none">None</enum>
                  <enum value="required">Required</enum>
               </allowed-values>
               <allowed-values target="(.)[@system=('http://www.first.org/cvss/v3.0', 'http://www.first.org/cvss/v3.1') and @name='modified-scope']/@value">
                  <enum value="not-defined">Not Defined</enum>
                  <enum value="unchanged">Unchanged</enum>
                  <enum value="changed">Changed</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-vectors" target="(.)[@system=('https://www.first.org/cvss/v4-0')]/@name">
                  <enum value="av">Base: Attack Vector</enum>
                  <enum value="ac">Base: Attack Complexity</enum>
                  <enum value="at">Base: Attack Requirements</enum>
                  <enum value="pr">Base: Privileges Required</enum>
                  <enum value="ui">Base: User Interaction</enum>
                  <enum value="vc">Base: Vulnerable System Confidentiality Impact</enum>
                  <enum value="vi">Base: Vulnerable System Integrity Impact</enum>
                  <enum value="va">Base: Vulnerable System Availability Impact</enum>
                  <enum value="sc">Base: Subsequent System Confidentiality Impact</enum>
                  <enum value="si">Base: Vulnerable System Integrity Impact</enum>
                  <enum value="sa">Base: Vulnerable System Availability Impact</enum>
                  <enum value="s">Supplemental: Safety</enum>
                  <enum value="au">Supplemental: Automatable</enum>
                  <enum value="r">Supplemental: Recovery</enum>
                  <enum value="v">Supplemental: Value Density</enum>
                  <enum value="re">Supplemental: Vulnerability Response Effort</enum>
                  <enum value="u">Supplemental: Provider Urgency</enum>
                  <enum value="mav">Environmental: Modified Attack Vector</enum>
                  <enum value="mac">Environmental: Modified Attack Complexity</enum>
                  <enum value="mat">Environmental: Modified Attack Requirements</enum>
                  <enum value="mpr">Environmental: Modified Privileges Required</enum>
                  <enum value="mui">Environmental: Modified User Interaction</enum>
                  <enum value="mvc">Environmental: Modified Vulnerable System Confidentiality</enum>
                  <enum value="mvi">Environmental: Modified Vulnerable System Integrity</enum>
                  <enum value="mva">Environmental: Modified Vulnerable System Availability</enum>
                  <enum value="msc">Environmental: Subsequent Vulnerable System Confidentiality</enum>
                  <enum value="msi">Environmental: Subsequent Vulnerable System Integrity</enum>
                  <enum value="msa">Environmental: Subsequent Vulnerable System Availability</enum>
                  <enum value="cr">Environmental: Confidentiality Requirements</enum>
                  <enum value="ir">Environmental: Integrity Requirements</enum>
                  <enum value="ar">Environmental: Availability Requirements</enum>
                  <enum value="e">Threat: Exploit Maturity</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-av-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='av']/@value">
                  <formal-name>Attack Vector Values</formal-name>
                  <enum value="n">Network</enum>
                  <enum value="a">Adjacent</enum>
                  <enum value="l">Local</enum>
                  <enum value="p">Physical</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-ac-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='ac']/@value">
                  <formal-name>Attack Complexity Values</formal-name>
                  <enum value="h">High</enum>
                  <enum value="l">Low</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-at-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='at']/@value">
                  <formal-name>Attack Requirements Values</formal-name>
                  <enum value="n">None</enum>
                  <enum value="p">Present</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-pr-cia-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name=('pr','vc','vi','va','sc','si','sa')]/@value">
                  <formal-name>Privileges Required, Confidentiality, Integrity, and Availability Values</formal-name>
                  <enum value="n">None</enum>
                  <enum value="l">Low</enum>
                  <enum value="h">High</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-ui-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='ui']/@value">
                  <formal-name>User Interaction Values</formal-name>
                  <enum value="n">None</enum>
                  <enum value="p">Passive</enum>
                  <enum value="a">Active</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-s-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='s']/@value">
                  <formal-name>Safety Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="n">Negligible</enum>
                  <enum value="p">Present</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-au-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='au']/@value">
                  <formal-name>Automatable Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="n">No</enum>
                  <enum value="y">Yes</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-r-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='r']/@value">
                  <formal-name>Recovery Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="a">Automatic</enum>
                  <enum value="u">User</enum>
                  <enum value="i">Irrecoverable</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-v-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='v']/@value">
                  <formal-name>Value Density Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="a">Automatic</enum>
                  <enum value="u">User</enum>
                  <enum value="i">Irrecoverable</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-re-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='re']/@value">
                  <formal-name>Vulnerability Response Effort Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="l">Low</enum>
                  <enum value="m">Moderate</enum>
                  <enum value="h">High</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-u-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='u']/@value">
                  <formal-name>Provider Urgency Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="clear">Clear</enum>
                  <enum value="green">Green</enum>
                  <enum value="amber">Amber</enum>
                  <enum value="red">Red</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-mav-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='mav']/@value">
                  <formal-name>Modified Attack Vector Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="n">Network</enum>
                  <enum value="a">Adjacent</enum>
                  <enum value="l">Local</enum>
                  <enum value="p">Physical</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-mac-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='mac']/@value">
                  <formal-name>Modified Attack Complexity Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="h">High</enum>
                  <enum value="l">Low</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-mat-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='mat']/@value">
                  <formal-name>Modified Attack Requirements Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="n">None</enum>
                  <enum value="p">Present</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-mpr-mvs-cia-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name=('mpr','mvc','mvi')]/@value">
                  <formal-name>Modified Privileges Required, and Vulnerable System Confidentiality, Integrity, and Availability Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="n">None</enum>
                  <enum value="l">Low</enum>
                  <enum value="h">High</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-mui-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='mui']/@value">
                  <formal-name>Modified User Interaction Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="n">None</enum>
                  <enum value="p">Passive</enum>
                  <enum value="a">Active</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-msc-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='msc']/@value">
                  <formal-name>Modified Subsequent System Confidentiality Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="n">Negligible</enum>
                  <enum value="l">Low</enum>
                  <enum value="h">High</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-msi-msa-cia-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name=('msi','msa')]/@value">
                  <formal-name>Modified Safety-Related Subsequent System Integrity and Availability Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="n">Negligible</enum>
                  <enum value="l">Low</enum>
                  <enum value="h">High</enum>
                  <enum value="s">Safety</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-env-cia-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name=('cr','ir','ar')]/@value">
                  <formal-name>Vulnerability Response Effort Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="l">Low</enum>
                  <enum value="m">Medium</enum>
                  <enum value="h">High</enum>
               </allowed-values>
               <allowed-values id="oscal-cvss-v4.0-e-values" target=".[@system='https://www.first.org/cvss/v4-0' and @name='e']/@value">
                  <formal-name>Vulnerability Response Effort Values</formal-name>
                  <enum value="x">Not Defined</enum>
                  <enum value="a">Attacked</enum>
                  <enum value="p">PoC</enum>
                  <enum value="u">Unreported</enum>
               </allowed-values>
            </constraint>
         </define-assembly>
      </model>
   </define-assembly>

   <define-assembly name="response" scope="local">
      <formal-name>Risk Response</formal-name>
      <description>Describes either recommended or an actual plan for addressing the risk.</description>
      <define-flag name="uuid" required="yes" as-type="uuid">
         <formal-name>Remediation Universally Unique Identifier</formal-name>
         <!-- Identifier Declaration -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this remediation elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>risk response</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
      </define-flag>
      <define-flag name="lifecycle" as-type="token" required="yes">
         <formal-name>Remediation Intent</formal-name>
         <description>Identifies whether this is a recommendation, such as from an assessor or tool, or an actual plan accepted by the system owner.</description>
         <constraint>
            <allowed-values allow-other="yes">
               <enum value="recommendation">Recommended remediation.</enum>
               <enum value="planned">The actions intended to resolve the risk.</enum>
               <enum value="completed">This remediation activities were performed to address the risk.</enum>
            </allowed-values>
         </constraint>
      </define-flag>
      <model>
         <define-field name="title" min-occurs="1" max-occurs="1" as-type="markup-line">
            <formal-name>Response Title</formal-name>
            <description>The title for this response activity.</description>
         </define-field>
         <define-field name="description" min-occurs="1" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
            <formal-name>Response Description</formal-name>
            <description>A human-readable description of this response plan.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <assembly ref="origin" max-occurs="unbounded">
            <group-as name="origins" in-json="ARRAY"/>
            <remarks>
               <p>Used to identify the individual and/or tool that generated this recommended or planned response.</p>
            </remarks>
         </assembly>

         <define-assembly name="required-asset" max-occurs="unbounded">
            <!-- QUESTION: Do we need to identify a set of remediation assets similar to assessment-assets -->
            <formal-name>Required Asset</formal-name>
            <description>Identifies an asset required to achieve remediation.</description>
            <group-as name="required-assets" in-json="ARRAY"/>
            <define-flag name="uuid" required="yes" as-type="uuid">
               <formal-name>Required Universally Unique Identifier</formal-name>
               <!-- Identifier Declaration -->
               <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this required asset elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>asset</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <model>
               <assembly ref="subject-reference" min-occurs="0" max-occurs="unbounded">
                  <use-name>subject</use-name>
                  <group-as name="subjects" in-json="ARRAY"/>
                  <remarks>
                     <p>Identifies an asset associated with this requirement, such as a party, system component, or inventory-item.</p>
                  </remarks>
               </assembly>
               <define-field name="title" min-occurs="0" max-occurs="1" as-type="markup-line">
                  <formal-name>Title for Required Asset</formal-name>
                  <description>The title for this required asset.</description>
               </define-field>
               <define-field name="description" min-occurs="1" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
                  <formal-name>Description of Required Asset</formal-name>
                  <description>A human-readable description of this required asset.</description>
               </define-field>
               <assembly ref="property" max-occurs="unbounded">
                  <group-as name="props" in-json="ARRAY"/>
               </assembly>
               <assembly ref="link" max-occurs="unbounded">
                  <group-as name="links" in-json="ARRAY"/>
               </assembly>
               <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
         </define-assembly>
         <assembly ref="task" min-occurs="0" max-occurs="unbounded">
            <group-as name="tasks" in-json="ARRAY"/>
         </assembly>
         <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
      </model>
      <constraint>
         <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
            <enum value="type">Risk Response Type</enum>
         </allowed-values>
         <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='type']/@value">
            <enum value="avoid">The risk will be eliminated.</enum>
            <enum value="mitigate">The risk will be reduced.</enum>
            <enum value="transfer">The risk will be transferred to another organization or entity.</enum>
            <enum value="accept">The risk will continue to exist without further efforts to address it. (Sometimes referred to as "Operationally required")</enum>
            <enum value="share">The risk will be partially transferred to another organization or entity.</enum>
            <enum value="contingency">Plans will be made to address the risk impact if the risk occurs. (This is a form of mitigation.)</enum>
            <enum value="none">No response, such as when the identified risk is found to be a false positive.</enum>
         </allowed-values>
      </constraint>
   </define-assembly>

   <define-flag name="objective-id" as-type="token" scope="local">
      <!-- This is an id to sync with control syntax -->
      <formal-name>Objective ID</formal-name>
      <description>Points to an assessment objective.</description>
   </define-flag>

   <define-assembly name="assessment-part"> <!--scope="local"-->
      <!-- QUESTION: Is it confusing to use part here, given the control meaning of part? -->
      <formal-name>Assessment Part</formal-name>
      <description>A partition of an assessment plan or results or a child of another part.</description>
      <use-name>part</use-name>
      <define-flag name="uuid" as-type="uuid">
         <!-- CHANGE: from uuiid to uuid -->
         <formal-name>Part Identifier</formal-name>
         <!-- Identifier Declaration -->
         <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this part elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>part</code> can be used to reference the data item locally or globally (e.g., in an ported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
      </define-flag>
      <define-flag name="name" as-type="token" required="yes">
         <formal-name>Part Name</formal-name>
         <description>A textual label that uniquely identifies the part's semantic type.</description>
         <constraint>
            <allowed-values allow-other="yes">
               <!-- QUESTION: Should this be in sync with control part? Should these be defined here or should they be defined in the context of use? -->
               <enum value="asset">An assessment asset.</enum>
               <enum value="method">An assessment method.</enum>
               <enum value="objective">Describes a set of control objectives.</enum>
            </allowed-values>
         </constraint>
      </define-flag>
      <define-flag name="ns" as-type="uri" default="http://csrc.nist.gov/ns/oscal">
         <!-- CHANGED: data type to uri -->
         <formal-name>Part Namespace</formal-name>
         <description>A namespace qualifying the part's name. This allows different organizations to associate distinct semantics with the same name.</description>
         <remarks>
            <p>This value must be an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that serves as a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#use-as-a-naming-system-identifier">naming system identifier</a>.</p>
            <p>When a <code>ns</code> is not provided, its value should be assumed to be <code>http://csrc.nist.gov/ns/oscal</code> and the name should be a name defined by the associated OSCAL model.</p>
         </remarks>
      </define-flag>
      <define-flag name="class" as-type="token">
         <formal-name>Part Class</formal-name>
         <description>A textual label that provides a sub-type or characterization of the part's <code>name</code>. This can be used to further distinguish or discriminate between the semantics of multiple parts of the same control with the same <code>name</code> and <code>ns</code>.</description>
         <remarks>
            <p>A <code>class</code> can be used in validation rules to express extra constraints over named items of a specific <code>class</code> value.</p>
            <p>A <code>class</code> can also be used in an OSCAL profile as a means to target an alteration to control content.</p>
         </remarks>
      </define-flag>
      <model>
         <define-field name="title" min-occurs="0" max-occurs="1" as-type="markup-line" >
            <formal-name>Part Title</formal-name>
            <description>A name given to the part, which may be used by a tool for display and navigation.</description>
         </define-field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </assembly>
         <define-field name="prose" as-type="markup-multiline" in-xml="UNWRAPPED" min-occurs="0">
            <!-- QUESTION: Is this the right name? -->
            <formal-name>Part Text</formal-name>
            <description>Permits multiple paragraphs, lists, tables etc.</description>
         </define-field>
         <assembly ref="assessment-part" max-occurs="unbounded">
            <group-as name="parts" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
         </assembly>
         <!-- <any/> -->
      </model>
      <constraint>
         <allowed-values target=".[@name='objective']/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
            <enum value="method">The assessment method to use. This typically appears on parts with the name "objective".</enum>
         </allowed-values>
         <has-cardinality target=".[@name='objective']/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='method']" min-occurs="1"/>
         <allowed-values target=".[@name='objective']/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='method']/@value">
            <enum value="INTERVIEW">The process of holding discussions with individuals or groups of individuals within an organization to once again, facilitate assessor understanding, achieve clarification, or obtain evidence.</enum>
            <enum value="EXAMINE">The process of reviewing, inspecting, observing, studying, or analyzing one or more assessment objects (i.e., specifications, mechanisms, or activities).</enum>
            <enum value="TEST">The process of exercising one or more assessment objects (i.e., activities or mechanisms) under specified conditions to compare actual with expected behavior.</enum>
         </allowed-values>
      </constraint>
      <remarks>
         <p>A <code>part</code> provides for logical partitioning of prose, and can be thought of as a grouping structure (e.g., section). A <code>part</code> can have child parts allowing for arbitrary nesting of prose content (e.g., statement hierarchy). A <code>part</code> can contain <code>prop</code> objects that allow for enriching prose text with structured name/value information.</p>
         <p>A <code>part</code> can be assigned an optional <code>id</code>, which allows for internal and external references to the textual concept contained within a <code>part</code>. A <code>id</code> provides a means for an OSCAL profile, or a higher layer OSCAL model to reference a specific part within a <code>catalog</code>. For example, an <code>id</code> can be used to reference or to make modifications to a control statement in a profile.</p>
         <p>Use of <code>part</code> and <code>prop</code> provides for a wide degree of extensibility within the OSCAL catalog model. The optional <code>ns</code> provides a means to qualify a part's <code>name</code>, allowing for organization-specific vocabularies to be defined with clear semantics. Any organization that extends OSCAL in this way should consistently assign a <code>ns</code> value that represents the organization, making a given namespace qualified <code>name</code> unique to that organization. This allows the combination of <code>ns</code> and <code>name</code> to always be unique and unambiguous, even when mixed with extensions from other organizations. Each organization is responsible for governance of their own extensions, and is strongly encouraged to publish their extensions as standards to their user community. If no <code>ns</code> is provided, the name is expected to be in the "OSCAL" namespace.</p>
         <p>To ensure a <code>ns</code> is unique to an organization and naming conflicts are avoided, a URI containing a DNS or other globally defined organization name should be used. For example, if FedRAMP and DoD both extend OSCAL, FedRAMP will use the <code>ns</code> <code>http://fedramp.gov/ns/oscal</code>, while DoD might use the <code>ns</code> <code>https://defense.gov</code> for any organization specific <code>name</code>.</p>
         <p>Tools that process OSCAL content are not required to interpret unrecognized OSCAL extensions; however, OSCAL compliant tools should not modify or remove unrecognized extensions, unless there is a compelling reason to do so, such as data sensitivity.</p>
      </remarks>
   </define-assembly>

</METASCHEMA>



================================================
FILE: src/metaschema/oscal_assessment-plan_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<METASCHEMA xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0">
    <schema-name>OSCAL Assessment Plan Model</schema-name>
    <schema-version>1.1.3</schema-version>
    <short-name>oscal-ap</short-name>
    <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
    <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
    <remarks>
        <p>The OSCAL assessment plan format is used to describe the information typically provided by an assessor during the preparation for an assessment.</p>
        <p>The root of the OSCAL assessment plan format is <code>assessment-plan</code>.
        </p>
    </remarks>
    <!-- IMPORT STATEMENTS -->
    <import href="oscal_metadata_metaschema.xml"/>
    <import href="oscal_assessment-common_metaschema.xml"/>
    <!-- TOP LEVEL ASSEMBLY -->
    <define-assembly name="assessment-plan">
        <formal-name>Security Assessment Plan (SAP)</formal-name>
        <description>An assessment plan, such as those provided by a FedRAMP assessor.</description>
        <root-name>assessment-plan</root-name>
        <define-flag name="uuid" required="yes" as-type="uuid">
            <formal-name>Assessment Plan Universally Unique Identifier</formal-name>
            <!-- Identifier Declaration -->
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this assessment plan in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ap-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>assessment plan</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
        </define-flag>
        <model>
            <assembly ref="metadata" min-occurs="1" max-occurs="1"/>
            <assembly ref="import-ssp" min-occurs="1" max-occurs="1">
                <remarks>
                    <p>Used by the SAP to import information about the system being assessed.</p>
                </remarks>
            </assembly>
            <define-assembly name="local-definitions">
                <!-- CHANGE: moved "local-definitions" to hete from assessment-subjects -->
                <formal-name>Local Definitions</formal-name>
                <description>Used to define data objects that are used in the assessment plan, that do not appear in the referenced SSP.</description>
                <model>
                    <assembly ref="system-component" min-occurs="0" max-occurs="unbounded">
                        <use-name>component</use-name>
                        <group-as name="components" in-json="ARRAY"/>
                        <remarks>
                            <p>Used to add any components, not defined via the System Security Plan (AR-&gt;AP-&gt;SSP)</p>
                        </remarks>
                    </assembly>
                    <assembly ref="inventory-item" min-occurs="0" max-occurs="unbounded">
                        <group-as name="inventory-items" in-json="ARRAY"/>
                        <remarks>
                            <p>Used to add any inventory-items, not defined via the System Security Plan (AR-&gt;AP-&gt;SSP)</p>
                        </remarks>
                    </assembly>
                    <assembly ref="system-user" min-occurs="0" max-occurs="unbounded">
                        <use-name>user</use-name>
                        <group-as name="users" in-json="ARRAY"/>
                        <remarks>
                            <p>Used to add any users, not defined via the System Security Plan (AR-&gt;AP-&gt;SSP)</p>
                        </remarks>
                    </assembly>
                    <!-- CHANGED: "ojbective" to "add-objectives-and-methods" -->
                    <assembly ref="local-objective" min-occurs="0" max-occurs="unbounded">
                        <use-name>objectives-and-methods</use-name>
                        <group-as name="objectives-and-methods" in-json="ARRAY"/>
                    </assembly>

                    <!-- CHANGED: implemented new model -->
                    <assembly ref="activity" min-occurs="0" max-occurs="unbounded">
                        <group-as name="activities" in-json="ARRAY"/>
                    </assembly>
                    <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
                </model>
                <constraint>
                    <is-unique id="unique-ap-local-definitions-component" target="component">
                        <key-field target="@uuid"/>
                        <remarks>
                            <p>Since multiple <code>component</code> entries can be provided, each component must have a unique <code>uuid</code>.</p>
                        </remarks>
                    </is-unique>
                    <is-unique id="unique-ap-local-definitions-user" target="user">
                        <key-field target="@uuid"/>
                        <remarks>
                            <p>A given <code>uuid</code> must be assigned only once to a user.</p>
                        </remarks>
                    </is-unique>
                </constraint>
            </define-assembly>
            <define-assembly name="terms-and-conditions">
                <formal-name>Assessment Plan Terms and Conditions</formal-name>
                <description>Used to define various terms and conditions under which an assessment, described by the plan, can be performed. Each child part defines a different type of term or condition.</description>
                <model>
                    <assembly ref="assessment-part" max-occurs="unbounded">
                        <group-as name="parts" in-json="ARRAY"/>
                    </assembly>
                </model>
                <constraint>
                    <allowed-values target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="rules-of-engagement">Defines the circumstances, conditions, degree, and manner in which the use of cyber-attack techniques or actions may be applied to the assessment.</enum>
                        <enum value="disclosures">Any information the assessor should make known to the system owner or authorizing official. Has child 'item' parts for each individual disclosure.</enum>
                        <enum value="assessment-inclusions">Defines any assessment activities which the system owner or authorizing official wishes to ensure are performed as part of the assessment.</enum>
                        <enum value="assessment-exclusions">Defines any assessment activities which the system owner or authorizing official explicitly prohibits from being performed as part of the assessment.</enum>
                        <enum value="results-delivery">Defines conditions related to the delivery of the assessment results, such as when to deliver, how, and to whom.</enum>
                        <enum value="assumptions">Defines any supposition made by the assessor. Has child 'item' parts for each assumption.</enum>
                        <enum value="methodology">An explanation of practices, procedures, and rules used in the course of the assessment.</enum>
                    </allowed-values>
                </constraint>
            </define-assembly>
            <!-- CHANGED: "objectives" to "reviewed-controls" -->
            <assembly ref="reviewed-controls" min-occurs="1" max-occurs="1"/>
            <assembly ref="assessment-subject" min-occurs="0" max-occurs="unbounded">
                <group-as name="assessment-subjects" in-json="ARRAY"/>
            </assembly>
            <assembly ref="assessment-assets" min-occurs="0" max-occurs="1">
                <!-- CHANGED: "assets" to "assessment-assets" -->
            </assembly>

            <!-- CHANGED: removed "assessment-actions" merging with "tasks" -->

            <!-- CHANGED: Moved "schedule" to top level (from assessment-activities), and changed model to "task" -->
            <assembly ref="task" min-occurs="0" max-occurs="unbounded">
                <group-as name="tasks" in-json="ARRAY"/>
            </assembly>
            <assembly ref="back-matter" min-occurs="0" max-occurs="1"/>
        </model>
        <!-- todo: add remark need to describe how import-ssp is also importing roles, parties, locations defined in the SSP, as well as other (similar) objects that may have been imported into the SSP (e.g., control-id).  Controls that can be referenced are those imported into the SSP through resolved profile.  -->
        <!-- bogus example
        <constraint>
            <index id="index-assessment-plan-roles" name="index-assessment-plan-role-ids" target="metadata/role|doc(import-ssp/@href)/metadata/role">
                <key-field target="@id"/>
            </index>
            <index-has-key name="index-assessment-plan-role-ids" target="tasks/responsible-roles">
                <key-field target="@role-id"/>
            </index-has-key>
        </constraint>
        -->
    </define-assembly>

</METASCHEMA>



================================================
FILE: src/metaschema/oscal_assessment-results_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/metaschema/1.0 ../../build/metaschema-xslt/support/metaschema/schema/xml/metaschema.xsd">
  <schema-name>OSCAL Assessment Results Model</schema-name>
  <schema-version>1.1.3</schema-version>
  <short-name>oscal-ar</short-name>
  <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
  <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
  <remarks>
    <p>The OSCAL assessment results format is used to describe the information typically provided by an assessor following an assessment.</p>
    <p>The root of the OSCAL assessment results format is <code>assessment-results</code>.
    </p>
  </remarks>
  <!-- IMPORT STATEMENTS -->
  <import href="oscal_metadata_metaschema.xml"/>
  <import href="oscal_assessment-common_metaschema.xml"/>
  <!-- TOP LEVEL ASSEMBLY -->
  <define-assembly name="assessment-results">
    <formal-name>Security Assessment Results (SAR)</formal-name>
    <description>Security assessment results, such as those provided by a FedRAMP assessor in the FedRAMP Security Assessment Report.</description>
    <root-name>assessment-results</root-name>
    <define-flag name="uuid" required="yes" as-type="uuid">
      <formal-name>Assessment Results Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this assessment results instance in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ar-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>assessment result</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
    </define-flag>
    <model>
      <assembly ref="metadata" min-occurs="1" max-occurs="1"/>
      <assembly ref="import-ap" min-occurs="1" max-occurs="1">
        <remarks>
          <p>Used by the SAR to import information about the original plan for assessing the system.</p>
        </remarks>
      </assembly>
      <define-assembly name="local-definitions">
        <!-- CHANGE: added "local-definitions" -->
        <formal-name>Local Definitions</formal-name>
        <description>Used to define data objects that are used in the assessment plan, that do not appear in the referenced SSP.</description>
        <model>
          <assembly ref="local-objective" min-occurs="0" max-occurs="unbounded">
            <use-name>objectives-and-methods</use-name>
            <group-as name="objectives-and-methods" in-json="ARRAY"/>
          </assembly>

          <!-- CHANGED: implemented new model -->
          <assembly ref="activity" min-occurs="0" max-occurs="unbounded">
            <use-name>activity</use-name>
            <group-as name="activities" in-json="ARRAY"/>
          </assembly>
          <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
        </model>
      </define-assembly>
      <assembly ref="result" min-occurs="1" max-occurs="unbounded">
        <!-- CHANGED: "results" to "result" -->
        <use-name>result</use-name>
        <!-- CHANGED: "results_group" to "results" -->
        <group-as name="results" in-json="ARRAY"/>
      </assembly>
      <assembly ref="back-matter" min-occurs="0" max-occurs="1"/>
    </model>
  </define-assembly>

  <!-- ********** RESULTS Assembly ********** -->
  <define-assembly name="result">
    <formal-name>Assessment Result</formal-name>
    <description>Used by the assessment results and POA&amp;M. In the assessment results, this identifies all of the assessment observations and findings, initial and residual risks, deviations, and disposition. In the POA&amp;M, this identifies initial and residual risks, deviations, and disposition.</description>
    <define-flag name="uuid" required="yes" as-type="uuid">
      <formal-name>Results Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this set of results in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ar-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>assessment result</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
    </define-flag>
    <model>
      <define-field name="title" min-occurs="1" max-occurs="1" as-type="markup-line">
        <formal-name>Results Title</formal-name>
        <description>The title for this set of results.</description>
      </define-field>
      <!-- CHANGE: Added WITH_WRAPPER to description -->
      <define-field name="description" min-occurs="1" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
        <formal-name>Results Description</formal-name>
        <description>A human-readable description of this set of test results.</description>
      </define-field>

      <define-field name="start" as-type="date-time-with-timezone" min-occurs="1" max-occurs="1">
        <formal-name>start field</formal-name>
        <description>Date/time stamp identifying the start of the evidence collection reflected in these results.</description>
      </define-field>
      <define-field name="end" as-type="date-time-with-timezone" max-occurs="1">
        <formal-name>end field</formal-name>
        <description>Date/time stamp identifying the end of the evidence collection reflected in these results. In a continuous motoring scenario, this may contain the same value as start if appropriate.</description>
      </define-field>

      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <define-assembly name="local-definitions">
        <!-- CHANGE: added "local-definitions" -->
        <formal-name>Local Definitions</formal-name>
        <description>Used to define data objects that are used in the assessment plan, that do not appear in the referenced SSP.</description>
        <model>
          <assembly ref="system-component" min-occurs="0" max-occurs="unbounded">
            <use-name>component</use-name>
            <group-as name="components" in-json="ARRAY"/>
            <remarks>
              <p>Used to add any components, not defined via the System Security Plan (AR-&gt;AP-&gt;SSP)</p>
            </remarks>
          </assembly>
          <assembly ref="inventory-item" min-occurs="0" max-occurs="unbounded">
            <group-as name="inventory-items" in-json="ARRAY"/>
            <remarks>
              <p>Used to add any inventory-items, not defined via the System Security Plan (AR-&gt;AP-&gt;SSP)</p>
            </remarks>
          </assembly>
          <assembly ref="system-user" min-occurs="0" max-occurs="unbounded">
            <use-name>user</use-name>
            <group-as name="users" in-json="ARRAY"/>
            <remarks>
              <p>Used to add any users, not defined via the System Security Plan (AR-&gt;AP-&gt;SSP)</p>
            </remarks>
          </assembly>

          <assembly ref="assessment-assets" min-occurs="0" max-occurs="1">
            <!-- To augment the assessment plan -->
            <remarks>
              <p>This needs to be defined in the results if an assessment platform used is different from the one described in the assessment plan. Else the platform(s) defined in the plan may be referenced within the results.</p>
            </remarks>
          </assembly>

          <assembly ref="task" min-occurs="0" max-occurs="unbounded">
            <use-name>assessment-task</use-name>
            <group-as name="tasks" in-json="ARRAY"/>
          </assembly>
        </model>
        <constraint>
          <is-unique id="unique-ar-local-definitions-component" target="component">
            <key-field target="@uuid"/>
            <remarks>
              <p>Since multiple <code>component</code> entries can be provided, each component must have a unique <code>uuid</code>.</p>
            </remarks>
          </is-unique>
          <is-unique id="unique-ar-local-definitions-user" target="user">
            <key-field target="@uuid"/>
            <remarks>
              <p>A given <code>uuid</code> must be assigned only once to a user.</p>
            </remarks>
          </is-unique>
        </constraint>
      </define-assembly>
      <!-- CHANGED: "objectives" to "reviewed-controls" -->
      <assembly ref="reviewed-controls" min-occurs="1" max-occurs="1">
        <remarks>
          <p>The Assessment Results <code>control-selection</code> ignores any control selection in the Assessment Plan and re-selects controls from the baseline identified by the SSP.</p>
          <p>The Assessment Results <code>control-objective-selection</code> ignores any control objective selection in the Assessment Plan and re-selects control objectives from the baseline identified by the SSP.</p>
          <p>Any additional control objectives defined in the Assessment Plan <code>local-definitions</code> do not need to be re-defined in the Assessment Results <code>local-definitions</code>; however, if they were explicitly referenced with an Assessment Plan <code>control-objective-selection</code>, they need to be selected again in the Assessment Results <code>control-objective-selection</code>.</p>
        </remarks>
      </assembly>

      <define-assembly name="attestation" max-occurs="unbounded">
        <formal-name>Attestation Statements</formal-name>
        <description>A set of textual statements, typically written by the assessor.</description>
        <group-as name="attestations" in-json="ARRAY"/>
        <model>
          <assembly ref="responsible-party" max-occurs="unbounded">
            <group-as name="responsible-parties" in-json="ARRAY"/>
          </assembly>
          <assembly ref="assessment-part" min-occurs="1" max-occurs="unbounded">
            <!-- TODO: defined allowed parts: authorization-statement -->
            <use-name>part</use-name>
            <group-as name="parts" in-json="ARRAY"/>
          </assembly>
        </model>
        <constraint>
          <is-unique id="unique-ar-attestation-responsible-party" target="responsible-party">
            <key-field target="@role-id"/>
            <remarks>
              <p>Since <code>responsible-party</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
            </remarks>
          </is-unique>
        </constraint>
      </define-assembly>
      <!-- CHANGED: removed "schedule" and replaced with "assessment-log" -->
      <define-assembly name="assessment-log">
        <formal-name>Assessment Log</formal-name>
        <description>A log of all assessment-related actions taken.</description>
        <model>
          <define-assembly name="entry" min-occurs="1" max-occurs="unbounded">
            <formal-name>Assessment Log Entry</formal-name>
            <!-- TODO: improve this description -->
            <description>Identifies the result of an action and/or task that occurred as part of executing an assessment plan or an assessment event that occurred in producing the assessment results.</description>
            <group-as name="entries" in-json="ARRAY"/>
            <define-flag name="uuid" required="yes" as-type="uuid">
              <formal-name>Assessment Log Entry Universally Unique Identifier</formal-name>
              <!-- Identifier Declaration -->
              <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference an assessment event in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ar-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>assessment log entry</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <model>
              <define-field name="title" min-occurs="0" max-occurs="1" as-type="markup-line">
                <formal-name>Action Title</formal-name>
                <description>The title for this event.</description>
              </define-field>
              <!-- CHANGE: Added WITH_WRAPPER to description -->
              <define-field name="description" min-occurs="0" max-occurs="1" as-type="markup-multiline" in-xml="WITH_WRAPPER">
                <formal-name>Action Description</formal-name>
                <description>A human-readable description of this event.</description>
              </define-field>
              <define-field name="start" as-type="date-time-with-timezone" min-occurs="1" max-occurs="1">
                <formal-name>Start</formal-name>
                <description>Identifies the start date and time of an event.</description>
              </define-field>
              <define-field name="end" as-type="date-time-with-timezone" max-occurs="1">
                <formal-name>End</formal-name>
                <description>Identifies the end date and time of an event. If the event is a point in time, the start and end will be the same date and time.</description>
              </define-field>
              <assembly ref="property" max-occurs="unbounded">
                <group-as name="props" in-json="ARRAY"/>
              </assembly>
              <assembly ref="link" max-occurs="unbounded">
                <group-as name="links" in-json="ARRAY"/>
              </assembly>
              <assembly ref="logged-by" max-occurs="unbounded">
                <group-as name="logged-by" in-json="ARRAY"/>
              </assembly>
              <!-- CHANGED: Added "related-task" -->
              <assembly ref="related-task" max-occurs="unbounded">
                <group-as name="related-tasks" in-json="ARRAY"/>
              </assembly>
              <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
          </define-assembly>
        </model>
      </define-assembly>

      <!-- CHANGE: move "observation" from finding -->
      <assembly ref="observation" min-occurs="0" max-occurs="unbounded">
        <group-as name="observations" in-json="ARRAY"/>
      </assembly>

      <!-- CHANGE: move "risk" from finding -->
      <assembly ref="risk" max-occurs="unbounded">
        <group-as name="risks" in-json="ARRAY"/>
      </assembly>
      <assembly ref="finding" max-occurs="unbounded">
        <group-as name="findings" in-json="ARRAY"/>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
    </model>
  </define-assembly>

  <!-- Moved Finding Assembly to Assessment Common -->

  <!-- Assessment Plan Import -->
  <define-assembly name="import-ap">
    <formal-name>Import Assessment Plan</formal-name>
    <description>Used by assessment-results to import information about the original plan for assessing the system.</description>
    <define-flag name="href" required="yes" as-type="uri-reference">
      <formal-name>Assessment Plan Reference</formal-name>
      <description>A resolvable URL reference to the assessment plan governing the assessment activities.</description>
      <remarks>
        <p>This value may be one of:</p>
        <ol>
          <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
          <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
          <li>a bare URI fragment (i.e., `#uuid`) pointing to a <code>back-matter</code> resource in this or an imported document (see <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking to another OSCAL object</a>).</li>
        </ol>
      </remarks>
    </define-flag>
    <model>
      <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
    </model>
  </define-assembly>

</METASCHEMA>



================================================
FILE: src/metaschema/oscal_catalog_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- OSCAL CATALOG METASCHEMA -->
<!-- validate with XSD and Schematron (linked) -->
<!DOCTYPE METASCHEMA [
   <!ENTITY allowed-values-control-group-property-name SYSTEM "shared-constraints/allowed-values-control-group-property-name.ent">
]>
<?xml-stylesheet type="text/css" href="metaschema-author.css"?>
<METASCHEMA xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0">
      <schema-name>OSCAL Control Catalog Model</schema-name>
      <schema-version>1.1.3</schema-version>
      <short-name>oscal-catalog</short-name>
      <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
      <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
      <remarks>
            <p>The OSCAL Control Catalog format can be used to describe a collection of security controls and related control enhancements, along with contextualizing documentation and metadata. The root of the Control Catalog format is <code>catalog</code>.</p>
      </remarks>
      <import href="oscal_control-common_metaschema.xml"/>
      <import href="oscal_metadata_metaschema.xml"/>
      <define-assembly name="catalog">
            <formal-name>Catalog</formal-name>
            <description>A structured, <a href="https://pages.nist.gov/OSCAL/concepts/terminology/#catalog">organized collection</a> of control information.</description>
            <root-name>catalog</root-name>
            <define-flag name="uuid" as-type="uuid" required="yes">
                  <formal-name>Catalog Universally Unique Identifier</formal-name>
                  <description>Provides a globally unique means to identify a given catalog instance.</description>
                  <prop name="value-type" value="identifier"/>
                  <prop name="identifier-type" value="machine-oriented"/>
                  <prop name="identifier-uniqueness" value="global"/>
                  <prop name="identifier-scope" value="cross-instance"/>
                  <prop name="identifier-persistence" value="change-on-write"/>
            </define-flag>

            <model>
                  <assembly ref="metadata" min-occurs="1"/>
                  <assembly ref="parameter" max-occurs="unbounded">
                        <group-as name="params" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="control" max-occurs="unbounded">
                        <group-as name="controls" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="group" max-occurs="unbounded">
                        <group-as name="groups" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="back-matter">
                        <remarks>
                              <p>Back matter including references and resources.</p>
                        </remarks>
                  </assembly>
            </model>
            <constraint>
                  <allowed-values target="metadata/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="resolution-tool">The tool used to produce a resolved profile.</enum>
                        <enum value="source-profile-uuid">The document-level <code>uuid</code> of the source profile from which the catalog was produced by <a href="https://pages.nist.gov/OSCAL/concepts/processing/profile-resolution/">profile resolution</a>.</enum>
                  </allowed-values>
                  <allowed-values target="metadata/link/@rel" allow-other="yes">
                        <enum value="source-profile">The profile from which the catalog was produced by <a href="https://pages.nist.gov/OSCAL/concepts/processing/profile-resolution/">profile resolution</a>.</enum>
                        <enum value="source-profile-uuid">The document-level <code>uuid</code> of the profile from which the catalog was produced by <a href="https://pages.nist.gov/OSCAL/concepts/processing/profile-resolution/">profile resolution</a>.</enum>
                  </allowed-values>
                  <index name="catalog-parts" target="//part" >
                        <key-field target="@id"/>
                  </index>
                  <index name="catalog-props" target="//prop" >
                        <key-field target="@uuid"/>
                  </index>
                  <index name="catalog-groups-controls-parts" target="//(control|group|part)">
                        <key-field target="@id"/>
                  </index>
                  <index name="catalog-controls" target="//control" >
                        <key-field target="@id"/>
                  </index>
                  <index name="catalog-params" target="//param" >
                        <key-field target="@id"/>
                  </index>
                  <index name="catalog-groups" target="//group" >
                        <key-field target="@id"/>
                  </index>
            </constraint>
            <remarks>
                  <p>Catalogs may use one or more <code>group</code> objects to subdivide the control contents of a catalog.</p>
            </remarks>
            <example>
                  <description>A small catalog with a single control.</description>
                  <catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0" uuid="35566cd4-7331-43ba-b023-988c38d62673">
                        <title>A Miniature Catalog</title>
                        <control id="single">
                              <title>A Single Control</title>
                              <!-- TODO: this is not a complete valid example. Fix this. -->
                        </control>
                  </catalog>
            </example>
      </define-assembly>
      <define-assembly name="group">
            <formal-name>Control Group</formal-name>
            <description>A group of controls, or of groups of controls.</description>
            <define-flag name="id" as-type="token">
                  <!-- This is an id because the identifier is assigned and managed externally by humans. -->
                  <formal-name>Group Identifier</formal-name>
                  <!-- Identifier Declaration -->
                  <description>Identifies the group for the purpose of cross-linking within the defining instance or from other instances that reference the catalog.</description>
                  <prop name="value-type" value="identifier"/>
                  <prop name="identifier-type" value="human-oriented"/>
                  <prop name="identifier-uniqueness" value="instance"/>
                  <prop name="identifier-scope" value="cross-instance"/>
                  <prop name="identifier-persistence" value="per-subject"/>
            </define-flag>
            <define-flag name="class" as-type="token">
                  <formal-name>Group Class</formal-name>
                  <description>A textual label that provides a sub-type or characterization of the group.</description>
                  <remarks>
                        <p>A <code>class</code> can be used in validation rules to express extra constraints over named items of a specific <code>class</code> value.</p>
                        <p>A <code>class</code> can also be used in an OSCAL profile as a means to target an alteration to control content.</p>
                  </remarks>
            </define-flag>
            <model>
                  <define-field name="title" as-type="markup-line" min-occurs="1">
                        <formal-name>Group Title</formal-name>
                        <description>A name given to the group, which may be used by a tool for display and navigation.</description>
                  </define-field>
                  <assembly ref="parameter" max-occurs="unbounded">
                        <group-as name="params" in-json="ARRAY"/>
                  </assembly>

                  <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="part" max-occurs="unbounded">
                        <group-as name="parts" in-json="ARRAY"/>
                  </assembly>
                  <choice>
                        <assembly ref="group" max-occurs="unbounded">
                              <group-as name="groups" in-json="ARRAY"/>
                        </assembly>
                        <assembly ref="control" max-occurs="unbounded">
                              <group-as name="controls" in-json="ARRAY"/>
                        </assembly>
                  </choice>
                  <!--<any/>-->
            </model>
            <constraint>
                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
            &allowed-values-control-group-property-name;
                  </allowed-values>
                  <allowed-values target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="overview">An introduction to a control or a group of controls.</enum>
                        <enum value="instruction">Information providing directions for a control or a group of controls.</enum>
                  </allowed-values>
            </constraint>
            <remarks>
                  <p>Catalogs can use the catalog <code>group</code> construct to organize related controls into a single grouping, such as a family of controls or other logical organizational structure.</p>
                  <p>A <code>group</code> may have its own properties, statements, parameters, and references, which are inherited by all controls of that are a member of the group.</p>
            </remarks>
            <example>
                  <group xmlns="http://csrc.nist.gov/ns/oscal/1.0" id="xyz">
                        <title>My Group</title>
                        <prop name="required" value="some value"/>
                        <control id="xyz1">
                              <title>Control</title>
                        </control>
                  </group>
            </example>
      </define-assembly>
      <define-assembly name="control">
            <formal-name>Control</formal-name>
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/terminology/#control"
                        >structured object</a> representing a requirement or guideline, which when
                  implemented will reduce an aspect of risk related to an information system and its
                  information.</description>
            <define-flag name="id" as-type="token" required="yes">
                  <!-- This is an id because the idenfier is managed externally. -->
                  <formal-name>Control Identifier</formal-name>
                  <!-- Identifier Declaration -->
                  <description>Identifies a control such that it can be referenced in the defining
                        catalog and other OSCAL instances (e.g., profiles).</description>
                  <prop name="value-type" value="identifier"/>
                  <prop name="identifier-type" value="human-oriented"/>
                  <prop name="identifier-uniqueness" value="local"/>
                  <prop name="identifier-scope" value="instance"/>
                  <prop name="identifier-persistence" value="per-subject"/>
            </define-flag>
            <define-flag name="class" as-type="token">
                  <formal-name>Control Class</formal-name>
                  <description>A textual label that provides a sub-type or characterization of the
                        control.</description>
                  <remarks>
                        <p>A <code>class</code> can be used in validation rules to express extra
                              constraints over named items of a specific <code>class</code>
                              value.</p>
                        <p>A <code>class</code> can also be used in an OSCAL profile as a means to
                              target an alteration to control content.</p>
                  </remarks>
            </define-flag>
            <model>
                  <define-field name="title" as-type="markup-line" min-occurs="1">
                        <formal-name>Control Title</formal-name>
                        <description>A name given to the control, which may be used by a tool for
                              display and navigation.</description>
                  </define-field>
                  <assembly ref="parameter" max-occurs="unbounded">
                        <group-as name="params" in-json="ARRAY"/>
                  </assembly>
                  <!-- TODO: Need to be able to add valid values in context -->
                  <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="part" max-occurs="unbounded">
                        <group-as name="parts" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="control" max-occurs="unbounded">
                        <group-as name="controls" in-json="ARRAY"/>
                  </assembly>
                  <!--<assembly named="ref-list"/>-->
                  <!-- <any/> -->
            </model>
            <constraint>
                  <expect id="catalog-control-require-statement-when-not-withdrawn" target="."
                        test="prop[@name='status']/@value=('withdrawn','Withdrawn') or part[@name='statement']"/>
                  <allowed-values
                        target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        &allowed-values-control-group-property-name;
                        <enum value="status">The status of a <code>control</code>. For example, a
                              value of 'withdrawn' can indicate that the <code>control</code> has
                              been withdrawn and should no longer be used.</enum>
                  </allowed-values>
                  <allowed-values
                        target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='status']/@value">
                        <enum value="withdrawn">The control is no longer used.</enum>
                        <enum value="Withdrawn" deprecated="1.0.0">**(deprecated)*** Use 'withdrawn'
                              instead.</enum>
                  </allowed-values>
                  <allowed-values target="link/@rel" allow-other="yes">
                        <enum value="reference">The link cites an external resource related to this
                              control.</enum>
                        <enum value="related">The link identifies another control with bearing to
                              this control.</enum>
                        <enum value="required">The link identifies another control that must be
                              present if this control is present.</enum>
                        <enum value="incorporated-into">The link identifies other control content
                              where this control content is now addressed.</enum>
                        <enum value="moved-to">The containing control definition was moved to the
                              referenced control.</enum>
                  </allowed-values>
                  <!-- TODO: add expect constraint to check for controls that reference themselves -->
                  <index-has-key name="catalog-groups-controls-parts"
                        target="link[@rel=('related','required','incorporated-into','moved-to') and starts-with(@href,'#')]">
                        <key-field target="@href" pattern="#(.*)"/>
                  </index-has-key>
                  <allowed-values
                        target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="overview">An introduction to a control or a group of
                              controls.</enum>
                        <enum value="statement">A set of implementation requirements or recommendations.</enum>
                        <enum value="guidance">Additional information to consider when selecting,
                              implementing, assessing, and monitoring a control.</enum>
                        <enum value="example">An example of an implemented requirement or control statement.</enum>
                        <enum value="assessment" deprecated="1.0.1">**(deprecated)** Use
                              'assessment-method' instead.</enum>
                        <enum value="assessment-method">The part describes a method-based assessment
                              over a set of assessment objects.</enum>
                  </allowed-values>
                  <allowed-values
                        target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='statement']//part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="item">An individual item within a control statement.</enum>
                        <remarks>
                              <p>Nested statement parts are "item" parts.</p>
                        </remarks>
                  </allowed-values>
                  <allowed-values
                        target=".//part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="objective" deprecated="1.0.1">**(deprecated)** Use
                              'assessment-objective' instead.</enum>
                        <enum value="assessment-objective">The part describes a set of assessment
                              objectives.</enum>
                        <remarks>
                              <p>Objectives can be nested.</p>
                        </remarks>
                  </allowed-values>
                  <allowed-values
                        target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('assessment','assessment-method')]/part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="objects" deprecated="1.0.1">**(deprecated)** Use
                              'assessment-objects' instead.</enum>
                        <enum value="assessment-objects">Provides a listing of assessment
                              objects.</enum>
                        <remarks>
                              <p>Assessment objects appear on assessment methods.</p>
                        </remarks>
                  </allowed-values>
                  <allowed-values
                        target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('assessment','assessment-method')]/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="method" deprecated="1.0.1">**(deprecated)** Use 'method' in the 'http://csrc.nist.gov/ns/rmf' namespace. The assessment method to use. This typically appears on parts with the name "assessment-method".</enum>
                  </allowed-values>
                  <allowed-values
                        target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('assessment','assessment-method')]/prop[has-oscal-namespace('http://csrc.nist.gov/ns/rmf')]/@name">
                        <enum value="method">The assessment method to use. This typically appears on
                              parts with the name "assessment-method".</enum>
                  </allowed-values>
                  <expect level="WARNING" target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('assessment','assessment-method')]" test="prop[has-oscal-namespace(('http://csrc.nist.gov/ns/oscal','http://csrc.nist.gov/ns/rmf')) and @name='method']"/>
                  <allowed-values
                        target="part[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('assessment','assessment-method')]/prop[has-oscal-namespace(('http://csrc.nist.gov/ns/oscal','http://csrc.nist.gov/ns/rmf')) and @name='method']/@value">
                        <enum value="INTERVIEW">The process of holding discussions with individuals or groups of individuals within an organization to once again, facilitate assessor understanding, achieve clarification, or obtain evidence.</enum>
                        <enum value="EXAMINE">The process of reviewing, inspecting, observing, studying, or analyzing one or more assessment objects (i.e., specifications, mechanisms, or activities).</enum>
                        <enum value="TEST">The process of exercising one or more assessment objects (i.e., activities or mechanisms) under specified conditions to compare actual with expected behavior.</enum>
                  </allowed-values>
            </constraint>
            <remarks>
                  <p>Each security or privacy control within the catalog is defined by a distinct control instance. Controls may be as complex or as simple as a catalog defines them. They may be decomposed or further specified into child <code>control</code> objects, for example to represent control enhancements or specific breakouts of control functionality, to be maintained as discrete requirements. Controls may also contain structured parts (using <code>part</code>) and they may be grouped together in families or classes with <code>group</code>.</p>
                  <p>Control structures in OSCAL will also exhibit regularities and rules that are not codified in OSCAL but in its applications or domains of application. For example, for catalogs describing controls as defined by NIST SP 800-53, a control must have a part with the name "statement", which represents the textual narrative of the control. This "statement" part must occur only once, but may have nested parts to allow for multiple paragraphs or sections of text. This organization supports addressability of this data content as long as, and only insofar as, it is consistently implemented across the control set. As given with these model definitions, constraints defined and assigned here can aid in ensuring this regularity; but other such constraints and other useful patterns of use remain to be discovered and described.</p>
            </remarks>
            <example>
                  <control xmlns="http://csrc.nist.gov/ns/oscal/1.0" id="x">
                        <title>Control 1</title>
                  </control>
            </example>
      </define-assembly>
</METASCHEMA>



================================================
FILE: src/metaschema/oscal_complete_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- OSCAL GRAND UNIFIED MEGALOMETASCHEMA -->
<!-- validate with XSD and Schematron (linked) -->
<!DOCTYPE METASCHEMA [
   <!ENTITY allowed-values-control-group-property-name SYSTEM "./shared-constraints/allowed-values-control-group-property-name.ent">
]>
<METASCHEMA xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0">
      <schema-name>OSCAL Unified Model of Models</schema-name>
      <schema-version>1.1.3</schema-version>
      <short-name>oscal-complete</short-name>
      <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
      <json-base-uri>http://csrc.nist.gov/ns/oscal/1.0</json-base-uri>
      <remarks>
            <p>This format represents a combination of all of the OSCAL models.</p>
      </remarks>
      <import href="oscal_catalog_metaschema.xml"/>
      <import href="oscal_profile_metaschema.xml"/>
      <import href="oscal_component_metaschema.xml"/>
      <import href="oscal_ssp_metaschema.xml"/>
      <import href="oscal_assessment-plan_metaschema.xml"/>
      <import href="oscal_assessment-results_metaschema.xml"/>
      <import href="oscal_poam_metaschema.xml"/>
</METASCHEMA>



================================================
FILE: src/metaschema/oscal_component_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!DOCTYPE METASCHEMA [
  <!ENTITY allowed-values-responsible-roles-operations SYSTEM "./shared-constraints/allowed-values-responsible-roles-operations.ent">
  <!ENTITY allowed-values-responsible-roles-component-production SYSTEM "./shared-constraints/allowed-values-responsible-roles-component-production.ent">
  <!ENTITY allowed-values-property-name-asset-type-values SYSTEM "./shared-constraints/allowed-values-property-name-asset-type-values.ent">
  <!ENTITY allowed-values-component_component_property-name SYSTEM "./shared-constraints/allowed-values-component_component_property-name.ent">
  <!ENTITY allowed-values-component_component_software SYSTEM "./shared-constraints/allowed-values-component_component_software.ent">
  <!ENTITY allowed-values-component_component_service SYSTEM "./shared-constraints/allowed-values-component_component_service.ent">
  <!ENTITY allowed-values-component_inventory-item_property-name SYSTEM "./shared-constraints/allowed-values-component_inventory-item_property-name.ent">
  <!ENTITY allowed-values-component_component_link-rel SYSTEM "./shared-constraints/allowed-values-component_component_link-rel.ent">
  <!ENTITY allowed-values-component-type SYSTEM "./shared-constraints/allowed-values-component-type.ent">
]>
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/metaschema/1.0 ../../build/metaschema-xslt/support/metaschema/schema/xml/metaschema.xsd">
  <schema-name>OSCAL Component Definition Model</schema-name>
  <schema-version>1.1.3</schema-version>
  <short-name>oscal-component-definition</short-name>
  <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
  <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
  <remarks>
    <p>The OSCAL Component Definition Model can be used to describe the implementation of controls in a <code>component</code> or a set of components grouped as a <code>capability</code>. A component can be either a <em>technical component</em>, or a <em>documentary component</em>.</p>
    <p>A technical component is a component that is implemented in hardware (physical or virtual) or software. Suppliers may document components in an OSCAL component definition that describes the implementation of controls in their hardware and software.</p>
    <p>A documentary component is a component implemented for a documented process, procedure, or policy.  Suppliers may document components in an OSCAL component definition that describes the implementation of controls in their process, procedure, or policy.</p>
    <p>The information provided by a technical or documentary component can be used by component consumers to provide starting narratives for documenting control implementations in an OSCAL SSP.</p>
    <p>The root of the OSCAL Implementation Layer Component Definition model is <code>component-definition</code>.</p>
  </remarks>

  <import href="oscal_implementation-common_metaschema.xml"/>

  <define-assembly name="component-definition">
    <formal-name>Component Definition</formal-name>
    <description>A collection of component descriptions, which may optionally be grouped by capability.</description>
    <root-name>component-definition</root-name>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Component Definition Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>Provides a globally unique means to identify a given component definition instance.</description>
      <prop name="value-type" value="identifier"/>
      <prop name="identifier-type" value="machine-oriented"/>
      <prop name="identifier-uniqueness" value="global"/>
      <prop name="identifier-scope" value="cross-instance"/>
      <prop name="identifier-persistence" value="change-on-write"/>
    </define-flag>
    <model>
      <assembly ref="metadata" min-occurs="1"/>
      <assembly ref="import-component-definition" max-occurs="unbounded">
        <group-as name="import-component-definitions" in-json="ARRAY"/>
      </assembly>
      <assembly ref="defined-component" max-occurs="unbounded">
        <use-name>component</use-name>
        <group-as name="components" in-json="ARRAY"/>
      </assembly>
      <assembly ref="capability" max-occurs="unbounded">
        <group-as name="capabilities" in-json="ARRAY"/>
      </assembly>
      <assembly ref="back-matter"/>
    </model>
    <constraint>
      <index name="index-system-component-uuid" target="component">
        <key-field target="@uuid"/>
        <remarks>
          <p>Since multiple <code>component</code> entries can be provided, each component must have a unique <code>uuid</code>.</p>
        </remarks>
      </index>
      <is-unique id="unique-component-definition-capability" target="capability">
        <key-field target="@uuid"/>
        <remarks>
          <p>A given <code>component</code> must not be referenced more than once within the same <code>capability</code>.</p>
        </remarks>
      </is-unique>
    </constraint>
  </define-assembly>

  <define-assembly name="import-component-definition">
    <formal-name>Import Component Definition</formal-name>
    <description>Loads a component definition from another resource.</description>
    <define-flag name="href" as-type="uri-reference" required="yes">
      <formal-name>Hyperlink Reference</formal-name>
      <description>A link to a resource that defines a set of components and/or capabilities to import into this collection.</description>
      <remarks>
        <p>This value may be one of:</p>
        <ol>
          <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
          <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
          <li>a bare URI fragment (i.e., `#uuid`) pointing to a <code>back-matter</code> resource in this or an imported document (see <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking to another OSCAL object</a>).</li>
        </ol>
      </remarks>
    </define-flag>
  </define-assembly>

  <define-assembly name="defined-component">
    <formal-name>Component</formal-name>
    <description>A defined component that can be part of an implemented system.</description>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Component Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>Provides a globally unique means to identify a given component.</description>
      <prop name="value-type" value="identifier"/>
      <prop name="identifier-type" value="machine-oriented"/>
      <prop name="identifier-uniqueness" value="global"/>
      <prop name="identifier-scope" value="cross-instance"/>
      <prop name="identifier-persistence" value="per-subject"/>
    </define-flag>
    <flag ref="defined-component-type" required="yes">
      <use-name>type</use-name>
    </flag>
    <model>
      <define-field name="title" as-type="markup-line" min-occurs="1">
        <formal-name>Component Title</formal-name>
        <description>A human readable name for the component.</description>
      </define-field>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Component Description</formal-name>
        <description>A description of the component, including information about its function.</description>
      </define-field>
      <define-field name="purpose" as-type="markup-line">
        <formal-name>Purpose</formal-name>
        <description>A summary of the technological or business purpose of the component.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <assembly ref="responsible-role" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY"/>
      </assembly>
      <assembly ref="protocol" max-occurs="unbounded">
        <group-as name="protocols" in-json="ARRAY"/>
        <remarks>
          <p>Used for <code>service</code> components to define the protocols supported by the service.</p>
        </remarks>
      </assembly>

      <assembly ref="control-implementation" max-occurs="unbounded">
        <group-as name="control-implementations" in-json="ARRAY"/>
      </assembly>
      <!--
         <assembly ref="configuration" max-occurs="unbounded">
           <group-as name="configurations" in-json="BY_KEY" />
         </assembly>
         <assembly ref="artifact" max-occurs="unbounded">
           <group-as name="artifacts" in-json="BY_KEY" />
         </assembly>
-->
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
        <!-- ========================================================================================================== -->
        <!-- = Changes to the following values need to be synced with component in the SSP and component metaschemas. = -->
        <!-- CHANGED (BJR): Done -->
        <!-- ========================================================================================================== -->
            &allowed-values-component_component_property-name;
            &allowed-values-component_inventory-item_property-name;

                    <!-- CHANGE: @name="date-released" changed to @name="release-date" -->
      </allowed-values>

      <allowed-values target="link/@rel" allow-other="yes">
        <!-- ========================================================================================================== -->
        <!-- = Changes to the following values need to be synced with component in the SSP and component metaschemas. = -->
        <!-- CHANGED (BJR): Done -->
        <!-- ========================================================================================================== -->
            &allowed-values-component_component_link-rel;
        <enum value="uses-network">This component uses the network provided by the identified network component.</enum>
      </allowed-values>

      <allowed-values target="responsible-role/@role-id|control-implementation/implemented-requirement/responsible-role/@role-id|control-implementation/implemented-requirement/statement/responsible-role/@role-id" allow-other="yes">
        <!-- ========================================================================================================== -->
        <!-- = Changes to the following values need to be synced with component in the SSP and component metaschemas. = -->
        <!-- CHANGED (BJR): Done -->
        <!-- ========================================================================================================== -->
            &allowed-values-responsible-roles-operations;
            &allowed-values-responsible-roles-component-production;
      </allowed-values>

      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='asset-type']/@value" allow-other="yes">
            &allowed-values-property-name-asset-type-values;
      </allowed-values>

      <!-- ========================================================================================================== -->
      <!-- = TODO: The following was copied from implementation-common as-is and should probably be setup with  = -->
      <!-- =       shared constraints; however, the values are highly static (yes/no, internal/external). -->
      <!-- =       Can be changed later with no breaking impact. -->
      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='allows-authenticated-scan']/@value">
        <enum value="yes">The component allows an authenticated scan.</enum>
        <enum value="no">The component does not allow an authenticated scan.</enum>
      </allowed-values>

      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='virtual']/@value">
        <enum value="yes">The component is virtualized.</enum>
        <enum value="no">The component is not virtualized.</enum>
      </allowed-values>

      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='public']/@value">
        <enum value="yes">The component is publicly accessible.</enum>
        <enum value="no">The component is not publicly accessible.</enum>
      </allowed-values>

      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='implementation-point']/@value">
        <enum value="internal">The component is implemented within the system boundary.</enum>
        <enum value="external">The component is implemented outside the system boundary.</enum>
      </allowed-values>
      <!-- ========================================================================================================== -->

      <index-has-key name="index-metadata-location-uuid" target="prop[@name='physical-location']">
        <key-field target="@value"/>
      </index-has-key>

      <matches target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='inherited-uuid']/@value" datatype="uuid" />
      <matches target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='release-date']/@value" datatype="date"/>

      <!-- ========================================================================================================== -->
      <!-- = Changes to the following values need to be synced with component in the SSP and component metaschemas. = -->
      <!-- CHANGED (BJR): Done -->
      <!-- ========================================================================================================== -->

      <!-- ========================================================================================================== -->
      <!-- = SOFTWARE: type='software' constraints                        = -->
      <!-- ========================================================================================================== -->
      <allowed-values target="(.)[@type='software']/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
            &allowed-values-component_component_software;
      </allowed-values>

      <!-- ========================================================================================================== -->
      <!-- = SERVICE: type='service' constraints                        = -->
      <!-- ========================================================================================================== -->
      <allowed-values target="(.)[@type='service']/link/@rel" allow-other="yes">
            &allowed-values-component_component_service;
      </allowed-values>

      <!-- ========================================================================================================== -->
      <!-- = TODO: Consider whether INTERCONNECTION constraints are appropriate here.      = -->
      <!-- =       I'm not sure I see a use case for this, but doesn't break to add later. = -->
      <!-- =       If interconnection is not appropriate for component-defintion, we'll need different = -->
      <!-- =           component-type lists for the two models.                                        = -->
      <!-- ========================================================================================================== -->
      <is-unique id="unique-defined-component-responsible-role" target="responsible-role">
        <key-field target="@role-id"/>
        <remarks>
          <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
    </constraint>
    <remarks>
      <p>Components may be products, services, APIs, policies, processes, plans, guidance, standards, or other tangible items that enable security and/or privacy.</p>
      <p>The <code>type</code> indicates which of these component types is represented.</p>
      <p>A group of components may be aggregated into a <code>capability</code>. For example, an account management capability that consists of an account management process, and a Lightweight Directory Access Protocol (LDAP) software implementation.</p>
      <p>Capabilities are expressed by combining one or more components.</p>
    </remarks>
  </define-assembly>

  <define-flag name="defined-component-type" as-type="string">
    <formal-name>Component Type</formal-name>
    <description>A category describing the purpose of the component.</description>
    <constraint>
      <allowed-values allow-other="yes">
            &allowed-values-component-type;
      </allowed-values>
    </constraint>
  </define-flag>

  <define-assembly name="capability">
    <formal-name>Capability</formal-name>
    <description>A grouping of other components and/or capabilities.</description>
    <define-flag required="yes" name="uuid" as-type="uuid">
      <formal-name>Capability Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>Provides a globally unique means to identify a given capability.</description>
      <prop name="value-type" value="identifier"/>
      <prop name="identifier-type" value="machine-oriented"/>
      <prop name="identifier-uniqueness" value="global"/>
      <prop name="identifier-scope" value="cross-instance"/>
      <prop name="identifier-persistence" value="per-subject"/>
    </define-flag>
    <define-flag name="name" as-type="string" required="yes">
      <formal-name>Capability Name</formal-name>
      <description>The capability's human-readable name.</description>
    </define-flag>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Capability Description</formal-name>
        <description>A summary of the capability.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <assembly ref="incorporates-component" max-occurs="unbounded">
        <group-as name="incorporates-components" in-json="ARRAY"/>
      </assembly>
      <assembly ref="control-implementation" max-occurs="unbounded">
        <group-as name="control-implementations" in-json="ARRAY"/>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <is-unique id="unique-component-definition-capability-incorporates-component" target="incorporates-component">
        <key-field target="@component-uuid"></key-field>
        <remarks>
          <p>A given <code>component</code> must not be referenced more than once within the same <code>capability</code>.</p>
        </remarks>
      </is-unique>
      <!-- Feature Request: add constraint ensuring a capability's incorporates-component references //component-definition/component/@uuid in the same component definition instance or an imported instance-->
    </constraint>
  </define-assembly>
  <define-assembly name="incorporates-component">
    <formal-name>Incorporates Component</formal-name>
    <!-- TODO: needs a description -->
    <description>The collection of components comprising this capability.</description>
    <define-flag required="yes" name="component-uuid" as-type="uuid">
      <formal-name>Component Reference</formal-name>
      <!-- Identifier Reference -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a <code>component</code>.</description>
    </define-flag>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Component Description</formal-name>
        <description>A description of the component, including information about its function.</description>
      </define-field>
    </model>
  </define-assembly>

  <define-assembly name="control-implementation" scope="local">
    <formal-name>Control Implementation Set</formal-name>
    <description>Defines how the component or capability supports a set of controls.</description>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Control Implementation Set Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>Provides a means to identify a set of control implementations that are supported by a given component or capability.</description>
      <prop name="value-type" value="identifier"/>
      <prop name="identifier-type" value="machine-oriented"/>
      <prop name="identifier-uniqueness" value="global"/>
      <prop name="identifier-scope" value="cross-instance"/>
      <prop name="identifier-persistence" value="per-subject"/>
    </define-flag>
    <define-flag name="source" as-type="uri-reference" required="yes">
      <formal-name>Source Resource Reference</formal-name>
      <description>A reference to an OSCAL catalog or profile providing the referenced control or subcontrol definition.</description>
      <remarks>
        <p>This value may be one of:</p>
        <ol>
          <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
          <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
          <li>a bare URI fragment (i.e., `#uuid`) pointing to a <code>back-matter</code> resource in this or an imported document (see <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking to another OSCAL object</a>).</li>
        </ol>
      </remarks>
    </define-flag>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Control Implementation Description</formal-name>
        <description>A description of how the specified set of controls are implemented for the containing component or capability.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <assembly ref="set-parameter" max-occurs="unbounded">
        <group-as name="set-parameters" in-json="ARRAY"/>
      </assembly>
      <assembly ref="implemented-requirement" min-occurs="1" max-occurs="unbounded">
        <group-as name="implemented-requirements" in-json="ARRAY"/>
      </assembly>
    </model>
    <constraint>
      <is-unique id="unique-component-definition-control-implementation-set-parameter" target="set-parameter">
        <key-field target="@param-id"/>
        <remarks>
          <p>Since multiple <code>set-parameter</code> entries can be provided, each parameter must be set only once.</p>
        </remarks>
      </is-unique>
    </constraint>
    <remarks>
      <p>Use of <code>set-parameter</code> in this context, sets the parameter for all controls referenced by any <code>implemented-requirement</code> contained in this context. Any <code>set-parameter</code> defined in a child context will override this value. If not overridden by a child, this value applies in the child context.</p>
    </remarks>
  </define-assembly>
  <define-assembly name="implemented-requirement" scope="local">
    <formal-name>Control Implementation</formal-name>
    <description>Describes how the containing component or capability implements an individual control.</description>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Control Implementation Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>Provides a globally unique means to identify a given control implementation by a component.</description>
      <prop name="value-type" value="identifier"/>
      <prop name="identifier-type" value="machine-oriented"/>
      <prop name="identifier-uniqueness" value="global"/>
      <prop name="identifier-scope" value="cross-instance"/>
      <prop name="identifier-persistence" value="per-subject"/>
    </define-flag>
    <flag ref="control-id" required="yes"/>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Control Implementation Description</formal-name>
        <description>A suggestion from the supplier (e.g., component vendor or author) for how the specified control may be implemented if the containing component or capability is instantiated in a system security plan.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <assembly ref="set-parameter" max-occurs="unbounded">
        <group-as name="set-parameters" in-json="ARRAY"/>
      </assembly>
      <assembly ref="responsible-role" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY"/>
      </assembly>
      <assembly ref="statement" max-occurs="unbounded">
        <group-as name="statements" in-json="ARRAY"/>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <is-unique id="unique-component-definition-implemented-requirement-set-parameter" target="set-parameter">
        <key-field target="@param-id"/>
        <remarks>
          <p>Since multiple <code>set-parameter</code> entries can be provided, each parameter must be set only once.</p>
        </remarks>
      </is-unique>
      <is-unique id="unique-component-definition-implemented-requirement-responsible-role" target="responsible-role">
        <key-field target="@role-id"/>
        <remarks>
          <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
      <is-unique id="unique-component-definition-implemented-requirement-statement" target="statement">
        <key-field target="@statement-id"/>
        <remarks>
          <p>Since <code>statement</code> entries can be referenced using the statement's statement-id, each statement must be referenced only once.</p>
        </remarks>
      </is-unique>
    </constraint>
    <remarks>
      <p>Implemented requirements within a component or capability in a component definition provide a means for component suppliers to suggest possible control implementation details, which may be used by a different party (e.g., component consumers) when authoring a system security plan. Thus, these requirements defined in a component definition are only a suggestion of how to implement, which may be adopted wholesale, changed, or ignored by a person defining an information system implementation.</p>
      <p>Use of <code>set-parameter</code> in this context, sets the parameter for the referenced control and any associated statements.</p>
    </remarks>
  </define-assembly>
  <define-assembly name="statement" scope="local">
    <formal-name>Control Statement Implementation</formal-name>
    <description>Identifies which statements within a control are addressed.</description>
    <flag ref="statement-id" required="yes">
      <remarks>
        <p>A reference to the specific implemented statement associated with a control.</p>
      </remarks>
    </flag>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Control Statement Reference Universally Unique Identifier</formal-name>
      <!-- Identifier Reference -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this control statement elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#component-definition-identifiers">this or other OSCAL instances</a>. The <em>UUID</em> of the <code>control statement</code> in the source OSCAL instance is sufficient to reference the data item locally or globally (e.g., in an imported OSCAL instance).</description>
    </define-flag>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Statement Implementation Description</formal-name>
        <description>A summary of how the containing control statement is implemented by the component or capability.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <assembly ref="responsible-role" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY"/>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <is-unique id="unique-component-definition-statement-responsible-role" target="responsible-role">
        <key-field target="@role-id"/>
        <remarks>
          <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
    </constraint>
  </define-assembly>
</METASCHEMA>



================================================
FILE: src/metaschema/oscal_control-common_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- OSCAL CATALOG METASCHEMA -->
<!-- validate with XSD and Schematron (linked) -->
<!DOCTYPE METASCHEMA [
   <!ENTITY allowed-values-control-group-property-name SYSTEM "./shared-constraints/allowed-values-control-group-property-name.ent">
]>
<?xml-stylesheet type="text/css" href="metaschema-author.css"?>
<METASCHEMA
        xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" abstract="yes">
        <schema-name>OSCAL Control Catalog Format -- Common Models</schema-name>
        <schema-version>1.0.4</schema-version>
        <short-name>oscal-control-common</short-name>
        <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
        <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
        <import href="oscal_metadata_metaschema.xml"/>
        <!-- ######################################## -->
        <!-- # Part Assembly and related constructs # -->
        <!-- ######################################## -->
        <define-assembly name="part">
                <formal-name>Part</formal-name>
                <description>An annotated, markup-based textual element of a control's or catalog group's definition, or a child of another part.</description>
                <define-flag name="id" as-type="token">
                        <!-- This is an id because the idenfier is intended to be human-readable. -->
                        <formal-name>Part Identifier</formal-name>
                        <!-- Identifier Declaration -->
                        <description>A unique identifier for the part.</description>
                        <prop name="value-type" value="identifier"/>
                        <prop name="identifier-type" value="human-oriented"/>
                        <prop name="identifier-uniqueness" value="instance"/>
                        <prop name="identifier-scope" value="cross-instance"/>
                        <prop name="identifier-persistence" value="per-subject"/>
                        <remarks>
                                <p>While a part is not required to have an id, it is often desirable for an identifier to be provided, which allows the part to be referenced elsewhere in OSCAL document instances. For this reason, it is RECOMMENDED to provide a part identifier.</p>
                        </remarks>
                </define-flag>
                <define-flag name="name" as-type="token" required="yes">
                        <formal-name>Part Name</formal-name>
                        <description>A textual label that uniquely identifies the part's semantic type, which exists in a value space qualified by the <code>ns</code>.</description>
                </define-flag>
                <define-flag name="ns" as-type="uri" default="http://csrc.nist.gov/ns/oscal">
                        <formal-name>Part Namespace</formal-name>
                        <description>An optional namespace qualifying the part's <code>name</code>. This allows different organizations to associate distinct semantics with the same name.</description>
                        <remarks>
                                <p>This value must be an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that serves as a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#use-as-a-naming-system-identifier">naming system identifier</a>.</p>
                                <p>When a <code>ns</code> is not provided, its value should be assumed to be <code>http://csrc.nist.gov/ns/oscal</code> and the name should be a name defined by the associated OSCAL model.</p>
                        </remarks>
                </define-flag>
                <define-flag name="class" as-type="token">
                        <formal-name>Part Class</formal-name>
                        <description>An optional textual providing a sub-type or characterization of the part's <code>name</code>, or a category to which the part belongs.</description>
                        <remarks>
                                <p>One use of this flag is to distinguish or discriminate between the semantics of multiple parts of the same control with the same <code>name</code> and <code>ns</code> (since even within a given namespace it can be useful to overload a name).</p>
                                <p>A <code>class</code> can be used in validation rules to express extra constraints over named items of a specific <code>class</code> value.</p>
                                <p>A <code>class</code> can also be used in an OSCAL profile as a means to target an alteration to control content.</p>
                        </remarks>
                </define-flag>
                <model>
                        <define-field name="title" as-type="markup-line">
                                <formal-name>Part Title</formal-name>
                                <description>An optional name given to the part, which may be used by a tool for display and navigation.</description>
                        </define-field>
                        <assembly ref="property" max-occurs="unbounded">
                                <group-as name="props" in-json="ARRAY"/>
                        </assembly>
                        <define-field name="prose" as-type="markup-multiline" in-xml="UNWRAPPED">
                                <formal-name>Part Text</formal-name>
                                <description>Permits multiple paragraphs, lists, tables etc.</description>
                        </define-field>
                        <assembly ref="part" max-occurs="unbounded">
                                <group-as name="parts" in-json="ARRAY"/>
                        </assembly>
                        <assembly ref="link" max-occurs="unbounded">
                                <group-as name="links" in-json="ARRAY"/>
                        </assembly>
                        <!-- <any/> -->
                </model>
                <constraint>
                        <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
            &allowed-values-control-group-property-name;
                        </allowed-values>
                </constraint>
                <remarks>
                        <p>A <code>part</code> provides for logical partitioning of prose, and can be thought of as a grouping structure (e.g., section). A <code>part</code> can have child parts allowing for arbitrary nesting of prose content (e.g., statement hierarchy). A <code>part</code> can contain <code>prop</code> objects that allow for enriching prose text with structured name/value information.</p>
                        <p>A <code>part</code> can be assigned an optional <code>id</code>, which allows references to this part from within a catalog, or within an instance of another OSCAL model that has a need to reference the part. Examples of where part referencing is used in OSCAL include:</p>
                        <ul>
                                    <li>Referencing a part by id to tailor (make modifications to) a control statement in a profile.</li>
                                    <li>Referencing a control statement represented by a part in a system security plan implemented-requirement where a statement-level response is desired.</li>
                        </ul>
                        <p>Use of <code>part</code> and <code>prop</code> provides for a wide degree of extensibility within the OSCAL catalog model. The optional <code>ns</code> provides a means to qualify a part's <code>name</code>, allowing for organization-specific vocabularies to be defined with clear semantics. Any organization that extends OSCAL in this way should consistently assign a <code>ns</code> value that represents the organization, making a given namespace qualified <code>name</code> unique to that organization. This allows the combination of <code>ns</code> and <code>name</code> to always be unique and unambiguous, even when mixed with extensions from other organizations. Each organization is responsible for governance of their own extensions, and is strongly encouraged to publish their extensions as standards to their user community. If no <code>ns</code> is provided, the name is expected to be in the "OSCAL" namespace.</p>
                        <p>To ensure a <code>ns</code> is unique to an organization and naming conflicts are avoided, a URI containing a DNS or other globally defined organization name should be used. For example, if FedRAMP and DoD both extend OSCAL, FedRAMP will use the <code>ns</code> <code>http://fedramp.gov/ns/oscal</code>, while DoD might use the <code>ns</code> <code>https://defense.gov</code> for any organization specific <code>name</code>.</p>
                        <p>Tools that process OSCAL content are not required to interpret unrecognized OSCAL extensions; however, OSCAL compliant tools should not modify or remove unrecognized extensions, unless there is a compelling reason to do so, such as data sensitivity.</p>
                </remarks>
                <example>
                        <description>Multiple Parts with Different Organization-Specific Names.</description>
                        <part xmlns="http://csrc.nist.gov/ns/oscal/1.0" name="statement" id="statement-A">
                                <part ns="http://fedramp.gov/ns/oscal" name="status" id="statement-A-FedRAMP">A requirement specific to FedRAMP stakeholders.</part>
                                <part ns="https://defense.gov" name="status" id="statement-A-DoD">A requirement specific to the Department of Defense stakeholders.</part>
                        </part>
                </example>
        </define-assembly>

        <!-- ############################################# -->
        <!-- # Parameter Assembly and related constructs # -->
        <!-- ############################################# -->
        <!-- continue here -->
        <define-assembly name="parameter">
                <formal-name>Parameter</formal-name>
                <description>Parameters provide a mechanism for the dynamic assignment of value(s) in a control.</description>
                <use-name>param</use-name>
                <define-flag name="id" as-type="token" required="yes">
                        <!-- This is an id because the idenfier is intended to be human-readable. -->
                        <formal-name>Parameter Identifier</formal-name>
                        <description>A unique identifier for the parameter.</description>
                        <prop name="value-type" value="identifier"/>
                        <prop name="identifier-type" value="human-oriented"/>
                        <prop name="identifier-uniqueness" value="instance"/>
                        <prop name="identifier-scope" value="cross-instance"/>
                        <prop name="identifier-persistence" value="per-subject"/>
                </define-flag>
                <!-- TODO: What is the semantics of class here? -->
                <define-flag name="class" as-type="token">
                        <formal-name>Parameter Class</formal-name>
                        <description>A textual label that provides a characterization of the type,
                                purpose, use or scope of the parameter.</description>
                        <remarks>
                                <p>A <code>class</code> can be used in validation rules to express extra constraints over named items of a specific <code>class</code> value.</p>
                        </remarks>
                </define-flag>
                <define-flag name="depends-on" as-type="token" deprecated="1.0.1">
                        <formal-name>Depends on</formal-name>
                        <description><strong>(deprecated)</strong> Another parameter invoking this one. This construct has been deprecated and should not be used.</description>
                </define-flag>
                <model>
                        <assembly ref="property" max-occurs="unbounded">
                                <group-as name="props" in-json="ARRAY"/>
                        </assembly>
                        <!-- CHANGE: relative order in sequence -->
                        <assembly ref="link" max-occurs="unbounded">
                                <group-as name="links" in-json="ARRAY"/>
                        </assembly>
                        <define-field name="label" as-type="markup-line">
                                <formal-name>Parameter Label</formal-name>
                                <description>A short, placeholder name for the parameter, which can be used as a substitute for a <code>value</code> if no value is assigned.</description>
                                <remarks>
                                       <p>The label value is intended use when rendering a parameter in generated documentation or a user interface when a parameter is referenced. Note that labels are not required to be distinctive, which means that parameters within the same control may have the same label.</p>
                                </remarks>
                        </define-field>
                        <define-field name="usage" as-type="markup-multiline" in-xml="WITH_WRAPPER">
                                <formal-name>Parameter Usage Description</formal-name>
                                <description>Describes the purpose and use of a
                                        parameter.</description>
                        </define-field>
                        <assembly ref="parameter-constraint" max-occurs="unbounded">
                                <use-name>constraint</use-name>
                                <group-as name="constraints" in-json="ARRAY"/>
                        </assembly>
                        <assembly ref="parameter-guideline" max-occurs="unbounded">
                                <use-name>guideline</use-name>
                                <group-as name="guidelines" in-json="ARRAY"/>
                        </assembly>
                        <choice>
                                <field ref="parameter-value" max-occurs="unbounded">
                                        <use-name>value</use-name>
                                        <group-as name="values" in-json="ARRAY"/>
                                        <remarks>
                                                <p>A set of values provided in a catalog can be redefined in OSCAL's <code>profile</code> or <code>system-security-plan</code> models.</p>
                                        </remarks>
                                </field>
                                <assembly ref="parameter-selection">
                                        <use-name>select</use-name>
                                        <remarks>
                                                <p>The OSCAL parameter <code>value</code> construct can be used to prescribe a specific parameter value in a catalog or profile. In cases where a prescriptive value is not possible in a catalog or profile, it may be possible to constrain the set of possible values to a few options. Use of <code>select</code> in a parameter instead of <code>value</code> is a way of defining value options that <strong>may</strong> be set.</p>
                                                <p>A set of allowed parameter values expressed as a set of options which may be selected. These options constrain the permissible values that may be selected for the containing parameter. When the value assignment is made, such as in an OSCAL profile or system security plan, the actual selected value can be examined to determine if it matches one of the permissible choices for the parameter value.</p>
                                                <p>When the value of <code>how-many</code> is set to "one-or-more", multiple values may be assigned reflecting more than one choice.</p>
                                        </remarks>
                                </assembly>
                        </choice>
                        <field ref="remarks" in-xml="WITH_WRAPPER"/>
                </model>
                <constraint>
                        <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                                &allowed-values-control-group-property-name;
                                <enum value="alt-label">An alternate to the value provided by the parameter's label. This will typically be qualified by a class.</enum>
                        </allowed-values>
                        <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/rmf')]/@name">
                                <enum value="aggregates">The parent parameter provides an
                                        aggregation of two or more other parameters, each described
                                        by this property.</enum>
                        </allowed-values>
                        <expect target="." test="not(exists(@depends-on))">
                                <message>depends-on is deprecated</message>
                        </expect>
                </constraint>
                <remarks>
                        <p>In a catalog, a parameter is typically used as a placeholder for the future assignment of a parameter value, although the OSCAL model allows for the direct assignment of a value if desired by the control author. The <code>value</code> may be optionally used to specify one or more values. If no value is provided, then it is expected that the value will be provided at the Profile or Implementation layer.</p>
                        <p>A parameter can include a variety of metadata options that support the future solicitation of one or more values. A <code>label</code> provides a textual placeholder that can be used in a tool to solicit parameter value input, or to display in catalog documentation. The <code>desc</code> provides a short description of what the parameter is used for, which can be used in tooling to help a user understand how to use the parameter. A <code>constraint</code> can be used to provide criteria for the allowed values. A <code>guideline</code> provides a recommendation for the use of a parameter.</p>
                </remarks>
        </define-assembly>

        <define-assembly name="parameter-constraint">
                <formal-name>Constraint</formal-name>
                <description>A formal or informal expression of a constraint or test.</description>
                <model>
                        <define-field name="description" as-type="markup-multiline" in-xml="WITH_WRAPPER">
                                <formal-name>Constraint Description</formal-name>
                                <description>A textual summary of the constraint to be applied.</description>
                        </define-field>
                        <define-assembly name="test" max-occurs="unbounded">
                                <formal-name>Constraint Test</formal-name>
                                <description>A test expression which is expected to be evaluated by a tool.</description>
                                <group-as name="tests" in-json="ARRAY"/>
                                <model>
                                        <define-field name="expression" as-type="string" min-occurs="1">
                                                <formal-name>Constraint test</formal-name>
                                                <description>A formal (executable) expression of a
                                                  constraint.</description>
                                        </define-field>
                                        <field ref="remarks" in-xml="WITH_WRAPPER"/>
                                </model>
                        </define-assembly>
                </model>
        </define-assembly>
        <define-assembly name="parameter-guideline">
                <formal-name>Guideline</formal-name>
                <description>A prose statement that provides a recommendation for the use of a parameter.</description>
                <model>
                        <define-field name="prose" as-type="markup-multiline" in-xml="UNWRAPPED" min-occurs="1">
                                <formal-name>Guideline Text</formal-name>
                                <description>Prose permits multiple paragraphs, lists, tables etc.</description>
                        </define-field>
                </model>
        </define-assembly>

        <define-field name="parameter-value">
                <formal-name>Parameter Value</formal-name>
                <description>A parameter value or set of values.</description>
        </define-field>

        <define-assembly name="parameter-selection">
                <formal-name>Selection</formal-name>
                <description>Presenting a choice among alternatives.</description>
                <define-flag name="how-many" as-type="token">
                        <formal-name>Parameter Cardinality</formal-name>
                        <description>Describes the number of selections that must occur. Without this setting, only one value should be assumed to be permitted.</description>
                        <constraint>
                                <allowed-values>
                                        <enum value="one">Only one value is permitted.</enum>
                                        <enum value="one-or-more">One or more values are permitted.</enum>
                                </allowed-values>
                        </constraint>
                </define-flag>
                <model>
                        <define-field name="choice" as-type="markup-line" max-occurs="unbounded">
                                <formal-name>Choice</formal-name>
                                <description>A value selection among several such
                                        options.</description>
                                <json-value-key>value</json-value-key>
                                <group-as name="choice" in-json="ARRAY"/>
                        </define-field>
                </model>
                <remarks>
                        <p>A set of parameter value choices, that may be picked from to set the parameter value.</p>
                </remarks>
        </define-assembly>
        <!-- ############################## -->
        <!-- # Control-related constructs # -->
        <!-- ############################## -->
        <define-flag name="control-id" as-type="token">
                <formal-name>Control Identifier Reference</formal-name>
                <!-- Identifier Reference -->
                <description>A reference to a control with a corresponding <code>id</code> value. When referencing an externally defined <code>control</code>, the <code>Control Identifier Reference</code> must be used in the context of the external / imported OSCAL instance (e.g., uri-reference).</description>
                <prop name="value-type" value="identifier-reference"/>
                <prop name="identifier-type" value="human-oriented"/>
                <prop name="identifier-scope" value="cross-instance"/>
        </define-flag>
        <define-assembly name="include-all">
                <formal-name>Include All</formal-name>
                <description>Include all controls from the imported catalog or profile resources.</description>
                <remarks>
                        <p>This element provides an alternative to calling controls individually from a catalog.</p>
                </remarks>
        </define-assembly>
</METASCHEMA>



================================================
FILE: src/metaschema/oscal_implementation-common_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!DOCTYPE METASCHEMA [
      <!ENTITY allowed-values-responsible-roles-operations SYSTEM "./shared-constraints/allowed-values-responsible-roles-operations.ent">
      <!ENTITY allowed-values-responsible-roles-component-production SYSTEM "./shared-constraints/allowed-values-responsible-roles-component-production.ent">
      <!ENTITY allowed-values-property-name-asset-type-values SYSTEM "./shared-constraints/allowed-values-property-name-asset-type-values.ent">
      <!ENTITY allowed-values-component_component_property-name SYSTEM "./shared-constraints/allowed-values-component_component_property-name.ent">
      <!ENTITY allowed-values-component_component_software SYSTEM "./shared-constraints/allowed-values-component_component_software.ent">
      <!ENTITY allowed-values-component_component_service SYSTEM "./shared-constraints/allowed-values-component_component_service.ent">
      <!ENTITY allowed-values-component_inventory-item_property-name SYSTEM "./shared-constraints/allowed-values-component_inventory-item_property-name.ent">
      <!ENTITY allowed-values-component_component_link-rel SYSTEM "./shared-constraints/allowed-values-component_component_link-rel.ent">
      <!ENTITY allowed-values-component-type SYSTEM "./shared-constraints/allowed-values-component-type.ent">
]>
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/metaschema/1.0 ../../build/metaschema-xslt/support/metaschema/schema/xml/metaschema.xsd" abstract="yes">
      <schema-name>OSCAL Implementation Common Information</schema-name>
      <schema-version>1.1.3</schema-version>
      <short-name>oscal-implementation-common</short-name>
      <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
      <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>

      <import href="oscal_metadata_metaschema.xml"/>
      <import href="oscal_control-common_metaschema.xml"/>
      
      <!-- ################################################## -->
      <!-- # The System Component and supporting constructs # -->
      <!-- ################################################## -->
      <define-assembly name="system-component">
            <formal-name>Component</formal-name>
            <description>A defined component that can be part of an implemented system.</description>
            <define-flag name="uuid" as-type="uuid" required="yes">
                  <formal-name>Component Identifier</formal-name>
                  <!-- Identifier Declaration -->
                  <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this component elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>component</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <flag ref="system-component-type" required="yes">
                  <!-- CHANGED: "component-type" to "type" -->
                  <use-name>type</use-name>
            </flag>
            <model>
                  <define-field name="title" as-type="markup-line" min-occurs="1">
                        <formal-name>Component Title</formal-name>
                        <description>A human readable name for the system component.</description>
                  </define-field>
                  <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
                        <formal-name>Component Description</formal-name>
                        <description>A description of the component, including information about its function.</description>
                  </define-field>
                  <define-field name="purpose" as-type="markup-line">
                        <formal-name>Purpose</formal-name>
                        <description>A summary of the technological or business purpose of the component.</description>
                  </define-field>
                  <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                  </assembly>
                  <define-assembly name="status" min-occurs="1">
                        <formal-name>Status</formal-name>
                        <description>Describes the operational status of the system component.</description>
                        <define-flag name="state" as-type="token" required="yes">
                              <formal-name>State</formal-name>
                              <description>The operational status.</description>
                              <constraint>
                                    <allowed-values>
                                          <enum value="under-development">The component is being designed, developed, or implemented.</enum>
                                          <enum value="operational">The component is currently operational and is available for use in the system.</enum>
                                          <enum value="disposition">The component is no longer operational.</enum>
                                          <enum value="other">Some other state.</enum>
                                    </allowed-values>
                              </constraint>
                        </define-flag>
                        <model>
                              <field ref="remarks" in-xml="WITH_WRAPPER"/>
                        </model>
                  </define-assembly>
                  <assembly ref="responsible-role" max-occurs="unbounded">
                        <group-as name="responsible-roles" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="protocol" max-occurs="unbounded">
                        <group-as name="protocols" in-json="ARRAY"/>
                        <remarks>
                              <p>Used for <code>service</code> components to define the protocols supported by the service.</p>
                        </remarks>
                  </assembly>
                  <field ref="remarks" in-xml="WITH_WRAPPER"/>
            </model>
            <constraint>
                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <!-- names related to inherited component -->
                        <enum value="implementation-point">Relative placement of component ('internal' or 'external') to the system.</enum>
                        <enum value="leveraged-authorization-uuid">UUID of the related leveraged-authorization assembly in this SSP.</enum>
                        <enum value="inherited-uuid">UUID of the component as it was assigned in the leveraged system's SSP.</enum>

                        <!-- ========================================================================================================== -->
                        <!-- = Changes to the following values need to be synced with component in the SSP and component metaschemas. = -->
                        <!-- CHANGED (BJR): Done -->
                        <!-- ========================================================================================================== -->
                        &allowed-values-component_inventory-item_property-name;

                        &allowed-values-component_component_property-name;
                  </allowed-values>

                  <allowed-values target="link/@rel" allow-other="yes">
                        <!-- ========================================================================================================== -->
                        <!-- = Changes to the following values need to be synced with component in the SSP and component metaschemas. = -->
                        <!-- CHANGED (BJR): Done -->
                        <!-- ========================================================================================================== -->
            &allowed-values-component_component_link-rel;
                        <enum value="uses-network">This component uses the network provided by the identified network component.</enum>
                        <enum value="imported-from">The hyperlink identifies a URI pointing to the <code>component</code> in a <code>component-definition</code> that originally defined the <code>component</code>.</enum>
                  </allowed-values>

                  <allowed-values target="responsible-role/@role-id" allow-other="yes">
                        <!-- ========================================================================================================== -->
                        <!-- = Changes to the following values need to be synced with component in the SSP and component metaschemas. = -->
                        <!-- ========================================================================================================== -->
            &allowed-values-responsible-roles-operations;
            &allowed-values-responsible-roles-component-production;
                  </allowed-values>

                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='asset-type']/@value" allow-other="yes">
            &allowed-values-property-name-asset-type-values;
                  </allowed-values>

                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='allows-authenticated-scan']/@value">
                        <enum value="yes">The component allows an authenticated scan.</enum>
                        <enum value="no">The component does not allow an authenticated scan.</enum>
                  </allowed-values>

                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='public']/@value">
                        <enum value="yes">The component is publicly accessible.</enum>
                        <enum value="no">The component is not publicly accessible.</enum>
                  </allowed-values>

                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='virtual']/@value">
                        <enum value="yes">The component is virtualized.</enum>
                        <enum value="no">The component is not virtualized.</enum>
                  </allowed-values>

                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='implementation-point']/@value">
                        <enum value="internal">The component is implemented within the system boundary.</enum>
                        <enum value="external">The component is implemented outside the system boundary.</enum>
                  </allowed-values>

                  <index-has-key name="index-metadata-location-uuid" target="prop[@name='physical-location']">
                        <key-field target="@value"/>
                  </index-has-key>

                  <matches target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='inherited-uuid']/@value" datatype="uuid" />
                  <matches target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='release-date']/@value" datatype="date"/>

                  <!-- ========================================================================================================== -->
                  <!-- = Changes to the following values need to be synced with component in the SSP and component metaschemas. = -->
                  <!-- ========================================================================================================== -->

                  <allowed-values target="(.)[@type=('software', 'hardware', 'service')]/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="vendor-name">The name of the company or organization </enum>
                  </allowed-values>

                  <!-- TODO: Add ipv4-subnet property for type='network' - add pattern constraint -->
                  <!-- TODO: Add ipv6-subnet property for type='network' - add pattern constraint -->

                  <!-- ========================================================================================================== -->
                  <!-- = VALIDATION: type='validation' constraints                        = -->
                  <!-- ========================================================================================================== -->
                  <allowed-values target="(.)[@type='validation']/link/@rel" allow-other="yes">
                        <enum value="validation-details">A link to an online information provided by the authorizing body.</enum>
                  </allowed-values>

                  <!-- ========================================================================================================== -->
                  <!-- = SOFTWARE: type='software' constraints                        = -->
                  <!-- ========================================================================================================== -->
                  <allowed-values target="(.)[@type='software']/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
            &allowed-values-component_component_software;
                  </allowed-values>

                  <!-- ========================================================================================================== -->
                  <!-- = SERVICE: type='service' constraints                        = -->
                  <!-- ========================================================================================================== -->
                  <allowed-values target="(.)[@type='service']/link/@rel" allow-other="yes">
            &allowed-values-component_component_service;
                  </allowed-values>

                  <expect target="." test="not(exists((.)[not(@type='service')]/protocol))"/>

                  <!-- ========================================================================================================== -->
                  <!-- = INTERCONNECTION: type='interconnection' constraints                        = -->
                  <!-- ========================================================================================================== -->
                  <allowed-values target="(.)[@type='interconnection']/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="isa-title">Title of the Interconnection Security Agreement (ISA).</enum>
                        <enum value="isa-date">Date of the Interconnection Security Agreement (ISA).</enum>
                        <enum value="isa-remote-system-name">The name of the remote interconnected system.</enum>
                        <enum value="ipv4-address">An Internet Protocol Version 4 interconnection address</enum>
                        <enum value="ipv6-address">An Internet Protocol Version 6 interconnection address</enum>
                        <enum value="direction">An Internet Protocol Version 6 interconnection address</enum>
                  </allowed-values>
                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name=('ipv4-address','ipv6-address')]/@class">
                        <enum value="local">The identified IP address is for this system.</enum>
                        <enum value="remote">The identified IP address is for the remote system to which this system is connected.</enum>
                  </allowed-values>
                  <allowed-values target="(.)[@type='interconnection']/link/@rel" allow-other="yes">
                        <!-- CHANGE: @name="agreement" changed to @name="isa-agreement" -->
                        <enum value="isa-agreement">A link to the system interconnection agreement.</enum>
                  </allowed-values>
                  <allowed-values target="(.)[@type='interconnection']/responsible-role/@role-id" allow-other="yes">
                        <enum value="isa-poc-local">Interconnection Security Agreement (ISA) point of contact (POC) for this system.</enum>
                        <enum value="isa-poc-remote">Interconnection Security Agreement (ISA) point of contact (POC) for the remote interconnected system.</enum>
                        <enum value="isa-authorizing-official-local">Interconnection Security Agreement (ISA) authorizing official for this system.</enum>
                        <enum value="isa-authorizing-official-remote">Interconnection Security Agreement (ISA) authorizing official for the remote interconnected system.</enum>
                  </allowed-values>
                  <matches target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='isa-date']/@value" datatype="date-time"/>
                  <matches target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='ipv4-address']/@value" datatype="ip-v4-address" />
                  <matches target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='ipv6-address']/@value" datatype="ip-v6-address" />
                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='direction']/@value">
                        <enum value="incoming">Data from the remote system flows into this system.</enum>
                        <enum value="outgoing">Data from this system flows to the remote system.</enum>
                  </allowed-values>
                  <is-unique id="unique-system-component-responsible-role" target="responsible-role">
                        <key-field target="@role-id"/>
                        <remarks>
                              <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
                        </remarks>
                  </is-unique>
            </constraint>
            <remarks>
                  <p>Components may be products, services, application programming interface (APIs), policies, processes, plans, guidance, standards, or other tangible items that enable security and/or privacy.</p>
                  <p>The <code>type</code> indicates which of these component types is represented.</p>
                  <!-- <p>A group of components may be aggregated into a <code>capability</code>. For example, an account management capability that consists of an account management process, and a Lightweight Directory Access Protocol (LDAP) software implementation.</p>
         <p>Capabilities are expressed by combining one or more components.</p>-->
                  <p>When defining a <code>service</code> component where are relationship to other components is known, one or more <code>link</code> entries with rel values of provided-by and used-by can be used to link to the specific component identifier(s) that provide and use the service respectively.</p>
            </remarks>
      </define-assembly>

      <define-flag name="system-component-type" as-type="string">
            <formal-name>Component Type</formal-name>
            <description>A category describing the purpose of the component.</description>
            <constraint>
                  <allowed-values allow-other="yes">
                        <enum value="this-system">The system as a whole.</enum>
                        <enum value="system">An external system, which may be a leveraged system or the other side of an interconnection.</enum>
                        &allowed-values-component-type;
                        <enum value="network">A physical or virtual network.</enum>
                  </allowed-values>
            </constraint>
      </define-flag>

      <define-assembly name="protocol">
            <formal-name>Service Protocol Information</formal-name>
            <description>Information about the protocol used to provide a service.</description>
            <define-flag name="uuid" as-type="uuid">
                  <formal-name>Service Protocol Information Universally Unique Identifier</formal-name>
                  <!-- Identifier Declaration -->
                  <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this service protocol information elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>service protocol</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <define-flag name="name">
                  <formal-name>Protocol Name</formal-name>
                  <description>The common name of the protocol, which should be the appropriate "service name" from the <a href="https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml">IANA Service Name and Transport Protocol Port Number Registry</a>.
                  </description>
                  <remarks>
                        <p>The short name of the protocol (e.g., https).</p>
                  </remarks>
            </define-flag>
            <model>
                  <define-field name="title" as-type="markup-line">
            <formal-name>Protocol Title</formal-name>
                        <description>A human readable name for the protocol (e.g., Transport Layer Security).</description>
                  </define-field>
                  <assembly ref="port-range" max-occurs="unbounded">
                        <group-as name="port-ranges" in-json="ARRAY"/>
                  </assembly>
            </model>
            <constraint>
                  <expect level="WARNING" target="." test="@uuid">
                        <message>It is a best practice to provide a UUID.</message>
                  </expect>
            </constraint>
      </define-assembly>
      <define-assembly name="port-range">
            <formal-name>Port Range</formal-name>
            <description>Where applicable this is the transport layer protocol port range an IPv4-based or IPv6-based service uses.</description>
            <define-flag name="start" as-type="non-negative-integer">
                  <formal-name>Start</formal-name>
                  <description>Indicates the starting port number in a port range for a transport layer protocol</description>
                  <remarks>
                        <p>Should be a number within a permitted range</p>
                  </remarks>
            </define-flag>
            <define-flag name="end" as-type="non-negative-integer">
                  <formal-name>End</formal-name>
                  <description>Indicates the ending port number in a port range for a transport layer protocol</description>
                  <remarks>
                        <p>Should be a number within a permitted range</p>
                  </remarks>
            </define-flag>
            <define-flag name="transport" as-type="token">
                  <formal-name>Transport</formal-name>
                  <description>Indicates the transport type.</description>
                  <constraint>
                        <allowed-values>
                              <enum value="TCP">Transmission Control Protocol</enum>
                              <enum value="UDP">User Datagram Protocol</enum>
                        </allowed-values>
                  </constraint>
            </define-flag>
            <!-- Added Contraints as Warnings -->
            <!-- constraint>
                  <expect level="WARNING" id="port-range-start-and-end-not-specified" target="." test="exists(@start) and exists(@end)">
                        <message>If a protocol is defined, it should include a start and end port range. To define a single port, the start and end should be the same value.</message>
                  </expect>
                  <expect level="WARNING" id="port-range-start-specified-with-no-end" target="." test="exists(@start) and not(exists(@end))">
                        <message>A start port exists, but an end point does not. To define a single port, the start and end should be the same value.</message>
                  </expect>
                  <expect level="WARNING" id="port-range-end-specified-with-no-start" target="." test="not(exists(@start)) and exists(@end)">
                        <message>An end point exists, but a start port does not. To define a single port, the start and end should be the same value.</message>
                  </expect>
                  <expect level="WARNING" id="port-range-end-date-is-before-start-date" target="." test="@start &lt;= @end">
                        <message>The port range specified has an end port that is less than the start port.</message>
                  </expect>
            </constraint -->
            <constraint>
                  <expect level="WARNING" target="." test="exists(@start)" id="port-range-has-start">
                        <message>A port range should have a start port given.</message>
                  </expect>
                  <expect level="WARNING" target="." test="exists(@end)" id="port-range-has-end">
                        <message>A port range should have an end port given. To define a single port, the start and end should be the same value.</message>
                  </expect>
                  <expect level="WARNING" target="." test="not(@start > @end)" id="port-range-starts-before-end">
                        <message>The port range start should not be after its end.</message>
                  </expect>
            </constraint>
            <remarks>
                  <p>To be validated as a natural number (integer &gt;= 1). A single port uses the same value for start and end. Use multiple 'port-range' entries for non-contiguous ranges.</p>
            </remarks>
            <example>
                  <service xmlns="http://csrc.nist.gov/ns/oscal/example" id="svc-01" name="Domain Name Service (DNS) Lookup">
                        <protocol name="dns">
                              <port-range start="53" end="53" transport="tcp"/>
                        </protocol>
                  </service>
            </example>
      </define-assembly>

      <define-assembly name="implementation-status">
            <formal-name>Implementation Status</formal-name>
            <description>Indicates the degree to which the a given control is implemented.</description>
            <define-flag name="state" as-type="token" required="yes">
                  <formal-name>Implementation State</formal-name>
                  <description>Identifies the implementation status of the control or control objective.</description>
                  <constraint>
                        <allowed-values allow-other="yes">
                              <enum value="implemented">The control is fully implemented.</enum>
                              <enum value="partial">The control is partially implemented.</enum>
                              <enum value="planned">There is a plan for implementing the control as explained in the remarks.</enum>
                              <enum value="alternative">There is an alternative implementation for this control as explained in the remarks.</enum>
                              <enum value="not-applicable">This control does not apply to this system as justified in the remarks.</enum>
                        </allowed-values>
                  </constraint>
            </define-flag>
            <model>
                  <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
            </model>
      </define-assembly>

      <!-- ############################################# -->
      <!-- # The System User and supporting constructs # -->
      <!-- ############################################# -->
      <define-assembly name="system-user">
            <formal-name>System User</formal-name>
            <description>A type of user that interacts with the system based on an associated role.</description>
            <define-flag name="uuid" as-type="uuid" required="yes">
                  <formal-name>User Universally Unique Identifier</formal-name>
                  <!-- Identifier Declaration -->
                  <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this user class elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>system user</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <model>
                  <define-field name="title" as-type="markup-line">
                        <formal-name>User Title</formal-name>
                        <description>A name given to the user, which may be used by a tool for display and navigation.</description>
                  </define-field>
                  <define-field name="short-name">
                        <formal-name>User Short Name</formal-name>
                        <description>A short common name, abbreviation, or acronym for the user.</description>
                  </define-field>
                  <define-field name="description" as-type="markup-multiline" in-xml="WITH_WRAPPER">
                        <formal-name>User Description</formal-name>
                        <description>A summary of the user's purpose within the system.</description>
                  </define-field>
                  <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                        <!-- TODO: Model specific link relationships?  (BJR - I don't think we need this now) -->
                  </assembly>
                  <field ref="role-id" min-occurs="0" max-occurs="unbounded">
                        <group-as name="role-ids" in-json="ARRAY"/>
                  </field>
                  <assembly ref="authorized-privilege" max-occurs="unbounded">
                        <group-as name="authorized-privileges" in-json="ARRAY"/>
                  </assembly>
                  <field ref="remarks" in-xml="WITH_WRAPPER"/>
            </model>
            <constraint>
                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="type">The type of user, such as internal, external, or general-public.</enum>
                        <enum value="privilege-level">The user's privilege level within the system, such as privileged, non-privileged, no-logical-access.</enum>
                  </allowed-values>
                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='type']/@value">
                        <enum value="internal">A user account for a person or entity that is part of the organization who owns or operates the system.</enum>
                        <enum value="external">A user account for a person or entity that is not part of the organization who owns or operates the system.</enum>
                        <enum value="general-public">A user of the system considered to be outside </enum>
                  </allowed-values>
                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='privilege-level']/@value">
                        <enum value="privileged">This role has elevated access to the system, such as a group or system administrator.</enum>
                        <enum value="non-privileged">This role has typical user-level access to the system without elevated access.</enum>
                        <enum value="no-logical-access">This role has no access to the system, such as a manager who approves access as part of a process.</enum>
                  </allowed-values>
                  <allowed-values target="role-id" allow-other="yes">
            &allowed-values-responsible-roles-operations;
                  </allowed-values>
            </constraint>
            <remarks>
                  <p>Permissible values to be determined closer to the application, such as by a receiving authority.</p>
            </remarks>
      </define-assembly>
      <define-assembly name="authorized-privilege">
            <formal-name>Privilege</formal-name>
            <description>Identifies a specific system privilege held by the user, along with an associated description and/or rationale for the privilege.</description>
            <model>
                  <define-field name="title" as-type="markup-line" min-occurs="1">
            <formal-name>Privilege Title</formal-name>
                        <description>A human readable name for the privilege.</description>
                  </define-field>
                  <define-field name="description" as-type="markup-multiline" in-xml="WITH_WRAPPER">
                        <formal-name>Privilege Description</formal-name>
                        <description>A summary of the privilege's purpose within the system.</description>
                  </define-field>
                  <field ref="function-performed" min-occurs="1" max-occurs="unbounded">
                        <group-as name="functions-performed" in-json="ARRAY"/>
                  </field>
            </model>
      </define-assembly>
      <define-field name="function-performed" as-type="string">
            <formal-name>Functions Performed</formal-name>
            <description>Describes a function performed for a given authorized privilege by this user class.</description>
      </define-field>

      <!-- ################################################ -->
      <!-- # The Inventory Item and supporting constructs # -->
      <!-- ################################################ -->
      <define-assembly name="inventory-item">
            <formal-name>Inventory Item</formal-name>
            <description>A single managed inventory item within the system.</description>
            <!--      <json-key flag-name="uuid"/>
-->
            <define-flag name="uuid" as-type="uuid" required="yes">
                  <formal-name>Inventory Item Universally Unique Identifier</formal-name>
                  <!-- Identifier Declaration -->
                  <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this inventory item elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>inventory item</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <!-- CHANGED: Moved to property[@name='asset-id']. -->
            <!--      <define-flag name="asset-id">
         <!-\- This is an id because the idenfier is assigned and managed externally. -\->
         <formal-name>Asset Identifier</formal-name>
         <description>Organizational asset identifier that is unique in the context of the system. This may be a reference to the identifier used in an asset tracking system or a vulnerability scanning tool.</description>
      </define-flag>  -->
            <model>
                  <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
                        <formal-name>Inventory Item Description</formal-name>
                        <description>A summary of the inventory item stating its purpose within the system.</description>
                  </define-field>
                  <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="responsible-party" max-occurs="unbounded">
                        <group-as name="responsible-parties" in-json="ARRAY"/>
                  </assembly>
                  <define-assembly name="implemented-component" max-occurs="unbounded">
                        <!-- TODO: Sync constraints with system-component; maybe remove this? (CHANGED (BJR): Dave-See Gitter for details on this. -->
                        <formal-name>Implemented Component</formal-name>
                        <description>The set of components that are implemented in a given system inventory item.</description>
                        <group-as name="implemented-components" in-json="ARRAY"/>

                        <define-flag required="yes" name="component-uuid" as-type="uuid">
                              <formal-name>Component Universally Unique Identifier Reference</formal-name>
                              <!-- Identifier Reference -->
                              <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a <code>component</code> that is implemented as part of an inventory item.</description>
                        </define-flag>

                        <!-- CHANGED (daw): the following is not needed since it is required on the referenced component -->
                        <!--      <!-\- CHANGED (BJR): Added component-type for alignment with system-component -\->
      <flag ref="component-type" required="yes" />
-->
                        <!-- The following is commented because this is not being used and can be inferred based on the type of the component -->
                        <!--
      <define-flag name="use">
         <formal-name>Implementation Use Type</formal-name>
         <description>The type of implementation</description>
         <constraint>
            <allowed-values allow-other="yes">
               <enum value="runs-software">The implemented component is a 'software' component that the inventory item has installed and uses.</enum>
               <enum value="uses-hardware">The implemented component is a 'hardware' component that the inventory item has installed and uses.</enum>
               <enum value="enforces-policy">The implemented component is a 'policy' component that the inventory item supports and enforces.</enum>
               <enum value="implements-process">The implemented component is a 'process' component that the inventory item supports and enforces.</enum>
            </allowed-values>
         </constraint>
      </define-flag>
-->
                        <model>
                              <assembly ref="property" max-occurs="unbounded">
                                    <group-as name="props" in-json="ARRAY"/>
                              </assembly>
                              <assembly ref="link" max-occurs="unbounded">
                                    <group-as name="links" in-json="ARRAY"/>
                              </assembly>
                              <assembly ref="responsible-party" max-occurs="unbounded">
                                    <group-as name="responsible-parties" in-json="ARRAY"/>
                                    <remarks>
                                          <p>This construct is used to either: 1) associate a party or parties to a role defined on the component using the <code>responsible-role</code> construct, or 2) to define a party or parties that are responsible for a role defined within the context of the containing <code>inventory-item</code>.
                                          </p>
                                    </remarks>
                              </assembly>
                              <field ref="remarks" in-xml="WITH_WRAPPER"/>
                        </model>
                        <constraint>
                              <!-- TODO: constrain component-uuid references to components defined in the document. ((BJR): Was unsure how to do this.) -->
                              <!-- TODO: constrain link href values based on rel ((BJR): Was unsure of how to do this.) -->

                              <!-- TODO: constrain property values based on name (CHANGED (BJR): Done.) -->
                              <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                  &allowed-values-component_component_property-name;
                  &allowed-values-component_inventory-item_property-name;

                              </allowed-values>


                              <allowed-values target="responsible-party/@role-id" allow-other="yes">
                  &allowed-values-responsible-roles-operations;
                              </allowed-values>

                              <!-- TODO: constrain party-id references to parties defined in the document. (BJR Unsure how to do this. )-->

                              <is-unique id="unique-implemented-component-responsible-party" target="responsible-party">
                                    <key-field target="@role-id"/>
                                    <remarks>
                                          <p>Since <code>responsible-party</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
                                    </remarks>
                              </is-unique>
                        </constraint>
                  </define-assembly>
                  <field ref="remarks" in-xml="WITH_WRAPPER"/>
            </model>
            <constraint>
                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="ipv4-address">The Internet Protocol v4 Address of the asset.</enum>
                        <enum value="ipv6-address">The Internet Protocol v6 Address of the asset.</enum>
                        <enum value="fqdn">The full-qualified domain name (FQDN) of the asset.</enum>
                        <enum value="uri">A Uniform Resource Identifier (URI) for the asset.</enum>
                        <enum value="serial-number">A serial number for the asset.</enum>
                        <enum value="netbios-name">The NetBIOS name for the asset.</enum>
                        <enum value="mac-address">The media access control (MAC) address for the asset.</enum>
                        <enum value="physical-location">The physical location of the asset's hardware (e.g., Data Center ID, Cage#, Rack#, or other meaningful location identifiers).</enum>
                        <enum value="is-scanned">is the asset subjected to network scans? (yes/no)</enum>
                        <!-- =========================================================================================== -->
                        <!-- = The following is to support the legacy approach for inventory-items without components. = -->
                        <!-- =========================================================================================== -->
                        <!-- This is "model" in the context of a component -->
                        <enum value="hardware-model">The model number of the hardware used by the asset.</enum>
                        <!-- This is "name" in the context of a component -->
                        <enum value="os-name">The name of the operating system used by the asset.</enum>
                        <!-- This is "version" in the context of a component -->
                        <enum value="os-version">The version of the operating system used by the asset.</enum>
                        <!-- This is "name" in the context of a component -->
                        <enum value="software-name">The software product name used by the asset.</enum>
                        <!-- This is "version" in the context of a component -->
                        <enum value="software-version">The software product version used by the asset.</enum>
                        <!-- This is "patch-level" in the context of a component -->
                        <enum value="software-patch-level">The software product patch level used by the asset.</enum>

                        <!-- =========================================================================================== -->
                        <!-- = The following is shared with system-component. = -->
                        <!-- =========================================================================================== -->
                        &allowed-values-component_inventory-item_property-name;

                  </allowed-values>
                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='asset-type']/@value" allow-other="yes">
                        &allowed-values-property-name-asset-type-values;
                  </allowed-values>

                  <allowed-values target="(.)[@type=('software', 'hardware', 'service')]/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="vendor-name">The name of the company or organization </enum>
                  </allowed-values>


                  <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='is-scanned']/@value">
                        <enum value="yes">The asset is included in periodic vulnerability scanning.</enum>
                        <enum value="no">The asset is not included in periodic vulnerability scanning.</enum>
                  </allowed-values>

                  <allowed-values target="link/@rel" allow-other="yes">
                        <enum value="baseline-template">A reference to the baseline template used to configure the asset.</enum>
                  </allowed-values>
                  <!-- TODO: constrain link href values based on rel ((BJR): Was unsure how to do this.) -->

                  <allowed-values target="responsible-party/@role-id" allow-other="yes">
            &allowed-values-responsible-roles-operations;
            &allowed-values-responsible-roles-component-production;
                  </allowed-values>

                  <index-has-key name="index-metadata-role-id" target="responsible-party">
                        <key-field target="@role-id"></key-field>
                  </index-has-key>
                  <index-has-key name="index-metadata-party-uuid" target="responsible-party">
                        <key-field target="party-uuid"></key-field>
                  </index-has-key>
                  <is-unique id="unique-inventory-item-responsible-party" target="responsible-party">
                        <key-field target="@role-id"/>
                        <remarks>
                              <p>Since <code>responsible-party</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
                        </remarks>
                  </is-unique>
            </constraint>
      </define-assembly>



      <!--   <define-assembly name="only-statement">
      <formal-name>Specific Statement</formal-name>
      <description>Describes which specific statements are addressed by a requirement, by pointing to a specific requirement statement within a control.</description>
      <json-key flag-name="statement-id"/>
      <flag ref="statement-id" required="yes">
         <remarks>
            <p>A reference to the specific implemented statement.</p>
         </remarks>
      </flag>
      <model>
         <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
            <formal-name>Statement Implementation Description</formal-name>
            <description>A description of the component, including information about its function.</description>
         </define-field>
         <field ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
         </field>
         <assembly ref="property" max-occurs="unbounded">
            <group-as name="properties" in-json="ARRAY"/>
         </assembly>
         <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
            <!-\- TODO: Model specific link relationships ((BJR): Was unsure how to do this.) -\->
         </assembly>
<!-\-
         <assembly ref="using"/>
-\->
         <!-\- TODO: Implement parameters -\->
         <field ref="remarks" in-xml="WITH_WRAPPER"/>
      </model>
   </define-assembly>
-->
      <define-flag name="statement-id" as-type="token">
            <formal-name>Control Statement Reference</formal-name>
            <!-- Identifier Reference -->
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#human-oriented">human-oriented</a> identifier reference to a <code>control statement</code>.</description>
      </define-flag>
      <define-assembly name="set-parameter">
            <formal-name>Set Parameter Value</formal-name>
            <description>Identifies the parameter that will be set by the enclosed value.</description>
            <flag ref="param-id" required="yes"/>
            <model>
                  <define-field name="value" as-type="string" min-occurs="1" max-occurs="unbounded">
                        <!-- CHANGED type from "markup-line" to "string" since this is intended to be a scalar value -->
                        <formal-name>Parameter Value</formal-name>
                        <description>A parameter value or set of values.</description>
                        <group-as name="values" in-json="ARRAY"/>
                  </define-field>
                  <field ref="remarks" in-xml="WITH_WRAPPER"/>
            </model>
      </define-assembly>

      <!-- ===== FIELDS ===== -->
      <define-field name="system-id" as-type="string">
            <!-- This is an id because the idenfier is assigned and managed by humans. -->
            <formal-name>System Identification</formal-name>
            <!-- Identifier Declaration -->
            <!-- 
                  TODO: Given feedback, we need to update Metaschema with usnistgov/metaschema#222
                  with props like in https://github.com/david-waltermire-nist/OSCAL/commit/3aafc080b3dc5f488c15b763f707326e77a61f5d#diff-4176d3cf694dd36b02a94207426934306ec0fdaecc54d1bb96f50f52cd7ceae6R27-R32.

                  We need to determine if both identifier-type='machine-oriented' and identifier-type='human-oriented'.
                  Option 2 is identifier-type='unspecified'.
            -->
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#human-oriented">human-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this system identification property elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL instances</a>. When referencing an externally defined <code>system identification</code>, the <code>system identification</code> must be used in the context of the external / imported OSCAL instance (e.g., uri-reference). This string should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same system across revisions of the document.</description>
            <json-value-key>id</json-value-key>
            <define-flag name="identifier-type" as-type="uri">
                  <formal-name>Identification System Type</formal-name>
                  <description>Identifies the identification system from which the provided identifier was assigned. </description>
                  <constraint>
                        <allowed-values allow-other="yes">
                              <enum value="https://fedramp.gov" deprecated="1.0.3">**deprecated** The identifier was assigned by FedRAMP. This has been deprecated; use <code>http://fedramp.gov/ns/oscal</code> instead.</enum>
                              <enum value="http://fedramp.gov/ns/oscal">The identifier was assigned by FedRAMP.</enum>
                              <enum value="https://ietf.org/rfc/rfc4122" deprecated="1.0.3">**deprecated** A Universally Unique Identifier (UUID) as defined by RFC4122. This value has been deprecated; use <code>http://ietf.org/rfc/rfc4122</code> instead.</enum>
                              <enum value="http://ietf.org/rfc/rfc4122">A Universally Unique Identifier (UUID) as defined by RFC4122.</enum>
                        </allowed-values>
                  </constraint>
                  <remarks>
                        <p>This value must be an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that serves as a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#use-as-a-naming-system-identifier">naming system identifier</a>.</p>
                  </remarks>
            </define-flag>
      </define-field>

      <!-- ===== FLAGS ===== -->
      <define-flag name="param-id" as-type="token">
            <!-- This is an id because the idenfier is assigned and managed by humans. -->
            <formal-name>Parameter ID</formal-name>
            <!-- Identifier Reference -->
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#human-oriented">human-oriented</a> reference to a <code>parameter</code> within a control, who's catalog has been imported into the current implementation context.</description>
            <example>
                  <set-param xmlns="http://csrc.nist.gov/ns/oscal/example" param-id="ac-2_prm_2">
                        <enum>System ISSO</enum>
                  </set-param>
            </example>
      </define-flag>
</METASCHEMA>



================================================
FILE: src/metaschema/oscal_metadata_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- OSCAL CATALOG METASCHEMA -->
<!-- validate with XSD and Schematron (linked) -->
<?xml-stylesheet type="text/css" href="metaschema-author.css"?>
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" abstract="yes">
    <schema-name>OSCAL Document Metadata Description</schema-name>
    <schema-version>1.1.3</schema-version>
    <short-name>oscal-metadata</short-name>
    <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
    <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>

    <!-- ############################################### -->
    <!-- # Metadata Assembly and supporting constructs # -->
    <!-- ############################################### -->
    <define-assembly name="metadata">
        <formal-name>Document Metadata</formal-name>
        <description>Provides information about the containing document, and defines concepts that are shared across the document.</description>
        <model>
            <define-field name="title" as-type="markup-line" min-occurs="1">
                <formal-name>Document Title</formal-name>
                <description>A name given to the document, which may be used by a tool for display and navigation.</description>
            </define-field>
            <field ref="published"/>
            <field ref="last-modified" min-occurs="1"/>
            <field ref="version" min-occurs="1"/>
            <field ref="oscal-version" min-occurs="1"/>
            <define-assembly name="revision" max-occurs="unbounded">
                <formal-name>Revision History Entry</formal-name>
                <description>An entry in a sequential list of revisions to the containing document, expected to be in reverse chronological order (i.e. latest first).</description>
                <group-as name="revisions" in-xml="GROUPED" in-json="ARRAY"/>                <model>
                    <define-field name="title" as-type="markup-line">
                        <formal-name>Document Title</formal-name>
                        <description>A name given to the document revision, which may be used by a tool for display and navigation.</description>
                    </define-field>
                    <field ref="published" />
                    <field ref="last-modified"/>
                    <field ref="version" min-occurs="1"/>
                    <field ref="oscal-version"/>
                    <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                    </assembly>
                    <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                    </assembly>
                    <field ref="remarks" in-xml="WITH_WRAPPER"/>
                </model>
                <constraint>
                    <!-- TODO: consider making this a warning
            <has-cardinality target="published|last-modified|link[@rel='canonical']" min-occurs="1"/>
-->
                    <allowed-values target="link/@rel" allow-other="yes">
                        <enum value="canonical">The link identifies the authoritative location for this resource. Defined by <a href="https://tools.ietf.org/html/rfc6596">RFC 6596</a>.</enum>
                        <enum value="alternate">The link identifies an alternative location or format for this resource. Defined by <a href="https://html.spec.whatwg.org/multipage/links.html#linkTypes">the HTML Living Standard</a></enum>
                        <enum value="predecessor-version">This link identifies a resource containing the predecessor version in the version history. Defined by  <a href="https://tools.ietf.org/html/rfc5829">RFC 5829</a>.</enum>
                        <enum value="successor-version">This link identifies a resource containing the predecessor version in the version history. Defined by <a href="https://tools.ietf.org/html/rfc5829">RFC 5829</a>.</enum>
                        <enum value="version-history">This link identifies a resource containing the version history of this document. Defined by <a href="https://tools.ietf.org/html/rfc5829">RFC 5829</a>.</enum>
                    </allowed-values>
                    <!-- TODO: check for if the last-modified is >= the latest revision. -->
                </constraint>
                <remarks>
                    <p>While <code>published</code>, <code>last-modified</code>, and <code>oscal-version</code> are not required, values for these entries should be provided if the information is known. A <code>link</code> with a <code>rel</code> of <q>source</q> should be provided if the information is known.</p>
                </remarks>
            </define-assembly>
            <field ref="document-id" max-occurs="unbounded">
                <group-as name="document-ids" in-json="ARRAY"/>
            </field>
            <assembly ref="property" max-occurs="unbounded">
                <group-as name="props" in-json="ARRAY"/>
            </assembly>
            <assembly ref="link" max-occurs="unbounded">
                <group-as name="links" in-json="ARRAY"/>
            </assembly>
            <define-assembly name="role" max-occurs="unbounded">
                <formal-name>Role</formal-name>
                <description>Defines a function, which might be assigned to a party in a specific situation.</description>
                <group-as name="roles" in-json="ARRAY"/>
                <define-flag name="id" as-type="token" required="yes">
                    <!-- Identifier Declarations -->
                    <formal-name>Role Identifier</formal-name>
                    <description>A unique identifier for the role.</description>
                    <prop name="value-type" value="identifier"/>
                    <prop name="identifier-type" value="human-oriented"/>
                    <prop name="identifier-uniqueness" value="instance"/>
                    <prop name="identifier-scope" value="cross-instance"/>
                    <prop name="identifier-persistence" value="per-subject"/>
                    <!-- TODO: discuss overriding of locally defined values. -->
                </define-flag>
                <model>
                    <define-field name="title" as-type="markup-line" min-occurs="1">
                        <formal-name>Role Title</formal-name>
                        <description>A name given to the role, which may be used by a tool for display and navigation.</description>
                    </define-field>
                    <define-field name="short-name">
                        <formal-name>Role Short Name</formal-name>
                        <description>A short common name, abbreviation, or acronym for the role.</description>
                    </define-field>
                    <!-- CHANGE "desc" to "description" -->
                    <define-field name="description" in-xml="WITH_WRAPPER" as-type="markup-multiline">
                        <formal-name>Role Description</formal-name>
                        <description>A summary of the role's purpose and associated responsibilities.</description>
                    </define-field>
                    <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                    </assembly>
                    <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                    </assembly>
                    <field ref="remarks" in-xml="WITH_WRAPPER"/>
                </model>
                <!-- TODO: Add support for builtin objects -->
                <!--
                <builtins>
                    <role id="creator">
                        <title>Document Created By Party </title>
                        <short-name>Document Creator</short-name>
                        <description>
                            <p>Indicates the person or organization that created this content.</p>
                        </description>
                    </role>
                    <role id="prepared-by">
                        <title>Prepared by Party</title>
                        <short-name>Prepared By</short-name>
                        <description>
                            <p>Indicates the person or organization that prepared this content.</p>
                        </description>
                    </role>
                    <role id="prepared-for">
                        <title>Prepared for Party</title>
                        <short-name>Prepared For</short-name>
                        <description>
                            <p>Indicates the person or organization for which this content was created.</p>
                        </description>
                    </role>
                    <role id="content-approver">
                        <title>Approved by Party</title>
                        <short-name>Content Approver</short-name>
                        <description>
                            <p>Indicates the person or organization responsible for all content represented in the "document".</p>
                        </description>
                    </role>
                    <role id="contact">
                        <title>Document Contact</title>
                        <short-name>Contact</short-name>
                        <description>
                            <p>Indicates the person or organization to contact for questions or support related to this content.</p>
                        </description>
                    </role>
                </builtins>
                -->
                <remarks>
                    <!-- TODO: roles only appear in metadata. Referenced in the document and linked instances. -->
                    <!-- TODO: discuss built-in roles. -->
                    <p>Permissible values to be determined closer to the application (e.g. by a receiving authority).</p>
                    <p>OSCAL has defined a set of standardized roles for consistent use in OSCAL documents. This allows tools consuming OSCAL content to infer specific semantics when these roles are used. These roles are documented in the specific contexts of their use (e.g., responsible-party, responsible-role). When using such a role, it is necessary to define these roles in this list, which will then allow such a role to be referenced.</p>
                </remarks>
            </define-assembly>
            <define-assembly name="location" max-occurs="unbounded">
                <formal-name>Location</formal-name>
                <description>A physical point of presence, which may be associated with people, organizations, or other concepts within the current or linked OSCAL document.</description>
                <group-as name="locations" in-json="ARRAY"/>
                <define-flag name="uuid" as-type="uuid" required="yes">
                    <formal-name>Location Universally Unique Identifier</formal-name>
                    <description>A unique ID for the location, for reference.</description>
                </define-flag>
                <model>
                    <define-field name="title" as-type="markup-line">
                        <formal-name>Location Title</formal-name>
                        <description>A name given to the location, which may be used by a tool for display and navigation.</description>
                    </define-field>
                    <assembly ref="address">
                        <remarks>
                            <p>The physical address of the location, which will provided for physical locations. Virtual locations can omit this data item.</p>
                        </remarks>
                    </assembly>
                    <field ref="email-address" max-occurs="unbounded">
                        <group-as name="email-addresses" in-json="ARRAY"/>
                        <remarks>
                            <p>A contact email associated with the location.</p>
                        </remarks>
                    </field>
                    <field ref="telephone-number" max-occurs="unbounded">
                        <group-as name="telephone-numbers" in-json="ARRAY"/>
                        <remarks>
                            <p>A phone number used to contact the location.</p>
                        </remarks>
                    </field>
                    <define-field name="url" as-type="uri" max-occurs="unbounded" deprecated="1.1.0">
                        <formal-name>Location URL</formal-name>
                        <description>The uniform resource locator (URL) for a web site or other resource associated with the location.</description>
                        <group-as name="urls" in-json="ARRAY"/>
                        <remarks>
                            <p>This data field is deprecated in favor of using a link with an appropriate relationship.</p>
                        </remarks>
                    </define-field>
                    <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                    </assembly>
                    <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                    </assembly>
                    <field ref="remarks" in-xml="WITH_WRAPPER"/>
                </model>
                <constraint>
                    <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="type">Characterizes the kind of location.</enum>
                    </allowed-values>
                    <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='type']/@value">
                        <enum value="data-center">A location that contains computing assets. A <code>class</code> can be used to indicate the sub-type of data-center as <em>primary</em> or <em>alternate</em>.</enum>
                    </allowed-values>
                    <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='type' and @value='data-center']/@class">
                        <enum value="primary">The location is a data-center used for normal operations.</enum>
                        <enum value="alternate">The location is a data-center used for fail-over or backup operations.</enum>
                    </allowed-values>
                    <has-cardinality target="address" level="WARNING" min-occurs="1">
                        <description>In most cases, it is useful to define a location. In some cases, defining an explicit location may represent a security risk.</description>
                    </has-cardinality>
                    <has-cardinality target="title|address|email-address|telephone-number" level="ERROR" min-occurs="1">
                        <description>A location must have at least a title, address, email-address, or telephone number.</description>
                    </has-cardinality>
                </constraint>
                <remarks>
                    <p>An address might be sensitive in nature. In such cases a title, mailing address, email-address, and/or phone number may be used instead.</p>
                </remarks>
            </define-assembly>
            <define-assembly name="party" max-occurs="unbounded">
                <formal-name>Party</formal-name>
                <description>An organization or person, which may be associated with roles or other concepts within the current or linked OSCAL document.</description>
                <group-as name="parties" in-json="ARRAY"/>
                <define-flag name="uuid" as-type="uuid" required="yes">
                    <formal-name>Party Universally Unique Identifier</formal-name>
                    <!-- Identifier Declaration -->
                    <description>A unique identifier for the party.</description>
                    <prop name="value-type" value="identifier"/>
                    <prop name="identifier-type" value="machine-oriented"/>
                    <prop name="identifier-uniqueness" value="instance"/>
                    <prop name="identifier-scope" value="cross-instance"/>
                    <prop name="identifier-persistence" value="per-subject"/>
                </define-flag>
                <define-flag name="type" as-type="string" required="yes">
                    <formal-name>Party Type</formal-name>
                    <description>A category describing the kind of party the object describes.</description>
                    <constraint>
                        <allowed-values>
                            <enum value="person">A human being regarded as an individual.</enum>
                            <enum value="organization">An organized group of one or more <code>person</code> individuals with a specific purpose.</enum>
                        </allowed-values>
                    </constraint>
                </define-flag>
                <model>
                    <define-field name="name">
                        <formal-name>Party Name</formal-name>
                        <description>The full name of the party. This is typically the legal name associated with the party.</description>
                    </define-field>
                    <define-field name="short-name">
                        <formal-name>Party Short Name</formal-name>
                        <description>A short common name, abbreviation, or acronym for the party.</description>
                    </define-field>
                    <define-field name="external-id" max-occurs="unbounded">
                        <!-- This is an id because the idenfier is assigned and managed externally by humans. -->
                        <formal-name>Party External Identifier</formal-name>
                        <description>An identifier for a person or organization using a designated
                            scheme. e.g. an Open Researcher and Contributor ID
                            (ORCID).</description>
                        <json-value-key>id</json-value-key>
                        <group-as name="external-ids" in-json="ARRAY"/>
                        <define-flag name="scheme" as-type="uri" required="yes">
                            <formal-name>External Identifier Schema</formal-name>
                            <description>Indicates the type of external identifier.</description>
                            <constraint>
                                <allowed-values allow-other="yes">
                                    <enum value="http://orcid.org/">The identifier is Open Researcher and Contributor ID (ORCID).</enum>
                                </allowed-values>
                            </constraint>
                            <remarks>
                                <p>This value must be an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that serves as a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#use-as-a-naming-system-identifier">naming system identifier</a>.</p>
                            </remarks>
                        </define-flag>
                    </define-field>
                    <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                    </assembly>
                    <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                    </assembly>
                    <field ref="email-address" max-occurs="unbounded">
                        <group-as name="email-addresses" in-json="ARRAY"/>
                        <remarks>
                            <p>This is a contact email associated with the party.</p>
                        </remarks>
                    </field>
                    <field ref="telephone-number" max-occurs="unbounded">
                        <group-as name="telephone-numbers" in-json="ARRAY"/>
                        <remarks>
                            <p>A phone number used to contact the party.</p>
                        </remarks>
                    </field>
                    <choice>
                        <assembly ref="address" max-occurs="unbounded">
                            <group-as name="addresses" in-json="ARRAY"/>
                        </assembly>
                        <field ref="location-uuid" max-occurs="unbounded">
                            <group-as name="location-uuids" in-json="ARRAY"/>
                        </field>
                    </choice>
                    <define-field name="member-of-organization" as-type="uuid" max-occurs="unbounded">
                        <formal-name>Organizational Affiliation</formal-name>
                        <!-- Identifier Reference -->
                        <description>A reference to another <code>party</code> by UUID, typically an organization, that this subject is associated with.</description>
                        <prop name="value-type" value="identifier-reference"/>
                        <prop name="identifier-type" value="machine-oriented"/>
                        <prop name="identifier-scope" value="cross-instance"/>
                        <group-as name="member-of-organizations" in-json="ARRAY"/>
                        <constraint>
                            <!-- TODO: Move to top-level to address cross-document issues. -->
                            <index-has-key name="index-metadata-party-organizations-uuid" target=".">
                                <key-field target="."/>
                            </index-has-key>
                        </constraint>
                        <remarks>
                            <p>Since the reference target of an organizational affiliation must be another <code>party</code> (whether further qualified as person or organization) as inidcated by its <code>uuid</code>. As a <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented" >machine-oriented</a> identifier with uniqueness across document and trans-document scope, this <code>uuid</code> value is sufficient to reference the data item locally or globally across related documents, e.g., in an imported OSCAL instance. </p>
                            <p>Parties of both the <code>person</code> or <code>organization</code> type can be associated with an organization using the <code>member-of-organization</code>.</p>
                        </remarks>
                    </define-field>
                    <field ref="remarks" in-xml="WITH_WRAPPER"/>
                </model>
                <constraint>
                    <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="mail-stop">A mail stop associated with the party.</enum>
                        <enum value="office">The name or number of the party's office.</enum>
                        <enum value="job-title">The formal job title of a person.</enum>
                    </allowed-values>
                </constraint>
                <remarks>
                    <p>A party can be optionally associated with either an address or a location. While providing a meaningful location for a party is desired, there are some cases where it might not be possible to provide an exact location or even any location.</p>
                </remarks>
            </define-assembly>
            <assembly ref="responsible-party" max-occurs="unbounded">
                <group-as name="responsible-parties" in-json="ARRAY"/>
            </assembly>
            <assembly ref="action" max-occurs="unbounded">
                <group-as name="actions" in-json="ARRAY"/>
            </assembly>
            <field ref="remarks" in-xml="WITH_WRAPPER"/>
        </model>
        <constraint>
            <index id="index-metadata-roles" name="index-metadata-role-ids" target="role">
                <!-- TODO: Should this be unique across the document and all imported documents? -->
                <key-field target="@id"/>
            </index>
            <is-unique id="unique-metadata-doc-id" target="document-id">
                <!--  CHANGE: Fixing field name @type -> @scheme   -->
                <key-field target="@scheme"/>
                <key-field target="."/>
            </is-unique>
            <is-unique id="unique-metadata-property" target="prop">
                <key-field target="@name"/>
                <key-field target="@ns"/>
                <key-field target="@class"/>
                <key-field target="@group"/>
                <key-field target="@value"/>
            </is-unique>
            <index id="index-metadata-property-uuid" name="index-metadata-property-uuid" target=".//prop">
                <!-- TODO: Should this be unique across the document and all imported documents? -->
                <key-field target="@uuid"/>
            </index>
            <is-unique id="unique-metadata-link" target="link">
                <key-field target="@href"/>
                <key-field target="@rel"/>
                <key-field target="@media-type"/>
            </is-unique>
            <index id="index-metadata-role-id" name="index-metadata-role-id" target="role">
                <!-- TODO: Should this be unique across the document and all imported documents? -->
                <key-field target="@id"/>
                <!--            <builtin>
               <o:role id="prepared-by">
                  <o:title>Document Preparer</o:title>
               </o:role>
            </builtin>
-->            </index>
            <index id="index-metadata-location-uuid" name="index-metadata-location-uuid" target="location">
                <!-- TODO: Should this be unique across the document and all imported documents? -->
                <key-field target="@uuid"/>
            </index>
            <index id="index-metadata-party-uuid" name="index-metadata-party-uuid" target="party">
                <!-- TODO: Should this be unique across the document and all imported documents? -->
                <key-field target="@uuid"/>
            </index>
            <index id="index-metadata-party-organizations-uuid" name="index-metadata-party-organizations-uuid" target="party[@type='organization']">
                <!-- TODO: Should this be unique across the document and all imported documents? -->
                <key-field target="@uuid"/>
            </index>
            <is-unique id="unique-metadata-responsible-party" target="responsible-party">
                <key-field target="@role-id"/>
                <remarks>
                    <p>Since <code>responsible-party</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
                </remarks>
            </is-unique>
            <allowed-values id="allowed-metadata-responsibe-party-role-ids" target="responsible-party/@role-id" allow-other="yes">
                <enum value="creator">Indicates the person or organization that created this content.</enum>
                <enum value="prepared-by">Indicates the person or organization that prepared this content.</enum>
                <enum value="prepared-for">Indicates the person or organization for which this content was created.</enum>
                <enum value="content-approver">Indicates the person or organization responsible for all content represented in the "document".</enum>
                <enum value="contact">Indicates the person or organization to contact for questions or support related to this content.</enum>
            </allowed-values>
            <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                <enum value="keywords">The value identifies a comma-seperated listing of keywords associated with this content. These keywords may be used as search terms for indexing and other applications.</enum>
            </allowed-values>
            <allowed-values target="link/@rel" allow-other="yes">
                <enum value="canonical">The link identifies the authoritative location for this resource. Defined by <a href="https://tools.ietf.org/html/rfc6596">RFC 6596</a>.</enum>
                <enum value="alternate">The link identifies an alternative location or format for this resource. Defined by <a href="https://html.spec.whatwg.org/multipage/links.html#linkTypes">the HTML Living Standard</a></enum>
                <enum value="latest-version">This link identifies a resource containing the latest version in the version history. Defined by <a href="https://tools.ietf.org/html/rfc5829">RFC 5829</a>.</enum>
                <enum value="predecessor-version">This link identifies a resource containing the predecessor version in the version history. Defined by  <a href="https://tools.ietf.org/html/rfc5829">RFC 5829</a>.</enum>
                <enum value="successor-version">This link identifies a resource containing the predecessor version in the version history. Defined by <a href="https://tools.ietf.org/html/rfc5829">RFC 5829</a>.</enum>
            </allowed-values>
            <is-unique target="document-id">
                <key-field target="@scheme"/>
                <key-field target="."/>
                <remarks>
                    <p>The combination of <code>scheme</code> and the field value must be unique.</p>
                </remarks>
            </is-unique>
        </constraint>
        <remarks>
            <p>All OSCAL documents use the same metadata structure, that provides a consistent way of expressing OSCAL document metadata across all OSCAL models. The metadata section also includes declarations of individual objects (i.e., roles, location, parties) that may be referenced within and across linked OSCAL documents.</p>
            <p>The metadata in an OSCAL document has few required fields, representing only the bare minimum data needed to differentiate one instance from another. Tools and users creating OSCAL documents may choose to use any of the optional fields, as well as extension mechanisms (e.g., properties, links) to go beyond this minimum to suit their use cases.</p>
            <p>A publisher of OSCAL content can use the <code>published</code>, <code>last-modified</code>, and <code>version</code> fields to establish information about an individual in a sequence of successive revisions of a given OSCAL-based publication. The metadata for a previous revision can be represented as a <code>revision</code> within this object. Links may also be provided using the <code>predecessor-version</code> and <code>successor-version</code> link relations to provide for direct access to the related resource. These relations can be provided as a link child of this object or as <code>link</code> within a given <code>revision</code>.</p>
            <p>A <code>responsible-party</code> entry in this context refers to roles and parties that have responsibility relative to the production, review, publication, and use of the containing document.</p>
        </remarks>
    </define-assembly>

    <define-field name="location-uuid" as-type="uuid">
        <formal-name>Location Universally Unique Identifier Reference</formal-name>
        <!-- Identifier Reference -->
        <description>Reference to a location by UUID.</description>
        <prop name="value-type" value="identifier-reference"/>
        <prop name="identifier-type" value="machine-oriented"/>
        <prop name="identifier-scope" value="cross-instance"/>
        <constraint>
            <index-has-key name="index-metadata-location-uuid" target=".">
                <!-- TODO: This is impacted by cross-document cross-references We need to relocate or localize this constraint. -->
                <key-field target="."/>
            </index-has-key>
        </constraint>
    </define-field>

    <define-field name="party-uuid" as-type="uuid">
        <formal-name>Party Universally Unique Identifier Reference</formal-name>
        <!-- Identifier Reference -->
        <description>Reference to a party by UUID.</description>
        <prop name="value-type" value="identifier-reference"/>
        <prop name="identifier-type" value="machine-oriented"/>
        <prop name="identifier-scope" value="cross-instance"/>
        <constraint>
            <index-has-key name="index-metadata-party-uuid" target=".">
                <!-- TODO: This is impacted by cross-document cross-references We need to relocate or localize this constraint. -->
                <key-field target="."/>
            </index-has-key>
        </constraint>
    </define-field>

    <define-field name="role-id" as-type="token">
        <formal-name>Role Identifier Reference</formal-name>
        <!-- Identifier Reference -->
        <description>Reference to a role by UUID.</description>
        <prop name="value-type" value="identifier-reference"/>
        <prop name="identifier-type" value="human-oriented"/>
        <prop name="identifier-scope" value="cross-instance"/>
        <constraint>
            <index-has-key name="index-metadata-role-id" target=".">
                <!-- TODO: This is impacted by cross-document cross-references We need to relocate or localize this constraint. -->
                <key-field target="."/>
            </index-has-key>
        </constraint>
    </define-field>

    <!-- ############################################### -->
    <!-- # Back Matter Assembly and related constructs # -->
    <!-- ############################################### -->
    <define-assembly name="back-matter">
        <formal-name>Back matter</formal-name>
        <description>A collection of resources that may be referenced from within the OSCAL document instance.</description>
        <model>
            <define-assembly name="resource" max-occurs="unbounded">
                <formal-name>Resource</formal-name>
                <description>A resource associated with content in the containing document instance. A resource may be directly included in the document using base64 encoding or may point to one or more equivalent internet resources.</description>
                <group-as name="resources" in-json="ARRAY"/>
                <define-flag name="uuid" as-type="uuid" required="yes">
                    <formal-name>Resource Universally Unique Identifier</formal-name>
                    <description>A unique identifier for a resource.</description>
                    <!-- identifier declaration -->
                </define-flag>
                <model>
                    <define-field name="title" as-type="markup-line">
                        <formal-name>Resource Title</formal-name>
                        <description>An optional name given to the resource, which may be used by a tool for display and navigation.</description>
                    </define-field>
                    <define-field name="description" in-xml="WITH_WRAPPER" as-type="markup-multiline">
                        <formal-name>Resource Description</formal-name>
                        <description>An optional short summary of the resource used to indicate the purpose of the resource.</description>
                    </define-field>
                    <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                    </assembly>
                    <field ref="document-id" max-occurs="unbounded">
                        <group-as name="document-ids" in-json="ARRAY"/>
                    </field>
                    <define-assembly name="citation">
                        <formal-name>Citation</formal-name>
                        <description>An optional citation consisting of end note text using structured markup.</description>
                        <model>
                            <define-field name="text" as-type="markup-line" min-occurs="1">
                                <formal-name>Citation Text</formal-name>
                                <description>A line of citation text.</description>
                            </define-field>
                            <assembly ref="property" max-occurs="unbounded">
                                <group-as name="props" in-json="ARRAY"/>
                            </assembly>
                            <assembly ref="link" max-occurs="unbounded">
                                <group-as name="links" in-json="ARRAY"/>
                            </assembly>
                            </model>
                    </define-assembly>
                    <define-assembly name="rlink" max-occurs="unbounded">
                        <formal-name>Resource link</formal-name>
                        <description>A URL-based pointer to an external resource with an optional hash for verification and change detection.</description>
                        <group-as name="rlinks" in-json="ARRAY"/>
                        <define-flag name="href" as-type="uri-reference" required="yes">
                            <formal-name>Hypertext Reference</formal-name>
                            <description>A resolvable URL pointing to the referenced resource.</description>
                            <remarks>
                                <p>This value may be either:</p>
                                <ol>
                                    <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
                                    <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
                                </ol>
                            </remarks>
                        </define-flag>
                        <flag ref="media-type"/>
                        <model>
                            <field ref="hash" max-occurs="unbounded">
                                <description>A hash of the resource identified by <code>href</code>, which can be used to verify the resource was not changed since it was hashed.</description>
                                <group-as name="hashes" in-json="ARRAY"/>
                                <remarks>
                                    <p>The <code>hash</code> value can be used to confirm that the resource referenced by the <code>href</code> is the same resources that was hashed by retrieving the resource, calculating a hash, and comparing the result to this value.</p>
                                </remarks>
                            </field>
                        </model>
                        <remarks>
                            <p>Multiple <code>rlink</code> objects can be included for a resource. In such a case, all provided <code>rlink</code> items are intended to be equivalent in content, but may differ in structure or format.</p>
                            <p>A <code>media-type</code> is used to identify the format of a given rlink, and can be used to differentiate items in a collection of rlinks. The <code>media-type</code> provides a hint to the OSCAL document consumer about the structure of the resource referenced by the <code>rlink</code>.
                            </p>
                        </remarks>
                    </define-assembly>

                    <define-field name="base64" as-type="base64">
                        <formal-name>Base64</formal-name>
                        <description>A resource encoded using the Base64 alphabet defined by <a href="https://www.rfc-editor.org/rfc/rfc2045.html">RFC 2045</a>.</description>
                        <json-value-key>value</json-value-key>
                        <define-flag name="filename" as-type="token">
                            <formal-name>File Name</formal-name>
                            <description>Name of the file before it was encoded as Base64 to be embedded in a <code>resource</code>. This is the name that will be assigned to the file when the file is decoded.</description>
                        </define-flag>
                        <flag ref="media-type"/>
                    </define-field>
                    <field ref="remarks" in-xml="WITH_WRAPPER"/>
                    <!-- <any/> -->
                </model>
                <constraint>
                    <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                        <enum value="type">Identifies the type of resource represented. The most specific appropriate type value SHOULD be used.</enum>
                        <enum value="version">For resources representing a published document, this represents the version number of that document.</enum>
                        <enum value="published">For resources representing a published document, this represents the publication date of that document.</enum>
                    </allowed-values>
                    <matches target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='published']/@value" datatype="date-time-with-timezone"/>
                    <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='type']/@value">
                        <!-- More general. Applies across all models. -->
                        <enum value="logo">Indicates the resource is an organization's logo.</enum>
                        <enum value="image">Indicates the resource represents an image.</enum>
                        <enum value="screen-shot">Indicates the resource represents an image of screen content. </enum>
                        <enum value="law">Indicates the resource represents an applicable law.</enum>
                        <enum value="regulation">Indicates the resource represents an applicable regulation.</enum>
                        <enum value="standard">Indicates the resource represents an applicable standard.</enum>
                        <enum value="external-guidance">Indicates the resource represents applicable guidance.</enum>
                        <enum value="acronyms">Indicates the resource provides a list of relevant acronyms.</enum>
                        <enum value="citation">Indicates the resource cites relevant information.</enum>
                        <!-- More related to implementation layer. -->
                        <enum value="policy">Indicates the resource is a policy.</enum>
                        <enum value="procedure">Indicates the resource is a procedure.</enum>
                        <enum value="system-guide">Indicates the resource is guidance document related to the subject system of an SSP.</enum>
                        <enum value="users-guide">Indicates the resource is guidance document a user's guide or administrator's guide.</enum>
                        <enum value="administrators-guide">Indicates the resource is guidance document a administrator's guide.</enum>
                        <enum value="rules-of-behavior">Indicates the resource represents rules of behavior content.</enum>
                        <enum value="plan">Indicates the resource represents a plan.</enum>
                        <!-- More related to assessment layers. -->
                        <enum value="artifact">Indicates the resource represents an artifact, such as may be reviewed by an assessor.</enum>
                        <enum value="evidence">Indicates the resource represents evidence, such as to support an assessment finding.</enum>
                        <enum value="tool-output">Indicates the resource represents output from a tool.</enum>
                        <enum value="raw-data">Indicates the resource represents machine data, which may require a tool or analysis for interpretation or presentation.</enum>
                        <enum value="interview-notes">Indicates the resource represents notes from an interview, such as may be collected during an assessment.</enum>
                        <enum value="questionnaire">Indicates the resource is a set of questions, possibly with responses.</enum>
                        <enum value="report">Indicates the resource is a report.</enum>
                        <enum value="agreement">Indicates the resource is a formal agreement between two or more parties.</enum>
                    </allowed-values>
                    <has-cardinality level="WARNING" target="rlink|base64" min-occurs="1">
                        <description>A resource should provide at least an <code>rlink</code> or <code>base64</code> object.</description>
                    </has-cardinality>
                    <is-unique id="unique-resource-rlink-href" target="rlink">
                        <description>Ensure that each rlink item references a unique resource.</description>
                        <key-field target="@href"/>
                        <key-field target="@media-type"/>
                    </is-unique>
                    <is-unique id="unique-resource-base64-filename" target="base64">
                        <description>Ensure that all base64 resources have a unique <code>filename</code>.</description>
                        <key-field target="@filename"/>
                    </is-unique>
                    <expect target=".[citation]" test="title">
                        <description>A <code>title</code> is required when a <code>citation</code> is provided.</description>
                    </expect>
                </constraint>
                <remarks>
                    <!-- TODO: state that at least one rlink and/or base64 should be provided. -->
                    <p>A resource can be used in two ways. 1) it may point to an specific retrievable network resource using a <code>rlink</code>, or 2) it may be included as an attachment using a <code>base64</code>. A resource may contain multiple <code>rlink</code> and <code>base64</code> entries that represent alternative download locations (rlink) and attachments (base64) for the same resource.</p>
                    <p>Both rlink and base64 allow for a <code>media-type</code> to be specified, which is used to distinguish between different representations of the same resource (e.g., Microsoft Word, PDF). When multiple <code>rlink</code> and <code>base64</code> items are included for a given resource, all items must contain equivalent information. This allows the document consumer to choose a preferred item to process based on a the selected item's <code>media-type</code>. This is extremely important when the items represent OSCAL content that is represented in alternate formats (i.e., XML, JSON, YAML), allowing the same OSCAL data to be processed from any of the available formats indicated by the items.</p>
                    <p>When a resource includes a citation, then the <code>title</code> and <code>citation</code> properties must both be included.</p>
                </remarks>
            </define-assembly>
        </model>
        <constraint>
            <index name="index-back-matter-resource" target="resource">
                <key-field target="@uuid"/>
            </index>
        </constraint>
        <remarks>
            <p>Provides a collection of identified <code>resource</code> objects that can be referenced by a <code>link</code> with a <code>rel</code> value of "reference" and an <code>href</code> value that is a fragment "#" followed by a reference to a reference's <code>uuid</code>. Other specialized link "rel" values also use this pattern when indicated in that context of use.</p>
        </remarks>
        <example>
            <!-- TODO: revisit this example -->
            <description>Use of link, citation, and resource</description>
            <remarks>
                <p>The following is a contrived example to show the use of link, citation, and resource.</p>
            </remarks>
            <o:profile xmlns:o="http://csrc.nist.gov/ns/oscal/example">
                <o:metadata>
                    <o:link rel="citation" href="#a53da8f9-4182-4f11-9d1f-50f08ac2117b">My citation</o:link>
                </o:metadata>
                <o:back-matter>
                    <o:resource uuid="a53da8f9-4182-4f11-9d1f-50f08ac2117b">
                        <o:rlink href="https://example.org/some-resource"/>
                    </o:resource>
                </o:back-matter>
            </o:profile>
        </example>
    </define-assembly>

    <!-- ##################### -->
    <!-- # Global constructs # -->
    <!-- ##################### -->
    <define-assembly name="property">
        <formal-name>Property</formal-name>
        <description>An attribute, characteristic, or quality of the containing object expressed as a namespace qualified name/value pair.</description>
        <use-name>prop</use-name>
        <define-flag name="name" as-type="token" required="yes">
            <formal-name>Property Name</formal-name>
            <description>A textual label, within a namespace, that identifies a specific attribute, characteristic, or quality of the property's containing object.</description>
        </define-flag>
        <define-flag name="uuid" as-type="uuid">
            <formal-name>Property Universally Unique Identifier</formal-name>
            <!-- identifier declaration -->
            <description>A unique identifier for a property.</description>
        </define-flag>
        <define-flag name="ns" as-type="uri" default="http://csrc.nist.gov/ns/oscal">
            <formal-name>Property Namespace</formal-name>
            <description>A namespace qualifying the property's name. This allows different organizations to associate distinct semantics with the same name.</description>
            <remarks>
                <p>This value must be an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that serves as a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#use-as-a-naming-system-identifier">naming system identifier</a>.</p>
                <p>When a <code>ns</code> is not provided, its value should be assumed to be <code>http://csrc.nist.gov/ns/oscal</code> and the name should be a name defined by the associated OSCAL model.</p>
            </remarks>
        </define-flag>
        <define-flag name="value" as-type="string" required="yes">
            <formal-name>Property Value</formal-name>
            <description>Indicates the value of the attribute, characteristic, or quality.</description>
        </define-flag>
        <define-flag name="class" as-type="token">
            <formal-name>Property Class</formal-name>
            <description>A textual label that provides a sub-type or characterization of the
                property's <code>name</code>.</description>
            <remarks>
                <p>This can be used to further distinguish or discriminate between the semantics of multiple properties of the same object with the same <code>name</code> and <code>ns</code>, or to group properties into categories.</p>
                <p>A <code>class</code> can be used in validation rules to express extra constraints over named items of a specific <code>class</code> value. It is available for grouping, but unlike <code>group</code> is not expected specifically to designate any group membership as such.</p>
            </remarks>
        </define-flag>
        <define-flag name="group" as-type="token">
            <formal-name>Property Group</formal-name>
            <description>An identifier for relating distinct sets of properties.</description>
            <remarks>
                <p>Different sets of properties may relate to separate contexts. Declare a group on a property to associate it with one or more other properties in a given context.</p>
            </remarks>
        </define-flag>
        <model>
            <field ref="remarks" in-xml="WITH_WRAPPER"/>
        </model>
        <constraint>
            <allowed-values target=".[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                <enum value="marking">A label or descriptor that is tied to a sensitivity or classification marking system. An optional class can be used to define the specific marking system used for the associated value.</enum>
            </allowed-values>
        </constraint>
        <remarks>
            <p>Properties permit the deployment and management of arbitrary controlled values, within OSCAL objects. A property can be included for any purpose useful to an application or implementation. Typically, properties will be used to sort, filter, select, order, and arrange OSCAL content objects, to relate OSCAL objects to one another, or to associate an OSCAL object to class hierarchies, taxonomies, or external authorities. Thus, the lexical composition of properties may be constrained by external processes to ensure consistency.</p>
            <p>Property allows for associated remarks that describe why the specific property value was applied to the containing object, or the significance of the value in the context of the containing object.</p>
        </remarks>
    </define-assembly>

    <define-assembly name="link">
        <formal-name>Link</formal-name>
        <description>A reference to a local or remote resource, that has a specific relation to the containing object.</description>
        <define-flag name="href" as-type="uri-reference" required="yes">
            <formal-name>Hypertext Reference</formal-name>
            <description>A resolvable URL reference to a resource.</description>
            <remarks>
                <p>This value may be one of:</p>
                <ol>
                    <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
                    <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
                    <li>a bare URI fragment (i.e., `#uuid`) pointing to an OSCAL object by the objects identifier (e.g., id, uuid) in this or an imported document (see <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking to another OSCAL object</a>). The specific object type will differ based on the link relationship type.</li>
                </ol>
            </remarks>
        </define-flag>
        <define-flag name="rel" as-type="token">
            <formal-name>Link Relation Type</formal-name>
            <description>Describes the type of relationship provided by the link's hypertext reference. This can be an indicator of the link's purpose.</description>
            <constraint>
                <allowed-values allow-other="yes">
                    <enum value="reference">A generalized reference to a network resource (relative or absolute) or to a <code>back-matter</code> resource by UUID expressed as a bare URI fragment.</enum>
                </allowed-values>
            </constraint>
        </define-flag>
        <flag ref="media-type">
            <formal-name>Link Media Type</formal-name>
            <remarks>
                <p>The <code>media-type</code> provides a hint about the content model of the referenced resource. A valid entry from the <a href="https://www.iana.org/assignments/media-types/media-types.xhtml">IANA Media Types registry</a> SHOULD be used.</p>
            </remarks>
        </flag>
        <define-flag name="resource-fragment" as-type="string">
            <formal-name>Resource Fragment</formal-name>
            <description>In case where the <code>href</code> points to a <code>back-matter/resource</code>, this value will indicate the URI <a href="https://www.rfc-editor.org/rfc/rfc3986#section-3.5">fragment</a> to append to any <code>rlink</code> associated with the resource. This value MUST be <a href="https://www.rfc-editor.org/rfc/rfc3986#section-2.1">URI encoded</a>.</description>
        </define-flag>
        <model>
            <define-field name="text" as-type="markup-line">
                <formal-name>Link Text</formal-name>
                <description>A textual label to associate with the link, which may be used for presentation in a tool.</description>
            </define-field>
        </model>
        <constraint>
            <expect target=".[starts-with(@href,'#')]" test="not(exists(@media-type))">
                <description>A local reference SHOULD NOT have a media-type.</description>
                <remarks>
                    <p>Since both <code>link</code> and <code>back-matter/resource</code> both allow specification of a <code>media-type</code>, the <code>media-type</code> on <code>link</code> may conflict with the any <code>media-type</code> entries on a resource's <code>rlink</code> or <code>base64</code> objects. This constraint prevents this from occurring.</p>
                </remarks>
            </expect>
            <matches target=".[@rel=('reference') and starts-with(@href,'#')]/@href" datatype="uri-reference"/>
            <index-has-key name="index-back-matter-resource" target=".[@rel=('reference') and starts-with(@href,'#')]">
                <key-field target="@href" pattern="#(.*)"/>
            </index-has-key>
            <matches target=".[@rel=('reference') and not(starts-with(@href,'#'))]/@href" datatype="uri"/>
            <matches target="@resource-fragment" regex="(?:[0-9a-zA-Z-._~/?!$&amp;'()*+,;=:@]|%[0-9A-F][0-9A-F])+">
                <remarks>
                    <p>This pattern is based on the fragment Augmented Backus-Naur form (ABNF) syntax provided in [RFC3986 section 3.5](https://www.rfc-editor.org/rfc/rfc3986#section-3.5). Uppercase alpha hex digits are required, which is the preferred normalized form defined in RFC3986.</p>
                </remarks>
            </matches>
        </constraint>
        <remarks>
            <p>To provide a cryptographic hash for a remote target resource, a local reference to a back matter <code>resource</code> is needed. The resource allows one or more hash values to be provided using the <code>rlink/hash</code> object.</p>
            <p>The OSCAL <code>link</code> is a roughly based on the HTML <a href="https://www.w3.org/TR/html401/struct/links.html#edef-LINK">link element</a>.
            </p>
        </remarks>
        <example>
            <description>Providing for link integrity</description>
            <remarks>
                <p>The following is a contrived example to show the use of link, citation, and resource.</p>
            </remarks>
            <o:oscal xmlns:o="http://csrc.nist.gov/ns/oscal/example">
                <o:link rel="reference" href="#resource1">My Hashed Resource</o:link>
        ...snip...
                <o:back-matter>
                    <o:resource id="resource1">
                        <o:rlink href="https://example.org/some-resource">
                            <o:hash algorithm="sha512">C2E9C1..snip..F88D2E</o:hash>
                        </o:rlink>
                    </o:resource>
                </o:back-matter>
            </o:oscal>
        </example>
    </define-assembly>

    <define-assembly name="responsible-party">
        <formal-name>Responsible Party</formal-name>
        <description>A reference to a set of persons and/or organizations that have responsibility for performing the referenced role in the context of the containing object.</description>
        <define-flag required="yes" name="role-id" as-type="token">
            <formal-name>Responsible Role</formal-name>
            <!-- Identifier Reference -->
            <description>A reference to a <code>role</code> performed by a <code>party</code>.</description>
            <prop name="value-type" value="identifier-reference"/>
            <prop name="identifier-type" value="human-oriented"/>
            <prop name="identifier-scope" value="cross-instance"/>
        </define-flag>
        <model>
            <field ref="party-uuid" min-occurs="1" max-occurs="unbounded">
                <description>Specifies one or more parties responsible for performing the associated <code>role</code>.</description>
                <group-as name="party-uuids" in-json="ARRAY"/>
            </field>
            <assembly ref="property" max-occurs="unbounded">
                <group-as name="props" in-json="ARRAY"/>
            </assembly>
            <assembly ref="link" max-occurs="unbounded">
                <group-as name="links" in-json="ARRAY"/>
            </assembly>
            <field ref="remarks" in-xml="WITH_WRAPPER"/>
        </model>
        <constraint>
            <index-has-key name="index-metadata-role-id" target=".">
                <key-field target="@role-id"/>
            </index-has-key>
        </constraint>
        <remarks>
            <p>A <code>responsible-party</code> requires one or more <code>party-uuid</code> references creating a strong relationship arc between the referenced <code>role-id</code> and the reference parties. This differs in semantics from <code>responsible-role</code> which doesn't require that a <code>party-uuid</code> is referenced.</p>
            <p>The scope of use of this object determines if the responsibility has been performed or will be performed in the future. The containing object will describe the intent.</p>
        </remarks>
    </define-assembly>
 
    <define-assembly name="action">
        <formal-name>Action</formal-name>
        <description>An action applied by a role within a given party to the content.</description>
        <define-flag name="uuid" as-type="uuid" required="yes">
            <formal-name>Action Universally Unique Identifier</formal-name>
            <description>A unique identifier that can be used to reference this defined action elsewhere in an OSCAL document. A UUID should be consistently used for a given location across revisions of the document.</description>
        </define-flag>
        <define-flag name="date" as-type="date-time-with-timezone">
            <formal-name>Action Occurrence Date</formal-name>
            <description>The date and time when the action occurred.</description>
        </define-flag>
        <define-flag name="type" as-type="token" required="yes">
            <formal-name>Action Type</formal-name>
            <description>The type of action documented by the assembly, such as an approval.</description>
        </define-flag>
        <define-flag name="system" as-type="uri" required="yes">
            <formal-name>Action Type System</formal-name>
            <description>Specifies the action type system used.</description>
            <remarks>
                <p>Provides a means to segment the value space for the <code>type</code>, so that different organizations and individuals can assert control over the allowed <code>action</code>'s <code>type</code>. This allows the semantics associated with a given <code>type</code> to be defined on an organization-by-organization basis.</p>
                <p>An organization MUST use a URI that they have control over. e.g., a domain registered to the organization in a URI, a registered uniform resource names (URN) namespace.</p>
            </remarks>
         </define-flag>
        <model>
            <assembly ref="property" max-occurs="unbounded">
                <group-as name="props" in-json="ARRAY"/>
            </assembly>
            <assembly ref="link" max-occurs="unbounded">
                <group-as name="links" in-json="ARRAY"/>
            </assembly>
            <assembly ref="responsible-party" max-occurs="unbounded">
                <group-as name="responsible-parties" in-json="ARRAY"/>
            </assembly>
            <field ref="remarks" in-xml="WITH_WRAPPER"/>
        </model>
        <constraint>
            <index-has-key name="index-metadata-role-id" target="responsible-party">
                <key-field target="@role-id"/>
            </index-has-key>
            <index-has-key name="index-metadata-party-uuid" target="responsible-party">
                <key-field target="party-uuid"/>
            </index-has-key>
            <allowed-values target="./system/@value" allow-other="yes">
                <enum value="http://csrc.nist.gov/ns/oscal">This value identifies action types defined in the NIST OSCAL namespace.</enum>
             </allowed-values>
             <allowed-values target="./type[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@value">
                <enum value="approval">An approval of a document instance's content.</enum>
                <enum value="request-changes">A request from the responisble party or parties to change the content.</enum>
            </allowed-values>
        </constraint>
    </define-assembly>
 
    <define-assembly name="responsible-role">
        <formal-name>Responsible Role</formal-name>
        <description>A reference to a role with responsibility for performing a function relative to the containing object, optionally associated with a set of persons and/or organizations that perform that role.</description>
        <define-flag name="role-id" as-type="token" required="yes">
            <formal-name>Responsible Role ID</formal-name>
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#human-oriented">human-oriented</a> identifier reference to a <code>role</code> performed.</description>
        </define-flag>
        <model>
            <assembly ref="property" max-occurs="unbounded">
                <group-as name="props" in-json="ARRAY"/>
            </assembly>
            <assembly ref="link" max-occurs="unbounded">
                <group-as name="links" in-json="ARRAY"/>
            </assembly>
            <field ref="party-uuid" max-occurs="unbounded">
                <description>Specifies zero or more parties responsible for performing the associated <code>role</code>.</description>
                <group-as name="party-uuids" in-json="ARRAY"/>
            </field>
            <field ref="remarks" in-xml="WITH_WRAPPER"/>
        </model>
        <remarks>
            <p>A <code>responsible-role</code> allows zero or more <code>party-uuid</code> references, each of which creates a relationship arc between the referenced <code>role-id</code> and the referenced party. This differs in semantics from <code>responsible-party</code>, which requires that at least one <code>party-uuid</code> is referenced.</p>
            <p>The scope of use of this object determines if the responsibility has been performed or will be performed in the future. The containing object will describe the intent.</p>
        </remarks>
    </define-assembly>

    <define-field name="hash">
        <!-- TODO: need a hex binary type. -->
        <formal-name>Hash</formal-name>
        <description>A representation of a cryptographic digest generated over a resource using a specified hash algorithm.</description>
        <json-value-key>value</json-value-key>
        <define-flag name="algorithm" as-type="string" required="yes">
            <formal-name>Hash algorithm</formal-name>
            <description>The digest method by which a hash is derived.</description>
            <constraint>
                <allowed-values allow-other="yes">
                    <enum value="SHA-224">The SHA-224 algorithm as defined by <a href="https://doi.org/10.6028/NIST.FIPS.180-4">NIST FIPS 180-4</a>.
                    </enum>
                    <enum value="SHA-256">The SHA-256 algorithm as defined by <a href="https://doi.org/10.6028/NIST.FIPS.180-4">NIST FIPS 180-4</a>.
                    </enum>
                    <enum value="SHA-384">The SHA-384 algorithm as defined by <a href="https://doi.org/10.6028/NIST.FIPS.180-4">NIST FIPS 180-4</a>.
                    </enum>
                    <enum value="SHA-512">The SHA-512 algorithm as defined by <a href="https://doi.org/10.6028/NIST.FIPS.180-4">NIST FIPS 180-4</a>.
                    </enum>
                    <enum value="SHA3-224">The SHA3-224 algorithm as defined by <a href="https://doi.org/10.6028/NIST.FIPS.202">NIST FIPS 202</a>.
                    </enum>
                    <enum value="SHA3-256">The SHA3-256 algorithm as defined by <a href="https://doi.org/10.6028/NIST.FIPS.202">NIST FIPS 202</a>.
                    </enum>
                    <enum value="SHA3-384">The SHA3-384 algorithm as defined by <a href="https://doi.org/10.6028/NIST.FIPS.202">NIST FIPS 202</a>.
                    </enum>
                    <enum value="SHA3-512">The SHA3-512 algorithm as defined by <a href="https://doi.org/10.6028/NIST.FIPS.202">NIST FIPS 202</a>.
                    </enum>
                </allowed-values>
            </constraint>
            <remarks>
                <p>Any other value used MUST be a value defined in the W3C <a href="https://www.w3.org/TR/xmlsec-algorithms/#digest-method-uris">XML Security Algorithm Cross-Reference</a> Digest Methods (W3C, April 2013) or <a href="https://tools.ietf.org/html/rfc6931#section-2.1.5">RFC 6931 Section 2.1.5</a> New SHA Functions.</p>
            </remarks>
        </define-flag>
        <constraint>
            <matches id="oscal-check-hash-length-SHA2-3-224" target=".[@algorithm=('SHA-224','SHA3-224')]" regex="^[0-9a-fA-F]{56}$"/>
            <matches id="oscal-check-hash-length-SHA2-3-256" target=".[@algorithm=('SHA-256','SHA3-256')]" regex="^[0-9a-fA-F]{64}$"/>
            <matches id="oscal-check-hash-length-SHA2-3-384" target=".[@algorithm=('SHA-384','SHA3-384')]" regex="^[0-9a-fA-F]{96}$"/>
            <matches id="oscal-check-hash-length-SHA2-3-512" target=".[@algorithm=('SHA-512','SHA3-512')]" regex="^[0-9a-fA-F]{128}$"/>
        </constraint>
    </define-field>

    <define-flag name="media-type" as-type="string">
        <formal-name>Media Type</formal-name>
        <description>A label that indicates the nature of a resource, as a data serialization or
            format.</description>
        <remarks>
            <p> The Internet Assigned Numbers Authority (IANA) <a
                    href="https://www.iana.org/assignments/media-types/media-types.xhtml">Media
                    Types Registry</a> defines a standardized set of media types, which may be used
                here.</p>
            <p>The <code>application/oscal+xml</code>, <code>application/oscal+json</code> or <code>application/oscal+yaml</code> media types SHOULD be used when referencing OSCAL XML, JSON, or YAML resources respectively.</p>
            <p>**Note: There is no official media type for YAML at this time.** OSCAL documents should specify <code>application/yaml</code> for general YAML content, or <code>application/oscal+yaml</code> for YAML-based OSCAL content. This approach aligns with use of a structured name suffix, per <a href="https://www.rfc-editor.org/rfc/rfc6838.html#section-4.2.8">RFC 6838 Section 4.2.8</a>.</p>
            <p>Some earlier OSCAL content incorporated the model into the media type. For example: <code>application/oscal.catalog+xml</code>. This practice SHOULD be avoided, since the OSCAL model can be detected by parsing the initial content of the referenced resource.</p>
        </remarks>
    </define-flag>

    <define-field name="remarks" as-type="markup-multiline">
        <formal-name>Remarks</formal-name>
        <description>Additional commentary about the containing object.</description>
        <remarks>
            <p>The <code>remarks</code> field SHOULD not be used to store arbitrary data. Instead, a <code>prop</code> or <code>link</code> should be used to annotate or reference any additional data not formally supported by OSCAL.</p>
        </remarks>
    </define-field>

    <!-- #################### -->
    <!-- # Local constructs # -->
    <!-- #################### -->
    <define-field name="published" as-type="date-time-with-timezone" scope="local">
        <formal-name>Publication Timestamp</formal-name>
        <description>The date and time the document was last made available.</description>
        <remarks>
            <p>Typically, this date value will be machine-generated at the time the containing document is published.</p>
            <p>In some cases, an OSCAL document may be derived from some source material provided in a different format. In such a case, the <code>published</code> value should indicate when the OSCAL document instance was last published, not the source material.</p>
            <!-- TODO: (AJ) State how to do the following: Where necessary, the publication date of the original source material can be captured as a named property. Define the link relation, and document here how to do this. -->
        </remarks>
    </define-field>

    <define-field name="last-modified" as-type="date-time-with-timezone" scope="local">
        <formal-name>Last Modified Timestamp</formal-name>
        <description>The date and time the document was last stored for later retrieval.</description>
        <remarks>
            <p>This value represents the point in time when the OSCAL document was last updated, or at the point of creation the creation date. Typically, this date value will be machine generated at time of creation or modification. Ideally, this field will be managed by the editing tool or service used to make modifications when storing the modified document.</p>
            <p>The intent of the last modified timestamp is to distinguish between significant change milestones when the document may be accessed by multiple entities. This allows a given entity to differentiate between mutiple document states at specific points in time. It is possible to make multiple modifications to the document without storing these changes. In such a case, the last modified timestamp might not be updated until the document is finally stored.</p>
            <p>In some cases, an OSCAL document may be derived from some source material in a different format. In such a case, the <code>last-modified</code> value should indicate the last modification time of the OSCAL document instance, not the source material.</p>
        </remarks>
    </define-field>
    <define-field name="version" scope="local">
        <formal-name>Document Version</formal-name>
        <description>Used to distinguish a specific revision of an OSCAL document from other previous and future versions.</description>
        <remarks>
            <p>A version may be a release number, sequence number, date, or other identifier sufficient to distinguish between different document revisions.</p>
            <p>While not required, it is recommended that OSCAL content authors use <a href="https://semver.org/spec/v2.0.0.html">Semantic Versioning</a> as the version format. This allows for the easy identification of a version tree consisting of major, minor, and patch numbers.</p>
            <p>A version is typically set by the document owner or by the tool used to maintain the content.</p>
        </remarks>
    </define-field>
    <define-field name="oscal-version" scope="local">
        <formal-name>OSCAL Version</formal-name>
        <description>The OSCAL model version the document was authored against and will conform to as valid.</description>
        <remarks>
            <p>Indicates the version of the OSCAL model to which the document conforms, for example <q>1.1.0</q> or <q>1.0.0-milestone1</q>. That can be used as a hint for a tool indicating which version of the OSCAL XML or JSON schema to use for validation.</p>
            <p>The OSCAL version serves a different purpose from the document version and is used to represent a different concept. If both have the same value, this is coincidental.</p>
        </remarks>
    </define-field>

    <define-field name="email-address" as-type="email-address" scope="local">
        <formal-name>Email Address</formal-name>
        <description>An email address as defined by <a
                href="https://tools.ietf.org/html/rfc5322#section-3.4.1">RFC 5322 Section
            3.4.1</a>.</description>
    </define-field>

    <define-field name="telephone-number" scope="local">
        <formal-name>Telephone Number</formal-name>
        <description>A telephone service number as defined by <a href="https://www.itu.int/rec/T-REC-E.164-201011-I/en">ITU-T E.164</a>.</description>
        <json-value-key>number</json-value-key>
        <define-flag name="type">
            <formal-name>type flag</formal-name>
            <description>Indicates the type of phone number.</description>
            <constraint>
                <allowed-values allow-other="yes">
                    <enum value="home">A home phone number.</enum>
                    <enum value="office">An office phone number.</enum>
                    <enum value="mobile">A mobile phone number.</enum>
                </allowed-values>
            </constraint>
        </define-flag>
        <constraint>
            <matches level="WARNING" target="." regex="^[0-9]{3}[0-9]{1,12}$">
                <remarks>
                    <p>Providing a country code provides an international means to interpret the phone number.</p>
                </remarks>
            </matches>
        </constraint>
    </define-field>

    <define-assembly name="address" scope="local">
        <formal-name>Address</formal-name>
        <description>A postal address for the location.</description>
        <flag ref="location-type">
            <use-name>type</use-name>
        </flag>
        <model>
            <field ref="addr-line" max-occurs="unbounded">
                <!-- CHANGE: "postal-address" to "addr-lines" -->
                <group-as name="addr-lines" in-json="ARRAY"/>
            </field>
            <define-field name="city">
                <formal-name>City</formal-name>
                <description>City, town or geographical region for the mailing address.</description>
            </define-field>
            <define-field name="state">
                <formal-name>State</formal-name>
                <description>State, province or analogous geographical region for a mailing
                    address.</description>
            </define-field>
            <define-field name="postal-code">
                <formal-name>Postal Code</formal-name>
                <description>Postal or ZIP code for mailing address.</description>
            </define-field>
            <define-field name="country">
                <formal-name>Country Code</formal-name>
                <description>The ISO 3166-1 alpha-2 country code for the mailing address.</description>
                <constraint>
                    <matches target="." regex="[A-Z]{2}"/>
                </constraint>
            </define-field>
            <!-- More address stuff -->
        </model>
    </define-assembly>
    <define-field name="addr-line" scope="local">
        <formal-name>Address line</formal-name>
        <description>A single line of an address.</description>
    </define-field>

    <define-flag name="location-type" as-type="token" scope="local">
        <formal-name>Address Type</formal-name>
        <description>Indicates the type of address.</description>
        <constraint>
            <allowed-values allow-other="yes">
                <enum value="home">A home address.</enum>
                <enum value="work">A work address.</enum>
            </allowed-values>
        </constraint>
    </define-flag>

    <define-field name="document-id" scope="local">
        <formal-name>Document Identifier</formal-name>
        <!-- identifier declaration -->
        <description>A document identifier qualified by an identifier
            <code>scheme</code>.</description>
        <json-value-key>identifier</json-value-key>
        <define-flag name="scheme" as-type="uri">
            <formal-name>Document Identification Scheme</formal-name>
            <description>Qualifies the kind of document identifier using a URI. If the scheme is not
                provided the value of the element will be interpreted as a string of
                characters.</description>
            <constraint>
                <allowed-values allow-other="yes">
                    <enum value="http://www.doi.org/">A <a href="https://www.doi.org/hb.html">Digital Object Identifier</a> (DOI); use is preferred, since this allows for retrieval of a full bibliographic record.</enum>
                </allowed-values>
            </constraint>
            <remarks>
                <p>This value must be an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that serves as a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#use-as-a-naming-system-identifier">naming system identifier</a>.</p>
            </remarks>
        </define-flag>
        <remarks>
            <p>A document identifier provides a <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique" >globally unique</a> identifier with a <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that is used for a group of documents that are to be treated as different versions, representations or digital surrogates of the same document.</p>
            <p>A document identifier provides an additional data point for identifying a document that can be assigned by a publisher or organization for purposes in a wider system, such as a digital object identifier (DOI) or a local content management system identifier.</p>
            <p>Use of a document identifier allows for document creators to associate sets of documents that are related in some way by the same <code>document-id</code>.</p>
            <p>An OSCAL document always has an implicit document identifier provided by the document's UUID, defined by the <code>uuid</code> on the top-level object. Having a default UUID-based identifier ensures all documents can be minimally identified when other document identifiers are not provided.</p>
        </remarks>
    </define-field>
</METASCHEMA>



================================================
FILE: src/metaschema/oscal_poam_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/metaschema/1.0 ../../build/metaschema-xslt/support/metaschema/schema/xml/metaschema.xsd">
    <schema-name>OSCAL Plan of Action and Milestones (POA&amp;M) Model</schema-name>
    <schema-version>1.1.3</schema-version>
    <short-name>oscal-poam</short-name>
    <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
    <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
    <remarks>
        <p>The OSCAL Plan of Action and Milestones (POA&amp;M) format is used to describe the information typically provided by an assessor during the preparation for an assessment.</p>
        <p>The root of the OSCAL Plan of Action and Milestones (POA&amp;M) format is <code>plan-action-milestones</code>.
        </p>
    </remarks>
    <!-- IMPORT STATEMENTS -->
    <import href="oscal_metadata_metaschema.xml"/>
    <import href="oscal_implementation-common_metaschema.xml"/>
    <import href="oscal_assessment-common_metaschema.xml"/>
    <!-- TOP LEVEL ASSEMBLY -->
    <define-assembly name="plan-of-action-and-milestones">
        <formal-name>Plan of Action and Milestones (POA&amp;M)</formal-name>
        <description>A plan of action and milestones which identifies initial and residual risks, deviations, and disposition, such as those required by FedRAMP.</description>
        <root-name>plan-of-action-and-milestones</root-name>
        <define-flag name="uuid" required="yes" as-type="uuid">
            <formal-name>POA&amp;M Universally Unique Identifier</formal-name>
             <!-- Identifier Declaration -->
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#instance">instance</a>scope that can be used to reference this POA&amp;M instance in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#poam-identifiers">this OSCAL instance</a>. This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
        </define-flag>
        <model>
            <assembly ref="metadata" min-occurs="1" max-occurs="1"/>
            <!-- QUESTION: should this be a choice with system-id? -->
            <assembly ref="import-ssp" min-occurs="0" max-occurs="1">
                <remarks>
                    <p>Used by the POA&amp;M to import information about the system.</p>
                </remarks>
            </assembly>
            <field ref="system-id" min-occurs="0" max-occurs="1"/>
            <assembly ref="local-definitions" min-occurs="0" max-occurs="1"/>
            <!-- CHANGE: move "observation" from poam-item -->
            <assembly ref="observation" min-occurs="0" max-occurs="unbounded">
                <group-as name="observations" in-json="ARRAY"/>
            </assembly>
            <!-- CHANGE: move "risk" from poam-item -->
            <assembly ref="risk" min-occurs="0" max-occurs="unbounded">
                <group-as name="risks" in-json="ARRAY"/>
            </assembly>
            <assembly ref="finding" min-occurs="0" max-occurs="unbounded">
                <group-as name="findings" in-json="ARRAY"/>
            </assembly>
            <assembly ref="poam-item" min-occurs="1" max-occurs="unbounded">
                <!-- CHANGED: removed the top-level "poam-items" -->
                <!-- CHANGED: "poam-item-group" to "poam-items" -->
                <group-as name="poam-items" in-json="ARRAY"/>
            </assembly>
            <assembly ref="back-matter" min-occurs="0" max-occurs="1"/>
        </model>
        <remarks>
            <p>Either an OSCAL-based SSP must be imported, or a unique system-id must be specified. Both may be present.</p>
        </remarks>
    </define-assembly>
    <define-assembly name="local-definitions">
        <formal-name>Local Definitions</formal-name>
        <description>Allows components, and inventory-items to be defined within the POA&amp;M for circumstances where no OSCAL-based SSP exists, or is not delivered with the POA&amp;M.</description>
        <model>
            <assembly ref="system-component" min-occurs="0" max-occurs="unbounded">
                <use-name>component</use-name>
                <group-as name="components" in-json="ARRAY"/>
                <remarks>
                    <p>Used to add any components, not defined via the System Security Plan (AR-&gt;AP-&gt;SSP)</p>
                </remarks>
            </assembly>
            <assembly ref="inventory-item" min-occurs="0" max-occurs="unbounded">
                <group-as name="inventory-items" in-json="ARRAY"/>
                <remarks>
                    <p>Used to add any inventory-items, not defined via the System Security Plan (AR-&gt;AP-&gt;SSP)</p>
                </remarks>
            </assembly>
            <!-- CHANGED: added to specify components and assessment-platforms from the assessment -->
            <assembly ref="assessment-assets" min-occurs="0" max-occurs="1">
                <remarks>
                    <p>Specifies components or assessment-platforms used in the assessment.</p>
                </remarks>
            </assembly>            
            <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
        </model>
        <constraint>
            <is-unique id="unique-poam-local-definitions-component" target="component">
                <key-field target="@uuid"/>
                <remarks>
                    <p>Since multiple <code>component</code> entries can be provided, each component must have a unique <code>uuid</code>.</p>
                </remarks>
            </is-unique>
        </constraint>
    </define-assembly>

    <define-assembly name="poam-item">
        <formal-name>POA&amp;M Item</formal-name>
        <description>Describes an individual POA&amp;M item.</description>
        <define-flag name="uuid" as-type="uuid">
            <formal-name>POA&amp;M Item Universally Unique Identifier</formal-name>
            <!-- Identifier Declaration -->
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#instance">instance</a> scope that can be used to reference this POA&amp;M item entry in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#poam-identifiers">this OSCAL instance</a>. This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
        </define-flag>
        <model>
            <define-field name="title" min-occurs="1" max-occurs="1" as-type="markup-line">
                <formal-name>POA&amp;M Item Title</formal-name>
                <description>The title or name for this POA&amp;M item .</description>
            </define-field>
            <!-- CHANGE: Added WITH_WRAPPER to description-->
            <define-field name="description" min-occurs="1" max-occurs="1" in-xml="WITH_WRAPPER" as-type="markup-multiline">
                <formal-name>POA&amp;M Item Description</formal-name>
                <description>A human-readable description of POA&amp;M item.</description>
            </define-field>
            <assembly ref="property" max-occurs="unbounded">
                <group-as name="props" in-json="ARRAY"/>
            </assembly>
            <assembly ref="link" max-occurs="unbounded">
                <group-as name="links" in-json="ARRAY"/>
            </assembly>
            <define-assembly name="origin" max-occurs="unbounded">
                <formal-name>Origin</formal-name>
                <description>Identifies the source of the finding, such as a tool or person.</description>
                <group-as name="origins" in-json="ARRAY"/>
                <model>
                    <assembly ref="origin-actor" min-occurs="1" max-occurs="unbounded">
                        <use-name>actor</use-name>
                        <group-as name="actors" in-json="ARRAY"/>
                    </assembly>
                </model>
                <remarks>
                    <p>Used to identify the individual and/or tool generated this poam-item.</p>
                </remarks>
            </define-assembly>

            <define-assembly name="related-finding" min-occurs="0" max-occurs="unbounded">
                <formal-name>Related Finding</formal-name>
                <description>Relates the poam-item to referenced finding(s).</description>
                <group-as name="related-findings" in-json="ARRAY"/>
                <define-flag name="finding-uuid" as-type="uuid" required="yes">
                    <formal-name>Finding Universally Unique Identifier Reference</formal-name>
                    <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a finding defined in the list of findings.</description>
                </define-flag>
            </define-assembly>

            <!-- TODO: add link; check in the other assessment models -->
            <!-- CHANGED: removed "collected" and "expires" (moved to observation) by brianrufgsa -->
            <!-- CHANGED: removed "objective-status" per brianrufgsa -->
            <!-- CHANGED: (per Brian) removed "implementation-statement-uuid" since this is in the SAR -->
            <!-- CHANGED: replaced embedded observation with references -->
            <define-assembly name="related-observation" max-occurs="unbounded">
                <formal-name>Related Observation</formal-name>
                <description>Relates the poam-item to a set of referenced observations that were used to determine the finding.</description>
                <group-as name="related-observations" in-json="ARRAY"/>
                <define-flag name="observation-uuid" as-type="uuid" required="yes">
                    <formal-name>Observation Universally Unique Identifier Reference</formal-name>
                    <!-- Identifier Reference -->
                    <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to an observation defined in the list of observations.</description>
                </define-flag>
            </define-assembly>

            <!-- CHANGED: replaced "risk" with new "assciated-risk" -->
            <define-assembly name="associated-risk" max-occurs="unbounded">
                <formal-name>Associated Risk</formal-name>
                <description>Relates the finding to a set of referenced risks that were used to determine the finding.</description>
                <group-as name="related-risks" in-json="ARRAY"/>
                <define-flag name="risk-uuid" as-type="uuid" required="yes">
                    <formal-name>Risk Universally Unique Identifier Reference</formal-name>
                    <!-- Identifier Reference -->
                    <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a risk defined in the list of risks.</description>
                </define-flag>
            </define-assembly>
            <field ref="remarks" in-xml="WITH_WRAPPER" min-occurs="0" max-occurs="1"/>
        </model>
        <constraint>
            <expect level="WARNING" target="." test="@uuid">
                <message>It is a best practice to provide a UUID.</message>
            </expect>
        </constraint>
    </define-assembly>
</METASCHEMA>



================================================
FILE: src/metaschema/oscal_profile_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!DOCTYPE METASCHEMA [
   <!ENTITY allowed-values-control-group-property-name SYSTEM "./shared-constraints/allowed-values-control-group-property-name.ent">
]>
<?xml-stylesheet type="text/css" href="metaschema-author.css"?>
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0">
      <schema-name>OSCAL Profile Model</schema-name>
      <schema-version>1.1.3</schema-version>
      <short-name>oscal-profile</short-name>
      <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
      <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
      <remarks>
            <p>In OSCAL a profile represents a set of selected <a
                        href="https://pages.nist.gov/OSCAL/concepts/terminology/#control"
                        >controls</a> from one or more control catalogs. Such a set of controls can
                  be referenced by an OSCAL <a
                        href="https://pages.nist.gov/OSCAL/concepts/layer/implementation/ssp/"
                        >system security plan</a> (SSP) to establish a control <a
                        href="https://pages.nist.gov/OSCAL/concepts/terminology/#baseline"
                        >baseline</a>. This effective set of controls is produced from an OSCAL
                  profile using a deterministic, predictable process called <a
                        href="https://pages.nist.gov/OSCAL/concepts/processing/profile-resolution/"
                        >profile resolution</a>.</p>
            <p>A profile references one or more OSCAL catalogs or profiles to import controls for control selection and tailoring. A profile can also describe how a resulting catalog is structured. When the profile is resolved, these selections and modifications are processed to produce a resulting OSCAL catalog.</p>
            <p>OSCAL profiles have uses beyond establishing control baselines, such as documentation
                  generation or as reference tables for validations.</p>
      </remarks>

      <import href="oscal_metadata_metaschema.xml"/>
      <import href="oscal_control-common_metaschema.xml"/>

      <define-assembly name="profile">
            <formal-name>Profile</formal-name>
            <description>Each OSCAL profile is defined by a <code>profile</code>
                  element.</description>
            <root-name>profile</root-name>
            <define-flag name="uuid" as-type="uuid" required="yes">
                  <formal-name>Profile Universally Unique Identifier</formal-name>
                  <!-- Identifier Declaration -->
                  <description>Provides a globally unique means to identify a given profile instance.</description>
                  <prop name="value-type" value="identifier"/>
                  <prop name="identifier-type" value="machine-oriented"/>
                  <prop name="identifier-uniqueness" value="global"/>
                  <prop name="identifier-scope" value="cross-instance"/>
                  <prop name="identifier-persistence" value="change-on-write"/>
            </define-flag>
            <model>
                  <assembly ref="metadata" min-occurs="1"/>
                  <assembly ref="import" min-occurs="1" max-occurs="unbounded">
                        <group-as name="imports" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="merge"/>
                  <assembly ref="modify"/>
                  <assembly ref="back-matter"/>
            </model>
            <remarks>
                  <p>An OSCAL document that describes a tailoring of controls from one or more catalogs, with possible modification of multiple controls. It provides mechanisms by which controls may be selected (<code>import</code>), merged or (re)structured (<code>merge</code>), and amended (<code>modify</code>). OSCAL profiles may select subsets of controls, set parameter values for them in application, and even adjust the representation of controls as given in and by a catalog. They may also serve as sources for further modification in and by other profiles, that import them.</p>
            </remarks>
      </define-assembly>
      <define-assembly name="import">
            <formal-name>Import Resource</formal-name>
            <description>Designates a referenced source catalog or profile that provides a source of control information for use in creating a new overlay or baseline.</description>
            <define-flag name="href" as-type="uri-reference" required="yes">
                  <formal-name>Catalog or Profile Reference</formal-name>
                  <description>A resolvable URL reference to the base catalog or profile that this profile is tailoring.</description>
                  <remarks>
                        <p>This value may be one of:</p>
                        <ol>
                              <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
                              <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
                              <li>a bare URI fragment (i.e., `#uuid`) pointing to a <code>back-matter</code> resource in this or an imported document (see <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking to another OSCAL object</a>).</li>
                        </ol>
                  </remarks>
            </define-flag>
            <model>
                  <choice>
                        <assembly ref="include-all" min-occurs="1">
                              <remarks>
                                    <p>Identifies that all controls are to be included from the imported catalog or profile.</p>
                              </remarks>
                        </assembly>
                        <assembly ref="select-control-by-id" min-occurs="1" max-occurs="unbounded">
                              <use-name>include-controls</use-name>
                              <group-as name="include-controls" in-json="ARRAY"/>
                              <remarks>
                                    <p>If <code>with-child-controls</code> is <q>yes</q> on the call to a control, any controls appearing within it (child controls) will be selected, with no additional <code>call</code> directives required. This flag provides a way to include controls with all their dependent controls (enhancements) without having to call them individually.</p>
                              </remarks>
                        </assembly>
                  </choice>
                  <assembly ref="select-control-by-id" max-occurs="unbounded">
                        <use-name>exclude-controls</use-name>
                        <group-as name="exclude-controls" in-json="ARRAY"/>
                        <remarks>
                              <p>Identifies which controls to exclude, or eliminate, from the set of included controls by control identifier or match pattern.</p>
                        </remarks>
                  </assembly>
            </model>
            <remarks>
                  <p>The contents of the <code>import</code> element indicate which controls from the source will be included. Controls from the source catalog or profile may be either selected, using the <code>include-all</code> or <code>include-controls</code> directives, or de-selected (using an <code>exclude-controls</code> directive).</p>
            </remarks>
            <example>
                  <import xmlns="http://csrc.nist.gov/ns/oscal/example" href="catalog.xml">
                        <include-all/>
                  </import>
            </example>
      </define-assembly>
      <define-assembly name="merge">
            <formal-name>Merge Controls</formal-name>
            <description>Provides structuring directives that instruct how controls are organized after profile resolution.</description>
            <model>
                  <define-assembly name="combine">
                        <formal-name>Combination Rule</formal-name>
                        <description>A Combine element defines how to resolve duplicate instances of the same control (e.g., controls with the same ID).</description>
                        <define-flag name="method" as-type="string">
                              <formal-name>Combination Method</formal-name>
                              <description>Declare how clashing controls should be
                                    handled.</description>
                              <constraint>
                                    <allowed-values>
                                          <enum value="use-first">Use the first definition - the first control with a given ID is used; subsequent ones are discarded</enum>
                                          <enum value="merge" deprecated="1.0.1"
                                                  >**(<i>deprecated</i>)** **(<i>unspecified</i>)**
                                                Merge - controls with the same ID are
                                                combined</enum>
                                          <enum value="keep">Keep - controls with the same ID are kept, retaining the clash</enum>
                                    </allowed-values>
                              </constraint>
                        </define-flag>
                        <constraint>
                              <expect id="req-merge-combine" target="." test="not(@method='merge')"/>
                        </constraint>
                  </define-assembly>
                  <choice>
                        <define-assembly name="flat" min-occurs="1">
                              <formal-name>Flat Without Grouping</formal-name>
                              <description>Directs that controls appear without any grouping structure.</description>
                        </define-assembly>
                        <define-field name="as-is" as-type="boolean" min-occurs="1">
                              <formal-name>Group As-Is</formal-name>
                              <description>Indicates that the controls selected should retain their original grouping as defined in the import source.</description>
                        </define-field>
                        <define-assembly name="custom" min-occurs="1">
                              <formal-name>Custom Grouping</formal-name>
                              <description>Provides an alternate grouping structure that selected controls will be placed in.</description>
                              <model>
                                    <assembly ref="group" max-occurs="unbounded">
                                          <group-as name="groups" in-json="ARRAY"/>
                                    </assembly>
                                    <assembly ref="insert-controls" max-occurs="unbounded">
                                          <group-as name="insert-controls" in-json="ARRAY"/>
                                    </assembly>
                              </model>
                              <remarks>
                                    <p>The <code>custom</code> element represents a custom arrangement or organization of controls in the resolution of a catalog. This structuring directive gives the profile author the ability to define an entirely different organization of controls as compared to their source catalog(s).</p>
                              </remarks>
                        </define-assembly>
                  </choice>
            </model>
      </define-assembly>
      <define-assembly name="group">
            <formal-name>Control Group</formal-name>
            <description>A group of (selected) controls or of groups of controls.</description>
            <define-flag name="id" as-type="token">
                  <!-- This is an id because the identifier is assigned and managed externally by humans. -->
                  <formal-name>Group Identifier</formal-name>
                  <!-- Identifier Declaration -->
                  <description>Identifies the group.</description>
                  <prop name="value-type" value="identifier"/>
                  <prop name="identifier-type" value="human-oriented"/>
                  <prop name="identifier-uniqueness" value="instance"/>
                  <prop name="identifier-scope" value="cross-instance"/>
                  <prop name="identifier-persistence" value="per-subject"/>
                  <remarks>
                       <p>This optional data element is available to support hyperlinking to formal groups or families as defined in control catalogs, among other operations.</p>
                  </remarks>
            </define-flag>
            <define-flag name="class" as-type="token">
                  <formal-name>Group Class</formal-name>
                  <description>A textual label that provides a sub-type or characterization of the group.</description>
                  <remarks>
                        <p>A <code>class</code> can be used in validation rules to express extra constraints over named items of a specific <code>class</code> value.</p>
                        <p>A <code>class</code> can also be used in an OSCAL profile as a means to target an alteration to control content.</p>
                  </remarks>
            </define-flag>
            <model>
                  <define-field name="title" as-type="markup-line" min-occurs="1">
                        <formal-name>Group Title</formal-name>
                        <description>A name to be given to the group for use in display.</description>
                  </define-field>
                  <assembly ref="parameter" max-occurs="unbounded">
                        <group-as name="params" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="property" max-occurs="unbounded">
                        <group-as name="props" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="link" max-occurs="unbounded">
                        <group-as name="links" in-json="ARRAY"/>
                  </assembly>
                  <assembly ref="part" max-occurs="unbounded">
                        <group-as name="parts" in-json="ARRAY"/>
                  </assembly>
                  <choice>
                        <assembly ref="group" max-occurs="unbounded">
                              <group-as name="groups" in-json="ARRAY"/>
                        </assembly>
                        <assembly ref="insert-controls" max-occurs="unbounded">
                              <group-as name="insert-controls" in-json="ARRAY"/>
                        </assembly>
                  </choice>
            </model>
            <remarks>
                  <p>This construct mirrors the same construct that exists in an OSCAL catalog.</p>
            </remarks>
      </define-assembly>
      <define-assembly name="modify">
            <formal-name>Modify Controls</formal-name>
            <description>Set parameters or amend controls in resolution.</description>
            <model>
                  <define-assembly name="set-parameter" max-occurs="unbounded">
                        <formal-name>Parameter Setting</formal-name>
                        <description>A parameter setting, to be propagated to points of
                              insertion.</description>
                        <group-as name="set-parameters" in-json="ARRAY"/>
                        <define-flag required="yes" name="param-id" as-type="token">
                              <!-- This is an id because the idenfier is assigned and managed by humans. -->
                              <formal-name>Parameter ID</formal-name>
                              <!-- Identifier Declaration -->
                              <description>An identifier for the parameter.</description>
                              <prop name="value-type" value="identifier"/>
                              <prop name="identifier-type" value="human-oriented"/>
                              <prop name="identifier-uniqueness" value="instance"/>
                              <prop name="identifier-scope" value="cross-instance"/>
                              <prop name="identifier-persistence" value="per-subject"/>
                        </define-flag>
                        <define-flag name="class" as-type="token">
                              <formal-name>Parameter Class</formal-name>
                              <description>A textual label that provides a characterization of the parameter.</description>
                              <remarks>
                                    <p>A <code>class</code> can be used in validation rules to express extra constraints over named items of a specific <code>class</code> value.</p>
                              </remarks>
                        </define-flag>
                        <define-flag name="depends-on" as-type="token" deprecated="1.0.1">
                              <formal-name>Depends On</formal-name>
                              <description>**(deprecated)** Another parameter invoking this one. This construct has been deprecated and should not be used.</description>
                        </define-flag>
                        <model>
                              <assembly ref="property" max-occurs="unbounded">
                                    <group-as name="props" in-json="ARRAY"/>
                              </assembly>
                              <assembly ref="link" max-occurs="unbounded">
                                    <group-as name="links" in-json="ARRAY"/>
                              </assembly>
                              <define-field name="label" as-type="markup-line">
                                    <formal-name>Parameter Label</formal-name>
                                    <description>A short, placeholder name for the parameter, which can be used as a substitute for a <code>value</code> if no value is assigned.</description>
                                    <remarks>
                                          <p>The label value should be suitable for inline display in a rendered catalog.</p>
                                    </remarks>
                              </define-field>
                              <define-field name="usage" as-type="markup-multiline" in-xml="WITH_WRAPPER">
                                    <formal-name>Parameter Usage Description</formal-name>
                                    <description>Describes the purpose and use of a
                                          parameter.</description>
                              </define-field>
                              <assembly ref="parameter-constraint" max-occurs="unbounded">
                                    <use-name>constraint</use-name>
                                    <group-as name="constraints" in-json="ARRAY"/>
                              </assembly>
                              <assembly ref="parameter-guideline" max-occurs="unbounded">
                                    <use-name>guideline</use-name>
                                    <group-as name="guidelines" in-json="ARRAY"/>
                              </assembly>
                              <choice>
                                    <field ref="parameter-value" max-occurs="unbounded">
                                          <use-name>value</use-name>
                                          <group-as name="values" in-json="ARRAY"/>
                                          <remarks>
                                                <p>Used to (re)define a parameter value.</p>
                                          </remarks>
                                    </field>
                                    <assembly ref="parameter-selection">
                                          <use-name>select</use-name>
                                    </assembly>
                              </choice>
                        </model>
                  </define-assembly>
                  <define-assembly name="alter" max-occurs="unbounded">
                        <formal-name>Alteration</formal-name>
                        <description>Specifies changes to be made to an included control when a profile is resolved.</description>
                        <group-as name="alters" in-json="ARRAY"/>
                        <flag ref="control-id" required="yes"/>
                        <model>
                              <define-assembly name="remove" max-occurs="unbounded">
                                    <formal-name>Removal</formal-name>
                                    <description>Specifies objects to be removed from a control based on specific aspects of the object that must all match.</description>
                                    <group-as name="removes" in-json="ARRAY"/>
                                    <define-flag name="by-name" as-type="token">
                                          <formal-name>Reference by (assigned) name</formal-name>
                                          <description>Identify items remove by matching their
                                                assigned name.</description>
                                    </define-flag>
                                    <define-flag name="by-class" as-type="token">
                                          <formal-name>Reference by class</formal-name>
                                          <description>Identify items to remove by matching their <code>class</code>.</description>
                                    </define-flag>
                                    <define-flag name="by-id" as-type="token">
                                          <formal-name>Reference by ID</formal-name>
                                          <description>Identify items to remove indicated by their <code>id</code>.</description>
                                    </define-flag>
                                    <define-flag name="by-item-name" as-type="token">
                                          <formal-name>Item Name Reference</formal-name>
                                          <description>Identify items to remove by the name of the
                                                item's information object name, e.g.
                                                  <code>title</code> or
                                                <code>prop</code>.</description>
                                          <constraint>
                                                <allowed-values>
                                                      <enum value="param">A descendant parameter and all of its descendants.</enum>
                                                      <enum value="prop">A descendant property and all of its descendants.</enum>
                                                      <enum value="link">A descendant link and all of its descendants.</enum>
                                                      <enum value="part">A descendant parameter and all of its descendants.</enum>
                                                      <enum value="mapping">A descendant mapping and all of its descendants.</enum>
                                                      <enum value="map">A descendant mapping entry (map) and all of its descendants.</enum>
                                                </allowed-values>
                                          </constraint>
                                    </define-flag>
                                    <define-flag name="by-ns" as-type="token">
                                          <formal-name>Item Namespace Reference</formal-name>
                                          <description>Identify items to remove by the item's <code>ns</code>, which is the namespace associated with a <code>part</code>, or <code>prop</code>.</description>
                                    </define-flag>
                                    <remarks>
                                          <p>Use <code>by-name</code>, <code>by-class</code>, <code>by-id</code> or <code>by-item-name</code> to indicate class tokens or ID reference, or the formal name, of the component to be removed or erased from a control, when a catalog is resolved. The control affected is indicated by the pointer on the removal's parent (containing) <code>alter</code> element.</p>
                                          <p>To change an element, use <code>remove</code> to remove the element, then <code>add</code> to add it back again with changes.</p>
                                    </remarks>
                              </define-assembly>
                              <define-assembly name="add" max-occurs="unbounded">
                                    <formal-name>Addition</formal-name>
                                    <description>Specifies contents to be added into controls, in
                                          resolution.</description>
                                    <group-as name="adds" in-json="ARRAY"/>
                                    <define-flag name="position" as-type="token" default="ending">
                                          <formal-name>Position</formal-name>
                                          <description>Where to add the new content with respect to
                                                the targeted element (beside it or inside
                                                it).</description>
                                          <constraint>
                                                <allowed-values>
                                                      <enum value="before">Preceding the by-id target</enum>
                                                      <enum value="after">Following the by-id target</enum>
                                                      <enum value="starting">Inside the control or by-id target, at the start</enum>
                                                      <enum value="ending">Inside the control or by-id target, at the end</enum>
                                                </allowed-values>
                                          </constraint>
                                    </define-flag>
                                    <define-flag name="by-id" as-type="token">
                                          <formal-name>Reference by ID</formal-name>
                                          <description>Target location of the addition.</description>
                                    </define-flag>
                                    <model>
                                          <define-field name="title" as-type="markup-line">
                                                <formal-name>Title Change</formal-name>
                                                <description>A name given to the control, which may be used by a tool for display and navigation.</description>
                                          </define-field>
                                          <assembly ref="parameter" max-occurs="unbounded">
                                                <group-as name="params" in-json="ARRAY"/>
                                          </assembly>
                                          <assembly ref="property" max-occurs="unbounded">
                                                <group-as name="props" in-json="ARRAY"/>
                                          </assembly>
                                          <assembly ref="link" max-occurs="unbounded">
                                                <group-as name="links" in-json="ARRAY"/>
                                          </assembly>
                                          <assembly ref="part" max-occurs="unbounded">
                                                <group-as name="parts" in-json="ARRAY"/>
                                          </assembly>
                                    </model>
                                    <constraint>
                                          <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
                                                &allowed-values-control-group-property-name;
                                          </allowed-values>
                                    </constraint>
                                    <remarks>
                                          <p>When no <code>by-id</code> is given, the addition is inserted into the control targeted by the alteration at the start or end as indicated by <code>position</code>. Only <code>position</code> values of "starting" or "ending" are permitted when there is no <code>by-id</code>.</p>
                                          <p><code>by-id</code>, when given, should indicate, by its ID, an element inside the control to serve as the anchor point for the addition. In this case, <code>position</code> value may be any of the permitted values.</p>
                                    </remarks>
                              </define-assembly>
                        </model>
                        <remarks>
                              <p>Use <code>@control-id</code> to indicate the scope of alteration.</p>
                              <p>It is an error for two <code>alter</code> elements to apply to the same control. In practice, multiple alterations can be applied (together), but it creates confusion.</p>
                              <p>At present, no provision is made for altering many controls at once (for example, to systematically remove properties or add global properties); extending this element to match multiple control IDs could provide for this.</p>
                        </remarks>
                  </define-assembly>
            </model>
            <constraint>
                  <is-unique id="unique-profile-modify-set-parameter" target="set-parameter">
                        <key-field target="@param-id"/>
                        <remarks>
                              <p>Since multiple <code>set-parameter</code> entries can be provided, each parameter must be set only once.</p>
                        </remarks>
                  </is-unique>
            </constraint>
            
      </define-assembly>
      <define-assembly name="insert-controls">
            <formal-name>Insert Controls</formal-name>
            <description>Specifies which controls to use in the containing context.</description>
            <define-flag as-type="token" name="order">
                  <formal-name>Order</formal-name>
                  <description>A designation of how a selection of controls in a profile is to be ordered.</description>
                  <constraint>
                        <allowed-values>
                              <enum value="keep">Use the order of their appearance, using a depth-first traversal of the source profile's imports.</enum>
                              <enum value="ascending">Sort all selected controls into ascending alphanumeric order by their ID.</enum>
                              <enum value="descending">Sort all selected controls into descending alphanumeric order by their ID.</enum>
                        </allowed-values>
                  </constraint>
            </define-flag>
            <model>
                  <choice>
                        <assembly ref="include-all" min-occurs="1"/>
                        <assembly ref="select-control-by-id" min-occurs="1" max-occurs="unbounded">
                              <use-name>include-controls</use-name>
                              <group-as name="include-controls" in-json="ARRAY"/>
                        </assembly>
                  </choice>
                  <assembly ref="select-control-by-id" max-occurs="unbounded">
                        <use-name>exclude-controls</use-name>
                        <group-as name="exclude-controls" in-json="ARRAY"/>
                        <remarks>
                              <p>Identifies which controls to exclude, or eliminate, from the set of matching includes.</p>
                        </remarks>
                  </assembly>
            </model>
            <remarks>
                  <p>To be schema-valid, this element must contain either (but not both) a single <code>include-all</code> directive, or a sequence of <code>include-controls</code> directives.</p>
                  <p>If this directive is not provided, then no controls are to be inserted; i.e., all controls are included explicitly.</p>
            </remarks>
      </define-assembly>
      <define-assembly name="select-control-by-id" scope="local">
            <formal-name>Select Control</formal-name>
            <description>Select a control or controls from an imported control set.</description>
            <flag ref="with-child-controls"/>
            <model>
                  <field ref="with-id" max-occurs="unbounded">
                        <group-as name="with-ids" in-json="ARRAY"/>
                  </field>
                  <assembly ref="matching" max-occurs="unbounded">
                        <group-as name="matching" in-json="ARRAY"/>
                  </assembly>
            </model>
            <remarks>
                  <p>If <code>with-child-controls</code> is <q>yes</q> on the call to a control, no sibling <code>call</code>elements need to be used to call any controls appearing within it. Since generally, this is how control enhancements are represented (as controls within controls), this provides a way to include controls with all their dependent controls (enhancements) without having to call them individually.</p>
            </remarks>
      </define-assembly>
      <define-flag as-type="token" name="with-child-controls">
            <formal-name>Include Contained Controls with Control</formal-name>
            <description>When a control is included, whether its child (dependent) controls are also included.</description>
            <constraint>
                  <allowed-values>
                        <enum value="yes">Include child controls with an included control.</enum>
                        <enum value="no">When importing a control, only include child controls that are also explicitly called.</enum>
                  </allowed-values>
            </constraint>
      </define-flag>
      <define-flag as-type="string" name="pattern">
            <formal-name>Pattern</formal-name>
            <description>A <a href="https://en.wikipedia.org/wiki/Glob_(programming)">glob expression</a> matching the IDs of one or more controls to be selected.</description>
      </define-flag>
      <define-field name="with-id" as-type="token">
            <formal-name>Match Controls by Identifier</formal-name>
            <description>Selecting a control by its ID given as a literal.</description>
      </define-field>
      <define-assembly name="matching">
            <formal-name>Match Controls by Pattern</formal-name>
            <description>Selecting a set of controls by matching their IDs with a wildcard pattern.</description>
            <flag ref="pattern"/>
      </define-assembly>
</METASCHEMA>



================================================
FILE: src/metaschema/oscal_ssp_metaschema.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<!-- ** NOTES **
- Need to check latest FR SSP template for "Privacy Impact Designation".
  Was it dropped in latest template, or is it missing from schema?
-->
<!-- OSCAL Implementation Layer: System Security Plan (SSP) METASCHEMA -->
<!-- validate with XSD and Schematron (linked) -->
<!DOCTYPE METASCHEMA [
  <!ENTITY allowed-values-responsible-roles-system SYSTEM "./shared-constraints/allowed-values-responsible-roles-system.ent">
  <!ENTITY allowed-values-responsible-roles-operations SYSTEM "./shared-constraints/allowed-values-responsible-roles-operations.ent">
  <!ENTITY allowed-values-responsible-roles-component-production SYSTEM "./shared-constraints/allowed-values-responsible-roles-component-production.ent">
]>
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/metaschema/1.0 ../../build/metaschema-xslt/support/metaschema/schema/xml/metaschema.xsd">
  <schema-name>OSCAL System Security Plan (SSP) Model</schema-name>
  <schema-version>1.1.3</schema-version>
  <short-name>oscal-ssp</short-name>
  <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
  <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
  <remarks>
    <p>The OSCAL Control SSP format can be used to describe the information typically specified in a system security plan, such as those defined in NIST SP 800-18.</p>
    <p>The root of the OSCAL System Security Plan (SSP) format is <code>system-security-plan</code>.</p>
  </remarks>

  <import href="oscal_metadata_metaschema.xml"/>
  <import href="oscal_implementation-common_metaschema.xml"/>

  <!-- ############################################## -->
  <!-- # The SSP Assembly and supporting constructs # -->
  <!-- ############################################## -->
  <define-assembly name="system-security-plan">
    <formal-name>System Security Plan (SSP)</formal-name>
    <description>A system security plan, such as those described in NIST SP 800-18.</description>
    <root-name>system-security-plan</root-name>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>System Security Plan Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this system security plan (SSP) elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>SSP</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance).This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
    </define-flag>
    <model>
      <assembly ref="metadata" min-occurs="1"/>
      <assembly ref="import-profile" min-occurs="1"/>
      <assembly ref="system-characteristics" min-occurs="1"/>
      <assembly ref="system-implementation" min-occurs="1"/>
      <assembly ref="control-implementation" min-occurs="1"/>
      <assembly ref="back-matter"/>
    </model>
    <constraint>
      <index name="by-component-uuid" target="control-implementation/implemented-requirement//by-component|doc(system-implementation/leveraged-authorization/link[@rel='system-security-plan']/@href)/system-security-plan/control-implementation/implemented-requirement//by-component">
        <key-field target="@uuid"/>
      </index>
    </constraint>
  </define-assembly>

  <!-- ######################################################### -->
  <!-- # The Import Profile Assembly and supporting constructs # -->
  <!-- ######################################################### -->
  <define-assembly name="import-profile">
    <formal-name>Import Profile</formal-name>
    <description>Used to import the OSCAL profile representing the system's control baseline.</description>
    <define-flag name="href" as-type="uri-reference" required="yes">
      <formal-name>Profile Reference</formal-name>
      <description>A resolvable URL reference to the profile or catalog to use as the system's control baseline.</description>
      <remarks>
        <p>This value may be one of:</p>
        <ol>
          <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that points to a network resolvable resource,</li>
          <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative reference</a> pointing to a network resolvable resource whose base URI is the URI of the containing document, or</li>
          <li>a bare URI fragment (i.e., `#uuid`) pointing to a <code>back-matter</code> resource in this or an imported document (see <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking to another OSCAL object</a>).</li>
        </ol>
        <p>If the resource is an OSCAL profile, it is expected that a tool will resolve the profile according to the OSCAL <a href="https://pages.nist.gov/OSCAL/concepts/processing/profile-resolution/">profile resolution specification</a> to produce a resolved profile for use when processing the containing system security plan. This allows a system security plan processor to use the baseline as a catalog of controls.</p>
        <p>While it is possible to reference a previously resolved OSCAL profile as a catalog, this practice is discouraged since the unresolved form of the profile communicates more information about selections and changes to the underlying catalog. Furthermore, the underlying catalog can be maintained separately from the profile, which also has maintenance advantages for distinct maintainers, ensuring that the best available information is produced through profile resolution.</p>
      </remarks>
    </define-flag>
    <model>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
  </define-assembly>

  <!-- ################################################################# -->
  <!-- # The System Characteristics Assembly and supporting constructs # -->
  <!-- ################################################################# -->
  <define-assembly name="system-characteristics">
    <formal-name>System Characteristics</formal-name>
    <description>Contains the characteristics of the system, such as its name, purpose, and security impact level.</description>
    <model>
      <field ref="system-id" min-occurs="1" max-occurs="unbounded">
        <group-as name="system-ids" in-json="ARRAY"/>
      </field>
      <define-field name="system-name" as-type="string" min-occurs="1">
        <formal-name>System Name - Full</formal-name>
        <description>The full name of the system.</description>
      </define-field>
      <define-field name="system-name-short" as-type="string">
        <formal-name>System Name - Short</formal-name>
        <description>A short name for the system, such as an acronym, that is suitable for display in a data table or summary list.</description>
        <remarks>
          <p>Since <code>system-name-short</code> is optional, if the <code>system-name-short</code> is not provided, the <code>system-name</code> can be used as a substitute.</p>
        </remarks>
      </define-field>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>System Description</formal-name>
        <description>A summary of the system.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <field ref="date-authorized"/>
      <define-field name="security-sensitivity-level" min-occurs="0">
        <formal-name>Security Sensitivity Level</formal-name>
        <description>The overall information system sensitivity categorization, such as defined by <a href="https://doi.org/10.6028/NIST.FIPS.199">FIPS-199</a>.</description>
        <remarks>
          <p>Often, organizations require the security sensitivity level to correspond with the highest confidentiality, integrity, or availability level identified by <code>security-impact-level</code>.
          </p>
        </remarks>
      </define-field>
      <assembly ref="system-information" min-occurs="1"/>
      <assembly ref="security-impact-level" min-occurs="0"/>
      <assembly ref="status" min-occurs="1"/>
      <assembly ref="authorization-boundary" min-occurs="1"/>
      <assembly ref="network-architecture"/>
      <assembly ref="data-flow"/>
      <assembly ref="responsible-party" max-occurs="unbounded">
        <group-as name="responsible-parties" in-json="ARRAY"/>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
        <enum value="identity-assurance-level">A value of 1, 2, or 3 as defined by <a href="https://doi.org/10.6028/NIST.SP.800-63-3">SP 800-63-3</a>.
        </enum>
        <enum value="authenticator-assurance-level">A value of 1, 2, or 3 as defined by <a href="https://doi.org/10.6028/NIST.SP.800-63-3">SP 800-63-3</a>.
        </enum>
        <enum value="federation-assurance-level">A value of 1, 2, or 3 as defined by <a href="https://doi.org/10.6028/NIST.SP.800-63-3">SP 800-63-3</a>.
        </enum>
      </allowed-values>
      <allowed-values target="prop[@name=('identity-assurance-level','authenticator-assurance-level','federation-assurance-level')]/@value">
        <enum value="1">As defined by <a href="https://doi.org/10.6028/NIST.SP.800-63-3">SP 800-63-3</a>.
        </enum>
        <enum value="2">As defined by <a href="https://doi.org/10.6028/NIST.SP.800-63-3">SP 800-63-3</a>.
        </enum>
        <enum value="3">As defined by <a href="https://doi.org/10.6028/NIST.SP.800-63-3">SP 800-63-3</a>.
        </enum>
      </allowed-values>
      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
        <enum value="cloud-deployment-model">The associated value is one of: public-cloud, private-cloud, community-cloud, government-only-cloud, hybrid-cloud, or other.</enum>
        <enum value="cloud-service-model">The associated value is one of: saas, paas, iaas, or other.</enum>
      </allowed-values>
      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='cloud-deployment-model']/@value">
        <enum value="public-cloud">The public cloud deployment model as defined by <a href="https://doi.org/10.6028/NIST.SP.800-145">The NIST Definition of Cloud Computing</a>.
        </enum>
        <enum value="private-cloud">The private cloud deployment model as defined by <a href="https://doi.org/10.6028/NIST.SP.800-145">The NIST Definition of Cloud Computing</a>.
        </enum>
        <enum value="community-cloud">The community cloud deployment model as defined by <a href="https://doi.org/10.6028/NIST.SP.800-145">The NIST Definition of Cloud Computing</a>.
        </enum>
        <enum value="hybrid-cloud">The hybrid cloud deployment model as defined by <a href="https://doi.org/10.6028/NIST.SP.800-145">The NIST Definition of Cloud Computing</a>.
        </enum>
        <!-- TODO: consider generalizing this in a way that applies to other usage contexts. -->
        <enum value="government-only-cloud">A specific type of community-cloud for use only by government services.</enum>
        <enum value="other">Any other type of cloud deployment model that is exclusive to the other choices.</enum>
        <remarks>
          <p>The hybrid cloud deployment model, as defined by <a href="https://doi.org/10.6028/NIST.SP.800-145">The NIST Definition of Cloud Computing</a>, can be supported by selecting two or more of the existing deployment models.</p>
        </remarks>
      </allowed-values>
      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='cloud-service-model']/@value">
        <enum value="saas">Software as a service (SaaS) cloud service model as defined by <a href="https://doi.org/10.6028/NIST.SP.800-145">The NIST Definition of Cloud Computing</a>.
        </enum>
        <enum value="paas">Platform as a service (PaaS) cloud service model as defined by <a href="https://doi.org/10.6028/NIST.SP.800-145">The NIST Definition of Cloud Computing</a>.
        </enum>
        <enum value="iaas">Infrastructure as a service (IaaS) cloud service model as defined by <a href="https://doi.org/10.6028/NIST.SP.800-145">The NIST Definition of Cloud Computing</a>.
        </enum>
        <enum value="other">Any other type of cloud service model that is exclusive to the other choices.</enum>
      </allowed-values>
      <is-unique id="unique-ssp-system-characteristics-responsible-party" target="responsible-party">
        <key-field target="@role-id"/>
        <remarks>
          <p>Since <code>responsible-party</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
      <allowed-values target="responsible-party/@role-id" allow-other="yes">
            &allowed-values-responsible-roles-system;
      </allowed-values>
    </constraint>
  </define-assembly>
  <define-assembly name="system-information">
    <formal-name>System Information</formal-name>
    <description>Contains details about all information types that are stored, processed, or transmitted by the system, such as privacy information, and those defined in <a href="https://doi.org/10.6028/NIST.SP.800-60v2r1">NIST SP 800-60</a>.</description>
    <model>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <define-assembly name="information-type" min-occurs="1" max-occurs="unbounded">
        <formal-name>Information Type</formal-name>
        <description>Contains details about one information type that is stored, processed, or transmitted by the system, such as privacy information, and those defined in <a href="https://doi.org/10.6028/NIST.SP.800-60v2r1">NIST SP 800-60</a>.</description>
        <group-as name="information-types" in-json="ARRAY"/>
        <define-flag name="uuid" as-type="uuid">
          <formal-name>Information Type Universally Unique Identifier</formal-name>
          <!-- Identifier Declaration -->
          <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this information type elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>information type</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
        </define-flag>
        <model>
          <define-field name="title" as-type="markup-line" min-occurs="1">
            <formal-name>title field</formal-name>
            <description>A human readable name for the information type. This title should be meaningful within the context of the system.</description>
          </define-field>
          <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
            <formal-name>Information Type Description</formal-name>
            <description>A summary of how this information type is used within the system.</description>
          </define-field>
          <define-assembly name="categorization" max-occurs="unbounded">
            <!-- CHANGED: replaced the information-type-id structure with the current structure -->
            <formal-name>Information Type Categorization</formal-name>
            <description>A set of information type identifiers qualified by the given identification <code>system</code> used, such as NIST SP 800-60.</description>
            <group-as name="categorizations" in-json="ARRAY"/>
            <define-flag name="system" as-type="uri" required="yes">
              <formal-name>Information Type Identification System</formal-name>
              <description>Specifies the information type identification system used.</description>
              <constraint>
                <allowed-values allow-other="yes">
                  <enum value="http://doi.org/10.6028/NIST.SP.800-60v2r1">Based on the section identifiers in NIST <a href="https://doi.org/10.6028/NIST.SP.800-60v2r1">Special Publication 800-60 Volume II Revision 1</a>.</enum>
                </allowed-values>
              </constraint>
              <remarks>
                <p>This value must be an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a> that serves as a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#use-as-a-naming-system-identifier">naming system identifier</a>.</p>
              </remarks>
            </define-flag>
            <model>
              <define-field name="information-type-id" as-type="string" max-occurs="unbounded">
                <!-- This is an id because the idenfier is assigned and managed externally by humans. -->
                <formal-name>Information Type Systematized Identifier</formal-name>
                <!-- Identifier Declaration -->
                <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#human-oriented">human-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier qualified by the given identification <code>system</code> used, such as NIST SP 800-60.  This identifier has <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope and can be used to reference this system elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. This id should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
                <json-value-key>id</json-value-key>
                <group-as name="information-type-ids" in-json="ARRAY"/>
              </define-field>
            </model>
          </define-assembly>
          <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
          </assembly>
          <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
          </assembly>
          <assembly ref="impact">
            <formal-name>Confidentiality Impact Level</formal-name>
            <description>The expected level of impact resulting from the unauthorized disclosure of the described information.</description>
            <use-name>confidentiality-impact</use-name>
          </assembly>
          <assembly ref="impact">
            <formal-name>Integrity Impact Level</formal-name>
            <description>The expected level of impact resulting from the unauthorized modification of the described information.</description>
            <use-name>integrity-impact</use-name>
          </assembly>
          <assembly ref="impact">
            <formal-name>Availability Impact Level</formal-name>
            <description>The expected level of impact resulting from the disruption of access to or use of the described information or the information system.</description>
            <use-name>availability-impact</use-name>
          </assembly>
        </model>
        <constraint>
          <expect level="WARNING" target="." test="@uuid">
            <message>It is a best practice to provide a UUID.</message>
          </expect>
        </constraint>
      </define-assembly>
    </model>
    <constraint>
      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
        <enum value="privacy-designation">Is this a privacy sensitive system? yes or no</enum>
      </allowed-values>
      <allowed-values target="prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='privacy-designation']/@value">
        <enum value="yes">The system is privacy sensitive.</enum>
        <enum value="no">The system is not privacy sensitive.</enum>
      </allowed-values>
      <allowed-values target="link/@rel" allow-other="yes">
        <enum value="privacy-impact-assessment">A link to the privacy impact assessment.</enum>
      </allowed-values>
      <matches target="link[@rel='privacy-impact-assessment']/@href[starts-with(.,'#')]" datatype="uri-reference"/>
      <index-has-key name="index-back-matter-resource" target="link[@rel='privacy-impact-assessment' and starts-with(@href,'#')]">
        <key-field target="@href" pattern="#(.*)"/>
      </index-has-key>
      <!-- 
        TODO: Per discussion in usnisgov/OSCAL#1331 review on 29 July 2022,
        add the path target to security-sensitivity-level as well.
      -->
      <matches target="link[@rel='privacy-impact-assessment']/@href[not(starts-with(.,'#'))]" datatype="uri"/>
      <allowed-values target="information-type/(confidentiality-impact|integrity-impact|availability-impact)/(base|selected)" allow-other="yes">
        <enum value="fips-199-low">A 'low' sensitivity level as defined in <a href="https://doi.org/10.6028/NIST.FIPS.199">FIPS-199</a>.
        </enum>
        <enum value="fips-199-moderate">A 'moderate' sensitivity level as defined in <a href="https://doi.org/10.6028/NIST.FIPS.199">FIPS-199</a>.
        </enum>
        <enum value="fips-199-high">A 'high' sensitivity level as defined in <a href="https://doi.org/10.6028/NIST.FIPS.199">FIPS-199</a>.
        </enum>
        <remarks>
          <p>FIPS-199 taxonomy is provided here as a starting point. We will provide other taxonomies based on community requests.</p>
        </remarks>
      </allowed-values>
    </constraint>
  </define-assembly>
  <define-assembly name="impact">
    <formal-name>Impact Level</formal-name>
    <description>The expected level of impact resulting from the described information.</description>
    <model>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <field ref="base" min-occurs="1"/>
      <field ref="selected"/>
      <field ref="adjustment-justification" in-xml="WITH_WRAPPER"/>
    </model>
  </define-assembly>
  <define-field name="base" as-type="string" scope="local">
    <formal-name>Base Level (Confidentiality, Integrity, or Availability)</formal-name>
    <description>The prescribed base (Confidentiality, Integrity, or Availability) security impact level.</description>
  </define-field>
  <define-field name="selected" as-type="string" scope="local">
    <formal-name>Selected Level (Confidentiality, Integrity, or Availability)</formal-name>
    <description>The selected (Confidentiality, Integrity, or Availability) security impact level.</description>
  </define-field>
  <define-field name="adjustment-justification" as-type="markup-multiline" scope="local">
    <formal-name>Adjustment Justification</formal-name>
    <description>If the selected security level is different from the base security level, this contains the justification for the change.</description>
  </define-field>
  <define-assembly name="security-impact-level">
    <formal-name>Security Impact Level</formal-name>
    <description>The overall level of expected impact resulting from unauthorized disclosure, modification, or loss of access to information.</description>
    <model>
      <!-- 
        TODO: Per discussion in usnisgov/OSCAL#1331 review on 29 July 2022,
        add the path target to security-impact-level as well for fips-199-low/mod/high.
      -->
      <define-field name="security-objective-confidentiality" as-type="string" min-occurs="1">
        <formal-name>Security Objective: Confidentiality</formal-name>
        <description>A target-level of confidentiality for the system, based on the sensitivity of information within the system.</description>
      </define-field>
      <define-field name="security-objective-integrity" as-type="string" min-occurs="1">
        <formal-name>Security Objective: Integrity</formal-name>
        <description>A target-level of integrity for the system, based on the sensitivity of information within the system.</description>
      </define-field>
      <define-field name="security-objective-availability" as-type="string" min-occurs="1">
        <formal-name>Security Objective: Availability</formal-name>
        <description>A target-level of availability for the system, based on the sensitivity of information within the system.</description>
      </define-field>
    </model>
  </define-assembly>
  <define-assembly name="status" scope="local">
    <formal-name>Status</formal-name>
    <description>Describes the operational status of the system.</description>
    <define-flag name="state" required="yes" as-type="string">
      <formal-name>State</formal-name>
      <description>The current operating status.</description>
      <constraint>
        <allowed-values>
          <enum value="operational">The system is currently operating in production.</enum>
          <enum value="under-development">The system is being designed, developed, or implemented</enum>
          <enum value="under-major-modification">The system is undergoing a major change, development, or transition.</enum>
          <enum value="disposition">The system is no longer operational.</enum>
          <enum value="other">Some other state.</enum>
        </allowed-values>
      </constraint>
    </define-flag>
    <model>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <remarks>
      <p>If 'other' is selected, a remark must be included to describe the current state.</p>
    </remarks>
  </define-assembly>
  <define-field name="date-authorized" as-type="date" scope="local">
    <formal-name>System Authorization Date</formal-name>
    <description>The date the system received its authorization.</description>
  </define-field>
  <define-assembly name="authorization-boundary">
    <formal-name>Authorization Boundary</formal-name>
    <description>A description of this system's authorization boundary, optionally supplemented by diagrams that illustrate the authorization boundary.</description>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Authorization Boundary Description</formal-name>
        <description>A summary of the system's authorization boundary.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
        <!-- TODO: Model specific link relationships? -->
      </assembly>
      <assembly ref="diagram" max-occurs="unbounded">
        <group-as name="diagrams" in-json="ARRAY"/>
        <remarks>
          <p>A visual depiction of the system's authorization boundary.</p>
        </remarks>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <is-unique id="unique-ssp-authorization-boundary-diagram" target="diagram">
        <key-field target="@uuid"/>
        <remarks>
          <p>A given <code>uuid</code> must be assigned only once to a diagram.</p>
        </remarks>
      </is-unique>
    </constraint>
  </define-assembly>
  <define-assembly name="diagram">
    <formal-name>Diagram</formal-name>
    <description>A graphic that provides a visual representation the system, or some aspect of it.</description>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Diagram ID</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this diagram elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>diagram</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
    </define-flag>
    <model>
      <define-field name="description" as-type="markup-multiline" in-xml="WITH_WRAPPER">
        <formal-name>Diagram Description</formal-name>
        <description>A summary of the diagram.</description>
        <remarks>
          <p>This description is intended to be used as alternate text to support compliance with requirements from <a href="https://www.section508.gov/manage/laws-and-policies">Section 508 of the United States Workforce Rehabilitation Act of 1973</a>.
          </p>
        </remarks>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <define-field name="caption" as-type="markup-line">
        <formal-name>Caption</formal-name>
        <description>A brief caption to annotate the diagram.</description>
      </define-field>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <allowed-values target="link/@rel" allow-other="yes">
        <enum value="diagram">A reference to the diagram image.</enum>
      </allowed-values>
      <matches target="link[@rel='diagram']/@href[starts-with(.,'#')]" datatype="uri-reference"/>
      <index-has-key name="index-back-matter-resource" target="link[@rel='diagram' and starts-with(@href,'#')]">
        <key-field target="@href" pattern="#(.*)"/>
      </index-has-key>
      <matches target="link[@rel='diagram']/@href[not(starts-with(.,'#'))]" datatype="uri"/>
    </constraint>
    <remarks>
      <p>A diagram must include a <code>link</code> with a rel value of "diagram", who's href references a remote URI or an internal reference within this document containing the diagram.</p>
    </remarks>
    <example>
      <remarks>
        <p>The internal reference "#diagram1" points to an attached resource defined in the <code>back-matter</code> as a <code>resource</code>. The <code>media-type</code> indicates that the image is a Portable Network Graphics (PNG) image.</p>
      </remarks>
      <o:diagram xmlns:o="http://csrc.nist.gov/ns/oscal/example" id="boundary-diagram-1">
        <o:description>A boundary diagram.</o:description>
        <o:link rel="diagram" href="#diagram1" media-type="image/png"/>
      </o:diagram>
    </example>
  </define-assembly>
  <define-assembly name="network-architecture">
    <formal-name>Network Architecture</formal-name>
    <description>A description of the system's network architecture, optionally supplemented by diagrams that illustrate the network architecture.</description>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Network Architecture Description</formal-name>
        <description>A summary of the system's network architecture.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
        <!-- TODO: Model specific link relationships? -->
      </assembly>
      <assembly ref="diagram" max-occurs="unbounded">
        <group-as name="diagrams" in-json="ARRAY"/>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <is-unique id="unique-ssp-network-architecture-diagram" target="diagram">
        <key-field target="@uuid"/>
        <remarks>
          <p>A given <code>uuid</code> must be assigned only once to a diagram.</p>
        </remarks>
      </is-unique>
    </constraint>
    
  </define-assembly>
  <define-assembly name="data-flow">
    <formal-name>Data Flow</formal-name>
    <description>A description of the logical flow of information within the system and across its boundaries, optionally supplemented by diagrams that illustrate these flows.</description>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Data Flow Description</formal-name>
        <description>A summary of the system's data flow.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
        <!-- TODO: Model specific link relationships? -->
      </assembly>
      <assembly ref="diagram" max-occurs="unbounded">
        <group-as name="diagrams" in-json="ARRAY"/>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <is-unique id="unique-ssp-data-flow-diagram" target="diagram">
        <key-field target="@uuid"/>
        <remarks>
          <p>A given <code>uuid</code> must be assigned only once to a diagram.</p>
        </remarks>
      </is-unique>
    </constraint>
  </define-assembly>

  <!-- ################################################################ -->
  <!-- # The System Implementation Assembly and supporting constructs # -->
  <!-- ################################################################ -->
  <define-assembly name="system-implementation">
    <formal-name>System Implementation</formal-name>
    <description>Provides information as to how the system is implemented.</description>
    <model>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
        <!-- TODO: Model specific link relationships? -->
      </assembly>
      <define-assembly name="leveraged-authorization" max-occurs="unbounded">
        <formal-name>Leveraged Authorization</formal-name>
        <description>A description of another authorized system from which this system inherits capabilities that satisfy security requirements. Another term for this concept is a <em>common control provider</em>.</description>
        <group-as name="leveraged-authorizations" in-json="ARRAY"/>
        <define-flag name="uuid" as-type="uuid" required="yes">
          <formal-name>Leveraged Authorization Universally Unique Identifier</formal-name>
          <!-- Identifier Declaration -->
          <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope and can be used to reference this leveraged authorization elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>leveraged authorization</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
        </define-flag>
        <model>
          <define-field name="title" as-type="markup-line" min-occurs="1">
            <formal-name>title field</formal-name>
            <description>A human readable name for the leveraged authorization in the context of the system.</description>
          </define-field>
          <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
          </assembly>
          <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
          </assembly>
          <define-field name="party-uuid" as-type="uuid" min-occurs="1">
            <formal-name>party-uuid field</formal-name>
            <!-- Identifier Reference -->
            <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to the  <code>party</code> that manages the leveraged system.</description>
          </define-field>
          <field ref="date-authorized" min-occurs="1"/>
          <field ref="remarks" in-xml="WITH_WRAPPER"/>
        </model>
        <constraint>
          <allowed-values target="link/@rel" allow-other="yes">
            <enum value="system-security-plan">A reference to the system security plan for the leveraged authorization.</enum>
          </allowed-values>
          <matches target="link[@rel='system-security-plan']/@href[starts-with(.,'#')]" datatype="uri-reference"/>
          <index-has-key name="index-back-matter-resource" target="link[@rel='system-security-plan' and starts-with(@href,'#')]">
            <key-field target="@href" pattern="#(.*)"/>
          </index-has-key>
          <matches target="link[@rel='system-security-plan']/@href[not(starts-with(.,'#'))]" datatype="uri"/>
        </constraint>
      </define-assembly>

      <assembly ref="system-user" min-occurs="1" max-occurs="unbounded">
        <use-name>user</use-name>
        <group-as name="users" in-json="ARRAY"/>
      </assembly>
      <assembly ref="system-component" min-occurs="1" max-occurs="unbounded">
        <use-name>component</use-name>
        <group-as name="components" in-json="ARRAY"/>
      </assembly>
      <!--         <assembly ref="capability" max-occurs="unbounded">
            <group-as name="capabilities" in-json="BY_KEY"/>
         </assembly>
         -->
      <assembly ref="inventory-item" min-occurs="0" max-occurs="unbounded">
        <group-as name="inventory-items" in-json="ARRAY"/>
        <remarks>
          <p>A set of <code>inventory-item</code> entries that represent the managed inventory instances of the system.</p>
        </remarks>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <!-- TODO: future: for FedRAMP, have user counts as props: current/internal, current/external, future/internal, future, external -->
      <index name="index-system-implementation-leveraged-authorization-uuid" target="leveraged-authorization">
        <key-field target="@uuid"/>
      </index>
      <index-has-key name="index-system-implementation-leveraged-authorization-uuid" target="component/prop[@name='leveraged-authorization-uuid']">
        <key-field target="@value"/>
      </index-has-key>

      <!-- References to components -->
      <index name="index-system-implementation-component-uuid" target="component">
        <key-field target="@uuid"/>
      </index>
      <index-has-key name="index-system-implementation-component-uuid" target="component/link[@rel='depends-on']">
        <key-field target="@href"/>
      </index-has-key>

      <!-- References to components of @type="validation" -->
      <index name="index-system-implementation-component-uuid-validation" target="component[@type='validation']">
        <key-field target="@uuid"/>
      </index>
      <index-has-key name="index-system-implementation-component-uuid-validation" target="component/link[@rel='validated-by']">
        <key-field target="@href"/>
      </index-has-key>
      <index-has-key name="index-system-implementation-component-uuid-validation" target="component/link[@rel='proof-of-compliance']">
        <key-field target="@href"/>
      </index-has-key>

      <!-- References to components of @type="service" -->
      <index name="index-system-implementation-component-uuid-service" target="component[@type='service']">
        <key-field target="@uuid"/>
      </index>
      <index-has-key name="index-system-implementation-component-uuid-service" target="component/link[@rel='uses-service']">
        <key-field target="@href"/>
      </index-has-key>

      <!-- TODO: check that prop names are defined -->
      <allowed-values target="(component | inventory-item)/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='allows-authenticated-scan']/@value">
        <enum value="yes">The component allows an authenticated scan.</enum>
        <enum value="no">The component does not allow an authenticated scan.</enum>
      </allowed-values>

      <!-- TODO: only allow a single "this-system" component -->

      <is-unique id="unique-ssp-system-implementation-user" target="user">
        <key-field target="@uuid"/>
        <remarks>
          <p>A given <code>uuid</code> must be assigned only once to a user.</p>
        </remarks>
      </is-unique>
    </constraint>
  </define-assembly>

  <define-assembly name="control-implementation" scope="local">
    <formal-name>Control Implementation</formal-name>
    <description>Describes how the system satisfies a set of controls.</description>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Control Implementation Description</formal-name>
        <description>A statement describing important things to know about how this set of control satisfaction documentation is approached.</description>
      </define-field>
      <assembly ref="set-parameter" max-occurs="unbounded">
        <group-as name="set-parameters" in-json="ARRAY"/>
      </assembly>
      <assembly ref="implemented-requirement" min-occurs="1" max-occurs="unbounded">
        <group-as name="implemented-requirements" in-json="ARRAY"/>
      </assembly>
    </model>
    <constraint>
      <is-unique id="unique-ssp-control-implementation-set-parameter" target="set-parameter">
        <key-field target="@param-id"/>
        <remarks>
          <p>Since multiple <code>set-parameter</code> entries can be provided, each parameter must be set only once.</p>
        </remarks>
      </is-unique>
      <index name="by-component-export-provided-uuid" target="implemented-requirement//by-component/export/provided">
        <key-field target="@uuid"/>
      </index>
    </constraint>
    <remarks>
      <p>Use of <code>set-parameter</code> in this context, sets the parameter for all controls referenced by any <code>implemented-requirement</code> contained in this context. Any <code>set-parameter</code> defined in a child context will override this value. If not overridden by a child, this value applies in the child context.</p>
    </remarks>
  </define-assembly>
  <define-assembly name="implemented-requirement" scope="local">
    <formal-name>Control-based Requirement</formal-name>
    <description>Describes how the system satisfies the requirements of an individual control.</description>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Control Requirement Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this control requirement elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>control requirement</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
    </define-flag>
    <flag ref="control-id" required="yes"/>
    <model>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
        <!-- TODO: Model specific link relationships -->
      </assembly>
      <assembly ref="set-parameter" max-occurs="unbounded">
        <group-as name="set-parameters" in-json="ARRAY"/>
      </assembly>
      <assembly ref="responsible-role" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY"/>
      </assembly>
      <assembly ref="statement" max-occurs="unbounded">
        <group-as name="statements" in-json="ARRAY"/>
      </assembly>
      <assembly ref="by-component" min-occurs="0" max-occurs="unbounded">
        <group-as name="by-components" in-json="ARRAY"/>
      </assembly>
      <!-- TODO: Implement parameters -->
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <allowed-values target="(.|statement|.//by-component)/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal')]/@name">
        <enum value="control-origination">Identifies the source of the implemented control.  Any <code>control-origination</code> prop defined in a child context will override the parent value.</enum>
      </allowed-values>
      <allowed-values target="(.|statement|.//by-component)/prop[has-oscal-namespace('http://csrc.nist.gov/ns/oscal') and @name='control-origination']/@value">
        <enum value="organization">The control is implemented by the organization owning the system, but is not specific to the system itself.</enum>
        <enum value="system-specific">The control is implemented specifically to this system.</enum>
        <enum value="customer-configured">The control is provided by the system, but must be configured by the customer.</enum>
        <enum value="customer-provided">The control must be implemented by the customer.</enum>
        <enum value="inherited">This control is inherited from an underlying system.</enum>
      </allowed-values>
      <allowed-values target="responsible-role/@role-id" allow-other="yes">
            &allowed-values-responsible-roles-operations;
      </allowed-values>
      <index-has-key name="index-metadata-role-id" target="responsible-role|statement/responsible-role|.//by-component//responsible-role">
        <key-field target="@role-id"/>
      </index-has-key>
      <index-has-key name="index-metadata-party-uuid" target="responsible-role|statement/responsible-role|.//by-component//responsible-role">
        <key-field target="party-uuid"/>
      </index-has-key>
      <has-cardinality target=".//by-component" min-occurs="1">
        <remarks>
          <p>Since all implementation statements are defined at the by-component level (e.g., type=this-system), there must be at least one by-component.</p>
        </remarks>
      </has-cardinality>
      <is-unique id="unique-ssp-implemented-requirement-set-parameter" target="set-parameter">
        <key-field target="@param-id"/>
        <remarks>
          <p>Since multiple <code>set-parameter</code> entries can be provided, each parameter must be set only once.</p>
        </remarks>
      </is-unique>
      <is-unique id="unique-ssp-implemented-requirement-responsible-role" target="responsible-role">
        <key-field target="@role-id"/>
        <remarks>
          <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
      <is-unique id="unique-ssp-implemented-requirement-statement" target="statement">
        <key-field target="@statement-id"/>
        <remarks>
          <p>Since <code>statement</code> entries can be referenced using the statement's statement-id, each statement must be referenced only once.</p>
        </remarks>
      </is-unique>
      <is-unique id="unique-ssp-implemented-requirement-by-component" target="by-component">
        <key-field target="@component-uuid"/>
        <remarks>
          <p>Since <code>by-component</code> can reference <code>component</code> entries using the component's uuid, each component must be referenced only once. This ensures that all implementation statements are contained in the same <code>by-component</code> entry.</p>
        </remarks>
      </is-unique>
    </constraint>
    <remarks>
      <p>Use of <code>set-parameter</code> in this context, sets the parameter for the referenced control. Any <code>set-parameter</code> defined in a child context will override this value. If not overridden by a child, this value applies in the child context.</p>
    </remarks>
  </define-assembly>
  <define-assembly name="statement" scope="local">
    <formal-name>Specific Control Statement</formal-name>
    <description>Identifies which statements within a control are addressed.</description>
    <flag ref="statement-id" required="yes">
      <remarks>
        <p>A reference to the specific implemented statement associated with a control.</p>
      </remarks>
    </flag>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Control Statement Reference Universally Unique Identifier</formal-name>
      <!-- Identifier Reference -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this control statement elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The <em>UUID</em> of the <code>control statement</code> in the source OSCAL instance is sufficient to reference the data item locally or globally (e.g., in an imported OSCAL instance).</description>
    </define-flag>
    <model>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <assembly ref="responsible-role" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY"/>
      </assembly>
      <assembly ref="by-component" max-occurs="unbounded">
        <group-as name="by-components" in-json="ARRAY"/>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <allowed-values target="responsible-role/@role-id" allow-other="yes">
            &allowed-values-responsible-roles-operations;
      </allowed-values>
      <is-unique id="unique-ssp-statement-responsible-role" target="responsible-role">
        <key-field target="@role-id"/>
        <remarks>
          <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
      <is-unique id="unique-ssp-implemented-requirement-statement-by-component" target="by-component">
        <key-field target="@component-uuid"/>
        <remarks>
          <p>Since <code>by-component</code> can reference <code>component</code> entries using the component's uuid, each component must be referenced only once. This ensures that all implementation statements are contained in the same <code>by-component</code> entry.</p>
        </remarks>
      </is-unique>
      
    </constraint>
  </define-assembly>
  <define-assembly name="by-component">
    <!-- QUESTION: Should set-parameter be moved here to allow component-specific parameter settings? or "this-system" for the whole system? -->
    <formal-name>Component Control Implementation</formal-name>
    <description>Defines how the referenced component implements a set of controls.</description>
    <define-flag required="yes" name="component-uuid" as-type="uuid">
      <formal-name>Component Universally Unique Identifier Reference</formal-name>
      <!-- Identifier Reference -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to the <code>component</code> that is implemeting a given control.</description>
    </define-flag>
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>By-Component Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this by-component entry elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>by-component</code> entry can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
    </define-flag>
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
        <formal-name>Control Implementation Description</formal-name>
        <description>An implementation statement that describes how a control or a control statement is implemented within the referenced system component.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY"/>
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY"/>
      </assembly>
      <assembly ref="set-parameter" max-occurs="unbounded">
        <group-as name="set-parameters" in-json="ARRAY"/>
      </assembly>
      <assembly ref="implementation-status">
        <remarks>
          <p>The <code>implementation-status</code> is used to qualify the <code>status</code> value to indicate the degree to which the control is implemented.</p>
        </remarks>
      </assembly>
      <define-assembly name="export" max-occurs="1">
        <formal-name>Export</formal-name>
        <description>Identifies content intended for external consumption, such as with leveraged organizations.</description>
        <model>
          <define-field name="description" as-type="markup-multiline" in-xml="WITH_WRAPPER">
            <formal-name>Control Implementation Export Description</formal-name>
            <description>An implementation statement that describes the aspects of the control or control statement implementation that can be available to another system leveraging this system.</description>
          </define-field>
          <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
          </assembly>
          <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
            <!-- TODO: Model specific link relationships -->
          </assembly>
          <define-assembly name="provided" max-occurs="unbounded">
            <formal-name>Provided Control Implementation</formal-name>
            <description>Describes a capability which may be inherited by a leveraging system.</description>
            <!-- CHANGED: "provided-group" to "provided" -->
            <group-as name="provided" in-json="ARRAY"/>
            <define-flag name="uuid" as-type="uuid" required="yes">
              <formal-name>Provided Universally Unique Identifier</formal-name>
              <!-- Identifier Declaration -->
              <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this provided entry elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>provided</code> entry can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <model>
              <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
                <formal-name>Provided Control Implementation Description</formal-name>
                <description>An implementation statement that describes the aspects of the control or control statement implementation that can be provided to another system leveraging this system.</description>
              </define-field>
              <assembly ref="property" max-occurs="unbounded">
                <group-as name="props" in-json="ARRAY"/>
              </assembly>
              <assembly ref="link" max-occurs="unbounded">
                <group-as name="links" in-json="ARRAY"/>
                <!-- TODO: Model specific link relationships -->
              </assembly>
              <assembly ref="responsible-role" min-occurs="0" max-occurs="unbounded">
                <group-as name="responsible-roles" in-json="ARRAY"/>
              </assembly>
              <field ref="remarks" in-xml="WITH_WRAPPER"/>
            </model>
            <constraint>
              <is-unique id="unique-provided-responsible-role" target="responsible-role">
                <key-field target="@role-id"/>
                <remarks>
                  <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
                </remarks>
              </is-unique>
            </constraint>
          </define-assembly>
          <define-assembly name="responsibility" max-occurs="unbounded">
            <formal-name>Control Implementation Responsibility</formal-name>
            <description>Describes a control implementation responsibility imposed on a leveraging system.</description>
            <group-as name="responsibilities" in-json="ARRAY"/>
            <define-flag name="uuid" as-type="uuid" required="yes">
              <formal-name>Responsibility Universally Unique Identifier</formal-name>
              <!-- Identifier Declaration -->
              <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this responsibility elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>responsibility</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
            </define-flag>
            <flag ref="provided-uuid" required="no" />
            <model>
              <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
                <formal-name>Control Implementation Responsibility Description</formal-name>
                <description>An implementation statement that describes the aspects of the control or control statement implementation that a leveraging system must implement to satisfy the control provided by a leveraged system.</description>
              </define-field>
              <assembly ref="property" max-occurs="unbounded">
                <group-as name="props" in-json="ARRAY"/>
              </assembly>
              <assembly ref="link" max-occurs="unbounded">
                <group-as name="links" in-json="ARRAY"/>
                <!-- TODO: Model specific link relationships -->
              </assembly>
              <assembly ref="responsible-role" min-occurs="0" max-occurs="unbounded">
                <group-as name="responsible-roles" in-json="ARRAY"/>
                <remarks>
                  <p>A role defined at the by-component level takes precedence over the same role defined on the parent implemented-requirement or on the referenced component. </p>
                </remarks>
              </assembly>
              <field ref="remarks" in-xml="WITH_WRAPPER"/>
            </model>
            <constraint>
              <is-unique id="unique-responsibility-responsible-role" target="responsible-role">
                <key-field target="@role-id"/>
                <remarks>
                  <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
                </remarks>
              </is-unique>
            </constraint>
          </define-assembly>
          <field ref="remarks" in-xml="WITH_WRAPPER"/>
        </model>
        <constraint>
          <has-cardinality target="provided|responsibility" min-occurs="1"/>
          <index-has-key name="by-component-export-provided-uuid" target="responsibility">
            <key-field target="@provided-uuid"/>
          </index-has-key>
        </constraint>
      </define-assembly>
      <define-assembly name="inherited" max-occurs="unbounded">
        <formal-name>Inherited Control Implementation</formal-name>
        <description>Describes a control implementation inherited by a leveraging system.</description>
        <!-- CHANGED: "inherited-group" to "inherited" -->
        <group-as name="inherited" in-json="ARRAY"/>
        <define-flag name="uuid" as-type="uuid" required="yes">
          <formal-name>Inherited Universally Unique Identifier</formal-name>
          <!-- Identifier Declaration -->
          <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this inherited entry elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>inherited control implementation</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
        </define-flag>
        <flag ref="provided-uuid" required="no" />
        <model>
          <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
            <formal-name>Inherited Control Implementation Description</formal-name>
            <description>An implementation statement that describes the aspects of a control or control statement implementation that a leveraging system is inheriting from a leveraged system.</description>
          </define-field>
          <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
          </assembly>
          <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
            <!-- TODO: Model specific link relationships -->
          </assembly>
          <assembly ref="responsible-role" min-occurs="0" max-occurs="unbounded">
            <group-as name="responsible-roles" in-json="ARRAY"/>
          </assembly>
        </model>
        <constraint>
          <is-unique id="unique-inherited-responsible-role" target="responsible-role">
            <key-field target="@role-id"/>
            <remarks>
              <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
            </remarks>
          </is-unique>
        </constraint>
      </define-assembly>
      <define-assembly name="satisfied" max-occurs="unbounded">
        <formal-name>Satisfied Control Implementation Responsibility</formal-name>
        <description>Describes how this system satisfies a responsibility imposed by a leveraged system.</description>
        <!-- CHANGED: "satisfied-group" to "satisfied" -->
        <group-as name="satisfied" in-json="ARRAY"/>
        <define-flag name="uuid" as-type="uuid" required="yes">
          <formal-name>Satisfied Universally Unique Identifier</formal-name>
          <!-- Identifier Declaration -->
          <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a> scope that can be used to reference this satisfied control implementation entry elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>control implementation</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
        </define-flag>
        <flag ref="responsibility-uuid" required="no" />
        <model>
          <define-field name="description" as-type="markup-multiline" min-occurs="1" in-xml="WITH_WRAPPER">
            <formal-name>Satisfied Control Implementation Responsibility Description</formal-name>
            <description>An implementation statement that describes the aspects of a control or control statement implementation that a leveraging system is implementing based on a requirement from a leveraged system.</description>
          </define-field>
          <assembly ref="property" max-occurs="unbounded">
            <group-as name="props" in-json="ARRAY"/>
          </assembly>
          <assembly ref="link" max-occurs="unbounded">
            <group-as name="links" in-json="ARRAY"/>
            <!-- TODO: Model specific link relationships -->
          </assembly>
          <assembly ref="responsible-role" min-occurs="0" max-occurs="unbounded">
            <group-as name="responsible-roles" in-json="ARRAY"/>
          </assembly>
          <field ref="remarks" in-xml="WITH_WRAPPER"/>
        </model>
        <constraint>
          <is-unique id="unique-satisfied-responsible-role" target="responsible-role">
            <key-field target="@role-id"/>
            <remarks>
              <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
            </remarks>
          </is-unique>
        </constraint>
      </define-assembly>
      <assembly ref="responsible-role" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY"/>
      </assembly>
      <!-- CHANGED: removed "set-parameter" -->
      <field ref="remarks" in-xml="WITH_WRAPPER"/>
    </model>
    <constraint>
      <allowed-values target="link/@rel" allow-other="yes">
        <!-- TODO: More work needs to be done around link enforcement constraints and requires Metaschema work on recurse-depth-first() recursive index searching. -->
        <enum value="imported-from">The hyperlink identifies a URI pointing to the <code>component</code> in a <code>component-definition</code> that originally described the <code>component</code> this component was based on.</enum>
      </allowed-values>
      <allowed-values target=".//responsible-role/@role-id" allow-other="yes">
            &allowed-values-responsible-roles-operations;
            &allowed-values-responsible-roles-component-production;
      </allowed-values>
      <is-unique id="unique-ssp-by-component-set-parameter" target="set-parameter">
        <key-field target="@param-id"/>
        <remarks>
          <p>Since multiple <code>set-parameter</code> entries can be provided, each parameter must be set only once.</p>
        </remarks>
      </is-unique>

      <allowed-values target="link/@rel" allow-other="yes">
        <enum value="provided-by">A reference to the UUID of a control or statement <code>by-component</code> object that is used as evidence of implementation.</enum>
      </allowed-values>
      <index-has-key name="by-component-uuid" target="link[@rel='provided-by']">
        <key-field target="@href" pattern="#(.*)" />
      </index-has-key>
    </constraint>
    <remarks>
      <p>Use of <code>set-parameter</code> in this context, sets the parameter for the control referenced in the containing <code>implemented-requirement</code> applied to the referenced component. If the <code>by-component</code> is used as a child of a <code>statement</code>, then the parameter value also applies only in the context of the referenced statement. If the same parameter is also set in the <code>control-implementation</code> or a specific <code>implemented-requirement</code>, then this <code>by-component/set-parameter</code> value will override the other value(s) in the context of the referenced component, control, and statement (if parent).</p>
    </remarks>
  </define-assembly>

  <define-flag name="provided-uuid" as-type="uuid" scope="local">
    <formal-name>Provided UUID</formal-name>
    <!-- Identifier Reference -->
    <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to an inherited control implementation that a leveraging system is inheriting from a leveraged system.</description>
  </define-flag>

  <define-flag name="responsibility-uuid" as-type="uuid" scope="local">
    <formal-name>Responsibility UUID</formal-name>
    <!-- Identifier Reference -->
    <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">machine-oriented</a> identifier reference to a control implementation that satisfies a responsibility imposed by a leveraged system.</description>
  </define-flag>
</METASCHEMA>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-component-type.ent
================================================
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="interconnection">A connection to something outside this system.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="software">Any software, operating system, or firmware.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="hardware">A physical device.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="service">A service that may provide APIs.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="policy">An enforceable policy.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="physical">A tangible asset used to provide physical protections or countermeasures.</enum>
<!-- CHANGED combined "process" and "procedure" as "process-proceedure" -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="process-procedure">A list of steps or actions to take to achieve some end result.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="plan">An applicable plan.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="guidance">Any guideline or recommendation.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="standard">Any organizational or industry standard.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="validation">An external assessment performed on some other component, that has been validated by a third-party.</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-component_component_link-rel.ent
================================================
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="depends-on">A reference to another component that this component has a dependency on.</enum>
<!-- CHANGED (BJR): validated-by to validation per  https://github.com/usnistgov/OSCAL/blob/metaschema-m4-integration/docs/content/documentation/schema/implementation-layer/validation-modeling.md -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="validation">A reference to another component of component-type=validation, that is a validation (e.g., FIPS 140-2) for this component</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="proof-of-compliance">A pointer to a validation record (e.g., FIPS 140-2) or other compliance information.</enum>
<!-- rel values to also be allowed in implemented-component -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="baseline-template">A reference to the baseline template used to configure the asset.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="uses-service">This service is used by the referenced component identifier.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="system-security-plan">A link to the system security plan of the external system.</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-component_component_property-name.ent
================================================
<!-- These are shared between SSP components and component-definition components -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="version">The version of the component.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="patch-level">The specific patch level of the component.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="model">The model of the component.</enum>
<!-- CHANGE: @name="date-released" changed to @name="release-date" -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="release-date">The date the component was released, such as a software release date or policy publication date.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="validation-type">Used with component-type='validation' to provide a well-known name for a kind of validation.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="validation-reference">Used with component-type='validation' to indicate the validating body's assigned identifier for their validation of this component.</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-component_component_service.ent
================================================
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="provided-by">This service is provided by the referenced component identifier.</enum>
<!-- CHANGE: Added "used-by" -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="used-by">This service is used by the referenced component identifier.</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-component_component_software.ent
================================================
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="software-identifier">If a "software" component-type, the identifier, such as a SWID tag, for the software component.</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-component_inventory-item_property-name.ent
================================================
<!-- These are shared between SSP components, SSP inventory-items, and component-definition components -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="asset-type">Simple indication of the asset's function, such as Router, Storage Array, DNS Server.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="asset-id">An organizationally specific identifier that is used to uniquely identify a logical or tangible item by the organization that owns the item.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="asset-tag">An asset tag assigned by the organization responsible for maintaining the logical or tangible item.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="public">Identifies whether the asset is publicly accessible (yes/no)</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="virtual">Identifies whether the asset is virtualized (yes/no)</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="vlan-id">Virtual LAN identifier of the asset.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="network-id">The network identifier of the asset.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="label">A human-readable label for the parent context.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="sort-id">An alternative identifier, whose value is easily sortable among other such values in the document.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="baseline-configuration-name">The name of the baseline configuration for the asset.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="allows-authenticated-scan">Can the asset be check with an authenticated scan? (yes/no)</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="function">The function provided by the asset for the system.</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-control-group-property-name.ent
================================================
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="label">A human-readable label for the parent context, which may be rendered in place of the actual identifier for some use cases.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="sort-id">An alternative identifier, whose value is easily sortable among other such values in the document.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="alt-identifier">An alternate or aliased identifier for the parent context.</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-property-name-asset-type-values.ent
================================================
<!--  TODO: define values  -->
<!--  CHANGHD "os" to "operating-system" -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="operating-system">System software that manages computer hardware, software resources, and provides common services for computer programs.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="database">An electronic collection of data, or information, that is specially organized for rapid search and retrieval.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="web-server">A system that delivers content or services to end users over the Internet or an intranet.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="dns-server">A system that resolves domain names to internet protocol (IP) addresses.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="email-server">A computer system that sends and receives electronic mail messages.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="directory-server">A  system that stores, organizes and provides access to directory information in order to unify network resources.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="pbx">A private branch exchange (PBX) provides a a private telephone switchboard.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="firewall">A network security system that monitors and controls incoming and outgoing network traffic based on predetermined security rules.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="router">A physical or virtual networking device that forwards data packets between computer networks.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="switch">A physical or virtual networking device that connects devices within a computer network by using packet switching to receive and forward data to the destination device.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="storage-array">A consolidated, block-level data storage capability.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="appliance">A physical or virtual machine that centralizes hardware, software, or services for a specific purpose.</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-responsible-roles-component-production.ent
================================================
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="maintainer">Responsible for the creation and maintenance of a component.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="provider">Organization responsible for providing the component, if this is different from the "maintainer" (e.g., a reseller).</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-responsible-roles-operations.ent
================================================
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="asset-owner">Accountable for ensuring the asset is managed in accordance with organizational policies and procedures.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="asset-administrator">Responsible for administering a set of assets.</enum>
<!-- CHANGE: from "soc" to "security-operations" -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="security-operations">Members of the security operations center (SOC).</enum>
<!-- CHANGE: from "noc" to "network-operations" -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="network-operations">Members of the network operations center (NOC).</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="incident-response">Responsible for responding to an event that could lead to loss of, or disruption to, an organization's operations, services or functions.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="help-desk">Responsible for providing information and support to users.</enum>
<!-- CHANGE: from "configuration-management-lead" to "configuration-management" -->
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="configuration-management">Responsible for the configuration management processes governing changes to the asset.</enum>



================================================
FILE: src/metaschema/shared-constraints/allowed-values-responsible-roles-system.ent
================================================
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="authorizing-official">The authorizing official for this system.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="authorizing-official-poc">The authorizing official's designated point of contact (POC) for this system.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="system-owner">The executive ultimately accountable for the system.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="system-poc-management">The primary management-level point of contact (POC) for the system.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="system-poc-technical">The primary technical point of contact (POC) for the system.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="system-poc-other">Other point of contact (POC) for the system that is not the management or technical POC.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="information-system-security-officer">The primary role responsible for ensuring the organization operates the system securely.</enum>
<enum xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0" value="privacy-poc">The point of contact (POC) responsible for identifying privacy information within the system, and ensuring its protection if present.</enum>



================================================
FILE: src/release/release-notes.md
================================================
# OSCAL Release Notes

Release information can be found at: https://github.com/usnistgov/OSCAL/releases



================================================
FILE: src/release/release-readme.txt
================================================
# The Open Security Controls Assessment Language (OSCAL)

NIST is developing OSCAL as a set of machine-readable data exchange formats, referred to as "OSCAL models" (https://pages.nist.gov/OSCAL/concepts/layer/). These models enable organizations to express and exchange detailed, security and privacy control-related information in an implementation neutral way that spans the needs of multiple industries and compliance regimes. NIST is facilitating the creation and maintenance of the core OSCAL models. These models are provided in Extensible Markup Language (XML), JavaScript Object Notation (JSON), and YAML Ain't Markup Language (YAML) formats that are synchronized allowing them to represent  the same information. OSCAL has been designed to be extended by other organizations to address industry-specific, compliance-specific, or organization-specific content.

More information about OSCAL can be found on the OSCAL Project Website: https://nist.gov/oscal.
Documentation for the OSCAL models can be found at: https://pages.nist.gov/OSCAL/reference/

# Release Contents

This release provides 2 types of resources, each located in a different subdirectory:

- `xml/` and `json/`: Provides the XML and JSON schemas and content converters that are needed to support the OSCAL model. Instructions for using these artifacts can be found at https://github.com/usnistgov/OSCAL/blob/develop/build/README.md#artifact-usage
- `metaschema/`: Provides the source OSCAL Metaschema modules with all external entities (XXE) resolved for tools that do not support XXEs.

These directories provide stable, released versions of the resources provided on the OSCAL GitHub repository: https://github.com/usnistgov/OSCAL.

Please note that OSCAL content examples, which were once included in these archives are now located at: https://github.com/usnistgov/oscal-content.

If you have existing content targeting the previous `oscal-version` from a prior release, you can use the content upgrade transforms to upgrade them to this release as documented in this directory's README: https://github.com/usnistgov/OSCAL/tree/main/src/release/content-upgrade/.

# The OSCAL Roadmap

OSCAL is being developed through a series of milestone releases, which are focused around stabilizing the OSCAL model layers in a progression. While the project is being developed iteratively, the OSCAL team is working to reduce the impact of changes between each milestone release, to provide for early adoption of OSCAL content and the development of tools supporting the lower-layer models.

More information on these milestones and complete OSCAL Roadmap is always available at: https://pages.nist.gov/OSCAL/contribute/roadmap/.

# How to Contribute

OSCAL is being developed in a public GitHub repository, in collaboration with industry and government. We welcome community participation in the project. We are always in need to volunteers willing to:

- Review content and tools providing feedback on what is working well, and where issues are found.
- Help with developing OSCAL models and associated content.
- Assistance with developing documentation, tutorials, and other informational resources.

If you are interested in helping, please visit or contributing page for more information at: https://github.com/usnistgov/OSCAL/blob/main/CONTRIBUTING.md.

Please direct any questions, comments, concerns, or kudos by email to: oscal@nist.gov.



================================================
FILE: src/release/content-upgrade/README.md
================================================
# OSCAL Content Upgrade Transforms

The NIST OSCAL Team provides XSLT transforms to upgrade OSCAL document instances sequentially from one version of OSCAL to another. Currently, there are following content-upgrade transforms:

- [v1.0.0-milestone1](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0-milestone1) to [v1.0.0-milestone2](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0-milestone2)
- [v1.0.0-milestone2](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0-milestone2) to [v1.0.0-milestone3](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0-milestone3)
- [v1.0.0-milestone3](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0-milestone3) to [v1.0.0-rc1](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0-rc1)
- [v1.0.0-rc1](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0-rc1) to [v1.0.0-rc2](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0-rc2)
- [v1.0.0-rc2](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0-rc2) to [v1.0.0](https://github.com/usnistgov/OSCAL/releases/tag/v1.0.0)

## How do I upgrade the content?

### Content Upgrades on the Command Line

You should install [a current Java Runtime Environment](https://www.oracle.com/java/technologies/downloads/) and [Saxon HE 10.x](http://saxon.sourceforge.net/) Java-based runtime to run the content upgrade transforms on the command line. You can use alternative XSLT processors, in different language runtimes and/or without the Saxon project. You must, however, use an XSLT processor that supports [XSLT 3.0, at a minimum](https://www.w3.org/TR/xslt-30/). This tutorial uses Saxon HE as an example.

After you installed the Java Runtime Environment and Saxon HE, to transform a sample OSCAL document `catalog_v1.0.0-rc2.xml`, upgrade its content from v1.0.0 Release Candidate 2 to v1.0.0, and save the result in the file `catalog_v1.0.0.xml`, you will execute a command like so in your Linux, macOS, or Windows terminal:

```sh
java -cp Saxon-HE-10.6.jar net.sf.saxon.Transform -xsl:oscal-rc2-v1-0-0-update.xsl -s:catalog_v1.0.0-rc2.xml -o:catalog_v1.0.0.xml
```

### Content Upgrades with Oxygen XML Editor

If you prefer the use of an integrated development environment (IDE), you can use [the Oxygen XML Editor](https://www.oxygenxml.com/) to [configure and execute XSLT transforms](https://www.oxygenxml.com/doc/ug-oxygen/topics/xslt-tab.html). This IDE embeds a Java Runtime Environment and multiple versions of the Saxon XSLT processor for you convenience.

After you installed the Oxygen XML Editor, to transform a sample OSCAL document `catalog_v1.0.0-rc2.xml`, upgrade its content from v1.0.0 RC2 to v1.0., and save the result in the file `catalog_v1.0.0.xml`, you can configure the XSLT transform to your preference in the XSLT tab or like so:

- Name: oscal-rc2-v1-0-0-update
- XSLT:
  - XML URL: file:/path/to/samples/catalog_v1.0.0-rc2.xml
  - XSLT URL: file:/path/to/repo/OSCAL/src/release/content-upgrade/oscal-rc2-v1-0-0-update.xsl
- Output:
  - Save As: file:/path/to/results/catalog_v1.0.0.xml
  - Show in results view as:
    - [X] XML
    - [ ] SVG
    - [ ] XHTML

## Can I customize the content upgrade process?

Please review each transform (or [contact us for more help](https://pages.nist.gov/OSCAL/contact/)) to see additional parameters provided to customize the transform process. Important runtime parameters are documented below.

### `schema-location`: Enable `xsi:schemaLocation` attribute in OSCAL document root node

By default, you will upgrade content in a document instance and it does not explicitly add a `xsi:schemaLocation` attribute every time. Often, `xsi:schemaLocation` can be a local path or remote URI that is frequently out of date. The `xsi:schemaLocation` is an empty string by default (`''`), and it will not be included and the transform will emit a warning message.

If you do wish to explicit add `xsi:schemaLocation`, you can apply the transform on the command line like so:

```sh
java -cp Saxon-HE-10.6.jar net.sf.saxon.Transform -xsl:oscal-rc2-v1-0-0-update.xsl -s:catalog_v1.0.0-rc2.xml -o:catalog_v1.0.0.xml schema-location="'http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd'"
# using both quotes like this "' is required; this parameter is a single XML string
```

Similarly, you can specify this parameter in [the XSLT transform's' parameter context menu Oxygen XML Editor](https://www.oxygenxml.com/doc/ug-editor/topics/xslt-stylesheet-parameters.html) or configuring appropriately in the IDE of your choice.

## Frequently Asked Questions

### What do you do if you have OSCAL documents in JSON or YAML format?

See the [converter artifact usage section of the build README](../../../build/README.md#converters).

### What do you do if you are several versions behind?

You cannot upgrade multiple versions in one operation, you must upgrade sequentially from version to version to upgrade content appropriately.

For example, if you have content in `v1.0.0-rc1` you must upgrade from `v1.0.0-rc1` to `v1.0.0-rc2`, then you must upgrade from `v1.0.0-rc2` to `v1.0.0`. You cannot directly upgrade from `v1.0.0-rc1` to `v1.0.0`.



================================================
FILE: src/release/content-upgrade/add-uuids.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    version="3.0">

<!--
        Run this stylesheet to replace 'uuid' with an actual uuid.
      Wherever there is an id or uuid, a fresh uuid is added. -->

    <!-- Catalog, M2 and M3   -->
    <xsl:strip-space elements="param guideline select part metadata back-matter revision annotation location party rlink address biblio resource citation role responsible-party catalog group control person org"/>

    <!-- Profile, M2 and M3   -->
    <xsl:strip-space elements="metadata back-matter revision annotation location party rlink address biblio resource citation role responsible-party param guideline select part profile import merge custom group modify include exclude set-parameter alter add person org set"/>

    <!-- SSP, M2 and M3   -->
    <xsl:strip-space elements="metadata back-matter revision annotation location party rlink address biblio resource citation role responsible-party system-security-plan import-profile system-characteristics system-information information-type confidentiality-impact integrity-impact availability-impact security-impact-level status leveraged-authorization authorization-boundary diagram network-architecture data-flow system-implementation user authorized-privilege component protocol system-inventory inventory-item implemented-component control-implementation implemented-requirement statement responsible-role by-component set-parameter person org service interconnection set-param"/>

    <xsl:output indent="yes"/>

    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:template match="/">
        <!--<xsl:comment expand-text="true"> Modified by conversion XSLT { current-dateTime() } - UUIDs refreshed </xsl:comment>-->
        <xsl:apply-templates/>
    </xsl:template>

    <!-- Copying and adding uuid -->
    <xsl:template xmlns:uuid="java:java.util.UUID" match="resource/@id | party/@id |
        location/@id | party/@id | resource/@id | diagram/@id | user/@id | component/@id | information-type/@id |
        protocol/@id | inventory-item/@id | implemented-requirement/@id | statement/@id | by-component/@id">
        <xsl:copy-of select="."/>
        <xsl:call-template name="uuid"/>
    </xsl:template>


    <!-- Fresh uuid -->
    <xsl:template match="*[empty(@id)]/@uuid" name="uuid" xmlns:uuid="java:java.util.UUID">
        <xsl:attribute name="uuid" select="uuid:randomUUID()"/>
    </xsl:template>

    <xsl:template match="implemented-component | implemented-requirement | statement | by-component">
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <xsl:call-template name="uuid"/>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/catalog-link-tweak.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    version="3.0">

<!-- Adjustments to link model M3-RC1 require some changes to content wrt link usage
     -->

    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:template match="/comment()">
        <xsl:next-match/>
        <xsl:text>&#xA;</xsl:text>
    </xsl:template>

    <xsl:template match="/*">
        <xsl:comment expand-text="yes"> Modified again { current-date() } to conform with RC1 schema with updated link representations. </xsl:comment>
        <xsl:text>&#xA;</xsl:text>
        <xsl:next-match/>
    </xsl:template>

    <!-- remove 'inactive' mode (which is never used) to keep present link text contents in a 'text' element child -->

    <xsl:template match="link[matches(.,'\S')]" mode="inactive">
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <text>
                <xsl:apply-templates/>
            </text>
        </xsl:copy>
    </xsl:template>

    <xsl:template priority="3" match="link">
        <xsl:copy>
            <xsl:copy-of select="@*"/>
        </xsl:copy>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/json-prop-to-props.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="3.0"
    xpath-default-namespace="http://www.w3.org/2005/xpath-functions"
    xmlns="http://www.w3.org/2005/xpath-functions">
    
<!-- 
    Command line invocation:
    
    $ java -jar $SAXON_HOME/saxon-he-10.2.jar -xsl:json-prop-to-props.xsl -it json-input=YOUR.json

    where YOUR.json is your JSON file and the jar file is Saxon 10 or later.
    
    The process reads the file at this URL, parses it as JSON, maps it through a filter, and reports it back.
    
    -->
    
    <xsl:output method="text"/>
    
    <xsl:mode on-no-match="shallow-copy"/>
    
    <!-- The input JSON file -->
    <xsl:param name="json-input" select="'url to json file'"/>
    
    <!-- The initial template that process the JSON -->
    <xsl:template name="xsl:initial-template">
        <xsl:variable name="mapped-result">
            <xsl:apply-templates select="json-to-xml(unparsed-text($json-input))"/>
        </xsl:variable>
        <!--<xsl:copy-of select="$mapped-result"/>-->
        <xsl:value-of select="xml-to-json($mapped-result)"/>
    </xsl:template>
    
    <xsl:template match="array[@key='prop']">
        <array key="props">
            <xsl:apply-templates/>
        </array>
    </xsl:template>
    
</xsl:stylesheet>


================================================
FILE: src/release/content-upgrade/oscal-m1-m2-update.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    version="3.0">

<!-- This XSLT, applied to an XML document valid to the Milestone1 OSCAL schema version for Catalog or Profile,
     will produce a similar XML document valid to the Milestone2 OSCAL schema. -->

    <xsl:strip-space elements="catalog group control subcontrol part param"/>

    <xsl:output indent="yes"/>

    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:template match="/*">
        <xsl:comment expand-text="true"> Modified by conversion XSLT { current-dateTime() } - Milestone 1 OSCAL becomes Milestone 2 OSCAL  - </xsl:comment>
        <xsl:next-match/>
    </xsl:template>

    <!-- Rewriting top-level @id -->
    <xsl:template match="/*/@id[function-available('uuid:randomUUID')]" xmlns:uuid="java:java.util.UUID">
        <xsl:attribute name="id" select="'uuid-' || uuid:randomUUID()"/>
    </xsl:template>

    <!-- copy metadata, mostly -->
    <xsl:template match="metadata">
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <xsl:apply-templates select="title"/>
            <!-- time stamp it at runtime -->
            <last-modified xsl:expand-text="true">{ current-dateTime() }</last-modified>
            <xsl:apply-templates select="* except title"/>
        </xsl:copy>
    </xsl:template>

    <!-- remove the old modification date, no longer valid or applicable -->
    <xsl:template match="last-modified-date"/>

    <!-- rename subcontrol to control, keeping its attributes -->
    <xsl:template match="subcontrol">
        <control>
            <xsl:copy-of select="@*"/>
            <xsl:apply-templates/>
        </control>
    </xsl:template>

    <!-- add role-id elements to party -->
    <xsl:template match="party">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:for-each select="tokenize(@role-id,'\s+')">
                <role-id xsl:expand-text="true">{ . }</role-id>
            </xsl:for-each>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:template>

    <!-- but drop the party/@role-id -->
    <xsl:template match="party/@role-id"/>

    <!-- rewrite subcontrol-id as control-id -->
    <xsl:template match="@subcontrol-id">
        <xsl:attribute name="control-id">
            <xsl:value-of select="."/>
        </xsl:attribute>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/oscal-m2-m3-elements.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    version="3.0">

<!-- This XSLT, applied to an XML document valid to the Milestone 2 OSCAL schema version for Catalog or Profile,
     will produce a similar XML document, valid or closer to valid to the Milestone 3 OSCAL schema.
    We say 'closer to valid' in this case because we implement only necessary mappings we have seen, not all conceivable, given Issue ; plus of course we depend on valid inputs. -->



    <!-- Catalog, M2 and M3   -->
    <xsl:strip-space elements="param guideline select part metadata back-matter revision annotation location party rlink address biblio resource citation role responsible-party catalog group control person org"/>

    <!-- Profile, M2 and M3   -->
    <xsl:strip-space elements="metadata back-matter revision annotation location party rlink address biblio resource citation role responsible-party param guideline select part profile import merge custom group modify include exclude set-parameter alter add person org set"/>

    <!-- SSP, M2 and M3   -->
    <xsl:strip-space elements="metadata back-matter revision annotation location party rlink address biblio resource citation role responsible-party system-security-plan import-profile system-characteristics system-information information-type confidentiality-impact integrity-impact availability-impact security-impact-level status leveraged-authorization authorization-boundary diagram network-architecture data-flow system-implementation user authorized-privilege component protocol system-inventory inventory-item implemented-component control-implementation implemented-requirement statement responsible-role by-component set-parameter person org service interconnection set-param"/>

    <xsl:output indent="yes"/>

    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:mode name="copy" on-no-match="shallow-copy"/>

    <xsl:template match="/*">
        <!--<xsl:comment expand-text="true"> Modified by conversion XSLT { current-dateTime() } - Milestone 2 OSCAL becomes Milestone 3 OSCAL  - </xsl:comment>-->
        <xsl:next-match/>
    </xsl:template>

    <!-- Rewriting top-level @id -->
    <xsl:template match="/*/@id[function-available('uuid:randomUUID')]" xmlns:uuid="java:java.util.UUID">
        <xsl:attribute name="uuid" select="uuid:randomUUID()"/>
    </xsl:template>

    <!-- copy metadata, mostly -->
    <xsl:template match="metadata">
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <xsl:apply-templates select="title, published"/>
            <!-- time stamp it at runtime -->
            <last-modified xsl:expand-text="true">{ current-dateTime() }</last-modified>
            <xsl:apply-templates select="* except (title | published)"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="last-modified" priority="6"/>

    <xsl:template match="oscal-version" priority="6">
        <xsl:apply-templates select="." mode="ws"/>
        <oscal-version>1.0.0-milestone3</oscal-version>
    </xsl:template>

    <xsl:template match="metadata/*" priority="5">
        <xsl:next-match/>
        <xsl:if test="empty(following-sibling::*)">
            <xsl:apply-templates select=".." mode="ws"/>
        </xsl:if>
    </xsl:template>

    <xsl:template match="party">
        <party>
            <xsl:apply-templates select="." mode="party-type"/>
            <!-- doing uuid in a later step -->
            <xsl:copy-of select="@id"/>
            <xsl:apply-templates/>
            <xsl:if test="empty(*)" expand-text="true">
                <party-name>{ @id }</party-name>
            </xsl:if>
        </party>
    </xsl:template>

    <xsl:template match="party[empty(org) and count(person) = 1]" mode="party-type">
        <xsl:attribute name="type">person</xsl:attribute>
    </xsl:template>

    <xsl:template match="party" mode="party-type">
        <xsl:attribute name="type">organization</xsl:attribute>
    </xsl:template>

    <xsl:template match="party/org | party/person">
        <xsl:apply-templates select="person-name, org-name, short-name, prop, annotation, url, address, email, phone, org-id"/>
        <xsl:apply-templates select="* except (person-name | org-name | short-name | prop | url | address | email | phone | org-id )"/>
    </xsl:template>

    <xsl:template match="party/*/url">
        <link rel="homepage" href="{.}">
            <xsl:apply-templates/>
        </link>
    </xsl:template>

    <xsl:template match="person-name | org-name">
        <party-name>
            <xsl:apply-templates/>
        </party-name>
    </xsl:template>

    <xsl:template match="party-id">
        <party-uuid>
            <xsl:apply-templates/>
        </party-uuid>
    </xsl:template>

    <xsl:template match="location-id">
        <location-uuid>
            <xsl:apply-templates/>
        </location-uuid>
    </xsl:template>

    <xsl:template match="org-id">
        <xsl:if test="matches(., '\S')">
            <member-of-organization>
                <xsl:apply-templates/>
            </member-of-organization>
        </xsl:if>
    </xsl:template>


    <xsl:template match="*" mode="ws">
        <xsl:text>&#xA;</xsl:text>
        <xsl:for-each select="ancestor::*">
            <xsl:text>    </xsl:text>
        </xsl:for-each>
    </xsl:template>

    <xsl:template match="set | set-param">
        <set-parameter>
            <xsl:copy-of select="@*"/>
            <xsl:apply-templates/>
        </set-parameter>
    </xsl:template>

    <xsl:template match="back-matter/citation">
        <!-- leaving an @id as link target to be mapped to uuid in a next stage       -->
        <resource id="{@id}">
            <xsl:apply-templates select="title" mode="copy"/>
            <xsl:apply-templates select="doc-id" mode="copy"/>
            <xsl:next-match/>
            <xsl:apply-templates select="target"/>
        </resource>
    </xsl:template>

    <xsl:template match="citation/desc">
        <text>
            <xsl:apply-templates/>
        </text>
    </xsl:template>

    <xsl:template name="target">
        <rlink href="{ . }"/>
    </xsl:template>

    <xsl:template match="citation/title">
        <text>
            <xsl:apply-templates/>
        </text>
    </xsl:template>

    <xsl:template match="citation/@id | citation/target | citation/text() | citation/doc-id"/>

    <!-- @id to @uuid migration ... does *not* rewrite UUID values ... see rewrite-uuid for this ...   -->

<!-- Following are mappings for SSP elements  -->

    <xsl:template match="information-type | component | authorized-privilege">
        <xsl:copy>
            <xsl:apply-templates select="@* except @name, @name"/>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="service | interconnection">
        <component component-type="{ local-name() }">
            <xsl:apply-templates select="@* except @name, @name"/>
            <xsl:apply-templates/>
        </component>
    </xsl:template>

    <xsl:template match="interconnection/remote-system-name">
        <title>
            <xsl:apply-templates/>
        </title>
    </xsl:template>

    <xsl:template match="information-type/@name | component/@name | authorized-privilege/@name">
        <title>
            <xsl:sequence select="string(.)"/>
        </title>
    </xsl:template>

    <xsl:template match="implemented-component">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="system-characteristics/leveraged-authorization"/>

    <xsl:template match="system-implementation">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates select="prop, annotation, link"/>
            <xsl:for-each select="../system-characteristics/leveraged-authorization">
                <xsl:copy>
                    <xsl:apply-templates select="@*"/>
                    <xsl:apply-templates/>
                </xsl:copy>
            </xsl:for-each>
            <xsl:apply-templates select="* except (prop | annotation | link)"/>

        </xsl:copy>

    </xsl:template>
</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/oscal-m2-m3-UPDATE-with-uuids.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math" exclude-result-prefixes="#all"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0">

    <!--

    An XSLT 3.0 stylesheet using XPath 3.1 functions including transform()

    This XSLT orchestrates a sequence of transformations over its input.

    The first transformation, "selection", aggregates the source with external (referenced) contents.

    Subsequent transformations, "merge" and "modify", are self-contained: all inputs are included.

    -->

    <xsl:output method="xml" indent="yes"/>

    <xsl:strip-space
        elements="catalog group control param guideline select part
        metadata back-matter annotation party person org rlink address resource role responsible-party citation
        profile import merge custom modify include exclude set alter add"/>

    <!-- Turning $trace to 'on' will
         - emit runtime messages with each transformation, and
         - retain opr:ERROR and opr:WARNING messages in results. -->

    <xsl:param name="trace" as="xs:string">off</xsl:param>

    <xsl:param name="uri-stack" as="xs:anyURI*" select="()"/>

    <!-- $path-to-source should point back to the source catalog from its result,
         so '..' is appropriate when writing results down a directory. -->
    <xsl:param name="path-to-source" as="xs:string?"/>

    <xsl:variable name="louder" select="$trace = 'on'"/>

    <xsl:variable name="home" select="/"/>

    <!-- The $transformation-sequence declares transformations to be applied in order. -->
    <xsl:variable name="transformation-sequence">
        <opr:transform version="3.0">oscal-m2-m3-elements.xsl</opr:transform>
        <opr:transform version="2.0">add-uuids.xsl</opr:transform>
        <opr:transform version="2.0">rewrite-links.xsl</opr:transform>
        <opr:finalize/>
    </xsl:variable>

    <!-- Entry point traps the root node of the source and passes it down the chain of transformation references -->
    <xsl:template match="/" name="profile-resolve">
        <xsl:param name="source" select="." as="document-node()"/>
        <!-- Each element inside $transformation-sequence is processed in turn.
             Each represents a stage in processing.
             The result of each processing step is passed to the next step as its input, until no steps are left. -->
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" expand-text="yes"> RESOLVING PROFILE { document-uri($source) } </xsl:with-param>
        </xsl:call-template>
        <xsl:iterate select="$transformation-sequence/*">
            <xsl:param name="doc" select="$source" as="document-node()"/>
            <xsl:on-completion select="$doc"/>
            <xsl:next-iteration>
                <xsl:with-param name="doc">
                    <xsl:apply-templates mode="opr:execute" select=".">
                        <xsl:with-param name="sourcedoc" select="$doc"/>
                    </xsl:apply-templates>
                </xsl:with-param>
            </xsl:next-iteration>
        </xsl:iterate>
    </xsl:template>

    <!-- for opr:transformation, the semantics are "apply this XSLT" -->
    <xsl:template mode="opr:execute" match="opr:transform">
        <xsl:param name="sourcedoc" as="document-node()"/>
        <xsl:variable name="xslt-spec" select="."/>
        <xsl:variable name="runtime-params" as="map(xs:QName,item()*)">
            <xsl:map>
                <xsl:map-entry key="QName('','profile-origin-uri')" select="document-uri($home)"/>
                <xsl:map-entry key="QName('','path-to-source')"     select="$path-to-source"/>
                <xsl:map-entry key="QName('','uri-stack-in')"       select="($uri-stack, document-uri($home))"/>
            </xsl:map>
        </xsl:variable>
        <!--<xsl:variable name="runtime" select="map {
                    'xslt-version': xs:decimal($xslt-spec/@version),
                    'stylesheet-location': string($xslt-spec),
                    'source-node': $sourcedoc,
                    'stylesheet-params': $runtime-params
                    }"/>-->
        <xsl:variable name="runtime" as="map(xs:string, item())">
            <xsl:map>
                <xsl:map-entry key="'xslt-version'" select="xs:decimal($xslt-spec/@version)"/>
                <xsl:map-entry key="'stylesheet-location'" select="string($xslt-spec)"/>
                <xsl:map-entry key="'source-node'" select="$sourcedoc"/>
                <xsl:map-entry key="'stylesheet-params'" select="$runtime-params"/>
            </xsl:map>
        </xsl:variable>

        <!-- The function returns a map; primary results are under 'output'
             unless a base output URI is given
             https://www.w3.org/TR/xpath-functions-31/#func-transform -->
        <xsl:sequence select="transform($runtime)?output"/>
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" expand-text="true"> ... applied step { count(.|preceding-sibling::*) }: XSLT { $xslt-spec } ... </xsl:with-param>
        </xsl:call-template>
    </xsl:template>

    <!-- The finalize step performs any last cleanup. -->
    <xsl:template mode="opr:execute" match="opr:finalize">
        <xsl:param name="sourcedoc" as="document-node()"/>
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" expand-text="true"> ... applied step {
                count(.|preceding-sibling::*) }: finalize ... </xsl:with-param>
        </xsl:call-template>

        <xsl:apply-templates select="$sourcedoc" mode="opr:finalize"/>
    </xsl:template>

    <!-- Not knowing any better, any other execution step passes through its source. -->
    <xsl:template mode="opr:execute" match="*">
        <xsl:param name="sourcedoc" as="document-node()"/>
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" expand-text="true"> ... applied step { count(.|preceding-sibling::*) }: { name() } ...</xsl:with-param>
        </xsl:call-template>
                <xsl:sequence select="$sourcedoc"/>
    </xsl:template>

    <!-- Mode 'opr:finalize' makes final adjustments. -->

    <!-- Here we wipe traces of XSD.   -->
    <xsl:template mode="opr:finalize" match="@xsi:*"/>

    <!-- Likewise, intermediate processing directives. -->
    <xsl:template mode="opr:finalize" match="opr:* | @opr:*"/>

    <!-- But keep warnings and errors when tracing. -->
    <xsl:template mode="opr:finalize" match="opr:ERROR[$louder] | opr:WARNING[$louder]">
        <xsl:copy-of copy-namespaces="no" select="."/>
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" select="string(.)"/>
        </xsl:call-template>
    </xsl:template>

    <!-- In 'finalize' mode, copying everything else without namespaces. -->
    <xsl:template mode="opr:finalize" match="node() | @*">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates select="node() | @*" mode="#current"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template name="alert">
        <xsl:param name="msg"/>
        <xsl:if test="$louder">
            <xsl:message>
                <xsl:sequence select="$msg"/>
            </xsl:message>
        </xsl:if>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/oscal-m2-m3-update.xpl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<p:declare-step xmlns:p="http://www.w3.org/ns/xproc"
  xmlns:c="http://www.w3.org/ns/xproc-step" version="1.0"
  xmlns:oscal="http://csrc.nist.gov/ns/oscal/1.0"
  type="oscal:resolve-profile" name="oscal-resolve-profile">

  <!-- &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& -->
  <!-- Ports -->

  <p:input port="source" primary="true"/>
  <p:input port="parameters" kind="parameter"/>

  <p:serialization port="a.echo-input" indent="true"/>
  <p:output        port="a.echo-input" primary="false">
    <p:pipe        port="result"       step="input"/>
  </p:output>

  <p:serialization port="b.update-structures" indent="true"/>
  <p:output        port="b.update-structures" primary="false">
    <p:pipe        port="result"      step="M2-M3-update"/>
  </p:output>

  <p:serialization port="c.add-uuids" indent="true"/>
  <p:output        port="c.add-uuids" primary="false">
    <p:pipe        port="result"      step="add-uuids"/>
  </p:output>

  <p:serialization port="d.rewrite-links" indent="true"/>
  <p:output        port="d.rewrite-links" primary="false">
    <p:pipe        port="result"          step="rewrite-links"/>
  </p:output>

  <p:serialization port="f.final" indent="true"/>
  <p:output        port="f.final" primary="false">
    <p:pipe        port="result"   step="final"/>
  </p:output>

  <!--
  <opr:transform version="2.0">oscal-profile-resolve-select.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-metadata.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-merge.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-modify.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-finish.xsl</opr:transform>-->


  <!--<p:serialization port="z.final" indent="true" method="xml" omit-xml-declaration="false"/>
  <p:output        port="z.final" primary="true">
    <p:pipe        port="result" step="final"/>
  </p:output>-->

  <!-- &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& -->
  <!-- Pipeline -->

  <p:identity name="input"/>

  <p:xslt name="M2-M3-update">
    <p:input port="stylesheet">
      <p:document href="oscal-m2-m3-elements.xsl"/>
    </p:input>
  </p:xslt>

  <p:xslt name="add-uuids">
    <p:input port="stylesheet">
      <p:document href="add-uuids.xsl"/>
    </p:input>
  </p:xslt>

  <p:xslt name="rewrite-links">
    <p:input port="stylesheet">
      <p:document href="rewrite-links.xsl"/>
    </p:input>
  </p:xslt>

  <p:xslt name="final">
    <p:input port="stylesheet">
      <p:inline>
        <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="3.0">

          <xsl:mode on-no-match="shallow-copy"/>
          <xsl:template match="/">
            <xsl:comment expand-text="true"> Modified by conversion XSLT { current-dateTime() } - M2-M3 update w/ uuids </xsl:comment>
            <xsl:text>&#xA;</xsl:text>
            <xsl:apply-templates/>
          </xsl:template>

          <xsl:template match="/comment()">
            <xsl:copy-of select="."/>
            <xsl:text>&#xA;</xsl:text>
          </xsl:template>
        </xsl:stylesheet>
      </p:inline>
    </p:input>
  </p:xslt>

</p:declare-step>



================================================
FILE: src/release/content-upgrade/oscal-m3-rc1-elements.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:uuid="java:java.util.UUID"
    exclude-result-prefixes="#all"
    version="3.0">

<!-- This XSLT, applied to an XML document valid to the Milestone 3 OSCAL schema version for Catalog, Profile, SSP or Component,
     will produce a similar XML document, valid or closer to valid to the Release Candidate 1 OSCAL schema. -->

    <xsl:output indent="yes"/>

    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:mode name="copy" on-no-match="shallow-copy"/>

    <xsl:variable select="uuid:randomUUID()" name="new-document-uuid"/>
    <xsl:variable select="uuid:randomUUID()" name="new-this-system-component-uuid"/>

    <!-- Grabbing the old UUID or the new UUID if there is no old one. -->
    <xsl:variable name="this-system-component-uuid" select="(/*/system-implementation/component[(@type|@component-type='this-system')]/@uuid,$new-this-system-component-uuid)[1]"/>

<!--
In {top-level-element}/metadata:
x renamed "revision-history" to "revisions"
x renamed "doc-id" to "document-id"

In {top-level-element}/metadata/document-id:
x renamed "type" to "scheme"
a doc-id/@type 'doi' to document-id/@scheme 'https://www.doi.org/'

    -->

    <xsl:template match="/*">
        <xsl:copy>
            <xsl:apply-templates select="@* except @id"/>
            <xsl:attribute name="uuid" select="$new-document-uuid"/>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:template>


    <xsl:template match="metadata">
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <xsl:apply-templates select="title, published"/>
            <!-- time stamp it at runtime -->
            <last-modified xsl:expand-text="true">{ current-dateTime() }</last-modified>
            <xsl:apply-templates select="* except (title | published)"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="last-modified" priority="6"/>

    <xsl:template match="oscal-version" priority="6">
        <oscal-version>1.0.0-rc1</oscal-version>
    </xsl:template>


    <xsl:template match="link">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:if test="matches(string(.),'\S')">
                <text>
                    <xsl:apply-templates/>
                </text>
            </xsl:if>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="revision-history">
        <revisions>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates/>
        </revisions>
    </xsl:template>


    <xsl:template match="doc-id">
        <document-id>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates/>
        </document-id>
    </xsl:template>

    <xsl:template match="doc-id/@type | external-id/@type">
        <xsl:attribute name="scheme" select="."/>
    </xsl:template>

    <xsl:template priority="10" match="doc-id/@type[.='doi']">
        <xsl:attribute name="scheme">https://www.doi.org/</xsl:attribute>
    </xsl:template>

<!--
In {top-level-element}/metadata/link:
n Defined allowed values for the "rel" property

In {top-level-element}/metadata/location:
x renamed "email" to "email-address"
x renamed "phone" to "telephone-number"
    -->

    <xsl:template match="email">
        <email-address>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates/>
        </email-address>
    </xsl:template>

    <xsl:template match="phone">
        <telephone-number>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates/>
        </telephone-number>
    </xsl:template>

<!--

In {top-level-element}/metadata/location/prop:
n Defined allowed values for the "name" attribute. Using the "type" as the name attribute value, you can now specify that a location is a "data-center" location and also use the "class" attribute to qualify the data center location as "primary" or "alternate".

In {top-level-element}/metadata/party:
a reordered contents of party
x renamed "party-name" to "name"
x renamed "email" to "email-address"
x renamed "phone" to "telephone-number"
n made use of address and location-uuid mutually exclusive, since either a static address or a reference to location provides similar functionality. The "location-type" attribute has been removed. This should data should now be described on the referenced "location" element using a prop element with a name of "type".

In {top-level-element}/metadata/party/prop:
n Defined allowed values for the "name" attribute. This can be used to provide a "mail-stop", "office", or "job-title".

In {top-level-element}/metadata/party/external-id:
x renamed "type" to "scheme"

    -->

    <xsl:template match="party">
        <!-- order of contents of `party`:
    M3: party-name, short-name, external-id, prop, annotation, link, address, email, phone, member-of-organization, location-uuid, remarks
    RC1: name, short-name, external-id, prop, annotation, link, email-address, telephone-number, (address|location-uuid), member-of-organization, remarks
          -->
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates select="party-name, short-name, external-id, prop, annotation, link, email, phone, address, location-uuid, member-of-organization, remarks"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="party-name">
        <name>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates/>
        </name>
    </xsl:template>

<!--
    In {top-level-element}/metadata/role:
x renamed "desc" to "description"

In {top-level-element}/back-matter/resource:
x renamed "desc" to "description"
x renamed "doc-id" to "document-id"
    -->
    <xsl:template match="desc">
        <description>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates/>
        </description>
    </xsl:template>

<!--
In {top-level-element}/back-matter/resource/prop:
n defined allowed values "type", "version", and "published" for the "name" property.

In {top-level-element}/metadata/resource/document-id:
x renamed "type" to "scheme"

In {top-level-element}/back-matter/resource/rlink:
n changed type from "uri" to "uri-reference"

Changes to all "prop" elements:
n changed the data type of "ns" to "uri"
x renamed "id" to "uuid" and changed type to "uuid" (prop has @uuid under M3+)
a - note, results will not have valid uuids until the UUID refresher is run

Changes to all "annotation" elements:
n changed the data type of "ns" to "uri"
x renamed "id" to "uuid" and changed type to "uuid"
a - again note that uuid values are unlikely to be valid until reassignment

    -->

    <xsl:template match="prop/@id | annotation/@id">
        <xsl:attribute name="uuid" select="."/>
    </xsl:template>

<!--
### Changes affecting the catalog and profile XML formats

Changes to all "part" elements:
n changed the data type of "ns" to "uri"

Changes to all "param" elements:
n added the "prop" and "link" elements.
x changed the sequencing of "link" to be consistent with other elements that include "link".
x changed the data type of "usage" from "markup-line" to "markup-multiline"
x changed "constraint" from an element with a text value, to an element with child elements. The text value is now contained in the "description" element. Also changed the "test" attribute to be a sequence of child "test" elements, with the text value now contained in the "expression" element.
x changed the cardinality of "value" to allow for multiple values". The data type of a value has changed from markup-line to string.

-->

<!-- Handles either catalog//param or profile//set-parameter -->
    <xsl:template match="param | set-parameter">
        <!-- old: (label{0-1}, usage{0-UNBOUNDED}, constraint{0-UNBOUNDED}, guideline{0-UNBOUNDED}, (value{0-1} | select{0-1}), link{0-UNBOUNDED})-->
        <!--new: (prop{0-UNBOUNDED}, annotation{0-UNBOUNDED}, link{0-UNBOUNDED}, label{0-1}, usage{0-1}, constraint{0-UNBOUNDED}, guideline{0-UNBOUNDED}, (value{0-UNBOUNDED} | select{0-1}))-->
        <xsl:copy>
            <xsl:apply-templates select="@* except @test"/>
            <xsl:apply-templates select="link, label, usage, constraint, guideline, value, select"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="usage[matches(.,'\S')]">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <p>
                <xsl:apply-templates/>
            </p>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="constraint">
        <xsl:copy>
            <xsl:apply-templates select="@* except @test"/>
            <xsl:if test="matches(.,'\S')">
            <description>
                    <p>
                        <xsl:apply-templates/>
                    </p>
            </description>
            </xsl:if>
            <xsl:apply-templates select="@test"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="constraint/@test">
        <test>
            <expression>
                <xsl:value-of select="."/>
            </expression>
        </test>
    </xsl:template>

    <xsl:template match="param/value">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <!-- markup not permitted -->
            <xsl:value-of select="."/>
        </xsl:copy>
    </xsl:template>

<!--
For /catalog//group and /catalog//control:
n defined allowed values for prop/@name

    -->

<!--
### Changes to profile XML format

For /profile/merge/custom//groups:
n added "annotation" and "link"

For /profile/modify/set-parameter:
n added "prop" and "annotation"
x change sequencing of "link"

For /profile/modify/alter/add:
n defined allowed values for prop/@name

    -->

<!--
### Changes to the SSP XML format

For /system-security-plan/system-characteristics:
n added allowed values for prop/@name, annotation/@name, link/@rel, and responsible-roles/role-id

For /system-security-plan/system-characteristics/*/diagram:
n added "annotation"
n changed the data type of "caption" from "string" to "markup-line"
n added allowed values for link/@rel="diagram", which allows for the linking of an image to use for the diagram.

For /system-security-plan/system-characteristics/system-information/information-type:
x renamed "id" to "uuid"
x changed structure of "information-type-id" to be wrapped by an outer characterization, which now defines the "system" for all referenced information type identifiers.
a actually this is 'categorization'
n added "annotation"
    -->

    <xsl:template match="system-security-plan//information-type/information-type-id">
        <categorization>
            <xsl:copy-of select="@system"/>
            <xsl:next-match/>
        </categorization>
    </xsl:template>

    <xsl:template match="information-type-id/@id">
        <!-- not lexically valid in result until uuid fixup -->
        <xsl:attribute name="uuid" select="."/>
    </xsl:template>

    <xsl:template match="system-security-plan//information-type/information-type-id/@system"/>


<!--

a /system-security-plan/system-implementation/system-inventory element removed from SSP
  with its inventory-item contents kept



    -->

    <!-- A new requirement in RC1 is the presence of a 'this-system' component (i.e. component[@type='this-system']
         If one is not given, we provide boilerplate for it. -->
    <xsl:template match="system-implementation">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates select="* except (component | system-inventory | remarks)"/>
            <xsl:if test="not(component/@component-type='this-system')">
                <xsl:call-template name="this-system-boilerplate"/>
            </xsl:if>
            <xsl:apply-templates select="component | system-inventory | remarks"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template name="this-system-boilerplate" xmlns:uuid="java:java.util.UUID">
        <component type="this-system" uuid="{$new-this-system-component-uuid}">
            <title>This System</title>
            <description>
                <p>The system described by this SSP.</p>
                <p>This text was auto-generated by the OSCAL M3-RC1 data upgrade converter.</p>
            </description>
            <status state="{/system-security-plan/system-characteristics/status/@state}">
                <xsl:if test="/system-security-plan/system-characteristics/status/@state='major-modification'">
                    <xsl:attribute name="state">other</xsl:attribute>
                </xsl:if>
            </status>
        </component>
    </xsl:template>


    <xsl:template match="system-implementation/system-inventory">
        <xsl:apply-templates/>
    </xsl:template>

<!--

For /system-security-plan/system-characteristics/system-information/information-type/*-impact:
n added "annotation" and "link"

For /system-security-plan/system-implementation/leveraged-authorization:
n defined additional allowed values "implementation-point", "leveraged-authorization-uuid", "inherited-uuid" for prop/@name, which provides traceability to a leveraged SSP
n defined allowed values for link/@rel

For /system-security-plan/system-implementation/user:
n defined allowed values for annotation/@name and role-id

For /system-security-plan/system-implementation/component:
x renamed "component-type" to "type", and updated allowed values (RC1 shows @component-type)
n defined allowed values for prop/@name, annotation/@name, link/@rel, and responsible-role/@role-id


    -->

    <xsl:template match="@component-type">
        <xsl:attribute name="type" select="."/>
    </xsl:template>

<!--

For /system-security-plan/system-implementation/inventory-item:
x moved "@asset-id" to a required prop/@name
n defined allowed values for prop/@name, annotation/@name, link/@rel, and responsible-role/@role-id


    -->

    <xsl:template match="inventory-item">
        <xsl:copy>
            <xsl:apply-templates select="@* except @asset-id"/>
            <xsl:apply-templates select="description"/>
            <xsl:apply-templates select="@asset-id"/>
            <xsl:apply-templates select="* except description"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="inventory-item/@asset-id" expand-text="true">
        <prop name="asset-id">{ . }</prop>
    </xsl:template>

<!--

For /system-security-plan/system-implementation/inventory-item/implemented-component:
x renamed "component-id" to "component-uuid"
n defined allowed values for prop/@name, annotation/@name, and responsible-party/@role-id
x removed "use", since this is capturing similar information to the component's type
    -->

    <xsl:template match="implemented-component/@component-id | by-component/@component-id">
        <xsl:attribute name="component-uuid" select="."/>
    </xsl:template>

    <xsl:template match="implemented-component/@use"/>


<!--



## Changes to the SSP model




For /system-security-plan/control-implementation/implemented-requirement:
x removed "description"
n added allowed values for annotation/@name including "implementation-status", "control-origination"
n added allowed values for prop/@name including "leveraged-authorization" to indicate if a control implementation is inherited from an underlying authorized system
n added allowed values for responsible-role/$role-id

-->

    <xsl:template match="implemented-requirement/description"/>

    <xsl:template match="implemented-requirement/statement/description"/>

    <!-- Adding a 'this-system' by-component if we don't already have one...-->
    <xsl:template match="implemented-requirement | implemented-requirement//statement">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates select="prop, annotation, link, set-parameter, responsible-role"/>
            <xsl:if test="exists(description) and empty(by-component[@component-uuid=$this-system-component-uuid]) ">
                <by-component component-uuid="{$this-system-component-uuid}" uuid="{uuid:randomUUID()}">
                    <xsl:sequence select="description"/>
                </by-component>
            </xsl:if>
            <xsl:apply-templates select="by-component, statement, remarks"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="implemented-requirement//by-component[@component-uuid=$this-system-component-uuid]">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:for-each select="description">
                <xsl:copy>
                    <xsl:apply-templates select="@*"/>
                    <xsl:copy-of select="../description/*"/>
                    <xsl:apply-templates/>
                </xsl:copy>
            </xsl:for-each>
            <xsl:if test="empty(description)">
                <xsl:copy-of select="../description"/>
            </xsl:if>
            <xsl:apply-templates select="* except description"/>
        </xsl:copy>
    </xsl:template>

<!--
For /system-security-plan/control-implementation/implemented-requirement/by-component:
x renamed "component-id" to "component-uuid"
n added "export", "inherited", and "satisfied" to support documenting leveraged authorizations
n added "remarks" to allow for adding general commentary

For /system-security-plan/control-implementation/implemented-requirement/statement:
- removed "description"

For /system-security-plan/control-implementation/implemented-requirement/statement/by-component:
x renamed "component-id" to "component-uuid"
n added "export", "inherited", and "satisfied" to support documenting leveraged authorizations
n added "remarks" to allow for adding general commentary

## Changes to the component definition model

### Changes to the component definition XML format

For /XXX/system-implementation/component:
- renamed "component-type" to "type", and updated allowed values
n defined allowed values for prop/@name, annotation/@name, link/@rel, and responsible-role/@role-id

For /XXX/system-implementation/user:
n defined allowed values for annotation/@name and role-id

For /XXX/system-implementation/inventory-item:
- moved "@asset-id" to a required prop/@name
n defined allowed values for prop/@name, annotation/@name, link/@rel, and responsible-role/@role-id

For /XXX/system-implementation/inventory-item/implemented-component:
- renamed "component-id" to "component-uuid"
n defined allowed values for prop/@name, annotation/@name, and responsible-party/@role-id

For /system-security-plan/control-implementation/implemented-requirements:
- removed "description"

For /system-security-plan/control-implementation/implemented-requirements/by-component:
- renamed "component-id" to "component-uuid"
n added "export", "inherited", and "satisfied" to support documenting leveraged authorizations
n added "remarks" to allow for adding general commentary

For /system-security-plan/control-implementation/implemented-requirements/statements:
- removed "description"

For /system-security-plan/control-implementation/implemented-requirements/statements/by-component:
- renamed "component-id" to "component-uuid"
n added "export", "inherited", and "satisfied" to support documenting leveraged authorizations
n added "remarks" to allow for adding general commentary

    -->

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/oscal-rc1-rc2-update.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:uuid="java:java.util.UUID"
    exclude-result-prefixes="#all"
    version="3.0">

<!-- This XSLT, applied to an XML document valid to the Milestone 3 OSCAL schema version for Catalog, Profile, SSP or Component,
     will produce a similar XML document, valid or closer to valid to the Release Candidate 1 OSCAL schema. -->

    <xsl:output indent="yes"/>

    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:mode name="copy" on-no-match="shallow-copy"/>

    <xsl:variable select="uuid:randomUUID()" name="new-document-uuid"/>
    <xsl:variable select="uuid:randomUUID()" name="new-this-system-component-uuid"/>

    <!-- Grabbing the old UUID or the new UUID if there is no old one. -->
    <xsl:variable name="this-system-component-uuid" select="(/*/system-implementation/component[(@type|@component-type='this-system')]/@uuid,$new-this-system-component-uuid)[1]"/>

    <xsl:template match="/comment()"/>

    <xsl:template match="/*">
        <xsl:comment expand-text="true"> Modified by the OSCAL 1.0.0 RC1 to OSCAL 1.0.0 RC2 conversion XSLT on { current-dateTime() } </xsl:comment>
        <xsl:copy>
            <xsl:apply-templates select="@* except @id"/>
            <xsl:attribute name="uuid" select="$new-document-uuid"/>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="oscal-version">
        <oscal-version>1.0.0-rc2</oscal-version>
    </xsl:template>

    <xsl:template match="last-modified" expand-text="true">
        <last-modified>{ current-dateTime() }</last-modified>
    </xsl:template>

    <xsl:template match="add-objectives-and-methods">
        <objectives-and-methods>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates/>
        </objectives-and-methods>
    </xsl:template>

    <xsl:template match="prop">
        <xsl:copy>
            <xsl:apply-templates select="@ns,@name,@value,(@* except (@ns,@name,@value))"/>
            <xsl:if test="empty(@value)">
                <xsl:attribute name="value">
                    <xsl:apply-templates/>
                </xsl:attribute>
            </xsl:if>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="annotation">
        <prop>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates/>
        </prop>
    </xsl:template>

    <xsl:template match="import/include[exists(all)]" priority="10">
        <xsl:apply-templates/>
    </xsl:template>

    <xsl:template match="import/include">
        <include-controls>
            <!-- any becomes every -->
            <xsl:copy select="child::*/@with-child-controls[.='yes']"/>
            <xsl:apply-templates/>
        </include-controls>
    </xsl:template>

    <xsl:template match="import/exclude">
        <exclude-controls>
            <!-- any becomes every -->
            <xsl:copy select="child::*/@with-child-controls[.='yes']"/>
            <xsl:apply-templates/>
        </exclude-controls>
    </xsl:template>

    <xsl:template match="import/include/call | import/exclude/call">
        <with-id>
            <xsl:apply-templates select="@*"/>
            <xsl:text expand-text="true">{ @control-id }</xsl:text>
        </with-id>
    </xsl:template>

    <xsl:template match="import/include/call/@control-id | import/exclude/call/@control-id"/>

    <xsl:template match="import/include/all/@with-child-controls | import/include/call/@with-child-controls"/>

    <xsl:template match="import/exclude/all/@with-child-controls | import/exclude/call/@with-child-controls"/>

    <xsl:template match="import/include/match | import/exclude/match">
        <matching>
            <xsl:apply-templates select="@*"/>
            <!--<xsl:text expand-text="true">{ @pattern }</xsl:text>-->
        </matching>
    </xsl:template>

    <!-- assumption is made that all inserts are type param given rc1 @param-id -->
    <xsl:template match="insert">
        <insert type="param" id-ref="{ @param-id }">
            <!-- so as not to mess up when already updated -->
            <xsl:apply-templates select="@*"/>
        </insert>
    </xsl:template>

    <xsl:template match="insert/@param-id"/>

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/oscal-rc2-v1-0-0-update.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                xmlns:xs="http://www.w3.org/2001/XMLSchema"
                xmlns="http://csrc.nist.gov/ns/oscal/1.0"
                xmlns:uuid="java:java.util.UUID"
                xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
                exclude-result-prefixes="#all"
                version="3.0">

<!-- This XSLT, applied to an XML document valid to the Milestone 3 OSCAL schema version for Catalog, Profile, SSP or Component,
     will produce a similar XML document, valid or closer to valid to the Release Candidate 1 OSCAL schema. -->
   <xsl:output indent="yes"/>
   
   <xsl:mode on-no-match="shallow-copy"/>
   
   <xsl:mode name="copy" on-no-match="shallow-copy"/>

   <xsl:param name="schema-location" as="xs:string" select="''"/>
   
   <xsl:variable select="uuid:randomUUID()" name="new-document-uuid"/>
   
   <xsl:template match="/comment()"/>
   
   <xsl:template match="/*">
      <xsl:comment expand-text="true"> Modified by the OSCAL 1.0.0 RC2 to OSCAL 1.0.0 conversion XSLT on { current-dateTime() } </xsl:comment>
      <xsl:copy copy-namespaces="no">
         <xsl:apply-templates select="@* except @id"/>
         <xsl:attribute name="uuid" select="$new-document-uuid"/>
         <xsl:choose>
            <xsl:when test="$schema-location => boolean()">
               <xsl:attribute name="xsi:schemaLocation" namespace="http://www.w3.org/2001/XMLSchema-instance" select="$schema-location"/>
            </xsl:when>
            <xsl:otherwise>
               <xsl:message>xsi:schemaLocation not set, parameter schema-location is undefined.</xsl:message>
            </xsl:otherwise>
         </xsl:choose>
         <xsl:apply-templates/>
      </xsl:copy>
   </xsl:template>

   <xsl:template match="@xsi:schemaLocation"/>
   
   <xsl:template match="oscal-version">
      <oscal-version>1.0.0</oscal-version>
   </xsl:template>
   
   <xsl:template match="last-modified" expand-text="true">
      <last-modified>{ current-dateTime() }</last-modified>
   </xsl:template>
   
   <!-- Usage change: we no longer permit spaces in values of select/@how-many -->
   <xsl:template match="select/@how-many" expand-text="true">
        <!-- trims and replaces remaining spaces with hyphens -->
      <xsl:attribute name="how-many" select="normalize-space() ! replace(.,' ','-')"/>
   </xsl:template>
   
   <!-- METASCHEMA MODULE oscal_catalog_metaschema.xml-->
   <!-- Catalog format changes only 'NCName' values to 'token'  -->
   
   <!-- METASCHEMA MODULE oscal_metadata_metaschema.xml-->
   <xsl:template match="back-matter//biblio">
      <xsl:message>'biblio' element is dropped from data in conversion (as it is no longer supported in OSCAL).</xsl:message>
   </xsl:template>
   
   <!-- METASCHEMA MODULE oscal_control-common_metaschema.xml-->
   <!-- only 'NCName' to 'token' -->
   
   <!-- METASCHEMA MODULE oscal_profile_metaschema.xml-->
   <xsl:template match="set-parameter">
      <xsl:copy>
         <xsl:apply-templates select="@*"/>
         <xsl:apply-templates select="prop"/>
         <xsl:apply-templates select="link"/>
         <xsl:apply-templates select="label"/>
         <xsl:apply-templates select="usage"/>
         <xsl:apply-templates select="constraint"/>
         <xsl:apply-templates select="guideline"/>
         <xsl:apply-templates select="value"/>
         <xsl:apply-templates select="select"/>
      </xsl:copy>
   </xsl:template>
   
   <xsl:template match="add/@id-ref | remove/@id-ref">
      <xsl:attribute name="by-id" select="."/>
   </xsl:template>
   
   <xsl:template match="remove/@name-ref">
      <xsl:attribute name="by-name" select="."/>
   </xsl:template>
   
   <xsl:template match="remove/@class-ref">
      <xsl:attribute name="by-class" select="."/>
   </xsl:template>
   
   <xsl:template match="remove/@item-name">
      <xsl:attribute name="by-item-name" select="."/>
   </xsl:template>
   
   <xsl:template match="remove/@ns-ref">
      <xsl:attribute name="by-ns" select="."/>
   </xsl:template>
   
   <!-- METASCHEMA MODULE oscal_ssp_metaschema.xml -->
   <!-- responsible-role was added (back) to statement; many BY_KEY were switched to ARRAY group types-->
   
   <!-- METASCHEMA MODULE oscal_component_metaschema.xml-->
   <!-- order changes: -->
   <xsl:template match="implemented-requirement">
      <xsl:copy>
         <xsl:apply-templates select="@*"/>
         <xsl:apply-templates select="prop"/>
         <xsl:apply-templates select="link"/>
         <xsl:apply-templates select="responsible-role"/>
         <xsl:apply-templates select="set-parameter"/>
         <xsl:apply-templates select="statement"/>
         <xsl:apply-templates select="remarks"/>
      </xsl:copy>
   </xsl:template>
   
   <!-- METASCHEMA MODULE oscal_implementation-common_metaschema.xml-->
   <!-- 'BY_KEY' is now 'ARRAY'; 'NCName' is now 'token' - no syntax change in XML -->
   
   <!-- METASCHEMA MODULE oscal_assessment-plan_metaschema.xml-->
   <!-- 'BY_KEY' is now 'ARRAY' -->
   
   <!-- METASCHEMA MODULE oscal_assessment-results_metaschema.xml-->
   <!-- 'BY_KEY' is now 'ARRAY' -->
   
   <!-- METASCHEMA MODULE oscal_assessment-common_metaschema.xml-->
   <xsl:template match="subject-placeholder">
      <xsl:message>'subject-placeholder' element is dropped from data in conversion (as it is no longer supported in OSCAL).</xsl:message>
   </xsl:template>
   
   <!-- object select-subject-by-id has names in use 'include-subject' and 'exclude-subject'-->
   <xsl:template match="include-subject/@uuid-ref | exclude-subject/@uuid-ref">
      <xsl:attribute name="subject-uuid" select="string(.)"/>
      <!-- ADD THE NEW MANDATORY @type HERE ...
             it may be 'system' or 'this-system' if the subject of the assessment is the system as a whole
             (uuid corresponding to 'this-system' in the imported SSP).
             or if a targeted component or capability, it may be the type of component or capability -->
      <!--<xsl:attribute name="type"> ... literal or calculated value, or ...
              <xsl:apply-templates select="$type-target" mode="type-for-assessment"/>
            </xsl:attribute>-->
      <!-- DROP MESSAGING BY REMOVING OR COMMENTING OUT -->
      <xsl:message expand-text="true">'{name(..)}' type must be defined: please provide a type for
            { name(..) } '{ @uuid-ref }'.</xsl:message>
   </xsl:template>
   
   <!-- METASCHEMA MODULE metaschema/oscal_poam_metaschema.xml-->
   <!-- 'BY_KEY' is now 'ARRAY' -->
</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/oscal-uuid-assign.xpl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<p:declare-step xmlns:p="http://www.w3.org/ns/xproc"
  xmlns:c="http://www.w3.org/ns/xproc-step" version="1.0"
  xmlns:oscal="http://csrc.nist.gov/ns/oscal/1.0"
  type="oscal:resolve-profile" name="oscal-resolve-profile">

  <!-- &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& -->
  <!-- Ports -->

  <p:input port="source" primary="true"/>
  <p:input port="parameters" kind="parameter"/>

  <p:serialization port="a.echo-input" indent="true"/>
  <p:output        port="a.echo-input" primary="false">
    <p:pipe        port="result"       step="input"/>
  </p:output>

  <p:serialization port="b.add-uuids" indent="true"/>
  <p:output        port="b.add-uuids" primary="false">
    <p:pipe        port="result"      step="add-uuids"/>
  </p:output>

  <p:serialization port="c.rewrite-links" indent="true"/>
  <p:output        port="c.rewrite-links" primary="false">
    <p:pipe        port="result"          step="rewrite-links"/>
  </p:output>

  <p:serialization port="f.finish" indent="true"/>
  <p:output        port="f.finish" primary="false">
    <p:pipe        port="result"   step="final"/>
  </p:output>

  <!--
  <opr:transform version="2.0">oscal-profile-resolve-select.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-metadata.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-merge.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-modify.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-finish.xsl</opr:transform>-->


  <!--<p:serialization port="z.final" indent="true" method="xml" omit-xml-declaration="false"/>
  <p:output        port="z.final" primary="true">
    <p:pipe        port="result" step="final"/>
  </p:output>-->

  <!-- &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& -->
  <!-- Pipeline -->

  <p:identity name="input"/>

  <p:xslt name="add-uuids">
    <p:input port="stylesheet">
      <p:document href="add-uuids.xsl"/>
    </p:input>
  </p:xslt>

  <p:xslt name="rewrite-links">
    <p:input port="stylesheet">
      <p:document href="rewrite-links.xsl"/>
    </p:input>
  </p:xslt>



  <!--<p:xslt name="finish">
    <p:input port="stylesheet">
      <p:document href="oscal-profile-resolve-finish.xsl"/>
    </p:input>
  </p:xslt>-->

  <p:identity name="final"/>

</p:declare-step>



================================================
FILE: src/release/content-upgrade/refresh-uuid.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    version="3.0">

<!--
        Run this stylesheet to replace 'uuid' with an actual uuid.
      Wherever there is an id or uuid, a fresh uuid is added. -->

    <xsl:strip-space elements="catalog group control subcontrol part param resource
        metadata back-matter revision annotation location party person org rlink address biblio resource citation role responsible-party
        profile import merge custom group modify include exclude set alter add"/>

    <xsl:output indent="yes"/>

    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:template match="/">
        <xsl:comment expand-text="true"> Modified by conversion XSLT { current-dateTime() } - UUIDs refreshed </xsl:comment>
        <xsl:apply-templates/>
    </xsl:template>

    <!-- Copying and adding uuid -->
    <xsl:template match="@id" xmlns:uuid="java:java.util.UUID">
        <xsl:copy-of select="."/>
        <xsl:call-template name="uuid"/>
    </xsl:template>

    <!-- Fresh uuid -->
    <xsl:template match="*[empty(@id)]/@uuid" name="uuid" xmlns:uuid="java:java.util.UUID">
        <xsl:attribute name="uuid" select="uuid:randomUUID()"/>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/rewrite-links.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    version="3.0">

<!--
        Run this stylesheet to replace 'uuid' with an actual uuid.
      Wherever there is an id or uuid, a fresh uuid is added. -->



    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:template match="/">
        <!--<xsl:comment expand-text="true"> Modified by conversion XSLT { current-dateTime() } - UUIDs refreshed </xsl:comment>-->
        <xsl:apply-templates/>
    </xsl:template>

    <!-- Removing resource/@id -->
    <xsl:template match="resource/@id | party/@id |
        location/@id | party/@id | resource/@id | diagram/@id | user/@id | component/@id | information-type/@id |
        protocol/@id | inventory-item/@id | implemented-requirement/@id | statement/@id | by-component/@id"/>

    <!-- Wherever a link or anchor points to a resource, it will point to its UUID -->

    <xsl:key name="resource-as-internal-link" match="back-matter/resource" use="'#' || @id"/>
    <xsl:key name="party-link"                match="party"                use="@id"/>
    <xsl:key name="location-link"             match="location"             use="@id"/>
    <xsl:key name="component-link"            match="component"            use="@id"/>

    <xsl:template match="
        import[exists(key('resource-as-internal-link',@href))]/@href |
        link[exists(key('resource-as-internal-link',@href))]/@href | a[exists(key('resource-as-internal-link',@href))]/@href">
        <xsl:variable name="target" select="key('resource-as-internal-link',.)"/>
        <xsl:attribute name="href" select="'#' || $target/@uuid"/>
    </xsl:template>

    <xsl:template match="party-uuid" expand-text="true">
        <xsl:variable name="target" select="key('party-link',string(.))"/>
        <party-uuid>{ if (exists($target)) then $target/@uuid else 'no target found' }</party-uuid>
    </xsl:template>

    <xsl:template match="member-of-organization" expand-text="true">
        <xsl:variable name="target" select="key('party-link',string(.))"/>
        <member-of-organization>{ if (exists($target)) then $target/@uuid else 'no target found' }</member-of-organization>
    </xsl:template>

    <xsl:template match="location-uuid" expand-text="true">
        <xsl:variable name="target" select="key('location-link',string(.))"/>
        <location-uuid>{ if (exists($target)) then $target/@uuid else 'no target found' }</location-uuid>
    </xsl:template>

    <xsl:template match="implemented-component | by-component">
        <xsl:variable name="target" select="key('component-link',string(@component-id))"/>
        <xsl:copy>
            <xsl:copy-of select="@* except self::implemented-component/@uuid"/>
            <xsl:attribute name="component-id" select="if (exists($target)) then $target/@uuid else 'no target found'"/>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/uuid/random-util.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math" exclude-result-prefixes="xs math r"
    xmlns:r="http://csrc.nist.gov/ns/random" version="3.0">

    <!-- from the spec https://www.w3.org/TR/xpath-functions-31/#func-random-number-generator

declare %public function r:random-sequence($length as xs:integer) as xs:double* {
  r:random-sequence($length, fn:random-number-generator())
};

declare %private function r:random-sequence($length as xs:integer,
                                            $G as map(xs:string, item())) {
  if ($length eq 0)
  then ()
  else ($G?number, r:random-sequence($length - 1, $G?next()))
};

r:random-sequence(200);

v4 UUID
   hex fields 8 4 4 4 12
     place 13 = 4
     place 17 = 8-b

    -->
    <xsl:output indent="yes"/>

    <!-- set $germ to a string for reproducible outputs of r:make-uuid-sequence
         pass in a blind value - and don't save it - for irreproducible outputs -->

    <xsl:param name="germ" select="current-dateTime() || document-uri(/)"/>

    <!-- for testing random number features   -->
    <xsl:template match="/" name="xsl:initial-template" expand-text="true">
        <!--<uuid><xsl:value-of select="uuid:randomUUID()" xmlns:uuid="java:java.util.UUID"/></uuid>-->
        <randomness>
            <now>{ r:make-uuid(current-dateTime()) }</now>
            <germ>{ r:make-uuid($germ) }</germ>
            <a>{ r:make-uuid('a') }</a>
            <a>{ r:make-uuid('a') }</a>
            <b>{ r:make-uuid('b') }</b>
            <ten>
                <xsl:for-each select="r:make-uuid-sequence($germ, 10)">
                    <uuid>{ . }</uuid>
                </xsl:for-each>
            </ten>
        </randomness>
    </xsl:template>

    <xsl:function name="r:make-uuid-sequence" as="xs:string*">
        <xsl:param name="seed" as="item()"/>
        <xsl:param name="length" as="xs:integer"/>
        <xsl:sequence select="r:produce-uuid-sequence($length,random-number-generator($seed))"/>
    </xsl:function>

    <xsl:function name="r:produce-uuid-sequence" as="xs:string*">
        <xsl:param name="length" as="xs:integer"/>
        <xsl:param name="PRNG" as="map(xs:string, item())"/>
        <xsl:if test="$length gt 0">
            <xsl:sequence select="string($PRNG?number) => r:make-uuid()"/>
            <xsl:sequence select="r:produce-uuid-sequence($length - 1, $PRNG?next())"/>
        </xsl:if>
    </xsl:function>

    <!-- make-uuid produces a UUID for a given seed - the same UUID every time for the same seed -->
    <xsl:function name="r:make-uuid" as="xs:string">
        <xsl:param name="seed" as="item()"/>
        <xsl:sequence select="r:produce-uuid($uuid-v4-template, random-number-generator($seed))"/>
    </xsl:function>

    <!--$template is a string to serve as a template for the UUID syntax
        $PRNG is a pseudo-random-number generator produced by fn:random-number-generator() -->
    <xsl:function name="r:produce-uuid" as="xs:string">
        <xsl:param name="template" as="xs:string"/>
        <xsl:param name="PRNG" as="map(xs:string, item())"/>
        <xsl:value-of>
            <xsl:apply-templates select="substring($template, 1, 1)" mode="uuid-char">
                <xsl:with-param name="PRNG" select="$PRNG"/>
            </xsl:apply-templates>
            <xsl:if test="matches($template, '.')">
                <xsl:sequence select="r:produce-uuid(substring($template, 2), $PRNG?next())"/>
            </xsl:if>
        </xsl:value-of>
    </xsl:function>

    <xsl:variable name="uuid-v4-template" as="xs:string">________-____-4___-=___-____________</xsl:variable>
    <!--                                                 a847eaab-cec8-41bd-98e2-02d02900b554            -->
    <!-- replacements for UUID v4:
           '_' becomes a random hex value 0-9a-f
           '=' becomes one of '8','9','a','b' at random
           any other character is copied -->

    <xsl:variable name="hex-digits" select="tokenize('0 1 2 3 4 5 6 7 8 9 a b c d e f', ' ')"/>

    <xsl:template match=".[. = '_']" mode="uuid-char">
        <xsl:param name="PRNG" as="map(xs:string, item())"/>
        <xsl:sequence select="$PRNG?permute($hex-digits)[1]"/>
    </xsl:template>

    <xsl:template match=".[. = '=']" mode="uuid-char">
        <xsl:param name="PRNG" as="map(xs:string, item())"/>
        <xsl:sequence select="$PRNG?permute(('8', '9', 'a', 'b'))[1]"/>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/uuid/reassign-uuids.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    exclude-result-prefixes="xs math"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    version="3.0">

<!-- reassign uuids:

    build a map from every @uuid (string value) to a new UUID
    rewrite UUIDs and references to them by reference to it

    -->

    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:template match="/">
            <xsl:apply-templates/>
    </xsl:template>

    <xsl:variable name="new-uuids" as="map(xs:string, xs:string)">
        <xsl:map>
            <!-- only contains entries if every @uuid is distinct -->
            <xsl:if test="count(//@uuid) eq count(//@uuid => distinct-values())">
                <xsl:apply-templates mode="make-map" select="//@uuid"/>
            </xsl:if>
        </xsl:map>
    </xsl:variable>

    <xsl:template mode="make-map" match="@uuid" expand-text="true">
        <xsl:map-entry key="string(.)" xmlns:uuid="java:java.util.UUID">{ uuid:randomUUID() }</xsl:map-entry>
    </xsl:template>

    <!-- to drop certain uuids from the map:
      <xsl:template mode="make-map" match="back-matter/resource/@uuid"/>-->

    <!-- scrubbing initial comments -->
    <xsl:template match="/comment()"/>

    <!-- time stamping last-modified date -->
    <xsl:template match="last-modified" priority="2" expand-text="true">
        <last-modified>{ current-dateTime() }</last-modified>
    </xsl:template>

    <!-- adding a new UUID -->
    <xsl:template match="@uuid">
        <xsl:attribute name="uuid" select="$new-uuids(string(.))"/>
    </xsl:template>

   <!-- Match a text-only element or any attribute whose string value
        corresponds to a UUID elsewhere in the (same) document with the corresponding
        entry from the $new-uuids. -->
    <xsl:template match="*[empty(*)][exists($new-uuids(string(.)))] | @*[exists($new-uuids(string(.)))]">
        <xsl:message expand-text="true">UPDATING { name() } POINTING TO { . } WITH { $new-uuids(string(.)) } </xsl:message>
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:value-of select="$new-uuids(string(.))"/>
        </xsl:copy>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/release/content-upgrade/uuid/refresh-uuids.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    exclude-result-prefixes="xs math"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    version="3.0">

<!-- refresh uuids:

    1. Any attribute named 'uuid' gets a new (UUID) value
    2. Any attribute or element whose string value corresponds to an *extant* UUID value
         in the same document, is provided with the same value.
    We do this in two passes, with a @new-uuid flag holding an intermediate value
      (so this filter will break on data with this attribute)
    -->

    <xsl:mode name="modify" on-no-match="shallow-copy"/>
    <xsl:mode name="rewire" on-no-match="shallow-copy"/>

    <xsl:template match="/">
        <xsl:variable name="with-new-uuids">
            <xsl:apply-templates mode="modify"/>
        </xsl:variable>
        <xsl:text>&#xA;</xsl:text>
        <xsl:apply-templates select="$with-new-uuids/*" mode="rewire"/>
    </xsl:template>

    <!-- scrubbing initial comments -->
    <xsl:template match="/comment()" mode="modify"/>

    <!-- time stamping last-modified date -->
    <xsl:template mode="modify" match="last-modified" priority="2" expand-text="true">
        <last-modified>{ current-dateTime() }</last-modified>
    </xsl:template>

    <!-- adding a new UUID -->
    <xsl:template match="@uuid" mode="modify">
        <xsl:copy-of select="."/>
        <xsl:attribute name="new-uuid" select="uuid:randomUUID()" xmlns:uuid="java:java.util.UUID"/>
    </xsl:template>

    <!-- a template like this will keep these UUIDs stable instead of rewriting them -->
    <!--<xsl:template match="back-matter/resource/@uuid" mode="modify">
        <xsl:copy-of select="."/>
    </xsl:template>-->

    <xsl:key name="by-uuid" match="*[exists(@uuid)]" use="@uuid"/>

    <!--Rewiring phase replaces the uuid and rewrites links that address it -->
    <xsl:template mode="rewire" match="@uuid[exists(../@new-uuid)]" priority="2"/>

    <xsl:template mode="rewire" match="@new-uuid" priority="2">
        <xsl:attribute name="uuid" select="."/>
        <xsl:message expand-text="true">UUID { ../@uuid } BECOMES { . } </xsl:message>
    </xsl:template>

    <!-- Match any empty element or any attribute whose string value
     corresponds to a UUID elsewhere in the (same) document with a (new) @new-uuid;
     and update it. -->
    <xsl:template mode="rewire"
        match="*[empty(*)][exists(key('by-uuid',.)/@new-uuid)] |
        @*[exists(key('by-uuid',.)/@new-uuid)]">
        <xsl:variable name="new-uuid" select="key('by-uuid',.)/(@new-uuid)[1]"/>
            <xsl:message expand-text="true">UPDATING { name() } POINTING TO { . } WITH { $new-uuid } </xsl:message>
        <xsl:copy>
            <xsl:apply-templates select="@*" mode="rewire"/>
            <xsl:value-of select="$new-uuid"/>
        </xsl:copy>
    </xsl:template>


</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/readme.md
================================================
# Profile Resolution Specification and Testing

## process notes

- new 'resolution-testing.xml' keeps track of unit tests
- spec is validated against this test manifest
- it can also be converted into XSpec or other test drivers

### Test coverage

Finishing the tests by assigning them to Github Issues?

### Validating the tests (source/target)

need a process for this - also Github Issues?

### Revising the spec

- validate test manifest against its spec - any broken links?




## Providing feedback on this specification

The OSCAL team welcomes feedback on the work in progress in this subdirectory, whether it be questions, points for clarification, critiques or suggestions. A rendered version of the Profile Resolution specification maintained here [appears](https://pages.nist.gov/OSCAL/resources/concepts/processing/profile-resolution/) on the OSCAL web site.

Please post Issues in Github or questions to the OSCAL mailing list, or ask about them on our [Gitter channel](https://gitter.im/usnistgov-OSCAL/Lobby). (See https://pages.nist.gov/OSCAL/contact/ for links.)

The specifications are being edited in an ad-hoc XML back end format, a lightweight extension to HTML tagging. If you wish to edit the files directly, we have stylesheets for presentation and HTML conversion along with Schematron for validation (runtime or at check points); please contact us.

## Profile Resolution Unit Tests

Profile resolution unit tests are maintained here and bound to the specification via markup embedded with the specifications, for convenience in alignment. Formal test scenario files can be generated dynamically from markup when needed.

In this subdirectory, the folder `profile-resolution-examples` includes old tests kept here for potential future use/reuse while we complete a common test set.

The comment test set we are developing can be found in folder `requirement-tests`.

## SpecML Capabilities

- XML authoring of specifications
- HTML previews with ToC / requirements index
- HTML rendering for Hugo / site load
- Back end validation support for specialized semantics
- Tagging of requirements integrates with unit tests
- Cosmetic reformatter rewrites your document with clean tagging and whitespace

- Unit test set (XSpec) is annotated with keys (links) back to spec document
- Two-way indexing enables assessment of coverage by unit tests (per marked up requirements)

- The tests themselves can be illustrated (in/out) using another rendering XSLT

### oXygen project for editing specs

Included in this folder is an oXygen XML Editor project file with settings for many of these operations.

### SpecML requirement tagging

`//req` shows requirements called out as statements in line.

`//eg` shows bindings to example documents for purposes of testing.

```
<eg href="requirement-tests/req-chained-deepA.xml">PENDING chained profiles</eg>
```

The `@href` is the file instance for the example. The text is a qualifying description. Prefixing the text with `PENDING` signals that a test should be deactivated. In this case, as soon as chained profiles are supported, the description can be changed and the test will be run.

Presently all `eg` are inside `req` so there is an implicit relation there (no examples are named apart from stated requirements).

### Unit test scenario generation

Based on markup in the SpecML document, XSpec unit test sheets can be generated framing the unit test held in this subdirectory, to be executed in any (current) XSpec implementation.

#### Requirements listing

Broken out by requirement - corresponding line by line to //req in the Spec document source.
This XSpec is generated by applying the XSLT `lib/build-reqs-xspec.xsl` to the SpecML source document (marked with `req` and `eg` tags).

#### File listing

Grouped by file instead of by requirement (since there is a many-to-many relation), this XSpec may be faster and more efficient to execute.

This XSpec is generated by applying the XSLT `lib/build-examples-xspec.xsl` to the same SpecML source document.

#### Handmade XSpec

Additionally handmade XSpec works, such as `profile-resolution-queryset.xspec`




================================================
FILE: src/specifications/profile-resolution/example-checkup.sch
================================================
<?xml version="1.0" encoding="UTF-8"?>
<sch:schema xmlns:sch="http://purl.oclc.org/dsdl/schematron" queryBinding="xslt2"
    xmlns:sqf="http://www.schematron-quickfix.com/validator/process"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:uuid="java:java.util.UUID">

    <sch:ns prefix="oscal" uri="http://csrc.nist.gov/ns/oscal/1.0"/>
    <sch:ns prefix="uuid"  uri="java:java.util.UUID"/>

    <xsl:key name="elements-by-id" match="*[exists(@id)]" use="@id"/>

<!-- For validating catalogs and profiles against constraints not checked by their schemas, to help ensure test viability   -->
    <sch:pattern>
        <sch:rule context="oscal:profile | oscal:catalog">
            <sch:assert test="matches(@uuid,'\S')"
                sqf:fix="add-uuid"><sch:name/> is missing uuid</sch:assert>
            <!--<sch:let name="presumed-id" value="replace(document-uri(/),'^.*/','') ! replace(.,'\.[^\.]*$','')"/>
            <sch:assert test="@id = $presumed-id">Document @id is not aligned with the file name: expecting <sch:value-of select="$presumed-id"/>
            </sch:assert>-->
        </sch:rule>

        <sch:rule context="oscal:control | oscal:group | oscal:param">
            <sch:assert test="empty(@id) or count(key('elements-by-id',@id)) = 1">Duplicate @id appears</sch:assert>
        </sch:rule>

        <sch:rule context="oscal:import">
            <sch:assert test="starts-with(@href,'#') or exists(document(@href,/)/*)">No document is found at import @href target
                <sch:value-of select="@href"/>.</sch:assert>
        </sch:rule>
        <sch:rule context="oscal:resource/oscal:rlink">
            <sch:assert test="matches(@href,'^https?:/') or exists(document(@href,/)/*)">No document is found at rlink @href target
                <sch:value-of select="@href"/>.</sch:assert>
        </sch:rule>
    </sch:pattern>

    <sch:pattern>
        <sch:rule context="oscal:last-modified">
            <sch:assert test=". castable as xs:dateTime"
                sqf:fix="datestamp-file"><sch:name/> not a dateTime (argh)</sch:assert>
            <!--<sch:assert role="warning" test="(current-dateTime() - xs:dateTime(.)) &lt; xs:dayTimeDuration('P1D')"
                sqf:fix="datestamp-file"><sch:name/> date stamp is more than a day old</sch:assert>-->

        </sch:rule>
    </sch:pattern>

    <sqf:fixes>
        <sqf:fix id="add-uuid">
            <sqf:description>
                <sqf:title>Refresh uuid with UUID</sqf:title>
            </sqf:description>
            <!--<sqf:add node-type="attribute" target="uuid" select="uuid:randomUUID()"/>-->
        </sqf:fix>
        <sqf:fix id="datestamp-file">
            <sqf:description>
                <sqf:title>Stamp date-time</sqf:title>
            </sqf:description>
            <!--<sqf:replace match="o:last-modified" target="o:last-modified" node-type="element" select="current-dateTime()"/>-->
            <sqf:stringReplace match="text()" regex="^.*$">
                <sch:value-of select="current-dateTime()"/>
            </sqf:stringReplace>
        </sqf:fix>
    </sqf:fixes>
</sch:schema>



================================================
FILE: src/specifications/profile-resolution/example-set.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<!-- autogenerated 2021-12-14T16:02:57.305-05:00 following model in example-set.xspec-->
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
               xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
               xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
               stylesheet="../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
               run-as="external"
               xmlns:ov="http://csrc.nist.gov/ns/oscal/test/variable">
   <x:helper stylesheet="lib/oscal-profile-test-helper.xsl"/>
   <!-- old tests are out of whack need update to current functionality /spec  -->
   <!-- but the XSpec provides a functional model -->
   <x:scenario label="Base test">
      <!-- Alternative model for test scrubbing both the result and the expected
           result for comparison -->
      <x:context href="profile-resolution-examples/base-test_profile.xml"/>
      <x:variable name="ov:expected-output"
         href="profile-resolution-examples/output-expected/base-test_profile_RESOLVED.xml"/>
      <x:expect label="Base test - fully resolved"
         test="opr:scrub($x:result)" select="opr:scrub($ov:expected-output)"/>
   </x:scenario>
   
   <x:scenario label="Testing base-test_profile.xml">
      
      <x:context href="profile-resolution-examples/base-test_profile.xml"/>
      <x:expect label="Resolution of base-test_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/base-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing base2-test_profile.xml">
      <x:context href="profile-resolution-examples/base2-test_profile.xml"/>
      <x:expect label="Resolution of base2-test_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/base2-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing broken_profile.xml" pending="galtm">
      <x:context href="profile-resolution-examples/broken_profile.xml"/>
      <x:expect label="Resolution of broken_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/broken_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing circular_profile.xml">
      <x:context href="profile-resolution-examples/circular_profile.xml"/>
      <x:expect label="Resolution of circular_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/circular_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing exclude-call-test_profile.xml">
      <x:context href="profile-resolution-examples/exclude-call-test_profile.xml"/>
      <x:expect label="Resolution of exclude-call-test_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/exclude-call-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing full-test_profile.xml">
      <x:context href="profile-resolution-examples/full-test_profile.xml"/>
      <x:expect label="Resolution of full-test_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/full-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing home_profile.xml">
      <x:context href="profile-resolution-examples/home_profile.xml"/>
      <x:expect label="Resolution of home_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/home_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing import-twice_profile.xml">
      <x:context href="profile-resolution-examples/import-twice_profile.xml"/>
      <x:expect label="Resolution of import-twice_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/import-twice_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing include-all-no-children-test_profile.xml">
      <x:context href="profile-resolution-examples/include-all-no-children-test_profile.xml"/>
      <x:expect label="Resolution of include-all-no-children-test_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/include-all-no-children-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing include-all-test_profile.xml">
      <x:context href="profile-resolution-examples/include-all-test_profile.xml"/>
      <x:expect label="Resolution of include-all-test_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/include-all-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing include-call-with-children-test_profile.xml">
      <x:context href="profile-resolution-examples/include-call-with-children-test_profile.xml"/>
      <x:expect label="Resolution of include-call-with-children-test_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/include-call-with-children-test_profile_RESOLVED.xml"/>
      <x:expect label="Includes grandparent in result" test="$x:result//o:control/@id = 'c3'"/>
      <x:expect label="Includes grandchild in result"  test="$x:result//o:control/@id = 'c3.a-1'"/>
      <x:expect label="Is missing a control not included"   test="not( $x:result//o:control/@id = 'c2' )"/>
   </x:scenario>
   <x:scenario label="Testing include-loose-param-test_profile.xml">
      <x:context href="profile-resolution-examples/include-loose-param-test_profile.xml"/>
      <x:expect label="Resolution of include-loose-param-test_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/include-loose-param-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing include-match-test_profile.xml">
      <x:context href="profile-resolution-examples/include-match-test_profile.xml"/>
      <x:expect label="Resolution of include-match-test_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/include-match-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing merge-implicit-keep_profile.xml">
      <x:context href="profile-resolution-examples/merge-implicit-keep_profile.xml"/>
      <x:expect label="Resolution of merge-implicit-keep_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/merge-implicit-keep_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing merge-keep-resources_profile.xml">
      <x:context href="profile-resolution-examples/merge-keep-resources_profile.xml"/>
      <x:expect label="Resolution of merge-keep-resources_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/merge-keep-resources_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing merge-keep_profile.xml">
      <x:context href="profile-resolution-examples/merge-keep_profile.xml"/>
      <x:expect label="Resolution of merge-keep_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/merge-keep_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing modify-adds_profile.xml">
      <x:context href="profile-resolution-examples/modify-adds_profile.xml"/>
      <x:expect label="Resolution of modify-adds_profile.xml"
                select="opr:scrub(.)"
                href="profile-resolution-examples/output-expected/modify-adds_profile_RESOLVED.xml"/>
   </x:scenario>
</x:description>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-queryset.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<!-- autogenerated 2022-02-15T16:32:41.750817-05:00 following model in example-set.xspec-->
<?xml-model href="lib/xspec-test-dev.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-stylesheet type="text/css" href="lib/xspec-oxygen.css"?>
<?specification profile-resolution-specml-102-plus.xml?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
   xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
   xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
   xmlns:xs="http://www.w3.org/2001/XMLSchema"
   stylesheet="../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
   run-as="external">
   <x:helper stylesheet="lib/oscal-profile-test-helper.xsl"/>

   <x:scenario label=" ... ">
      <?requirement req-include-all ?>
      <x:context href="requirement-tests/req-spoofing-resource.xml"/>
      <!--<x:expect label="Error showing retrieval failure" select="opr:scrub(.)"
         href="requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml"/>-->
      <!--Base URI for resolving a relative URI from a resource corresponds to the document URI of the containing profile-->
      <x:expect label="As the base URI of the resource does not match document URI of containing profile (in the spoofing scenario) we should get an error not a successful resolution" href="requirement-tests/output-expected/req-spoofing-dropped-UNRESOLVED.xml"/>
<!-- nb we need to test      -->
   </x:scenario>
   
   <x:scenario label=" ... ">
      <?requirement req-resolve-profile ?>
      <x:context href="requirement-tests/req-chained-deepA.xml"/>
      <x:expect label="A (chained) profile resolution merged with a catalog" select="opr:scrub(.)"
         href="requirement-tests/output-expected/req-chained-deepA_RESOLVED.xml"/>
   </x:scenario>
   
</x:description>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-specml-files.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<!-- autogenerated 2022-04-19T13:32:10.4758398-04:00 following model in example-set.xspec-->
<?xml-model href="lib/xspec-test-dev.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-stylesheet type="text/css" href="lib/xspec-oxygen.css"?>
<?specification profile-resolution-specml-102plus.xml?>
<x:description xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
               xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
               xmlns:x="http://www.jenitennison.com/xslt/xspec"
               xmlns:xs="http://www.w3.org/2001/XMLSchema"
               stylesheet="../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
               run-as="external">
   <x:helper stylesheet="lib/oscal-profile-test-helper.xsl"/>
   <x:scenario label="requirement-tests/req-include-all-asis.xml">
      <x:context href="requirement-tests/req-include-all-asis.xml"/>
      <x:scenario label="6.1.1 Import URI Resolution | Tools MUST resolve URIs by following Section 5 of RFC3986, with the exception of URI Fragments (URIs that start with &#34;#&#34;). URI Fragments MUST instead be resolved as defined in [Section internalref]."><?requirement req-uri-resolve ?>
         <x:expect label="Resolution of req-include-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="6.1.2 Import Resource Acquisition | URI base corresponds to document URIFor the purposes of resolving URIs using the above specification, the Base URI MUST be considered to be the absolute URI of the containing profile."><?requirement req-uri-base ?>
         <x:expect label="Resolution of req-include-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="6.2.1 include-all | When an import provides the include-all directive, ALL controls and groups in the referenced document (including nested controls) MUST be included."><?requirement req-include-all ?>
         <x:expect label="Resolution of req-include-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="requirement-tests/req-import-by-resource.xml">
      <x:context href="requirement-tests/req-import-by-resource.xml"/>
      <x:scenario label="6.1.2 Import Resource Acquisition | Tools MUST acquire resources at the resolved URI by following Section 5 of RFC3986, with the exception of URI Fragments (URIs that start with &#34;#&#34;). URI Fragments MUST instead be acquired as defined in [Section internalref]."><?requirement req-uri-aquire ?>
         <x:expect label="Resolution of req-import-by-resource.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-import-by-resource_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="6.1.3 Internal References | In the context of the Import Phase, internal references will only appear as a reference to a profile or catalog that is in the resources section of the source. When tools encounter such a reference, they MUST locate the object in resources with the matching UUID value, and resolve the resource. By OSCAL model requirements, a given resource can have zero to many rlink objects and zero to one base64 objects; however, it must have at least one of the two present. Tools can assume that any of these each resolves to the same underlying OSCAL object, although potentially in different serialization formats. For deterministic resolution of these backmatter OSCAL objects, tools need to adhere to the following requirements:"><?requirement req-internal ?>
         <x:expect label="Resolution of req-import-by-resource.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-import-by-resource_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="requirement-tests/req-missing-resource.xml">
      <x:context href="requirement-tests/req-missing-resource.xml"/>
      <x:scenario label="6.1.2 Import Resource Acquisition | In the case that acquiring a resource fails, the tool MUST cease processing and provide an error. In order to ensure profile resolution results in the same catalog regardless of which tool resolves it, all imports must successfully resolve. While this may cause inconvenience if resources are frequently not available, it ensures interoperability."
                  pending="[spec]"><?requirement req-uri-error ?>
         <x:expect label="Resolution of req-missing-resource.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-missing-resource_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="6.1.3 Internal References | If the object fetched cannot be found or is not a valid OSCAL object, the tool MUST cease processing and provide an error."
                  pending="[spec]"><?requirement req-internal-error ?>
         <x:expect label="Resolution of req-missing-resource.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-missing-resource_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="requirement-tests/req-broken-import.xml">
      <x:context href="requirement-tests/req-broken-import.xml"/>
      <x:scenario label="6.1.3 Internal References | If the object fetched cannot be found or is not a valid OSCAL object, the tool MUST cease processing and provide an error."
                  pending="[spec]"><?requirement req-internal-error ?>
         <x:expect label="Resolution of req-broken-import.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-broken-import_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="requirement-tests/req-chained-all-asis.xml">
      <x:context href="requirement-tests/req-chained-all-asis.xml"/>
      <x:scenario label="6.1.4 Resolving Imports of Profiles | If the resource acquired is an OSCAL Profile, the tool MUST apply this specification to resolve it, then continue processing having imported the resulting catalog."><?requirement req-circular-resolve ?>
         <x:expect label="Resolution of req-chained-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-chained-all-asis_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="6.1.4 Resolving Imports of Profiles | When a profile imports a profile, the subordinate profile SHOULD be resolved first into a catalog using this specification, before it is imported."><?requirement req-circular-catalog ?>
         <x:expect label="Resolution of req-chained-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-chained-all-asis_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="requirement-tests/req-circular_import.xml">
      <x:context href="requirement-tests/req-circular_import.xml"/>
      <x:scenario label="6.1.4 Resolving Imports of Profiles | If a processor encounters a circular import as described above (self-imports are inherently circular), the processor MUST cease processing and generate an error."><?requirement req-circular-error ?>
         <x:expect label="Resolution of req-circular_import.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-circular_import_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="requirement-tests/req-include-all-flat.xml">
      <x:context href="requirement-tests/req-include-all-flat.xml"/>
      <x:scenario label="6.2.1 include-all | When an import provides the include-all directive, ALL controls and groups in the referenced document (including nested controls) MUST be included."><?requirement req-include-all ?>
         <x:expect label="Resolution of req-include-all-flat.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-flat_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="7.2.1 No Structuring Directive | If no merge directive is given in the profile, or if a merge is given without a structuring directive, structuring the output MUST be treated as if the structuring directive flat was given. For example, a profile with no merge directive:"><?requirement req-structure-none ?>
         <x:expect label="Resolution of req-include-all-flat.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-flat_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
</x:description>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-specml-requirements.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<!-- autogenerated 2022-04-26T17:20:58.3482225-04:00 following model in example-set.xspec-->
<?xml-model href="lib/xspec-test-dev.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-stylesheet type="text/css" href="lib/xspec-oxygen.css"?>
<?specification profile-resolution-specml-102plus.xml?>
<x:description xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
               xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
               xmlns:x="http://www.jenitennison.com/xslt/xspec"
               xmlns:xs="http://www.w3.org/2001/XMLSchema"
               stylesheet="../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
               run-as="external">
   <x:helper stylesheet="lib/oscal-profile-test-helper.xsl"/>
   <x:scenario label="5 Phases of Profile Processing | It is strongly RECOMMENDED that implementations execute the following steps in the order that they are provided here (import, merge, modify)."
               pending="[dev]">
      <x:scenario label="Example TBD - PENDING test design" pending="test design"/>
   </x:scenario>
   <x:scenario label="6.1.1 Import URI Resolution | Tools MUST resolve URIs by following Section 5 of RFC3986, with the exception of URI Fragments (URIs that start with &#34;#&#34;). URI Fragments MUST instead be resolved as defined in [Section internalref].">
      <x:scenario label="Example req-include-all-asis.xml - relative URI"><?requirement req-uri-resolve ?>
         <x:context href="requirement-tests/req-include-all-asis.xml"/>
         <x:expect label="Resolution of req-include-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.2 Import Resource Acquisition | Tools MUST acquire resources at the resolved URI by following Section 5 of RFC3986, with the exception of URI Fragments (URIs that start with &#34;#&#34;). URI Fragments MUST instead be acquired as defined in [Section internalref].">
      <x:scenario label="Example req-import-by-resource.xml - via internal reference to&#xA;              resource/rlink"><?requirement req-uri-aquire ?>
         <x:context href="requirement-tests/req-import-by-resource.xml"/>
         <x:expect label="Resolution of req-import-by-resource.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-import-by-resource_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.2 Import Resource Acquisition | For the purposes of resolving URIs using the above specification, the Base URI MUST be considered to be the absolute URI of the containing profile.">
      <x:scenario label="Example req-include-all-asis.xml - URI base corresponds to document URI"><?requirement req-uri-base ?>
         <x:context href="requirement-tests/req-include-all-asis.xml"/>
         <x:expect label="Resolution of req-include-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.2 Import Resource Acquisition | In the case that acquiring a resource fails, the tool MUST cease processing and provide an error. In order to ensure profile resolution results in the same catalog regardless of which tool resolves it, all imports must successfully resolve. While this may cause inconvenience if resources are frequently not available, it ensures interoperability.">
      <x:scenario label="Example req-missing-resource.xml - PENDING rebase over latest from galtm missing resource"
                  pending="rebase over latest from galtm missing resource"><?requirement req-uri-error ?>
         <x:context href="requirement-tests/req-missing-resource.xml"/>
         <x:expect label="Resolution of req-missing-resource.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-missing-resource_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.3 Internal References | In the context of the Import Phase, internal references will only appear as a reference to a profile or catalog that is in the resources section of the source. When tools encounter such a reference, they MUST locate the object in resources with the matching UUID value, and resolve the resource. By OSCAL model requirements, a given resource can have zero to many rlink objects and zero to one base64 objects; however, it must have at least one of the two present. Tools can assume that any of these each resolves to the same underlying OSCAL object, although potentially in different serialization formats. For deterministic resolution of these backmatter OSCAL objects, tools need to adhere to the following requirements:">
      <x:scenario label="Example req-import-by-resource.xml - "><?requirement req-internal ?>
         <x:context href="requirement-tests/req-import-by-resource.xml"/>
         <x:expect label="Resolution of req-import-by-resource.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-import-by-resource_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.3 Internal References | Tools MAY use any of the rlink or base64 objects present in the resource."
               pending="[dev]">
      <x:scenario label="Example TBD - PENDING test design (support for either/both base64&#xA;                  and rlink)"
                  pending="test design (support for either/both base64&#xA;                  and rlink)"/>
   </x:scenario>
   <x:scenario label="6.1.3 Internal References | Tools MAY verify that each above objects resolves to the same underlying OSCAL object. If there are OSCAL Model content differences between the resolved objects, the tool SHOULD provide a warning."
               pending="[dev]">
      <x:scenario label="Example TBD - PENDING test design (correspondence of base64 and&#xA;                  rlink-nominated objects)"
                  pending="test design (correspondence of base64 and&#xA;                  rlink-nominated objects)"/>
   </x:scenario>
   <x:scenario label="6.1.3 Internal References | When a rlink is encountered and is to be resolved, it MUST be resolved by using a HTTP request to retrieve a byte stream."
               pending="[dev]">
      <x:scenario label="Example TBD - PENDING test design (retrieval)"
                  pending="test design (retrieval)"/>
   </x:scenario>
   <x:scenario label="6.1.3 Internal References | When a base64 is encountered and is to be resolved, it MUST be considered a Byte Stream."
               pending="[dev]">
      <x:scenario label="Example TBD - PENDING test design (base64 integrity)"
                  pending="test design (base64 integrity)"/>
   </x:scenario>
   <x:scenario label="6.1.3 Internal References | Regardless of its source, the Byte Stream MUST be decoded based on the algorithm defined in Section 4 RFC 4648."
               pending="[dev]">
      <x:scenario label="Example TBD - PENDING test design (base64&#xA;                integrity)"
                  pending="test design (base64&#xA;                integrity)"/>
   </x:scenario>
   <x:scenario label="6.1.3 Internal References | If the object fetched cannot be found or is not a valid OSCAL object, the tool MUST cease processing and provide an error.">
      <x:scenario label="Example req-missing-resource.xml - PENDING rebase over latest from galtm"
                  pending="rebase over latest from galtm"><?requirement req-internal-error ?>
         <x:context href="requirement-tests/req-missing-resource.xml"/>
         <x:expect label="Resolution of req-missing-resource.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-missing-resource_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="Example req-broken-import.xml - PENDING rebase over latest from galtm"
                  pending="rebase over latest from galtm"><?requirement req-internal-error ?>
         <x:context href="requirement-tests/req-broken-import.xml"/>
         <x:expect label="Resolution of req-broken-import.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-broken-import_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.4 Resolving Imports of Profiles | If the resource acquired is an OSCAL Profile, the tool MUST apply this specification to resolve it, then continue processing having imported the resulting catalog.">
      <x:scenario label="Example req-chained-all-asis.xml - PENDING chained profiles"
                  pending="chained profiles"><?requirement req-circular-resolve ?>
         <x:context href="requirement-tests/req-chained-all-asis.xml"/>
         <x:expect label="Resolution of req-chained-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-chained-all-asis_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.4 Resolving Imports of Profiles | When a profile imports a profile, the subordinate profile SHOULD be resolved first into a catalog using this specification, before it is imported.">
      <x:scenario label="Example req-chained-all-asis.xml - PENDING chained profiles"
                  pending="chained profiles"><?requirement req-resolve-profile ?>
         <x:context href="requirement-tests/req-chained-all-asis.xml"/>
         <x:expect label="Resolution of req-chained-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-chained-all-asis_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="Example req-chained-deepA.xml - PENDING [bug repair] chained profile&#xA;              merged with controls from its own source catalog"
                  pending="[bug repair] chained profile&#xA;              merged with controls from its own source catalog"><?requirement req-resolve-profile ?>
         <x:context href="requirement-tests/req-chained-deepA.xml"/>
         <x:expect label="Resolution of req-chained-deepA.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-chained-deepA_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.4 Resolving Imports of Profiles | If a processor encounters a circular import as described above (self-imports are inherently circular), the processor MUST cease processing and generate an error.">
      <x:scenario label="Example req-circular_import.xml - PENDING circular import detection"
                  pending="circular import detection"><?requirement req-circular-error ?>
         <x:context href="requirement-tests/req-circular_import.xml"/>
         <x:expect label="Resolution of req-circular_import.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-circular_import_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.5 Multiple imports | Note that this occurs even if the same catalog is imported multiple times: each distinct import collects controls into a separate selection">
      <x:scenario label="Example req-chained-deepA.xml - PENDING&#xA;              chained profiles"
                  pending="chained profiles"><?requirement rq-multiple-imports ?>
         <x:context href="requirement-tests/req-chained-deepA.xml"/>
         <x:expect label="Resolution of req-chained-deepA.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-chained-deepA_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.1.5 Multiple imports | The control inclusions are combined and collapsed in the next phase of processing">
      <x:scenario label="Example req-chained-deepA.xml - PENDING&#xA;              chained profiles"
                  pending="chained profiles"><?requirement rq-multiple-merge ?>
         <x:context href="requirement-tests/req-chained-deepA.xml"/>
         <x:expect label="Resolution of req-chained-deepA.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-chained-deepA_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.1 include-all | When an import provides the include-all directive, ALL controls and groups in the referenced document (including nested controls) MUST be included.">
      <x:scenario label="Example req-include-all-asis.xml - "><?requirement req-include-all ?>
         <x:context href="requirement-tests/req-include-all-asis.xml"/>
         <x:expect label="Resolution of req-include-all-asis.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="Example req-include-all-flat.xml - "><?requirement req-include-all ?>
         <x:context href="requirement-tests/req-include-all-flat.xml"/>
         <x:expect label="Resolution of req-include-all-flat.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-flat_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.2 include-controls plus with-id | When an import provides the include-controls directive, with a with-id child, all controls in the referenced document whose id match one of the listed id values MUST be included.">
      <x:scenario label="Example req-include-by-id.xml - "><?requirement req-include-by-id ?>
         <x:context href="requirement-tests/req-include-by-id.xml"/>
         <x:expect label="Resolution of req-include-by-id.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-by-id_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.3 include-controls plus matching | When an import provides the include-controls directive, with a matching child, all controls in the referenced document whose id matches one of the listed pattern values (Glob matching) MUST be included.">
      <x:scenario label="Example req-include-by-match.xml - "><?requirement req-include-by-match ?>
         <x:context href="requirement-tests/req-include-by-match.xml"/>
         <x:expect label="Resolution of req-include-by-match.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-by-match_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.3 include-controls plus matching | If a matching object is provided with no pattern, it MUST be treated as matching nothing. While not providing a pattern is technically valid, resolution tool implementers should be aware that it is generally undesirable, and warnings or notices to the user may be appropriate.">
      <x:scenario label="Example req-include-by-match-empty.xml - "><?requirement req-include-by-match-empty ?>
         <x:context href="requirement-tests/req-include-by-match-empty.xml"/>
         <x:expect label="Resolution of req-include-by-match-empty.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-by-match-empty_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.4.1 with-child-controls | A with-child-controls: yes directive on an include-controls indicates that all descendant controls of the included control MUST also be included.">
      <x:scenario label="Example req-include-by-id.xml - "><?requirement req-with-child-controls-yes ?>
         <x:context href="requirement-tests/req-include-by-id.xml"/>
         <x:expect label="Resolution of req-include-by-id.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-by-id_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.4.1 with-child-controls | A with-child-controls: no directive on an include-controls indicates that ONLY the matching control is included, any descendant children MUST NOT be included.">
      <x:scenario label="Example req-with-child-controls-no.xml - "><?requirement req-with-child-controls-no ?>
         <x:context href="requirement-tests/req-with-child-controls-no.xml"/>
         <x:expect label="Resolution of req-with-child-controls-no.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-with-child-controls-no_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.4.1 with-child-controls | If no with-child-controls is provided, the processor MUST consider the directive as being equivalent to one having with-child-controls:no.">
      <x:scenario label="Example req-with-child-controls-none.xml - "><?requirement req-with-child-controls-none ?>
         <x:context href="requirement-tests/req-with-child-controls-none.xml"/>
         <x:expect label="Resolution of req-with-child-controls-none.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-with-child-controls-none_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.4.2 with-parent-controls | A with-parent-controls: yes directive on an include-controls indicates that all parent controls of the included control MUST also be included.">
      <x:scenario label="Example req-with-parent-controls-yes1.xml - PR&#xA;                https://github.com/usnistgov/OSCAL/pull/1207"><?requirement req-with-parent-controls-yes ?>
         <x:context href="requirement-tests/req-with-parent-controls-yes1.xml"/>
         <x:expect label="Resolution of req-with-parent-controls-yes1.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-with-parent-controls-yes1_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="Example req-with-parent-controls-yes2.xml - PR&#xA;                https://github.com/usnistgov/OSCAL/pull/1207"><?requirement req-with-parent-controls-yes ?>
         <x:context href="requirement-tests/req-with-parent-controls-yes2.xml"/>
         <x:expect label="Resolution of req-with-parent-controls-yes2.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-with-parent-controls-yes2_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.4.2 with-parent-controls | A with-parent-controls: no directive on an include-controls indicates that ONLY the matching control is included, any parent MUST NOT be included.">
      <x:scenario label="Example req-with-parent-controls-no1.xml - PENDING PR&#xA;                https://github.com/usnistgov/OSCAL/pull/1207"
                  pending="PR&#xA;                https://github.com/usnistgov/OSCAL/pull/1207"><?requirement req-with-parent-controls-no ?>
         <x:context href="requirement-tests/req-with-parent-controls-no1.xml"/>
         <x:expect label="Resolution of req-with-parent-controls-no1.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-with-parent-controls-no1_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.4.2 with-parent-controls | If no with-parent-controls is provided, the processor MUST consider the directive as being equivalent to one having with-parent-controls:yes."
               pending="[dev]">
      <x:scenario label="Example TBD - PENDING PR&#xA;                https://github.com/usnistgov/OSCAL/pull/1207"
                  pending="PR&#xA;                https://github.com/usnistgov/OSCAL/pull/1207"/>
   </x:scenario>
   <x:scenario label="6.2.5 exclude-controls | Any control designated to be both included and excluded, MUST be excluded. This holds irrespective of the specificity of the selection for inclusion or exclusion.">
      <x:scenario label="Example req-include-exclude1.xml - "><?requirement req-exclude ?>
         <x:context href="requirement-tests/req-include-exclude1.xml"/>
         <x:expect label="Resolution of req-include-exclude1.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-exclude1_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="Example req-include-exclude2.xml - "><?requirement req-exclude ?>
         <x:context href="requirement-tests/req-include-exclude2.xml"/>
         <x:expect label="Resolution of req-include-exclude2.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-exclude2_RESOLVED.xml"/>
      </x:scenario>
      <x:scenario label="Example req-include-exclude3.xml - "><?requirement req-exclude ?>
         <x:context href="requirement-tests/req-include-exclude3.xml"/>
         <x:expect label="Resolution of req-include-exclude3.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-exclude3_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.5 exclude-controls | When exclude-controls has at least one with-ids or matching directive, the processor MUST follow the same rules as defined in the relevant sections above for these directives, but exclude instead of include any controls. All optional features (with-child-controls, etc.) also apply to exclusion directives.">
      <x:scenario label="Example req-include-exclude4.xml - "><?requirement req-exclude-additional ?>
         <x:context href="requirement-tests/req-include-exclude4.xml"/>
         <x:expect label="Resolution of req-include-exclude4.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-exclude4_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.6 Redundant Inclusions and Exclusions | A given import may have any number of inclusion statements and any number of exclusion statements. Their effect is cumulative; any control that is included (or excluded) more than once MUST be considered to be included (or excluded) only once. In other words, a given control being included or excluded more than once has no effect. Exclusion still takes priority over inclusion (see above).">
      <x:scenario label="Example req-include-exclude4.xml - "><?requirement req-redundant ?>
         <x:context href="requirement-tests/req-include-exclude4.xml"/>
         <x:expect label="Resolution of req-include-exclude4.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-exclude4_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="6.2.7 Handling Params | All loose params from both imported documents and the profile source MUST be included. These params will be kept in the final output if the document contains any references to them, and discarded otherwise. See [Section cleanup]."
               pending="[dev]"/>
   <x:scenario label="7 Merge Phase | It is RECOMMENDED that tools apply the &#34;combine&#34; directive to the intermediate generated by the Import phase first, then apply the &#34;structuring&#34; directive."
               pending="[dev]">
      <x:scenario label="Example TBD - PENDING is this testable?"
                  pending="is this testable?"/>
   </x:scenario>
   <x:scenario label="7.1 The &#34;combine&#34; Directive | Note that &#34;merge: combine&#34; is deprecated, and MUST be considered undefined behavior when encountered."
               pending="[dev]">
      <x:scenario label="Example TBD - PENDING specification" pending="specification"/>
   </x:scenario>
   <x:scenario label="7.1.1 No Combine Directive | If no merge directive is given in the profile, or if a merge is given without a combine, merge conflicts MUST be treated as if method: keep was given.">
      <x:scenario label="Example keep-everything-twice.xml - "><?requirement req-merge-none ?>
         <x:context href="requirement-tests/keep-everything-twice.xml"/>
         <x:expect label="Resolution of keep-everything-twice.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/keep-everything-twice_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="7.1.2 method:keep | When a merge is indicated by method:keep, or when no merge directive is given, the keepcombination rule is used. Any control with the same distinctive ID [Section id]MUST NOT not merged. (They are kept.)"
               pending="[dev]"/>
   <x:scenario label="7.1.2 method:keep | Processors SHOULD provide a warning under the merge:keep directive when duplicate controls are detected."
               pending="[dev]"/>
   <x:scenario label="7.1.2 method:keep | The processor MAY throw an error and cease processing (short-circuiting a certain future error) when duplicate controls are detected under the merge:keep directive."
               pending="[dev]"/>
   <x:scenario label="7.1.3 method:use-first | When the &#34;use-first&#34;combination rule is applied, and controls that share a distinctive ID are found, the first control encountered MUST be kept, the rest MUST be discarded. &#34;First&#34; MUST be determined by a top-down, depth-first traversal of the source profile's import hierarchy."
               pending="[dev]"/>
   <x:scenario label="7.2 The &#34;structuring&#34; Directive | Optionally, one of three &#34;structuring&#34; directives can be included as a child of merge: flat, as-isand custom. When one of these appears, it is the selected structuring directive. If more than one appears, processors MUST generate an error and cease processing."
               pending="[dev]"/>
   <x:scenario label="7.2.1 No Structuring Directive | If no merge directive is given in the profile, or if a merge is given without a structuring directive, structuring the output MUST be treated as if the structuring directive flat was given. For example, a profile with no merge directive:">
      <x:scenario label="Example req-include-all-flat.xml - "><?requirement req-structure-none ?>
         <x:context href="requirement-tests/req-include-all-flat.xml"/>
         <x:expect label="Resolution of req-include-all-flat.xml"
                   select="opr:scrub(.)"
                   href="requirement-tests/output-expected/req-include-all-flat_RESOLVED.xml"/>
      </x:scenario>
   </x:scenario>
   <x:scenario label="7.2.2 &#34;flat&#34; | Profiles with the &#34;flat&#34; merge directive MUST be resolved as unstructured catalogs, with no grouping or nesting of controls."
               pending="[dev]"/>
   <x:scenario label="7.2.2 &#34;flat&#34; | Unstructured catalog output MUST be produced by adhering to the following requirements:"
               pending="[dev]"/>
   <x:scenario label="7.2.2 &#34;flat&#34; | All included controls are output to the target as a flat list directly under &#34;catalog&#34;."
               pending="[dev]"/>
   <x:scenario label="7.2.2 &#34;flat&#34; | Any included &#34;loose params&#34; are output to the target as a flat list directly under &#34;catalog&#34;."
               pending="[dev]"/>
   <x:scenario label="7.2.2 &#34;flat&#34; | Any groups are discarded." pending="[dev]"/>
   <x:scenario label="7.2.3 as-is | Processors MUST handle the as-is directive by adhering to the following requirements:"
               pending="[dev]"/>
   <x:scenario label="7.2.3 as-is | All included controls are output to the target, keeping the structure of the groups and nested controls. Any group that holds an included control MUST appear in the output with all of its non-control children intact. If an included control has a parent control that was not included, that control's output location is &#34;up-leveled&#34;, or made equal to the non-included parent. This applies recursively until the control is directly under either &#34;catalog&#34; or another included control."
               pending="[dev]"/>
   <x:scenario label="7.2.3 as-is | Any included &#34;loose params&#34; are output to the target as a flat list directly under &#34;catalog&#34;."
               pending="[dev]"/>
   <x:scenario label="7.2.4.1 Creating Custom Groups | A groupobject given under custom MUST result in a group with the exact same content (excluding insert-controls) in the target catalog."
               pending="[dev]"/>
   <x:scenario label="7.2.4.1 Creating Custom Groups | If the ID of the group matches the ID of a group that has been included during the import phase, all contents inside the group, including title, param, prop and part objects MUST be copied into the target, appearing in the same order as in the source."
               pending="[dev]"/>
   <x:scenario label="7.2.4.2 Inserting Controls | When processing the control selection of a custom element, the behavior defined in this section MUST be followed to generate the output."
               pending="[dev]"/>
   <x:scenario label="7.2.4.2 Inserting Controls | In the case that a control selection matches none of the included controls, it MUST be ignored."
               pending="[dev]"/>
   <x:scenario label="7.2.4.2 Inserting Controls | In the case that a control selection matches none of the included controls, a warning SHOULD be provided."
               pending="[dev]"/>
   <x:scenario label="8.1 Setting Parameters | If no such parameter is found, a warning SHOULD be issued."
               pending="[dev]"/>
   <x:scenario label="8.1 Setting Parameters | If no such parameter is found, processing MUST still continue."
               pending="[dev]"/>
   <x:scenario label="8.1 Setting Parameters | For the following objects inside the source: class, depends-on, label, usage, values, select; the object MUST be copied into the target from the source, first removing any existing objects with the same name."
               pending="[dev]"/>
   <x:scenario label="8.1 Setting Parameters | For the following objects inside the source: props, links, constraints, guidelines; the contents of the object MUST be added to the contents of the target object of the same name. If no such object exists in the target, it is created."
               pending="[dev]"/>
   <x:scenario label="8.1 Setting Parameters | For the following objects inside the source: prop, link; the object MUST be copied into the target from the source, first removing any existing objects with the same distinctive ID. ([Section id])."
               pending="[dev]"/>
   <x:scenario label="8.1 Setting Parameters | If more than one set-parameter directive is given for the same parameter, all MUST BE applied, in the sequence given in the profile."
               pending="[dev]"/>
   <x:scenario label="8.2.1.1 Implicit binding | An add directive with no by-id child MUST be considered an implicit binding, and will apply to the control as a whole."
               pending="[dev]"/>
   <x:scenario label="8.2.1.1 Implicit binding | The contents of an implicitly bound add directive MUST be added to the control contents in the target, either after its title when position is starting, or at the end if its position is ending, or if no valid position is given."
               pending="[dev]"/>
   <x:scenario label="8.2.1.1 Implicit binding | When an add directive is implicitly bound, the position values before and after MUST be treated like starting and ending, respectively."
               pending="[dev]"/>
   <x:scenario label="8.2.1.1 Implicit binding | After processing an implicitly bound add directive, the control contents MUST be sorted to appear in the required order: a new prop appears after any prop already in the control, when position is ending, or not given, or before any prop in the control when position is starting."
               pending="[dev]"/>
   <x:scenario label="8.2.1.2 Explicit binding | An add directive with a by-id child MUST be considered an explicit binding, and applies to only a single object inside the control."
               pending="[dev]"/>
   <x:scenario label="8.2.1.2 Explicit binding | When an add directive is explicitly bound, the value of the by-id child MUST correspond to the value of an id on an object inside the control, and not the control itself."
               pending="[dev]"/>
   <x:scenario label="8.2.1.2 Explicit binding | If by-id does not correspond to such a value, the add directive MUST be considered inoperative and ignored."
               pending="[dev]"/>
   <x:scenario label="8.2.1.2 Explicit binding | An inoperative add directive MAY result in a warning."
               pending="[dev]"/>
   <x:scenario label="8.2.1.2 Explicit binding | When position has a value of startingor ending, the contents of the source MUST be added inside the target, either at the start or end of its contents, respectively."
               pending="[dev]"/>
   <x:scenario label="8.2.1.2 Explicit binding | When position has a value of before or after, the contents of the source MUST be added outside the target, either directly before or after it, respectively."
               pending="[dev]"/>
   <x:scenario label="8.2.1.3 Modifying controls inside controls | Profile resolution tools MUST be able to correctly handle add directives targetting nested controls. This includes directives that target a child control as well as directives that target a parent control and modify the child."
               pending="[dev]"/>
   <x:scenario label="8.2.2 Removing contents from controls | An object inside the control MUST be removed from the output if and only if it meets all of the criteria given by the child objects of the remove directive."
               pending="[dev]"/>
   <x:scenario label="8.2.2 Removing contents from controls | The remove directive criteria by-id MUST match an object if and only if its value is identical to the id value of that object."
               pending="[dev]"/>
   <x:scenario label="8.2.2 Removing contents from controls | The remove directive criteria name-ref MUST match an object if and only if its value is identical to the value of that object's name child."
               pending="[dev]"/>
   <x:scenario label="8.2.2 Removing contents from controls | The remove directive criteria ns-ref MUST match an object if and only if its value is identical to the value of that object's ns child."
               pending="[dev]"/>
   <x:scenario label="8.2.2 Removing contents from controls | The remove directive criteria class-ref MUST match an object if and only if its value is identical to the value of that object's class child."
               pending="[dev]"/>
   <x:scenario label="8.2.2 Removing contents from controls | The remove directive criteria item-name MUST match an object if and only if its value is identical to the value of that object's serialized name."
               pending="[dev]"/>
   <x:scenario label="8.2.2 Removing contents from controls | In serialization formats that use arrays of objects in the OSCAL model, an object's name MUST be referenced as singular form of its containing parent array."
               pending="[dev]"/>
   <x:scenario label="9.1 Backmatter Resolution | The output's backmatter MUST be generated by copying in each resource object from the backmatters of the imported catalogs/profiles in top-to-bottom order, then by copying in each resource object from the backmatter of the source profile itself. These objects MUST be processed in the order they are defined in each respective document."
               pending="[dev]"/>
   <x:scenario label="9.1 Backmatter Resolution | If a given resource has the same uuid as a resource that has already been added, the previous resource MUST be removed, and the more recent one added, unless superseded by other requirements."
               pending="[dev]"/>
   <x:scenario label="9.1 Backmatter Resolution | A resource with a child prop of name:keep and value:always MUST NOT be replaced by the addition of another resource, unless the new resource also has a child prop of name:keep and value:always."
               pending="[dev]"/>
   <x:scenario label="9.1 Backmatter Resolution | Tools MAY check for pruning conditions [Section cleanup] as resources are added as long as the final result is the same as if the pruning had taken place at the end of all resource addition."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | The output catalog's metadata MUST have a unique top-level UUID (metadata:uuid). This UUID MAY be generated as seen fit by the tool, as long as it is reasonable to assume it is globally unique. It is RECOMMENDED that tools use a Version 4 UUID as specified in Section 4 of RFC 4122."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | The value of metadata:version in the target MUST be set with a string that identifies the version of that document."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | The metadata:version SHOULD be used to track updates to this specific output document."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | The value of metadata:oscal-version in the target MUST be set with a string that identifies the version of OSCAL used by this tool to resolve the profile (ex. 1.0.0). This value MUST be determined by compiling the oscal-versions from each imported document and the source profile, and taking the most recent minor version. If this version is more recent than what the resolution tool is using, then the value of oscal-version MUST be the version that the tool used internally."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | If any of the above OSCAL versions (imported document versions, source profile version, tool version) are of a different major version (the first digit differs), the tool SHOULD provide an error and cease processing."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | The value of metadata:last-modified in the target MUST be set with a valid timestamp. This value SHOULD represent the time that resolution occurred."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | A child prop object with name:source-profile MUST be created. The value object of this prop SHOULD be set with a valid URI that points to the profile that resulted in this catalog."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | If there are privacy or security concerns, the value object of this prop MAY be set to anything, in which case the simple existence of the source-profile property indicates that this is a resolved profile."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | A child prop object with name:resolution-tool SHOULD be created. The value object of this prop in the target SHOULD be set with a string that represents the tool that was used to resolve this catalog."
               pending="[dev]"/>
   <x:scenario label="9.2 Metadata Resolution | For any metadata:roles or metadata:parties that exist in the source catalogs, if they have a prop child with name:keep and value:always, they are to be copied as is into the output metadata."
               pending="[dev]"/>
   <x:scenario label="9.3 Pruning and Ordering | The processor SHOULD prune the resulting output catalog by removing unused objects."
               pending="[dev]"/>
   <x:scenario label="9.3 Pruning and Ordering | Any object that has a child prop with a name of &#34;keep&#34; and a value of &#34;always&#34; MUST NOT be pruned."
               pending="[dev]"/>
   <x:scenario label="9.3 Pruning and Ordering | If an object was explicitly included in the [Section select-phase], it MUST NOT be pruned."
               pending="[dev]"/>
   <x:scenario label="9.3 Pruning and Ordering | If an object was referenced in a custom section of the source profile, it MUST NOT be pruned."
               pending="[dev]"/>
   <x:scenario label="9.3 Pruning and Ordering | If an object was referenced in the modify section of the source profile, it MUST NOT be pruned. Any objects removed in that section are still removed."
               pending="[dev]"/>
   <x:scenario label="9.3 Pruning and Ordering | If the object appears in a reference anywhere in the final result catalog, except in other objects that also meet all other pruning criteria, it MUST NOT be removed. A reference to a given object exists if #{distinctiveID} appears anywhere, where {distinctiveID} is the distinctive ID of the object [Section id]."
               pending="[dev]"/>
   <x:scenario label="9.3 Pruning and Ordering | Tools MUST reorder the output catalog into canonical order [Section order], except where this specification provides different ordering requirements."
               pending="[dev]"/>
   <x:scenario label="10.1 Distinct ID of Objects | For the objects control, param, and group, distinctiveness MUST be determined by the value of the &#34;id&#34; child object."
               pending="[dev]"/>
   <x:scenario label="10.1 Distinct ID of Objects | For the object resource, distinctiveness MUST be determined by the value of the &#34;uuid&#34; [Section target-back-matter]."
               pending="[dev]"/>
   <x:scenario label="10.2 Dealing with Multiple Formats | Profile Resolution tools SHOULD be able to handle source profiles, imported catalogs, and imported profiles that are serialized in XML, JSON, or YAML."
               pending="[dev]"/>
   <x:scenario label="10.2 Dealing with Multiple Formats | A different serialization format of any given input MUST NOT result in a differing output catalog."
               pending="[dev]"/>
   <x:scenario label="10.2.1 Requirements and Guidance for XML Output | The final Catalog output, if using XML, MUST be valid as defined by the XML model documentation for the OSCAL Catalog. See the complete XML reference for model requirements."
               pending="[dev]"/>
   <x:scenario label="10.2.2 Requirements and Guidance for JSON Output | The final Catalog output, if using JSON, MUST be valid as defined by the JSON model documentation for the OSCAL Catalog. See the complete JSON reference for model requirements."
               pending="[dev]"/>
   <x:scenario label="10.2.3 Requirements and Guidance for YAML Output | The final Catalog output, if using YAML, MUST be valid as defined by the JSON model documentation for the OSCAL Catalog."
               pending="[dev]"/>
   <x:scenario label="10.2.4 Order of objects in serialization | When the output format is XML, tools MUST use the OSCAL canonical order as described above. When using the YAML or JSON formats, order conveys no meaning, and is not considered important."
               pending="[dev]"/>
</x:description>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-specml-working.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="lib/spec-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-model href="lib/specml.rnc" type="application/relax-ng-compact-syntax"?>

<!-- Edit this PI for checking up on test bindings -->
<?specml-testset requirements-working-set.xspec?>
<?xml-stylesheet type="text/css" href="lib/specml.css"?>
<SPECIFICATION xmlns="http://csrc.nist.gov/ns/oscal/specml">
  <head>OSCAL Profile Resolution</head>
  <section id="draft">
    <head>Notice of Draft Status</head>
    <p>Please note that this specification is currently a work in progress and is subject to change. If you have any feedback or comments, please create an issue at the NIST OSCAL Github Repository:<a href="https://github.com/usnistgov/OSCAL"/>.</p>
  </section>
  <section id="abstract">
    <head>Abstract</head>
    <p>This specification provides the minimal requirements for processing an OSCAL Profile to create a new OSCAL Catalog Document. This process of applying a profile to a catalog to create a new catalog is called <term>Profile Resolution</term>. Not all OSCAL Profiles will be resolved, nor are expected to be; however, the resolution requirements in this document are crucial to understanding the intended functionality of any given OSCAL Profile. This specification is intended for software developers who intend to develop an OSCAL Profile Resolver, or for OSCAL Profile authors who want a more in-depth understanding of profile resolution.</p>
  </section>
  <section id="intro">
    <head>Introduction</head>
    <section id="purpose">
      <head>Purpose</head>
      <p>This document defines the normative requirements for an OSCAL Profile Resolver. Profile resolution is core to addressing a fundamental OSCAL requirement: the representation of baselines separately from the control catalogs on which they depend). The requirements for resolution must therefore be well-defined and deterministic, enabling tool developers and parties exchanging OSCAL Profiles can work from a common understanding.</p>
      <p>No requirements are placed on implementation-level details, instead, requirements are laid out as what the output of resolution must look like given a certain input. By adhering to these requirements OSCAL producers, OSCAL consumers, and any other members of the OSCAL ecosystem can create and resolve profiles deterministically, with repeatable results, regardless of the tool used.</p>
    </section>
  </section>
  <section id="readingthis">
    <head>Reading This Document</head>
    <section id="terminology"><!-- TODO: Parse document for additional terms to add -->
      <head>Terminology</head>
      <p>Many core OSCAL concepts are defined on the <a href="https://pages.nist.gov/OSCAL/concepts/terminology/">OSCAL Terminology Page</a>. The most important are repeated in this document, but readers should verify their understanding of all core OSCAL terms before reading this document.</p>
      <p>Additionally, many terms in the wider domain have overloaded definitions. Unless defined otherwise by OSCAL or explicitly in this document, terms are to be understood as defined in the <a href="https://csrc.nist.gov/glossary">NIST CSRC Glossary</a>.</p>
      <ul>
        <li>
          <p><term>profile</term>- an OSCAL Profile Document. Defines a set of inclusions, modifications, and transformations against a <term>catalog</term>. See <a href="https://pages.nist.gov/OSCAL/concepts/layer/control/profile/">OSCAL Profile Model</a>.</p>
        </li>
        <li>
          <p><term>catalog</term>- an OSCAL Catalog Document. Contains a well-defined set of <term>controls</term>. See <a href="https://pages.nist.gov/OSCAL/concepts/layer/control/catalog/">OSCAL Catalog Model</a>.</p>
        </li>
        <li>
          <p><term>control</term>- an individual item in an OSCAL Catalog. See <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-53r5.pdf">NIST Special Publication 800-53r5</a> for a more in-depth definition.</p>
        </li>
        <li>
          <p><term>profile resolution</term>- The process of consuming one or more OSCAL Profiles and the OSCAL Catalogs that they reference to produce a new tailored <term>catalog</term>. See <a href="https://pages.nist.gov/OSCAL/concepts/layer/control/catalog/">OSCAL Catalog Model</a>.</p>
        </li>
        <li>
          <p><term>source</term>- refers to the profile document that is input into the profile resolution processor. This is the profile being resolved. In this document, when referring to objects from the <term>source</term> document, the following style is used:<src>source-object</src>.</p>
        </li>
        <li>
          <p><term>target</term>- the intended output of the transformation, a catalog document. In this document, when referring to objects of a <term>target</term> document, the following style is used:<tgt>target-object</tgt>.</p>
        </li>
        <li>
          <p><term>directive</term>- refers to an object or combination of objects in source documents, which is designed to affect a particular outcome in the target catalog. For the most part, directives are in the source profile document â€“ for example, a <src>set-parameter</src> object in a source profile is a directive to set a parameter value in the target catalog.</p>
        </li>
        <li>
          <p><term>original order</term>- the order of objects as presented in the <term>source</term> document(s). See XYZ.</p>
        </li>
        <li>
          <p><term>canonical order</term>- the order of objects as required in the appropriate OSCAL Model (Profile, Catalog, etc.). This can differ from the above order when converting between &quot;ordered&quot; formats (ex. XML), and &quot;non-ordered&quot; formats (ex. JSON).</p>
        </li>
      </ul>
    </section>
    <section>
      <head>Requirement Keywords</head>
      <p>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be interpreted as described in <a href="https://tools.ietf.org/pdf/bcp14.pdf">BCP 14</a> <a href="https://tools.ietf.org/pdf/rfc2119">[RFC2119]</a><a href="https://tools.ietf.org/pdf/rfc8174">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.</p>
    </section>
    <section id="use-of-yaml">
      <head>Use of YAML</head>
      <p>OSCAL supports a variety of serialization formats, each of which having it&apos;s own benefits and drawbacks. In this document, YAML (YAML Ain&apos;t Markup Language) is used to represent the various objects of the <term>source</term> and <term>target</term>. All examples and in-line references will be represented using <a href="https://yaml.org/spec/1.2/spec.html">YAML 1.2</a>.</p>
      <p>YAML maps cleanly to JSON, thus allowing easy use of existing JSON/XML transformers where needed. With that in mind, the <a href="https://pages.nist.gov/OSCAL/reference/latest/complete/json-reference/">OSCAL Complete JSON Reference</a> is a valuable resource for understanding the YAML-based information structures used in this document. All JSON properties and objects defined in the reference equate to a YAML mapping, list, or dictionary.</p>
    </section>
    <section id="reading-examples">
      <head>Reading YAML Examples</head>
      <p>YAML is a particularly human-readable format. For those unfamiliar with the format, the basics:</p>
      <ul>
        <li>
          <p>Each line is a key-value pair, presented as <code>key:value</code>, or as <code>key:</code> with any number of list items on the following lines.</p>
        </li>
        <li>
          <p>Indentation, spacing, and white space matters. Items below a key and indented one level in are members (or children) of that key.</p>
        </li>
        <li>
          <p>List items are represented with a preceding dash <code>- listitemkey:value</code>.</p>
        </li>
      </ul>
      <p>The YAML specification is freely available here:<a href="https://yaml.org/spec/1.2/spec.html">YAML 1.2</a>.</p>
      <p>Additionally, in order to unambiguously express information, this specification uses additional conventions, as described below.</p>
      <p>There are some objects whose values must be determined dynamically at processing time. The most common example of this is timestamping output as it is processed. In this case, and any other dynamic-value cases, the expression <code>${{ }}</code> is used.</p>
      <p>For example:</p>
      <tagging whose="target_catalog"><![CDATA[
last-modified: ${{ timestamp }}]]></tagging>
      <p>Indicates the <tgt>last-modified</tgt> object should be produced with contents generated appropriately, in this case, the timestamp at the time of processing.</p>
      <p>Some examples may elide content to enhance readability or save space. In these cases, a YAML comment (any line that starts with <code>#</code>) will be used to explain the elision.</p>
      <p>Finally, although examples are syntactically faithful to OSCAL, they are not necessarily always formally valid in every respect. For example, OSCAL defines allowed property names (<src>props</src>) and values, and those rules may not be observed here. Examples are given for purposes of illustrating profile resolution semantics only, and should not be taken as normative for any actual use.</p>
    </section>
    <section id="document-layout">
      <head>Document Layout</head>
      <p>The specification is broken into the following major sections:</p>
      <ul>
        <li>
          <p><term>Phases of Profile Resolution</term>- Lays out the necessary steps and phases of profile resolution. As each phase executes, the processor is understood to be creating and editing an intermediate representation of the output. There is one section for each of the three main phases.</p>
        </li>
        <li>
          <p><term>Target Catalog Structure</term>- Provides the requirements for structuring the final output from the intermediate representation generated throughout the previous section.</p>
        </li>
      </ul>
      <p><term>Please note</term>: As referenced in the Purpose section <xref rid="purpose" />, this specification makes no hard requirements on the specifics of implementation. It is feasible for an implementation to use no intermediate representation, and to directly and iteratively build the output. As long as all processing and output requirements are satisfied, any approach is allowed. With that said, the specification has been laid out to aid in implementation by providing a clear organization as a sequence of distinct operations.</p>
    </section>
    <section id="intermediate">
      <head>The Intermediate and Implementation Guidance</head>
      <p>The overall intent of this document, in addition to defining strict requirements, is to provide rough guidelines on implementing an OSCAL Profile Resolution Tool. To this end, each phase of resolution will be framed as a series of transformations applied to an internal data structure that is persistent throughout the process. We call this &quot;the intermediate&quot;.</p>
      <p>Any examples that are labelled as &quot;Intermediate&quot; are pseudo-code, designed to represent how this data structure might look as we apply different operations to it. The example intermediates are often not valid OSCAL, and are not to be taken as guidance, but rather a useful visualization tool for implementers.</p>
      <p>The authors believe that applying the steps of resolution in order against this intermediate representation is the simplest way to achieve full compliance with the specification. However, there is no requirement to implement profile resolution in this way. Requirements are given as rules on the output of resolution, and as such, tools can operate any way they would like internally.</p>
    </section>
  </section>
  <section id="phases">
    <head>Phases of Profile Processing</head>
    <p>An OSCAL Profile has three major sections, each which correspond to a phase of profile resolution. In order to complete the profile resolution process, each section must be fully parsed and a catalog output created.</p>
    <p><req level="recommended" id="req-phase-order">It is strongly RECOMMENDED that implementations execute the following steps in the order that they are provided here (import, merge, modify).</req> While it is possible to achieve compliance with a non-standard approach, the iterative nature of profile resolution lends itself to linear processing.</p>
    <p>The three steps are <term>import</term>;<term>merge</term>; and <term>modify</term>. In brief:</p>
    <ul>
      <li>
        <p><term>import</term>- identifies one or more control sources (catalogs or profiles) and defines the controls within them to be included in the result catalog. If nothing is imported, no resulting catalog is produced. Invoked by <src>import</src> directives in source profiles;</p>
      </li>
      <li>
        <p><term>merge</term>- designates the rules for how controls will be organized (ordered and/or grouped) and merged (addressing conflicts or ambiguities) in the result catalog. Controlled by the <src>merge</src> directive in source profiles; if none are included, default merge rules are used;</p>
      </li>
      <li>
        <p><term>modify</term>- indicates how controls and their parameters in the underlying catalog are to be altered, edited, amended or added in the final result catalog. Logical evaluation and parameter constraints provide advanced processing. Controlled by the <src>modify</src> directive in source profiles. If a <src>modify</src> directive is not provided, no changes will be made to the controls that have been imported/merged.</p>
      </li>
    </ul>
    <p>As described in the previous section, when resolved, an OSCAL Profile takes the form of an OSCAL Catalog. The phases described below will produce outputs conforming to the catalog model.</p>
  </section>
  <section id="import">
    <head>Import Phase</head>
    <p>A profile begins by listing a set of catalogs and/or profiles to be imported. Each is represented by a resolvable resource URI and a directive specifying which controls to import from that resource. These resources may be available as static resources, or they may be produced dynamically on request; such as is the case when a profile is imported. Imports are given in sequence after the metadata:</p>
    <tagging whose="source_profile"><![CDATA[
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: ${{ catalog URI }}
      include-controls: ${{ list of selected controls }}
    - href: ${{ profile URI }}
      include-controls: ${{ list of selected controls }} 
   ]]></tagging>
    <p>In an import directive, the reference to the resource to be imported appears on an <src>href</src> child object. It takes either of two forms, external or internal:</p>
    <p>An external reference appears as an absolute or relative URL:</p>
    <tagging whose="source_profile"><![CDATA[
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: >-
        https://github.com/usnistgov/oscal-content/tree
        /master/nist.gov/SP800-53/rev4/yaml/NIST_SP-800-53_rev4_catalog.yaml
      include-controls: ${{ list of selected controls }}
    - href: "../../NIST_SP-800-53_rev5_catalog.yaml"
      include-controls: ${{ list of selected controls }} 
   ]]></tagging>
    <p>While an internal reference appears as below (see <xref rid="internalref" />):</p>
    <tagging whose="source_profile"><![CDATA[
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: #80052rev4
      include-controls: ${{ list of selected controls }}
    - href: #80052rev5
      include-controls: ${{ list of selected controls }} 
   ]]></tagging>
    <p>All import directives will contain either <src>include-all: ~</src> or <src>include-controls</src>. These directives indicate which controls from the imported document are explicitly selected <xref rid="select-phase" />.</p>
    <p>The following section contains requirements for processing the <src>import</src> child of a source <src>profile</src></p>
    <section id="importhrefs">
      <head>Import href Requirements</head>
      <section id="resolving-uris">
        <head>Import URI Resolution</head>
        <p><req level="must" id="req-uri-resolve">Tools MUST resolve URIs by following <a href="https://datatracker.ietf.org/doc/html/rfc3986#section-5">Section 5 of RFC3986</a>, with the exception of URI Fragments (URIs that start with &quot;#&quot;). URI Fragments MUST instead be resolved as defined in <xref rid="internalref" />.</req></p>
      </section>
      <section id="aquiring-resource">
        <head>Import Resource Acquisition</head>
        <p><req level="must" id="req-uri-aquire">Tools MUST acquire resources at the resolved URI by following <a href="https://datatracker.ietf.org/doc/html/rfc3986#section-5">Section 5 of RFC3986</a>, with the exception of URI Fragments (URIs that start with &quot;#&quot;). URI Fragments MUST instead be acquired as defined in <xref rid="internalref" />.</req></p>
        <p><req level="must" id="req-uri-base">For the purposes of resolving URIs using the above specification, the Base URI MUST be considered to be the absolute URI of the containing profile.</req></p>
        <p><req level="must" id="req-uri-error">In the case that acquiring a resource fails, the tool MUST cease processing and provide an error. In order to ensure profile resolution results in the same catalog regardless of which tool resolves it, all imports must successfully resolve. While this may cause inconvenience if resources are frequently not available, it ensures interoperability.</req></p>
        <p>Note that receiving a cached version of an import, or resolving an import that is otherwise unavailable through some other (but automatic) means still satisfies the above requirement. This specification does not put requirements on the precise function of the import, as long as the correct document is retrieved.</p>
      </section>
      <section id="internalref">
        <head>Internal References</head>
        <p>URI Fragments in OSCAL represent internal references to other OSCAL objects in the same document. These references follow the pattern of &quot;#{{objectID}}&quot;. For example, the URI Fragment &quot;#param1&quot; is referencing the Parameter with unique ID &quot;param1&quot;.</p>
        <p><req level="must" id="req-internal">In the context of the Import Phase, internal references will only appear as a reference to a profile or catalog that is in the <src>resources</src> section of the source. When tools encounter such a reference, they MUST locate the object in <src>resources</src> with the matching ID value, and resolve the import using the <src>rlink</src> URI and the above resolution requirements.</req></p>
        <p><req level="must" id="req-internal-error">If the object fetched cannot be found or is not a valid OSCAL object, the tool MUST cease processing and provide an error.</req></p>
        <tagging whose="source_profile"><![CDATA[
profile:
  metadata: ~
  imports:
    - href: "#nist-sp800-53_catalog"
      include-controls: ${{ list of selected controls }}
    
  # Content Elided
    
  backmatter:
    resources:
      - uuid: "nist-sp800-53_catalog"
        description: "NIST SP 800-53 rev5 OSCAL format, on Github."
        rlinks:
          - rlink:
              href: >-
                https://github.com/usnistgov/oscal-content/tree
                /master/nist.gov/SP800-53/rev4/xml/NIST_SP-800-53_rev5_catalog.xml   
       ]]></tagging>
      </section>
      <section id="URI-circular">
        <head>Resolving Imports of Profiles</head>
        <p><req level="must" id="req-circular-resolve">If the resource acquired is an OSCAL Profile, the tool MUST apply this specification to resolve it, then continue processing having imported the resulting catalog.</req></p>
        <p><req level="should" id="req-circular-catalog">When a profile imports a profile, the subordinate profile SHOULD be resolved first into a catalog using this specification, before it is imported.</req> This presents the possibility of circular imports, when a profile is directed to import itself either directly or indirectly.</p>
        <p>A <term>circular import</term> occurs when a profile imports an already imported profile, which was called at an earlier place in the import hierarchy. For example, if profile A imports profile B, and profile B imports profile A, the second import is circular. (An import at the top can only be circular if a profile tries to import itself.) If A imports B, B imports C and C imports A, Câ€™s import is circular.</p>
        <p>Note that an import can only be circular within the context of processing a particular profile. In the last example, Câ€™s import would not be circular if invoked in the context of resolving B by itself.</p>
        <p><req level="must" id="req-circular-error">If a processor encounters a <term>circular import</term> as described above (self-imports are inherently circular), the processor MUST cease processing and generate an error.</req></p>
        <mapping>
          <p>A profile identified as <code>home_profile.yaml</code> imports another one identified as <code>circular_profile.yaml</code>:</p>
          <tagging whose="source_profile"><![CDATA[
profile:
  id: "home_profile.yaml"
  metadata: ~
  imports:
    - href: "circular_profile.yaml"
      include-controls: ${{ list of selected controls }} 
         ]]></tagging>
          <p>In turn this file invokes <code>home_profile.xml</code>:</p>
          <tagging whose="source_profile"><![CDATA[
profile:
  id: "circular_profile.yaml"
  metadata: ~
  imports:
    - href: "home_profile.yaml"
      include-controls: ${{ list of selected controls }} 
         ]]></tagging>
          <p>Once detected, this circular import will result in an error and no further processing will take place.</p>
          <tagging whose="target_catalog"><![CDATA[
# Import at href: "circular_profile.yaml" failed.
  # Reason: Error during profile import:
  # Import at href: "home_profile.yaml" failed.
  # Reason: Circular import 
         ]]></tagging>
        </mapping>
      </section>
      <section id="URI-multiple">
        <head>Multiple imports</head>
        <p>Each import directive is processed to produce a set of controls. Note that this occurs even if the same catalog is imported multiple times: each distinct import collects controls into a separate <int>selection</int>:</p>
        <tagging whose="source_profile"><![CDATA[
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: "#catalog"
      include-controls:
       - with-ids:
          - ac-1
          - ac-2
    - href: "#catalog"
      include-controls:
       - with-ids:
          - ac-3
          - ac-4 
       ]]></tagging>
        <tagging whose="inter_catalog"><![CDATA[
intermediate:
  inclusions:
    - id: ${{uuid of #catalog}}
      included-controls:
          - ac-1
          - ac-2
    - id: ${{uuid of #catalog}}
      included-controls:
          - ac-3
          - ac-4 
       ]]></tagging>
        <p>The control inclusions are combined and collapsed in the next phase of processing,<term>merge</term>(see <xref rid="merge-phase"/>) .</p>
        <p>Multiple imports against the same resource are allowed, and would most commonly occur when the profile author is using <xref rid="mapping"/> to create very specific output. Multiple imports may result in outputs with clashing control IDs if mapping or the merge directive is not set correctly.</p>
      </section>
      <section id="mapping">
        <head>Mapping Controls</head>
        <p>The optional <src>mapping</src> child of a given <src>import</src> provides a simple ID remapping for objects included from that specific import. This provides the means for profile authors to proactively avoid clashing IDs of controls and other objects.</p>
        <p>The Mapping section consists of 5 optional subsections, each covering a particular type of object. Each subsection is a list of ID mappings to be applied for objects that are the parent object type.</p>
        <p>When encountering a given mapping instruction, processors:</p>
        <ul>
          <li>
            <p>MUST change the distinctive ID of that object to be equal to the value of the <src>to</src> object.</p>
          </li>
          <li>
            <p>MUST update all known references to the old ID in other included content, allowing the new ID to be used in subsequent profile sections.</p>
          </li>
        </ul>
        <p>Since mapping is a self contained process inside each import, the rest of this specification will continue to reference IDs with the assumption that mapping has already been applied if it was present. Since mapping is most commonly used to avoid clashing IDs, processors should take care to not handle duplicate IDs until after mapping is complete.</p>
        <p>Below is a simple example of mapping. The second <src>import</src> is included controls from a different catalog whose ID values happen to collide. Knowing this, the profile author has remapped those IDs to new values.</p>
        <tagging whose="source_profile"><![CDATA[
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: "#catalog"
      include-controls:
       - with-ids:
          - ac-1
          - ac-2
    - href: "#catalog2"
      include-controls:
       - with-ids:
          - ac-1
          - ac-2
      mapping:
       - controls:
          - from: ac-1
            to: map-ac-1
          - from: ac-2
            to: map-ac-2
       ]]></tagging>
        <p>Using the intermediate approach, an internal data structure resembling the following would result from the above profile:</p>
        <tagging whose="inter_catalog"><![CDATA[
intermediate:
  metadata: ~
  inclusions:
    - id: ${{uuid of #catalog}}
      included-controls:
          - ac-1
          - ac-2
    - id: ${{uuid of #catalog2}}
      included-controls:
          - map-ac-1
          - map-ac-2 
       ]]></tagging>
      </section>
    </section>
    <section id="select-phase">
      <head>Including Controls</head>
      <p>Each import contains directives on which controls from the imported catalog are to be fetched and used for further processing. Throughout the rest of the document we will refer to this as &quot;inclusion&quot;. If a control is included, and the source profile makes no other changes to it, it will be present in the output. Exclusion directives in this section, as well as directives in the following two major sections (merge and modify), may make changes to an included control or group that could cause it to appear differently, or not at all, in the output. Using the intermediate implementation approach, any control(s) that are included would be extracted from the referenced catalogs, any applicable mappings would be applied, then the controls(s) would be stored.</p>
      <section id="include-all">
        <head>include-all</head>
        <p><req level="must" id="req-include-all" eg="req-include-all-asis.xml req-include-all-flat.xml">When an import provides the <src>include-all</src> directive, ALL controls and groups in the referenced document (including nested controls) MUST be included.</req></p>
        <tagging whose="source_profile"><![CDATA[
include-all: ~]]></tagging>
      </section>
      <section id="include-by-id">
        <head>include-controls plus with-id</head>
        <p><req level="must" id="req-include-by-id">When an import provides the <src>include-controls</src> directive, with a <src>with-id</src> child, all controls in the referenced document whose <code>id</code> match one of the listed <code>id</code> values MUST be included.</req></p>
        <tagging whose="source_profile"><![CDATA[
include-controls:
  - with-ids:
    - id: ac-1
    - id: ac-2
       ]]></tagging>
      </section>
      <section id="include-by-match">
        <head>include-controls plus matching</head>
        <p>Controls may also be included using match patterns against their IDs. This is useful because related controls (either in a hierarchy, or together in a group) frequently have related IDs as well.</p>
        <p><req level="must" id="req-include-by-match">When an import provides the <src>include-controls</src> directive, with a <src>matching</src> child, all controls in the referenced document whose <code>id</code> matches one of the listed <code>pattern</code> values (Glob matching) MUST be included.</req></p>
        <p><req level="must" id="req-include-by-match-empty">If a <code>matching</code> object is provided with no <code>pattern</code>, it MUST be treated as matching nothing. While not providing a pattern is technically valid, resolution tool implementers should be aware that it is generally undesirable, and warnings or notices to the user may be appropriate.</req></p>
        <tagging whose="source_profile"><![CDATA[
include-controls:
  - matching:
    - pattern: "ac*" 
       ]]></tagging>
      </section>
      <section id="import-nested">
        <head>Dealing with Nested Controls and Groups</head>
        <p>In OSCAL, controls may contain child controls. For instance, in SP 800-53 many controls are supplemented with control enhancements; in OSCAL these are represented as child controls within parent controls. So parent AC-2 (in a given catalog) has children AC-2(1) through AC-2(13), for example.</p>
        <p>By default, inclusion of a control also causes any of that control&apos;s ancestors (or parents) to also be included. By default, inclusion of a control DOES NOT cause the inclusion of any descendants (or children) of that control to be included. This applies to both controls and groups.</p>
        <p>This default behavior can be modified by the following two optional children of the <src>include-controls</src> object.</p>
        <section id="include-child-controls">
          <head>with-child-controls</head>
          <p>Child controls are, for the most part, treated the same as top level controls: they can be explicitly included using the selection directives above. As a shortcut to manually including all of the desired descendant controls of a given control, OSCAL provides the &quot;with-child-controls&quot; option. &quot;with-child-controls&quot; appears as a child object under a given inclusion directive, and defines additional behavior that is to be executed alongside the parent inclusion.</p>
          <p><req level="must" id="req-with-child-controls-yes">A <src>with-child-controls: yes</src> directive on an <src>include-controls</src> indicates that <em>all descendant controls</em> of the included control MUST also be included.</req></p>
          <p><req level="must" id="req-with-child-controls-no">A <src>with-child-controls: no</src> directive on an <src>include-controls</src> indicates that ONLY the matching control is included, any descendant children MUST NOT be included.</req></p>
          <p><req level="must" id="req-with-child-controls-none">If no <src>with-child-controls</src> is provided, the processor MUST consider the directive as being equivalent to one having <src>with-child-controls:no</src>.</req></p>
        </section>
        <section id="include-parent-controls">
          <head>with-parent-controls</head>
          <p>Although similar to the above <src>with-child-controls</src>, the optional <src>with-parent-controls</src> applies to parents of the included control, and has the opposite default behavior. In order to maintain the structure of the source catalog, profile resolution includes all parents of an included control by default. If a profile author wants to change this structure, they could use an exclude directive that lists all of the undesired parents. As a shortcut for this,<src>with-parent-controls</src> provides the following functionality:</p>
          <p><req level="must" id="req-with-parent-controls-yes">A <src>with-parent-controls: yes</src> directive on an <src>include-controls</src> indicates that <em>all parent controls</em> of the included control MUST also be included.</req></p>
          <p><req level="must" id="req-with-parent-controls-no">A <src>with-parent-controls: no</src> directive on an <src>include-controls</src> indicates that ONLY the matching control is included, any parents MUST NOT be included.</req></p>
          <p><req level="must" id="req-with-parent-controls-none">If no <src>with-parent-controls</src> is provided, the processor MUST consider the directive as being equivalent to one having <src>with-parent-controls:yes</src>.</req></p>
        </section>
      </section>
      <section id="exclude-directive">
        <head>exclude-controls</head>
        <p>Exclusions work the same way as inclusions, except with the opposite effect - the indicated control(s) do not appear in the target catalog.</p>
        <p><req level="must" id="req-exclude">Any control designated to be both included and excluded, MUST be excluded. This holds irrespective of the specificity of the selection for inclusion or exclusion.</req> For example, if AC-1 is included by id <code>ac-1</code> and excluded by matching <code>ac.*</code>, it is excluded.</p>
        <p><req level="must" id="req-exclude-additional">When <src>exclude-controls</src> has at least one <src>with-ids</src> or <src>matching</src> directive, the processor MUST follow the same rules as defined in the relevant sections above for these directives, but exclude instead of include any controls. All optional features (with-child-controls, etc.) also apply to exclusion directives.</req></p>
      </section>
      <section id="redundant-calls">
        <head>Redundant Inclusions and Exclusions</head>
        <p><req level="must" id="req-redundant">A given <src>import</src> may have any number of inclusion statements and any number of exclusion statements. Their effect is cumulative; any control that is included (or excluded) more than once MUST be considered to be included (or excluded) only once. In other words, a given control being included or excluded more than once has no effect. Exclusion still takes priority over inclusion (see above).</req></p>
        <p>Note that this requirement only applies to controls included within the context of a single import. Controls with duplicate IDs included under a different <src>import</src> are not discarded. Also note that this redundancy pruning happens after any relevant mappings have been applied.</p>
      </section>
      <section id="import-param">
        <head>Handling Params</head>
        <p>Any <src>param</src> that is not directly under a control is referred to as a <q>loose</q> param.</p>
        <p><req level="must" id="req-loose-param">All loose params from both imported documents and the profile source MUST be included. These params will be kept in the final output if document contains any references to them, and discarded otherwise. See <xref rid="cleanup" />.</req> Since new references can be created during the <src>modify</src> phase, tools should be careful not to prune params without fully understanding the final state of the output document.</p>
      </section>
      <section id="import-group"><!-- TODO: Add requirements here? Take another look at this. -->
        <head>Handling Groups</head>
        <p>Some source catalogs use <src>group</src> objects to place controls into arbitrary groupings. Tools will need to be aware of these groups when executing the "merge" phase below, as they will duplicated into the output under the "as-is" mode and can be referenced in "custom" mode. The naÃ¯ve intermediate approach would keep all groups until all other phases are complete, but implementations may find it more performant to look ahead and prune unused groups early.</p>
      </section>
      <section id="import-pitfalls">
        <head>Avoiding Implementation Pitfalls</head>
        <p>In order to ensure that implementers have as much flexibility as possible, requirements in this section have purposefully been kept minimal. Below are some common issues for implementers to be aware of:</p>
        <ul><!-- TODO: Add more of these pitfall tips? -->
          <li>
            <p>The ordering and hierarchical organization of included controls as they were present in the original catalog may be used later in the resolution process. Specifically, if the profile is using the "as-is" structuring directive, the ordering and organziation of the output should match the source catalog as closely as possible. Implementations may want to track this information, or look ahead to see what structuring mode is being used. Note that "as-is" also requires implementations to replicate any use of the <src>group</src> element.</p>
          </li>
        </ul>
      </section>
    </section>
    <section id="import-wrap-up">
      <head>Wrapping up the Import Phase</head>
      <p>At this point all requirements for content importing and control inclusion have been covered. If using the intermediate approach, the processor should have an intermediate that contains: a set of included controls and all of their child informational (non-control, non-group) objects, any relevant <src>group</src> objects and their informational content, and a set of included &quot;loose params&quot;<xref rid="import-param" />(zero to many). The general structure of the intermediate would match that of the imported catalogs (i.e. Nested controls remain nested, grouped controls remain grouped).</p>
    </section>
  </section>
  <section id="merge-phase">
    <head>Merge Phase</head>
    <p>Profiles may contain a <src>merge</src> section, where directives are given to instruct the processor how to combine the set of included objects collected during the Import Phase.<code>merge</code> has two parts: a &quot;combine&quot; directive, and a &quot;structuring&quot; directive.</p>
    <p><req level="recommended" id="req-merge-order">It is RECOMMENDED that tools apply the &quot;combine&quot; directive to the intermediate generated by the Import phase first, then apply the &quot;structuring&quot; directive.</req></p>
    <p>The following section contains requirements for processing the <src>merge</src> child of a source profile.</p>
    <section id="merge-combine">
      <head>The &quot;combine&quot; Directive</head>
      <p><code>combine</code> is an optional child of <code>merge</code> that provides the rules for dealing with objects that have duplicate (or clashing) distinct IDs <xref rid="id" />.</p>
      <p>There are two valid combination methods provided by OSCAL, provided by the <src>method</src> child of <src>combine</src>:</p>
      <ul>
        <li>
          <p>use-first: Use the first definition - the first control with a given ID is used; subsequent ones are discarded</p>
        </li>
        <li>
          <p>keep: Keep - controls with the same ID are kept, retaining the clash</p>
        </li>
      </ul>
      <p><req level="must" id="req-merge-combine">Note that "merge: combine" is deprecated, and MUST be considered undefined behavior when encountered.</req></p>
      <p>In order to apply the combination method, IDs of each control explicitly included are compared against one another. As IDs are unique across entire OSCAL documents, different imports or any groupings have no bearing on collision. Processing requirements for each method are described below.</p>
      <section id="no-merge-explicit">
        <head>No Combine Directive</head>
        <p><req level="must" id="req-merge-none">If no <src>merge</src> directive is given in the profile, or if a <src>merge</src> is given without a <src>combine</src>, merge conflicts MUST be treated as if <src>method: keep</src> was given.</req> For example, a profile with no <src>merge</src> directive:</p>
        <tagging whose="source_profile"><![CDATA[
profile:
  imports:
    - href: #catalogURI
      include-all: ~ 
       ]]></tagging>
        <p>is the same as</p>
        <tagging whose="source_profile"><![CDATA[
profile:
  imports:
    - href: #catalogURI
      include-all: ~
  merge:
    combine:
      method: keep
      flat: ~ 
       ]]></tagging>
      </section>
      <section id="no-merge-combination-rule">
        <head><q>method:keep</q></head>
        <p><req level="must" id="req-merge-keep">When a merge is indicated by <src>method:keep</src>, or when no merge directive is given, the <q>keep</q> combination rule is used. Any controls with the same distinctive ID <xref rid="id" /> MUST NOT not merged. (They are kept.)</req></p>
        <tagging whose="source_profile"><![CDATA[
merge:
    combine:
      method: keep 
       ]]></tagging>
        <p>Under this directive, colliding controls will result in invalid results, as they will both appear in the results with the same ID. Accordingly, this setting may be useful in ensuring integrity of references to controls as given in the profile: if any included control is called only once, clashing controls will not be produced and validation will succeed.</p>
        <tagging whose="source_profile"><![CDATA[
profile:
  imports:
    - href: #catalog1
      include-controls:
        - with-ids
            id: ac-1
            id: ac-2
    - href: #catalog1
      include-controls:
        - with-ids
            id: ac-1
            id: ac-2 
  merge:
    combine:
      method: keep
       ]]></tagging>
        <p>In the intermediate (showing control inclusions):</p>
        <tagging whose="inter_catalog"><![CDATA[
intermediate:
  inclusions:
    - explicitly-included-controls:
          - ac-1
          - ac-2
          - ac-1
          - ac-2 
       ]]></tagging>
        <p>In this case, downstream errors should be expected: the two <code>ac-1</code> controls clash with each other, as do the two <code>ac-2</code> controls.</p>
        <p><req level="should" id="req-merge-keep-warning">Processors SHOULD provide a warning under the merge:keep directive when duplicate controls are detected.</req> <req level="may" id="req-merge-keep-error">The processor MAY throw an error and cease processing (short-circuiting a certain future error) when duplicate controls are detected under the merge:keep directive.</req></p>
      </section>
      <section id="use-first-combination-rule">
        <head><q>method:use-first</q></head>
        <tagging whose="source_profile"><![CDATA[
merge:
    combine:
      method: use-first 
       ]]></tagging>
        <p><req level="must" id="req-merge-use-first">When the <q>use-first</q> combination rule is applied, and controls that share a distinctive ID are found, the first control encountered MUST be kept, the rest MUST be discarded.<q>First</q> MUST be determined by a top-down, depth-first traversal of the source profile&apos;s import hierarchy.</req></p>
        <mapping>
          <tagging whose="source_profile"><![CDATA[
profile:
  imports:
    - href: #catalog1
      include-controls:
        - with-ids
            id: ac-1
            id: ac-3
    - href: #catalog1
      include-controls:
        - with-ids
            id: ac-1
            id: ac-2 
  merge:
    combine:
      method: use-first
         ]]></tagging>
          <p>In the intermediate(showing control inclusions):</p>
          <tagging whose="inter_catalog"><![CDATA[
intermediate:
  inclusions:
    - explicitly-included-controls:
          - ac-1 (From catalog1)
          - ac-3
          - ac-2 
         ]]></tagging>
        </mapping>
      </section>
      <section id="merge-combination-rule">
        <head><src>method:merge</src></head>
        <p>Deprecated, unspecified behavior.</p>
      </section>
    </section>
    <section id="structuring-result">
      <head>The &quot;structuring&quot; Directive</head>
      <p>This section describes how a profile may dictate the structure of the target <tgt>catalog</tgt>, apart from its <tgt>metadata</tgt> or <tgt>back-matter</tgt>.<req level="must" id="req-stucture">Optionally, one of three &quot;structuring&quot; directives can be included as a child of <src>merge</src>:<src>flat</src>,<src>as-is</src> and <src>custom</src>. When one of these appears, it is the selected structuring directive. If more than one appears, processors MUST generate an error and cease processing.</req> Processing requirements for each are given below:</p>
      <section id="structure-none">
        <head>No Structuring Directive</head>
        <p><req level="must" id="req-structure-none" eg="req-include-all-flat.xml">If no <src>merge</src> directive is given in the profile, or if a <src>merge</src> is given without a structuring directive, structuring the output MUST be treated as if the structuring directive <src>flat</src> was given. For example, a profile with no <src>merge</src> directive:</req></p>
        <tagging whose="source_profile"><![CDATA[
profile:
  imports:
    - href: #catalogURI
      include-all: ~ 
       ]]></tagging>
        <p>is the same as</p>
        <tagging whose="source_profile"><![CDATA[
profile:
  imports:
    - href: #catalogURI
      include-all: ~
  merge:
    combine:
      method: keep 
      flat: ~ 
       ]]></tagging>
      </section>
      <section id="merge-flat">
        <head>&quot;flat&quot;</head>
        <p><req level="must" id="req-merge-flat">Profiles with the &quot;flat&quot; merge directive MUST be resolved as unstructured catalogs, with no grouping or nesting of controls.</req></p>
        <p><req level="must" id="req-merge-flat-list">Unstructured catalog output MUST be produced by adhering to the following requirements:</req></p>
<!-- TODO, ISSUE, REQ TAGGING OF LISTS -->        <ul>
          <li>
            <p><req level="must" id="req-merge-flat-list-1">All included controls are output to the target as a flat list directly under &quot;catalog&quot;.</req></p>
          </li>
          <li>
            <p><req level="must" id="req-merge-flat-list-2">Any included &quot;loose params&quot; are output to the target as a flat list directly under &quot;catalog&quot;.</req></p>
          </li>
          <li>
            <p><req level="must" id="req-merge-flat-list-3">Any groups are discarded.</req></p>
          </li>
        </ul>
        <p>An example of flat structuring is provided below</p>
        <tagging whose="source_catalog"><![CDATA[
catalog:
  groups:
    - groupA
      - ac-1
      - ac-2
    - groupB
      - bc-1 
       ]]></tagging>
        <tagging whose="source_profile"><![CDATA[
profile:
  imports:
    - href: #catalogURI
      include-controls:
        with-ids:
          - ac-1
          - ac-2
          - bc-1
  merge:
    combine:
      method: keep 
      flat: ~ 
       ]]></tagging>
        <tagging whose="inter_catalog"><![CDATA[
intermediate:
  controls:
    - ac-1
    - ac-2
    - bc-1 
       ]]></tagging>
      </section>
      <section id="merge-as-is">
        <head><q>as-is</q></head>
        <p>An <src>as-is</src> directive is used to reproduce the structure of the source documents in the target catalog.</p>
        <p><req level="must" id="id-structure-as-is-list">Processors MUST handle the <src>as-is</src> directive by adhering to the following requirements:</req> <!-- TODO, ISSUE, REQ TAGGING OF LISTS --></p>
        <ul>
          <li>
            <p><req level="must" id="id-structure-as-is-list-1">All included controls are output to the target, keeping the structure of the groups and nested controls. Any group that holds an included control MUST appear in the output with all of its non-control children intact. If an included control has a parent control that was not included, that control's output location is "up-leveled", or made equal to the non-included parent. This applies recursively until the control is directly under either "catalog" or another included control.</req></p>
          </li>
          <li>
            <p><req level="must" id="id-structure-as-is-list-2">Any included &quot;loose params&quot; are output to the target as a flat list directly under &quot;catalog&quot;.</req></p>
          </li>
        </ul>
        <p>Example:</p>
        <tagging whose="source_catalog"><![CDATA[
catalog:
  groups:
    - groupA
      - ac-1
      - ac-2
    - groupB
      - bc-1 
       ]]></tagging>
        <tagging whose="source_profile"><![CDATA[
profile:
  imports:
    - href: #catalogURI
      include-controls:
        with-ids:
          - ac-1
          - ac-2
          - bc-1
  merge:
    combine:
      method: keep 
      as-is: ~ 
       ]]></tagging>
        <tagging whose="inter_catalog"><![CDATA[
intermediate: 
#In this approach, the original hierarchy of the controls under the groups is stored,
#but is not shown in this example.
  controls:
    - ac-1
    - ac-2
    - bc-1
  groups:
    - groupA
    - groupB 
       ]]></tagging>
      </section>
      <section id="merge-custom">
        <head><q>custom</q></head>
        <p>The <src>custom</src> directive provides the target catalog with a custom structure. A one-to-one mapping of the desired structure of the target catalog is defined alongside control matching instructions, resulting in a strictly controlled output catalog.</p>
        <section id="custom-groups">
          <head>Creating Custom Groups</head>
          <p><req level="must" id="req-custom-group">A <src>group</src> object given under <src>custom</src> MUST result in a <tgt>group</tgt> with the exact same content (excluding <src>insert-controls</src>) in the target catalog.</req></p>
          <p><req level="must" id="req-custom-group-contents">If the ID of the group matches the ID of a group that has been included during the import phase, all contents inside the group, including <src>title</src>,<src>param</src>,<src>prop</src> and <src>part</src> objects MUST be copied into the target, appearing in the same order as in the source.</req></p>
          <p>Note that groups defined in <src>custom</src> may vary from fully featured to minimally instantiated. This includes arbitrary nesting of such groups inside of one another. No groups other than those explicitly declared should appear in the output catalog.</p>
        </section>
        <section id="custom-selection">
          <head>Inserting Controls</head>
          <p>The <src>insert-controls</src> directive may appear anywhere under <src>custom</src>, whether as a direct child or inside any of the defined groups. Inside insert-controls,<src>include-controls</src> and <src>include-all</src> from the Import Phase <xref rid="import" /> are used with the same basic behavior to configure which controls are selected and inserted at the current location.</p>
          <p>In order to provide clarity, controls that match the various conditions of these inclusion directives inside the <src>custom</src> object will be referred to as &quot;selected&quot; instead of &quot;included&quot;. Only directly selected controls will appear in the target catalog.</p>
          <p><req level="must" id="req-custom-select">When processing the control selection of a <src>custom</src> element, the behavior defined in this section MUST be followed to generate the output.</req></p>
          <p>A <src>insert-controls</src> with an <src>include-controls</src> child results in the following behavior:</p>
          <ul>
            <li>
              <p><src>with-id</src> results in selecting and inserting, at that point inside the new grouping, the included controls with the <src>id</src> given by <src>with-id</src>. They should be given in the same order as they appear in the control selection(s).</p>
            </li>
            <li>
              <p>A <src>matching</src> directive results in selecting and inserting, at that point inside the new grouping, all included controls whose <src>id</src> match, as a Glob expression, the pattern given in the <src>pattern</src>. They are given in the same order as they appear in the input control selection(s).</p>
            </li>
          </ul>
          <p>An <src>insert-controls</src> with an <src>include-all</src> child results in all included controls being selected and inserted. They are given in the same order as they appear in the input control selection(s).</p>
          <p><src>insert-controls</src> can also indicate the order that the selected controls are to be emitted in the result catalog using an <src>order</src> child. Three values MUST be supported and handled as specified below:</p>
          <ul>
            <li>
              <p><code>ascending</code> will sort all selected controls into ascending alphanumeric order by their ID.</p>
            </li>
            <li>
              <p><code>descending</code> will sort all selected controls into descending alphanumeric order by their ID.</p>
            </li>
            <li>
              <p><code>keep</code> indicates that controls should be inserted in the order of their appearance, using a depth-first traversal of the source profile&apos;s imports.</p>
            </li>
          </ul>
          <p><req level="must" id="req-custom-select-ignore">In the case that a control selection matches none of the included controls, it MUST be ignored.</req> <req level="should" id="req-custom-select-warning">In the case that a control selection matches none of the included controls, a warning SHOULD be provided.</req> If a control that was included by the Import Phase is never selected, no error occurs, that control simply does not appear in the output catalog.</p>
        </section>
      </section>
    </section>
    <section id="merge-wrapup">
      <head>Wrapping up the Merge Phase</head>
      <p>After the merge phase, the intermediate should now closely resemble the content and structure of the final output catalog. Controls and groups have been included, remapped, de-duplicated, then placed into their final location within the output&apos;s structure. Note: there is still an opportunity for included controls or groups to become referenced; and therefore, not eligible for pruning <xref rid="cleanup" /> in the next phase.</p>
      <p>Regardless of any merge directives, there also likely remains &quot;loose params&quot; that have been propagated forward; these too must be persisted.</p>
    </section>
  </section>
  <section id="modify-phase">
    <head>Modify Phase</head>
    <p>There are two ways profiles may further modify the results of profile resolution: setting parameters, and altering controls. These activities are defined as two child objects inside the third step of profile resolution, the Modify Phase.</p>
    <p>The following section contains requirements for processing the <src>modify</src> child of a source profile.</p>
    <section id="param-setting">
      <head>Setting Parameters</head>
      <p>Modification of parameter settings is indicated using the <src>set-parameter</src> object under <src>modify</src>. For this section, a given <src>set-parameter</src> object will be referred to as the source.</p>
      <p>Profile Resolution Tools MUST adhere to the following requirements for processing &quot;set-parameter&quot;:</p>
      <ul>
        <li>
          <p>First, the list of included params (among &quot;loose params&quot; and remaining included controls and groups) is searched for a param who has an &quot;id&quot; equal to this object&apos;s &quot;param-id&quot;. This is the &quot;target&quot;.<req level="should" id="req-modify-set-param-warning">If no such parameter is found, a warning SHOULD be issued.</req> <req level="must" id="req-modify-set-param-id-ignore">If no such parameter is found, processing MUST still continue.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-modify-set-param-objects1">For the following objects inside the source: class, depends-on, label, usage, values, select; the object MUST be copied into the target from the source, first removing any existing objects with the same name.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-modify-set-param-objects2">For the following objects inside the source: props, links, constraints, guidelines; the contents of the object MUST be added to the contents of the target object of the same name. If no such object exists in the target, it is created.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-modify-set-param-objects3">For the following objects inside the source: prop, link; the object MUST be copied into the target from the source, first removing any existing objects with the same distinctive ID. (<xref rid="id"></xref>).</req></p>
        </li>
        <li>
          <p><req level="must" id="req-modify-param-multi">If more than one <src>set-parameter</src> directive is given for the same parameter, all MUST BE applied, in the sequence given in the profile.</req></p>
        </li>
      </ul>
    </section>
    <section id="control-altering">
      <head>Altering controls</head>
      <p>A control can be altered by an <src>alter</src> object inside &quot;modify&quot;. The <src>control-id</src> child object under the <src>alter</src> indicates the control to which the alteration is applied.</p>
      <section id="add-directive">
        <head>Adding contents to controls</head>
        <p>Contents may be added to controls using an add directive inside an alter directive. There are two forms of alteration: with implicit and explicit bindings.</p>
        <section id="add-to-control">
          <head>Implicit binding</head>
          <p><req level="must" id="req-modify-alter-add-implicit">An <src>add</src> directive with no <src>by-id</src> child MUST be considered an implicit binding, and will apply to the control as a whole.</req></p>
          <p><req level="must" id="req-modify-alter-add-implicit0contents">The contents of an implicitly bound add directive MUST be added to the control contents in the target, either after its <tgt>title</tgt> when <src>position</src> is <code>starting</code>, or at the end if its position is <code>ending</code>, or if no valid poisition is given.</req></p>
          <p><req level="must" id="req-modify-alter-add-implicit-position">When an add directive is implicitly bound, the <src>position</src> values <code>before</code> and <code>after</code> MUST be treated like <code>starting</code> and <code>ending</code>, respectively.</req></p>
          <p>Control contents in catalogs must appear in the order <code>title, param, prop, link, part, control</code> per the OSCAL model documentation.<req level="must" id="req-modify-alter-add-implicit-order">After processing an implicitly bound add directive, the control contents MUST be sorted to appear in the required order: a new <tgt>prop</tgt> appears after any <src>prop</src> already in the control, when <src>position</src> is <code>ending</code>, or not given, or before any <src>prop</src> in the control when <src>position</src> is <code>starting</code>.</req></p>
          <mapping>
            <p>An addition operating on a control with implicit binding and position <code>starting</code></p>
            <tagging whose="source_catalog"><![CDATA[
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready 
           ]]></tagging>
            <tagging whose="source_profile"><![CDATA[
alter:
  control-id: a1
  add:
    position: starting
    props:
      - name: basis
        value: enumerated
    parts:
      - name: caution
        prose: \\n\\nPending scheduled testing. 
           ]]></tagging>
            <tagging whose="target_catalog"><![CDATA[
control:
  id: a1
  title: Basic precautions
  props:
    - name: basis
      value: enumerated
    - name: status
      value: ready
  parts:
    - name: caution
      prose: \\n\\nPending scheduled testing. 
           ]]></tagging>
            <p>Position is <code>starting</code> but the new <tgt>part</tgt> is added after the existing <tgt>prop</tgt>, because <tgt>prop</tgt> objects must always occur first.</p>
          </mapping>
          <mapping>
            <p>An addition operating on a control with implicit binding and position <code>ending</code></p>
            <tagging whose="source_catalog"><![CDATA[
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready 
           ]]></tagging>
            <tagging whose="source_profile"><![CDATA[
alter:
  control-id: a1
  add:
    position: starting
    props:
      - name: basis
        value: enumerated
    parts:
      - name: caution
        prose: \\n\\nPending scheduled testing. 
           ]]></tagging>
            <tagging whose="target_catalog"><![CDATA[
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready
    - name: basis
      value: enumerated
  parts:
    - name: caution
      prose: \\n\\nPending scheduled testing. 
           ]]></tagging>
            <p>The <src>position</src> is <code>ending</code> so the new <tgt>prop</tgt> appears after the existing <tgt>prop</tgt>.</p>
          </mapping>
        </section>
        <section id="add-to-element">
          <head>Explicit binding</head>
          <p>An explicit binding on an addition permits inserting new contents anywhere in a control, not only at the top level.<req level="must" id="req-modify-alter-add-explicit">An <src>add</src> directive with a <src>by-id</src> child MUST be considered an explicit binding, and applies to only a single object inside the control.</req> <req level="must" id="req-modify-alter-add-explicit-id">When an add directive is explitly bound, the value of the <src>by-id</src> child MUST correspond to the value of an <src>id</src> on an object inside the control, and not the control itself.</req> <req level="must" id="req-modify-alter-add-explicit-id-ignore">If <src>by-id</src> does not correspond to such a value, the <src>add</src> directive MUST be considered inoperative and ignored.</req> <req level="may" id="req-modify-alter-add-explicit-id-warning">An inoperative add directive MAY result in a warning.</req></p>
          <p>The object with <src>id</src> equal to the value of <src>by-id</src> is considered the <term>target</term> of the addition.</p>
          <p><req level="must" id="req-modify-alter-add-explicit-inside">When <src>position</src> has a value of <code>starting</code> or <code>ending</code>, the contents of the source MUST be added inside the target, either at the start or end of its contents, respectively.</req></p>
          <p><req level="must" id="req-modify-alter-add-explicit-outside">When <src>position</src> has a value of <code>before</code> or <code>after</code>, the contents of the source MUST be added outside the target, either directly before or after it, respectively.</req></p>
          <mapping>
            <p>An addition operating on a control with explicit binding and position <code>after</code></p>
            <tagging whose="source_catalog"><![CDATA[
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready
  parts:
    - name: recommendations
      id: a1.b
      parts: 
        - name: task1
          id: a1.b1
          prose: Collect recycling for pickup
        - name: task2
          id: a1.b2
          prose: Sweep surfaces free of dust
           ]]></tagging>
            <p>Note that the <src>add</src> directive identifies the object with <src>id</src>  <code>a1.b1</code> as its target.</p>
            <tagging whose="source_profile"><![CDATA[
alter:
  control-id: a1
  add:
    position: after
    by-id: a1.b1
    props:
      - name: basis
        value: allocated
    parts:
      - name: caution
        prose: Unavailable on weekends 
           ]]></tagging>
            <tagging whose="target_catalog"><![CDATA[
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready
  parts:
    - name: recommendations
      id: a1.b
      parts: 
        - name: task1
          id: a1.b1
          prose: Collect recycling for pickup
        - name: caution
          prose: Unavailable on weekends
        - name: task2
          id: a1.b2
          prose: Sweep surfaces free of dust
      props:
        - name: basis
          value: allocated
           ]]></tagging>
            <p>The <src>position</src> is <code>after</code> so both objects inside <src>add</src> are added after (not inside) the target object. Since the target object is inside another <tgt>part</tgt> in the control, the new additions appear there as well.</p>
            <p>Note that the result in this case will be schema-invalid since a <tgt>prop</tgt> may not occur directly following a <tgt>part</tgt>. A better result can be obtained (a better target may be defined) by using two <src>add</src> directives, to insert the new <tgt>prop</tgt> separately before any <tgt>part</tgt> objects in the target.</p>
          </mapping>
        </section>
        <section id="nested-controls">
          <head>Modifying controls inside controls</head>
          <p>OSCAL supports controls inside controls in the form of <src>control</src> objects inside <src>control</src> objects. Because the semantics of the <src>add</src> and remove directives target any (object) contents of controls, they can be used to target these child controls for modification as well as other contents.<req level="must" id="req-modify-alter-add-nested">Profile Resolution tools MUST be able to correctly handle add directives targetting nested controls. This includes directives that target a child control as well as directives that target a parent control and modify the child.</req></p>
        </section>
      </section>
      <section id="remove-directive">
        <head>Removing contents from controls</head>
        <p>Contents inside controls can be removed from them in catalog targets. In combination with adding new contents, this feature can be used to edit controls as well as amend them.</p>
        <p>A <src>remove</src> directive inside an <src>alter</src> directive identifies an object or set of objects inside a control to be removed. It does this using any of five child objects.</p>
        <p><req level="must" id="req-modify-alter-remove-match">An object inside the control MUST be removed from the output if and only if it meets all of the criteria given by the child objects of the remove directive.</req> When more than one child appears under the remove directive, an object would need to match all of them, otherwise it is not removed.</p>
        <ul>
          <li>
            <p><req level="must" id="req-modify-alter-remove-by-id">The remove directive criteria <src>by-id</src> MUST match an object if and only its value is identical to the <src>id</src> value of that object.</req> Because <src>id</src> values are unique, this criteria will result in the remove directive removing only a single object.</p>
          </li>
          <li>
            <p><req level="must" id="req-modify-alter-remove-name-ref">The remove directive criteria <src>name-ref</src> MUST match an object if and only its value is identical to the value of that object's <src>name</src> child.</req></p>
          </li>
          <li>
            <p><req level="must" id="req-modify-alter-remove-ns-ref">The remove directive criteria <src>ns-ref</src> MUST match an object if and only its value is identical to the value of that object's <src>ns</src> child.</req></p>
          </li>
          <li>
            <p><req level="must" id="req-modify-alter-remove-class-ref">The remove directive criteria <src>class-ref</src> MUST match an object if and only its value is identical to the value of that object's <src>class</src> child.</req></p>
          </li>
          <li>
            <p><req level="must" id="req-modify-alter-remove-item-name">The remove directive criteria <src>item-name</src> MUST match an object if and only its value is identical to the value of that object's serialized name.</req> For example,<code>remove:item-name:prop</code> has the effect of removing all <src>prop</src> objects from inside the control.</p>
            <p><req level="must" id="req-modify-alter-remove-item-name-array">In serialization formats that use arrays of objects in the OSCAL model, an object's name MUST be considered the singular form of its containing parent array.</req> For example, in the JSON format, remove:item-name:link would remove all of the objects inside of the <src>links</src> array.</p>
          </li>
        </ul>
      </section>
    </section>
  </section>
  <section id="finalphase">
    <head>Final Operations</head>
    <section id="target-back-matter">
      <head>Backmatter Resolution</head>
      <p><tgt>back-matter</tgt> in the result is produced by combining all objects within <src>back-matter</src> in all source catalogs, with the <src>back-matter</src> in the input profile.</p>
      <ul>
        <li>
          <p><req level="must" id="req-backmatter">The output's backmatter MUST be generated by copying in each <src>resource</src> object from the backmatters of the imported catalogs/profiles in top-to-bottom order, then by copying in each <src>resource</src> object from the backmatter of the source profile itself. These objects MUST be processed in the order they are given in their respective documents.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-backmatter-dupe">If a given <src>resource</src> has the same <src>uuid</src> as a resource that has already been added, the previous resource MUST be removed, and the more recent one added, unless superceded by other requirements.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-backmatter-keep">A <src>resource</src> with a child <src>prop</src> of <src>name:keep</src> and <src>value:always</src> MUST NOT be replaced by the addition of another <src>resource</src>, unless the new resource also has a child <src>prop</src> of <src>name:keep</src> and <src>value:always</src>.</req></p>
        </li>
      </ul>
      <p><req level="may" id="req-backmatter-prune">Tools MAY check for pruning conditions <xref rid="cleanup" /> as resources are added as long as the final result is the same as if the pruning had taken place at the end of all resource addition.</req></p>
      <p>Placing the keep always prop on a resource in a catalog has the effect of ensuring it will always appear in the output produced by any profile importing that catalog, even if nothing links to the resource. This version of the resource will also be the one copied, unless a later-imported catalog or importing profile offers its own version marked to keep always.</p>
    </section>
    <section id="target-metadata">
      <head>Metadata Resolution</head>
      <p>The following requirements MUST be followed with regards to the Metadata section of the output catalog:</p>
      <ul>
        <li>
          <p><req level="must" id="req-meta-uuid">The output catalog's metadata MUST have a unique top-level UUID (metadata:uuid). This UUID may be generated as seen fit by the tool, as long as it is reasonable to assume it is globally unique. It is RECOMMENDED that tools use a combination of meaningful text and a uniquely generated value (Ex.<code>{{sourceprofilename}}-RESOLVED-{{GUIDv5}}</code>).</req></p>
        </li>
        <li>
          <p><req level="must" id="req-meta-version">The value of metadata:version in the target MUST be set with a string that identifies the version of that document.</req> <req level="should" id="req-meta-version-track">The metadata:version SHOULD be used to track updates to this specific output document.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-meta-oscal-version">The value of metadata:oscal-version in the target MUST be set with a string that identifies the version of OSCAL used by this tool to resolve the profile (ex. 1.0.0). This value MUST be determined by compiling the oscal-versions from each imported document and the source profile, and taking the most recent minor version. If this version is more recent than what the resolution tool is using, then the value of the output oscal-version MUST be the version that the tool used internally.</req> <req level="must" id="req-meta-oscalversion-error">If any of the above OSCAL versions (imported document versions, source profile version, tool version) are of a different major version (the first digit differs), the tool SHOULD provide an error and cease processing.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-meta-last-modified">The value of metadata:last-modified in the target MUST be set with a valid timestamp. This value SHOULD represent the time that profile resolution occurred.</req></p>
        </li>
        <li>
          <p><req level="should" id="req-meta-source-profile">The value of metadata:source-profile in the target SHOULD be set with a valid URI that points to the profile that resulted in this catalog.</req> <req level="may" id="req-meta-source-profile-privacy">If there are privacy or security concerns, the value of metadata:source-profile MAY be set to anything, in which case the simple existence of the source-profile property indicates that this is a resolved profile.</req></p>
        </li>
        <li>
          <p><req level="should" id="req-meta-resolution-tool">The value of metadata:resolution-tool in the target SHOULD be set with a string that represents the tool that was used to resolve this catalog.</req></p>
<!-- TODO: Should this be generalized? -->        </li>
        <li>
          <p><req level="must" id="req-meta-keep">For any metadata:roles or metadata:parties that exist in the source catalogs, if they have a <src>prop</src> child with name:keep and value:always, they are to be copied as is into the output metadata.</req></p>
        </li>
      </ul>
      <p>Beyond these requirements, tools are free to use any and all of the objects inside metadata to provide additional information downstream.</p>
      <p>Because of options in producing metadata and especially the requirement for a timestamp, developers and users should note that two different resolutions of the same profile will not, ordinarily, be identical inside <tgt>metadata</tgt>.</p>
    </section>
    <section id="cleanup">
      <head>Pruning and Ordering</head>
      <p><req level="should" id="req-prune">The processor SHOULD prune the resulting output catalog by removing unused objects.</req></p>
      <ul>
        <li>
          <p><req level="must" id="req-prune-keep">Any object that has a child <src>prop</src> with a <src>name</src> of "keep" and a <src>value</src> of "always" MUST NOT be pruned.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-prune-include">If an object was explicitly included in the <xref rid="select-phase" />, it MUST NOT be pruned.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-prune-custom">If an object was referenced in a <src>custom</src> section of the source profile, it MUST NOT be pruned.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-prune-modify">If an object was referenced in the <src>modify</src> section of the source profile, it MUST NOT be pruned. Any objects removed in that section are still removed.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-prune-ref">If the object appears in a reference anywhere in the final result catalog, except in other objects that also meet all other pruning criteria, it MUST NOT be removed. A reference to a given object exists if &quot;#{distinctiveID}&quot; appears anywhere, where {distinctiveID} is the distinctive ID of the object <xref rid="id" />.</req></p>
        </li>
      </ul>
      <p>Implementers should note that pruning need not take place after all other steps. As long as all above criteria are respected, pruning can happen at any time, and doing so is a likely performance and memory overhead improvement.</p>
      <p><req level="must" id="req-reorder">Tools MUST reorder the output catalog into canonical order <xref rid="order" />, except where this specification provides different ordering requirements.</req></p>
    </section>
  </section>
  <section id="other">
    <head>Items of Note</head>
    <section id="id">
      <head>Distinct ID of Objects</head>
      <p>Whenever this specification refers to <q>distinctiveness</q>, it is to be interpreted as is defined in this section with regards to the object in question.</p>
      <p><req level="must" id="req-id-id">For the objects control, param, and group, distinctiveness MUST be determined by the value of the <q>id</q> child object.</req></p>
      <p><req level="must" id="req-id-uuid">For the object resource, distinctiveness MUST be determined by the value of the <q>uuid</q> <xref rid="target-back-matter" />.</req></p>
    </section>
    <section id="multiformat">
      <head>Dealing with Multiple Formats</head>
      <p><req level="should" id="req-multiformat">Profile Resolution tools SHOULD be able to handle source profiles, imported catalogs, and imported profiles that are serialized in XML, JSON, or YAML.</req> <req level="must" id="req-multiformat-differ">A different serialization format of any given input MUST NOT result in a differing output catalog.</req></p>
      <p>In order to help bootstrap this format management, the following resources are provided for implementers:</p>
      <ul>
        <li>
          <p>.<!-- TODO: Add links to OSCAL conversion libraries, format guidance pages, etc. --></p>
        </li>
      </ul>
      <p>The following sections provide additional requirements and guidance for each format.</p>
      <section id="xmlrequirements">
        <head>Requirements and Guidance for XML Output</head>
        <p><req level="must" id="req-output-xml">The final Catalog output, if using XML, MUST be valid as defined by the XML model documentation for the OSCAL Catalog. See <a href="https://pages.nist.gov/OSCAL/reference/latest/complete/xml-definitions/">the complete XML reference</a> for model requirements.</req></p>
<!-- TODO: Add Namespace --><!-- TODO: Consult XML Wizards on namespacing and other XML requirements -->      </section>
      <section id="jsonrequirements">
        <head>Requirements and Guidance for JSON Output</head>
        <p><req level="must" id="req-output-json">The final Catalog output, if using JSON, MUST be valid as defined by the JSON model documentation for the OSCAL Catalog. See the <a href="https://pages.nist.gov/OSCAL/reference/latest/complete/json-reference/">complete JSON reference</a> for model requirements.</req></p>
        <p>The JSON format, in general use, does not require the preservation of order of fields. As order matters in OSCAL, care should be taken to adhere to the canonical OSCAL order <xref rid="order" /> when outputting a catalog in JSON.</p>
<!-- TODO: Add Namespace (BaseURI) -->      </section>
      <section id="yamlrequirements">
        <head>Requirements and Guidance for YAML Output</head>
        <p><req level="must" id="req-output-yaml">The final Catalog output, if using YAML, MUST be valid as defined by the JSON model documentation for the OSCAL Catalog.</req> YAML is considered a simple variation on the JSON format. Beyond cosmetic differences there are no differences in the information structure between these formats. Therefore, the <a href="https://pages.nist.gov/OSCAL/reference/latest/complete/json-reference/">complete JSON reference</a> provides model requirements.</p>
        <p>The YAML format, in general use, does not require the preservation of order of fields. As order matters in OSCAL, care should be taken to adhere to the canonical OSCAL order <xref rid="order" /> when outputting a catalog in YAML.</p>
<!-- TODO: Add Namespace (BaseURI) -->      </section>
      <section id="order">
        <head>Order of objects in serialization</head>
        <p>In OSCAL, order of top level objects (those that are direct children of the root element) is considered important only when the XML format is used. To facilitate this, OSCAL provides the concept of <term>canonical order</term>. This order is provided by the OSCAL Metaschema files for a given document type (see <a href="https://pages.nist.gov/OSCAL/concepts/layer/overview/#modeling-approach">an overview of Metaschema</a>.</p>
        <p><req level="must" id="req-order">When the output format is XML, tools MUST use the OSCAL canonical order as described above. When using the YAML or JSON formats, order conveys no meaning, and is not considered important.</req></p>
      </section>
      <section id="comments-in-result">
        <head>Comments in result documents</head>
        <p>In an XML-based profile resolution, XML comments are one straightforward way for a processor to record events or conditions without affecting the output&apos;s nominal semantics. To support this, while two processors are obliged to return the same catalog XML for the same profile XML inputs, they are not required to match one another&apos;s comments, white space usage, attribute order, or processing instructions, only each other&apos;s objects, attributes and data content.</p>
        <p>One consequence of this is that processes intended to compare two profile resolutions may have to accommodate differences in comments, considering them as insignificant along with other differences in serialization.</p>
      </section>
    </section>
  </section>
</SPECIFICATION>
<!-- REMOVING INTRO
<section id="infocontext">
  <head>Informational Context and Scope</head>
  <p>A <term>profile</term>in OSCAL represents a selection and configuration of a set of <term>controls</term>. 
    In the normal case, the set of controls available to a profile is provided by a catalog.For example, the three NIST SP 800-53 profiles representing the impact baselines HIGH, MODERATE and LOW: call on a Catalog representing the families, 
    controls and control enhancements described in SP 800-53/53A. In a data processing system, this dependency can be modeled in the form of separate documents or data instances - the (nominal) <q>catalog</q>and its
    <q>profile</q>, the latter being a selection, adaptation and organization of controls, as distinct from the catalog from which those controls are derived.
  </p>
  <p>However, profiles may also select controls from profiles, thus deriving them from underlying catalogs as modified by those profiles. This feature enables an organization that wishes to promulgate guidelines or requirements to do so by publishing a set of customizations to an existing catalog, rather than create a catalog from scratch. Profiles can also arrange combinations of controls from more than one catalog or profile origin, making it possible to use them to support the creation of hybrid catalogs.</p>
  <p>In the general case OSCAL must support sourcing more than one catalog at once, in order to aggregate and organize controls from disparate sources. For example, it should be routine for a profile to acquire its controls from an authoritative standard catalog, plus a local supplement. But multiple catalog inputs, especially when they are produced and sourced independently of one another, may not combine without issues. In order to provide sensible and transparent results even for incoherent inputs, this specification defines these processes such that legible and testable results are produced even when they are formally invalid to constraints governing the outputs. Such downstream processing errors including validation errors are expected to be detectable and remediable. This especially applies to situations where multiple catalogs are sourced, or where the same catalog is sourced more than once, directly or indirectly.</p>
  <p>In order to support these semantics â€“ because whatever data set is sourced by a profile, it must
    <q>look like a catalog</q>â€“ the results of resolving a single profile must be in the form of a single catalog. Two different OSCAL processors that promise profile resolution, must deliver, for the same input, the same catalog with regard to its contents: which controls are included; their ordering (insofar as the target format represents ordering); and the structure (groups) in which they are embedded. This specification is designed to make this possible, by defining outputs with sufficient rigor that
    <q>the same</q>is meaningful and testable in this context.
  </p>
</section>
<section id="why-a-catalog">
 TODO: Needs more in-depth editing pass
  <head>Why resolve a profile as a catalog</head>
  <p>A profile is a representation of a delta, a
    <q>here to there</q>. As such, a profile might be conceived of as a recipe or instruction set â€“ a sequence of steps or procedures â€“ whereby to create an OSCAL catalog (set of controls describing security requirements) from an OSCAL catalog (set of controls describing security requirements). The primary use case for this is when we need to make a new catalog to apply to a system or set of systems, starting from a canonical, received, mandated or standard catalog with a more general scope.
  </p>
  <p>This is because although catalogs - for example, the controls described in NIST SP 800-53 - are published, available for use, and even standardized, they can never be used exactly in the form in which they are acquired. They must be taken from the packaging and placed into operational context before they mean anything. This typically requires that a few operations over
    <q>raw catalogs</q>be supported by a profiling mechanism. We must be able to select controls; we must be able to arrange them in order (or not); and we must be able to qualify or condition them by setting parameters defined for them and making adjustments to them.
  </p>
  <p>By representing the steps by which a base catalog can be sliced, sifted, amended and edited, into a (nominally) finished or ready set of control requirements, a profile makes it easier to codify and preserve even very incidental or temporary local revisions of a control catalog. Once expressed as a profile in OSCAL format, a set of amendments to a catalog (also known as &quot;tailoring&quot;) can be managed entirely separately and independently from the catalog. Because a conformant processor can always create the customized catalog by resolving the profile against its sources (executing the transformation described in this document), the profile can also be examined and used as a proxy for that catalog for other purposes. The customized catalog can be made available wherever and for whatever purposes it is needed, while its revision and maintenance can be focused on the profile.</p>
  <p>This separation of concerns - between the originating catalog authors, who describe policy in only general terms, and the authors of the
    <q>user manual</q>catalog, who must describe policy in very particular and local terms - is a necessary factor in supporting sustainable processes with the potential for automation and process improvement. An OSCAL profile bridges the gap between a set of general guidelines, and actionable rules. Only by examining the system in the context of the actual intentions appropriate to that system, can we properly assess its security. Profiles make this possible.
  </p>
  <p>In order for this to work, however, we need a process that can perform the necessary operations, to apply the delta to an unmodified catalog, to produce the local view of the catalog as modified. This is profile resolution.</p>
</section>
-->


================================================
FILE: src/specifications/profile-resolution/profile-resolution-specml.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="lib/spec-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-model href="lib/specml.rnc" type="application/relax-ng-compact-syntax"?>

<!-- Edit this PI for checking up on test bindings -->
<?specml-testset resolution-testing.xml?>
<?xml-stylesheet type="text/css" href="lib/specml.css"?>
<SPECIFICATION xmlns="http://csrc.nist.gov/ns/oscal/specml">
  <head>OSCAL Profile Resolution</head>
  <section id="draft">
    <head>Notice of Draft Status</head>
    <p>Please note that this specification is currently a work in progress and is subject to change. If you have any feedback or comments, please create an issue at the NIST OSCAL Github Repository: <a href="https://github.com/usnistgov/OSCAL">github.com/usnistgov/OSCAL</a>.</p>
  </section>
  <section id="abstract">
    <head>Abstract</head>
    <p>This specification provides the minimal requirements for processing an OSCAL Profile to create a new OSCAL Catalog Document. This process of applying a profile to a catalog to create a new catalog is called
      <term>Profile Resolution</term>. Not all OSCAL Profiles will be resolved, nor are expected to be; however, the resolution requirements in this document are crucial to understanding the intended functionality of any given OSCAL Profile.
       This specification is intended for software developers who intend to develop an OSCAL Profile Resolver, or for OSCAL Profile authors who want a more in-depth understanding of profile resolution.
    </p>
  </section>
  <section id="intro">
    <head>Introduction</head>
    <section id="purpose">
      <head>Purpose</head>
      <p><!-- For purposes of security assessment, an information system is designed and built (implemented) against a baseline of security controls. 
      An OSCAL Profile defines the selection and (where appropriate) amendments or alterations to a control catalog that are needed to establish a baseline.
      By design, OSCAL artifacts in the Implementation layer make reference to a catalog of controls. Profile Resolution allows for computing an effective catalog of controls from an OSCAL Profile.-->
        Information systems are implemented against a baseline of security controls. An OSCAL Profile defines the selection and potential alterations to a control catalog that are needed to establish a baseline. However, the OSCAL implementation layer depends on having an OSCAL Catalog that represents the baseline of controls to be implemented. Profile Resolution allows for computing an effective catalog based on an OSCAL Profile. For a given OSCAL Profile, the Profile Resolution process needs to result in the same OSCAL Catalog when executed by different tools on the same inputs. The requirements for resolution must therefore be well-defined and deterministic, enabling tool developers and parties exchanging OSCAL Profiles to work from a common understanding. This document defines the normative requirements for an OSCAL Profile Resolver.
</p>

      <p>No requirements are placed on implementation-level details, instead, requirements are laid out as what the output of resolution must look like given a certain input.
         By adhering to these requirements OSCAL producers, OSCAL consumers, and any other members of the OSCAL ecosystem can create and resolve profiles deterministically, 
         with repeatable results, regardless of the tool used.</p>
    </section>
  </section>
  <section id="readingthis">
    <head>Reading This Document</head>
    <section id="terminology">
      <!-- TODO: Parse document for additional terms to add -->
      <head>Terminology</head>
      <p>Many core OSCAL concepts are defined on the <a href="https://pages.nist.gov/OSCAL/concepts/terminology/">OSCAL Terminology Page</a>. The most important are repeated in this document, but readers should verify their understanding of all core OSCAL terms before reading this document.</p>
      <p>Additionally, many terms in the wider domain have overloaded definitions. Unless defined otherwise by OSCAL or explicitly in this document, terms are to be understood as defined in the <a href="https://csrc.nist.gov/glossary">NIST CSRC Glossary</a>.</p>
      <ul>
        <li>
          <p>
            <term>profile</term>- an OSCAL Profile Document. Defines a set of inclusions, modifications, and transformations against a
            <term>catalog</term>. See
            <a href="https://pages.nist.gov/OSCAL/concepts/layer/control/profile/">OSCAL Profile Model</a>.
          </p>
        </li>
        <li>
          <p>
            <term>catalog</term>- an OSCAL Catalog Document. Contains a well-defined set of
            <term>controls</term>. See
            <a href="https://pages.nist.gov/OSCAL/concepts/layer/control/catalog/">OSCAL Catalog Model</a>.
          </p>
        </li>
        <li>
          <p>
            <term>control</term>- an individual item in an OSCAL Catalog. See
            <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-53r5.pdf">NIST Special Publication 800-53r5</a>for a more in-depth definition.
          </p>
        </li>
        <li>
          <p>
            <term>profile resolution</term>- The process of consuming one or more OSCAL Profiles and the OSCAL Catalogs that they reference to produce a new tailored
            <term>catalog</term>. See
            <a href="https://pages.nist.gov/OSCAL/concepts/layer/control/catalog/">OSCAL Catalog Model</a>.
          </p>
        </li>
        <li>
          <p>
            <term>source</term>- refers to the profile document that is input into the profile resolution processor. This is the profile being resolved. In this document, when referring to objects from the
            <term>source</term>document, the following style is used:
            <src>source-object</src>.
          </p>
        </li>
        <li>
          <p>
            <term>target</term>- the intended output of the transformation, a catalog document. In this document, when referring to objects of a
            <term>target</term>document, the following style is used:
            <tgt>target-object</tgt>.
          </p>
        </li>
        <li>
          <p>
            <term>directive</term>- refers to an object or combination of objects in source documents, which is designed to affect a particular outcome in the target catalog. For the most part, directives are in the source profile document â€“ for example, a
            <src>set-parameter</src>object in a source profile is a directive to set a parameter value in the target catalog.
          </p>
        </li>
        <li>
          <p>
            <term>original order</term>- the order of objects as presented in the
            <term>source</term>document(s). See XYZ.
          </p>
        </li>
        <li>
          <p>
            <term>canonical order</term>- the order of objects as required in the appropriate OSCAL Model (Profile, Catalog, etc.). This can differ from the above order when converting between &quot;ordered&quot; formats (ex. XML), and &quot;non-ordered&quot; formats (ex. JSON).
          </p>
        </li>
      </ul>
    </section>
    <section>
      <head>Requirement Keywords</head>
      <p>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be interpreted as described in
        <a href="https://tools.ietf.org/pdf/bcp14.pdf">BCP 14</a>
        <a href="https://tools.ietf.org/pdf/rfc2119">[RFC2119]</a>
        <a href="https://tools.ietf.org/pdf/rfc8174">[RFC8174]</a>when, and only when, they appear in all capitals, as shown here.
      </p>
    </section>
    <section id="use-of-yaml">
      <head>Use of YAML</head>
      <p>OSCAL supports a variety of serialization formats, each of which having it&apos;s own benefits and drawbacks. In this document, YAML (YAML Ain&apos;t Markup Language) is used to represent the various objects of the
        <term>source</term>and
        <term>target</term>. All examples and in-line references will be represented using
        <a href="https://yaml.org/spec/1.2/spec.html">YAML 1.2</a>.
      </p>
      <p>YAML maps cleanly to JSON, thus allowing easy use of existing JSON/XML transformers where needed. With that in mind, the
        <a href="https://pages.nist.gov/OSCAL/reference/latest/complete/json-reference/">OSCAL Complete JSON Reference</a>is a valuable resource for understanding the YAML-based information structures used in this document. All JSON properties and objects defined in the reference equate to a YAML mapping, list, or dictionary.
      </p>
    </section>
    <section id="reading-examples">
      <head>Reading YAML Examples</head>
      <p>YAML is a particularly human-readable format. For those unfamiliar with the format, the basics:</p>
      <ul>
        <li>
          <p>Each line is a key-value pair, presented as
            <code>key:value</code>, or as
            <code>key:</code>with any number of list items on the following lines.
          </p>
        </li>
        <li>
          <p>Indentation, spacing, and white space matters. Items below a key and indented one level in are members (or children) of that key.</p>
        </li>
        <li>
          <p>List items are represented with a preceding dash
            <code>- listitemkey:value</code>.
          </p>
        </li>
      </ul>
      <p>The YAML specification is freely available here:
        <a href="https://yaml.org/spec/1.2/spec.html">YAML 1.2</a>.
      </p>
      <p>Additionally, in order to unambiguously express information, this specification uses additional conventions, as described below.</p>
      <p>There are some objects whose values must be determined dynamically at processing time. The most common example of this is timestamping output as it is processed. In this case, and any other dynamic-value cases, the expression
        <code>${{ }}</code>is used.
      </p>
      <p>For example:</p>
      <tagging whose="target_catalog">last-modified: ${{ timestamp }}</tagging>
      <p>Indicates the
        <tgt>last-modified</tgt>object should be produced with contents generated appropriately, in this case, the timestamp at the time of processing.
      </p>
      <p>Some examples may elide content to enhance readability or save space. In these cases, a YAML comment (any line that starts with
        <code>#</code>) will be used to explain the elision.
      </p>
      <p>Finally, although examples are syntactically faithful to OSCAL, they are not necessarily always formally valid in every respect. For example, OSCAL defines allowed property names (
        <src>props</src>) and values, and those rules may not be observed here. Examples are given for purposes of illustrating profile resolution semantics only, and should not be taken as normative for any actual use.
      </p>
    </section>
    <section id="document-layout">
      <head>Document Layout</head>
      <p>The specification is broken into the following major sections:</p>
      <ul>
        <li>
          <p>
            <term>Phases of Profile Resolution</term>- Lays out the necessary steps and phases of profile resolution. As each phase executes, the processor is understood to be creating and editing an intermediate representation of the output. There is one section for each of the three main phases.
          </p>
        </li>
        <li>
          <p>
            <term>Target Catalog Structure</term>- Provides the requirements for structuring the final output from the intermediate representation generated throughout the previous section.
          </p>
        </li>
      </ul>
      <p>
        <term>Please note</term>: As referenced in the Purpose section
        <xref rid="purpose" />, this specification makes no hard requirements on the specifics of implementation. It is feasible for an implementation to use no intermediate representation, and to directly and iteratively build the output. As long as all processing and output requirements are satisfied, any approach is allowed. With that said, the specification has been laid out to aid in implementation by providing a clear organization as a sequence of distinct operations.
      </p>
    </section>
    <section id="intermediate">
      <head>The Intermediate and Implementation Guidance</head>
      <p>The overall intent of this document, in addition to defining strict requirements, is to provide rough guidelines on implementing an OSCAL Profile Resolution Tool. To this end, each phase of resolution will be framed as a series of transformations applied to an internal data structure that is persistent throughout the process. We call this &quot;the intermediate&quot;.</p>
      <p>Any examples that are labelled as &quot;Intermediate&quot; are pseudo-code, designed to represent how this data structure might look as we apply different operations to it. The example intermediates are often not valid OSCAL, and are not to be taken as guidance, but rather a useful visualization tool for implementers.</p>
      <p>The authors believe that applying the steps of resolution in order against this intermediate representation is the simplest way to achieve full compliance with the specification. However, there is no requirement to implement profile resolution in this way. Requirements are given as rules on the output of resolution, and as such, tools can operate any way they would like internally.</p>
    </section>
  </section>
  <section id="phases">
    <head>Phases of Profile Processing</head>
    <p>An OSCAL Profile has three major sections, each which correspond to a phase of profile resolution. In order to complete the profile resolution process, each section must be fully parsed and a catalog output created.</p>
    <p><req level="recommended" id="req-phase-order">It is strongly RECOMMENDED
        that implementations execute the following steps in the order that they are provided here
        (import, merge, modify).</req> While it is possible to achieve compliance with a
      non-standard approach, the iterative nature of profile resolution lends itself to linear
      processing.</p>
    <p>The three steps are
      <term>import</term>;
      <term>merge</term>; and
      <term>modify</term>. In brief:
    </p>
    <ul>
      <li>
        <p>
          <term>import</term>- identifies one or more control sources (catalogs or profiles) and defines the controls within them to be included in the result catalog. If nothing is imported, no resulting catalog is produced. Invoked by
          <src>import</src>directives in source profiles;
        </p>
      </li>
      <li>
        <p>
          <term>merge</term>- designates the rules for how controls will be organized (ordered and/or grouped) and merged (addressing conflicts or ambiguities) in the result catalog. Controlled by the
          <src>merge</src>directive in source profiles; if none are included, default merge rules are used;
        </p>
      </li>
      <li>
        <p>
          <term>modify</term>- indicates how controls and their parameters in the underlying catalog are to be altered, edited, amended or added in the final result catalog. Logical evaluation and parameter constraints provide advanced processing. Controlled by the
          <src>modify</src>directive in source profiles. If a
          <src>modify</src>directive is not provided, no changes will be made to the controls that have been imported/merged.
        </p>
      </li>
    </ul>
    <p>As described in the previous section, when resolved, an OSCAL Profile takes the form of an OSCAL Catalog. The phases described below will produce outputs conforming to the catalog model.</p>
  </section>
  <section id="import">
    <head>Import Phase</head>
    <p>A profile begins by listing a set of catalogs and/or profiles to be imported. Each is represented by a resolvable resource URI and a directive specifying which controls to import from that resource. These resources may be available as static resources, or they may be produced dynamically on request; such as is the case when a profile is imported. Imports are given in sequence after the metadata:</p>
    <tagging whose="source_profile">
      
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: ${{ catalog URI }}
      include-controls: ${{ list of selected controls }}
    - href: ${{ profile URI }}
      include-controls: ${{ list of selected controls }} 
    </tagging>
    <p>In an import directive, the reference to the resource to be imported appears on an
      <src>href</src>child object. It takes either of two forms, external or internal:
    </p>
    <p>An external reference appears as an absolute or relative URL:</p>
    <tagging whose="source_profile">
      
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: >-
        https://github.com/usnistgov/oscal-content/tree
        /master/nist.gov/SP800-53/rev4/yaml/NIST_SP-800-53_rev4_catalog.yaml
      include-controls: ${{ list of selected controls }}
    - href: "../../NIST_SP-800-53_rev5_catalog.yaml"
      include-controls: ${{ list of selected controls }} 
    </tagging>
    <p>While an internal reference appears as below (see
      <xref rid="internalref" />):
    </p>
    <tagging whose="source_profile">
      
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: #80052rev4
      include-controls: ${{ list of selected controls }}
    - href: #80052rev5
      include-controls: ${{ list of selected controls }} 
    </tagging> 
    <p>All import directives will contain either
      <src>include-all: ~</src>or
      <src>include-controls</src>. These directives indicate which controls from the imported document are explicitly selected
      <xref rid="select-phase" />.
    </p>
    <p>The following section contains requirements for processing the
      <src>import</src> child of a source
      <src>profile</src>
    </p>
    <section id="importhrefs">
      <head>Import href Requirements</head>
      <section id="resolving-uris">
        <head>Import URI Resolution</head>
        <p><req level="must" id="req-uri-resolve">Tools MUST resolve
            URIs by following <a href="https://datatracker.ietf.org/doc/html/rfc3986#section-5"
              >Section 5 of RFC3986</a>, with the exception of URI Fragments (URIs that start with
            &quot;#&quot;). URI Fragments MUST instead be resolved as defined in <xref
              rid="internalref"/>.</req>
        </p>
      </section>
      <section id="aquiring-resource">
        <head>Import Resource Acquisition</head>
        <p><req level="must" id="req-uri-aquire">Tools MUST acquire resources at the resolved URI by following <a
              href="https://datatracker.ietf.org/doc/html/rfc3986#section-5">Section 5 of
              RFC3986</a>, with the exception of URI Fragments (URIs that start with &quot;#&quot;).
            URI Fragments MUST instead be acquired as defined in <xref rid="internalref"/>.
        </req></p>
        <p><req level="must" id="req-uri-base">For the purposes of resolving URIs
            using the above specification, the Base URI MUST be considered to be the absolute URI of
            the containing profile.</req></p>
        <p><req level="must" id="req-uri-error">In the case
            that acquiring a resource fails, the tool MUST cease processing and provide an error. In
            order to ensure profile resolution results in the same catalog regardless of which tool
            resolves it, all imports must successfully resolve. While this may cause inconvenience
            if resources are frequently not available, it ensures interoperability.</req></p>
        <p>Note that receiving a cached version of an import, or resolving an import that is otherwise unavailable through some other (but automatic) means still satisfies the above requirement. This specification does not put requirements on the precise function of the import, as long as the correct document is retrieved.</p>
      </section>
      <section id="internalref">
        <head>Internal References</head>
        <p>URI Fragments in OSCAL represent internal references to other OSCAL objects in the same document. These references follow the pattern of <code>#{{objectID}}</code>. For example, the URI Fragment <code>#param1</code> is referencing the Parameter with unique ID <code>param1</code>.</p>
        <p><req level="must" id="req-internal">In the context of the Import Phase,
            internal references will only appear as a reference to a profile or catalog that is in
            the <src>resources</src> section of the source. When tools encounter such a reference,
            they MUST locate the object in <src>resources</src> with the matching UUID value, and
            resolve the resource. By OSCAL model requirements, a given <src>resource</src> can have
            zero to many <src>rlink</src> objects and zero to one <src>base64</src> objects;
            however, it must have at least one of the two present. Tools can assume that any of
            these each resolves to the same underlying OSCAL object, although potentially in
            different serialization formats. For deterministic resolution of these backmatter OSCAL
            objects, tools need to adhere to the following requirements: </req></p>
        <ul>
          <li><p><req level="may" id="req-internal-resolve1">Tools MAY use any of the <src>rlink</src> or <src>base64</src>
                objects present in the <src>resource</src>.</req> </p> </li>
          <li><p><req level="may" id="req-internal-resolve2">Tools MAY verify that each above objects resolves to
                the same underlying OSCAL object. If there are OSCAL Model content differences
                between the resolved objects, the tool SHOULD provide a warning. </req></p> </li>
          <li><p><req level="must" id="req-internal-resolve3">When a
                  <src>rlink</src> is encountered and is to be resolved, it MUST be resolved by
                using a HTTP request to retrieve a byte stream. </req></p> </li>
          <li><p><req level="must" id="req-internal-resolve4">When
                a <src>base64</src> is encountered and is to be resolved, it MUST be considered a
                Byte Stream.</req>
            </p> </li>
          <li><p><req level="must" id="req-internal-resolve5">Regardless of its source, the Byte Stream MUST be decoded based on
                the algorithm defined in <a href="https://datatracker.ietf.org/doc/html/rfc4648">
                  Section 4 RFC 4648</a>. </req></p> </li>
        </ul>
        
        
        
        <p><req level="must" id="req-internal-error">If the object fetched cannot be found
            or is not a valid OSCAL object, the tool MUST cease processing and provide an
            error.</req></p>
        <tagging whose="source_profile">
          
profile:
  metadata: ~
  imports:
    - href: "#nist-sp800-53_catalog"
      include-controls: ${{ list of selected controls }}
    
  # Content Elided
    
  backmatter:
    resources:
      - uuid: "nist-sp800-53_catalog"
        description: "NIST SP 800-53 rev5 OSCAL format, on Github."
        rlinks:
          - rlink:
              href: >-
                https://github.com/usnistgov/oscal-content/tree
                /master/nist.gov/SP800-53/rev4/xml/NIST_SP-800-53_rev5_catalog.xml   
        </tagging>
      </section>
      <section id="URI-circular">
        <head>Resolving Imports of Profiles</head>
        <p><req level="must" id="req-circular-resolve">If the resource acquired is an OSCAL Profile, the tool
            MUST apply this specification to resolve it, then continue processing having imported
            the resulting catalog.</req></p>
        <p><req level="should" id="req-resolve-profile">When a profile imports a profile,
            the subordinate profile SHOULD be resolved first into a catalog using this
            specification, before it is imported. </req> This presents the possibility of circular
          imports, when a profile is directed to import itself either directly or indirectly.</p>
        <p>A
          <term>circular import</term> occurs when a profile imports an already imported profile, which was called at an earlier place in the import hierarchy. For example, if profile A imports profile B, and profile B imports profile A, the second import is circular. (An import at the top can only be circular if a profile tries to import itself.) If A imports B, B imports C and C imports A, Câ€™s import is circular.
        </p>
        <p>Note that an import can only be circular within the context of processing a particular profile. In the last example, Câ€™s import would not be circular if invoked in the context of resolving B by itself.</p>
        <p><req level="must" id="req-circular-error">If a processor encounters a <term>circular
              import</term> as described above (self-imports are inherently circular), the processor
            MUST cease processing and generate an error. </req></p>
        <mapping>
          <p>A profile identified as <code>home_profile.yaml</code>imports another one identified as
              <code>circular_profile.yaml</code>: </p>
          <tagging whose="source_profile">
            
profile:
  id: "home_profile.yaml"
  metadata: ~
  imports:
    - href: "circular_profile.yaml"
      include-controls: ${{ list of selected controls }} 
          </tagging>
          <p>In turn this file invokes <code>home_profile.xml</code>: </p>
          <tagging whose="source_profile">
            
profile:
  id: "circular_profile.yaml"
  metadata: ~
  imports:
    - href: "home_profile.yaml"
      include-controls: ${{ list of selected controls }} 
          </tagging>
          <p>Once detected, this circular import will result in an error and no further processing
            will take place.</p>
          <tagging whose="target_catalog">
            
  # Import at href: "circular_profile.yaml" failed.
  # Reason: Error during profile import:
  # Import at href: "home_profile.yaml" failed.
  # Reason: Circular import 
          </tagging>
        </mapping>
      </section>
      <section id="URI-multiple">
        <head>Multiple imports</head>
        <p>Each import directive is processed to produce a set of controls. <req
            id="rq-multiple-imports" level="must">Note that this occurs even if the same catalog is imported
            multiple times: each distinct import collects controls into a separate
              <int>selection</int></req>: </p>
        <tagging whose="source_profile">
          
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: "#catalog"
      include-controls:
       - with-ids:
          - ac-1
          - ac-2
    - href: "#catalog"
      include-controls:
       - with-ids:
          - ac-3
          - ac-4 
        </tagging>
        <tagging whose="inter_catalog">
          
intermediate:
  inclusions:
    - id: ${{uuid of #catalog}}
      included-controls:
          - ac-1
          - ac-2
    - id: ${{uuid of #catalog}}
      included-controls:
          - ac-3
          - ac-4 
        </tagging>
        <p><req id="rq-multiple-merge" level="must">The control inclusions are combined and collapsed in the next
            phase of processing</req>, <term>merge</term>(see <xref rid="merge-phase"/>) . </p>
        <p>Multiple imports against the same resource are allowed, and would most commonly occur when the profile author is using <xref rid="mapping"/> to create very specific output. 
          Multiple imports may result in outputs with clashing control IDs if mapping or the merge directive is not set correctly.</p>
      </section>
      <section id="mapping">
        <head>Mapping Controls</head>
        <p>The optional
          <src>mapping</src> child of a given
          <src>import</src> provides a simple ID remapping for objects included from that specific import. This provides the means for profile authors to proactively avoid clashing IDs of controls and other objects.
        </p>
        <p>The Mapping section consists of 5 optional subsections, each covering a particular type of object. Each subsection is a list of ID mappings to be applied for objects that are the parent object type.</p>
        <p>When encountering a given mapping instruction, processors:</p>
        <ul>
          <li>
            <p>MUST change the distinctive ID of that object to be equal to the value of the
              <src>to</src> object.
            </p>
          </li>
          <li>
            <p>MUST update all known references to the old ID in other included content, allowing the new ID to be used in subsequent profile sections.</p>
          </li>
        </ul>
        <p>Since mapping is a self contained process inside each import, the rest of this specification will continue to reference IDs with the assumption that mapping has already been applied if it was present. Since mapping is most commonly used to avoid clashing IDs, processors should take care to not handle duplicate IDs until after mapping is complete.</p>
        <p>Below is a simple example of mapping. The second
          <src>import</src> included controls from a different catalog whose ID values happen to collide. Knowing this, the profile author has remapped those IDs to new values.
        </p>
        <tagging whose="source_profile">
          
profile:
  uuid: ~
  metadata: ~
  imports:
    - href: "#catalog"
      include-controls:
       - with-ids:
          - ac-1
          - ac-2
    - href: "#catalog2"
      include-controls:
       - with-ids:
          - ac-1
          - ac-2
      mapping:
       - controls:
          - from: ac-1
            to: map-ac-1
          - from: ac-2
            to: map-ac-2
        </tagging>
        <p>Using the intermediate approach, an internal data structure resembling the following would result from the above profile:</p>
        <tagging whose="inter_catalog">
          
intermediate:
  metadata: ~
  inclusions:
    - id: ${{uuid of #catalog}}
      included-controls:
          - ac-1
          - ac-2
    - id: ${{uuid of #catalog2}}
      included-controls:
          - map-ac-1
          - map-ac-2 
        </tagging>
      </section>
    </section>
    <section id="select-phase">
      <head>Including Controls</head>
      <p>Each import contains directives on which controls from the imported catalog are to be fetched and used for further processing. Throughout the rest of the document we will refer to this as &quot;inclusion&quot;. 
        If a control is included, and the source profile makes no other changes to it, it will be present in the output. Exclusion directives in this section, as well as directives in the following two major sections (merge and modify), 
        may make changes to an included control or group that could cause it to appear differently, or not at all, in the output. Using the intermediate implementation approach, any control(s) that are included would be extracted from the referenced catalogs, any applicable mappings would be applied, then the controls(s) would be stored.</p>
      <section id="include-all">
        <head>include-all</head>
        <p><req level="must" id="req-include-all">
            When
            an import provides the <src>include-all</src> directive, ALL controls and groups in the
            referenced document (including nested controls) MUST be included. </req></p>
        <tagging whose="source_profile">include-all: ~</tagging>
      </section>
      <section id="include-by-id">
        <head>include-controls plus with-id</head>
        <p><req level="must" id="req-include-by-id">When an import provides the
              <src>include-controls</src> directive, with a <src>with-id</src> child, all controls
            in the referenced document whose <code>id</code> match one of the listed <code>id</code>
            values MUST be included. </req></p>
        <tagging whose="source_profile">
          
include-controls:
  - with-ids:
    - id: ac-1
    - id: ac-2
        </tagging>
      </section>
      <section id="include-by-match">
        <head>include-controls plus matching</head>
        <p>Controls may also be included using match patterns against their IDs. This is useful because related controls (either in a hierarchy, or together in a group) frequently have related IDs as well.</p>
        <p><req level="must" id="req-include-by-match">When an import provides the
          <src>include-controls</src> directive, with a
          <src>matching</src> child, all controls in the referenced document whose
          <code>id</code> matches one of the listed
          <code>pattern</code> values (Glob matching) MUST be included.
        </req></p>
        <p><req level="must" id="req-include-by-match-empty">If a
          <code>matching</code> object is provided with no
          <code>pattern</code>, it MUST be treated as matching nothing. While not providing a pattern is technically valid, resolution tool implementers should be aware that it is generally undesirable, and warnings or notices to the user may be appropriate.
        </req></p>
        <tagging whose="source_profile">
          
include-controls:
  - matching:
    - pattern: "ac*" 
        </tagging>
      </section>
      <section id="import-nested">
        <head>Dealing with Nested Controls and Groups</head>
        <p>In OSCAL, controls may contain child controls. For instance, in SP 800-53 many controls are supplemented with control enhancements; in OSCAL these are represented as child controls within parent controls. So parent AC-2 (in a given catalog) has children AC-2(1) through AC-2(13), for example.</p>
        <p>By default, inclusion of a control also causes any of that control&apos;s ancestors to also be included. By default, inclusion of a control DOES NOT cause the inclusion of any descendants of that control to be included. This applies to both controls and groups.</p>
        <p>This default behavior can be modified by the following two optional children of the
          <src>include-controls</src> object.
        </p>
        <section id="include-child-controls">
          <head>with-child-controls</head>
          <p>Child controls are, for the most part, treated the same as top level controls: they can be explicitly included using the selection directives above. As a shortcut to manually including all of the desired descendant controls of a given control, OSCAL provides the <code>with-child-controls</code> option. <code>with-child-controls</code> appears as a child object under a given inclusion directive, and defines additional behavior that is to be executed alongside the parent inclusion.</p>
          <p><req level="must" id="req-with-child-controls-yes">A <src>with-child-controls:
                yes</src> directive on an <src>include-controls</src> indicates that <em>all
                descendant controls</em> of the included control MUST also be included. </req></p>
          <p><req level="must" id="req-with-child-controls-no">A <src>with-child-controls:
                no</src> directive on an <src>include-controls</src> indicates that ONLY the
              matching control is included, any descendant children MUST NOT be included. </req></p>
          <p><req level="must" id="req-with-child-controls-none">If no
                <src>with-child-controls</src> is provided, the processor MUST consider the
              directive as being equivalent to one having <src>with-child-controls:no</src>.
          </req></p>
        </section>
      </section>
      <section id="exclude-directive">
        <head>exclude-controls</head>
        <p>Exclusions work the same way as inclusions, except with the opposite effect - the indicated control(s) do not appear in the target catalog.</p>
        <p><req level="must" id="req-exclude">Any control designated to be both
            included and excluded, MUST be excluded. This holds irrespective of the specificity of
            the selection for inclusion or exclusion.</req> For example, if AC-1 is included by id
            <code>ac-1</code> and excluded by matching <code>ac*</code>, it is excluded. </p>
        <p><req level="must" id="req-exclude-additional">When <src>exclude-controls</src>
            has at least one <src>with-ids</src> or <src>matching</src> directive, the processor
            MUST follow the same rules as defined in the relevant sections above for these
            directives, but exclude instead of include any controls. All optional features
              (<src>with-child-controls</src>, etc.) also apply to exclusion directives. </req></p>
      </section>
      <section id="redundant-calls">
        <head>Redundant Inclusions and Exclusions</head>
        <p><req level="must" id="req-redundant">A given <src>import</src> may have
            any number of inclusion statements and any number of exclusion statements. Their effect
            is cumulative; any control that is included (or excluded) more than once MUST be
            considered to be included (or excluded) only once. In other words, a given control being
            included or excluded more than once has no effect. Exclusion still takes priority over
            inclusion (see above). </req></p>
        <p>Note that this requirement only applies to controls included within the context of a single import. Controls with duplicate IDs included under a different
          <src>import</src> are not discarded. Also note that this redundancy pruning happens after any relevant mappings have been applied.
        </p>
      </section>
      <section id="import-param">
        <head>Handling Params</head>
        <p>Any
          <src>param</src>that is not directly under a control is referred to as a
          <q>loose</q>param.
        </p>
        <p><req level="must" id="req-loose-param">All loose params from both imported documents and the profile source MUST be included. These params will be kept in the final output if the document contains any references to them, and discarded otherwise. See
          <xref rid="cleanup" />.</req> Since new references can be created during the
          <src>modify</src> phase, tools should be careful not to prune params without fully understanding the final state of the output document.
        </p>
      </section>
      <section id="import-group"> <!-- TODO: Add requirements here? Take another look at this. -->
        <head>Handling Groups</head>
        <p>Some source catalogs use
          <src>group</src> objects to place controls into arbitrary groupings. Tools will need to be aware of these groups when executing the "merge" phase below, as they will duplicated into the output under the "as-is" mode and can be referenced in "custom" mode. The naÃ¯ve intermediate approach would keep all groups until all other phases are complete, but implementations may find it more performant to look ahead and prune unused groups early.
        </p>
        <p>Group objects that have a child <src>prop</src> object with name:keep and value:always MUST NOT be pruned (see <xref rid="cleanup"/>. Additional details on handling the final outputting of these groups can be found in the "merge" phase below.</p>
      </section>
      <section id="import-pitfalls">
        <head>Avoiding Implementation Pitfalls</head>
        <p>In order to ensure that implementers have as much flexibility as possible, requirements in this section have purposefully been kept minimal. Below are some common issues for implementers to be aware of:  </p>
        <ul> <!-- TODO: Add more of these pitfall tips? -->
          <li><p>The ordering and hierarchical organization of included controls as they were present in the original catalog may be used later in the resolution process. 
            Specifically, if the profile is using the "as-is" structuring directive, the ordering and organization of the output should match the source catalog as closely as possible. 
            Implementations may want to track this information, or look ahead to see what structuring mode is being used. Note that "as-is" also requires implementations to replicate any use of the <src>group</src> element.</p>
          </li>
        </ul>
      </section>
    </section>
    <section id="import-wrap-up">
      <head>Wrapping up the Import Phase</head>
      <p>At this point all requirements for content importing and control inclusion have been covered. If using the intermediate approach, the processor should have an intermediate that contains: a set of included controls and all of their child informational (non-control, non-group) objects, any relevant
        <src>group</src> objects and their informational content, and a set of included &quot;loose params&quot;
        <xref rid="import-param" /> (zero to many). The general structure of the intermediate would match that of the imported catalogs (i.e. nested controls remain nested, grouped controls remain grouped).
      </p>
    </section>
  </section>
  <section id="merge-phase">
    <head>Merge Phase</head>
    <p>Profiles may contain a
      <src>merge</src>section, where directives are given to instruct the processor how to combine the set of included objects collected during the Import Phase.
      <src>merge</src>has two parts: a &quot;combine&quot; directive, and a &quot;structuring&quot; directive.
    </p>
    <p><req level="recommended" id="req-merge-order">It is RECOMMENDED that tools apply the
        &quot;combine&quot; directive to the intermediate generated by the Import phase first, then
        apply the &quot;structuring&quot; directive.</req></p>
    <p>The following section contains requirements for processing the
      <src>merge</src> child of a source profile.
    </p>
    <section id="merge-combine">
      <head>The &quot;combine&quot; Directive</head>
      <p>
        <code>combine</code>is an optional child of
        <code>merge</code>that provides the rules for dealing with objects that have duplicate (or clashing) distinct IDs
        <xref rid="id" />.
      </p>
      <p>There are two valid combination methods provided by OSCAL, provided by the
        <src>method</src>child of
        <src>combine</src>:
      </p>
      <ul>
        <li>
          <p>use-first: Use the first definition - the first control with a given ID is used; subsequent ones are discarded</p>
        </li>
        <li>
          <p>keep: Keep - controls with the same ID are kept, retaining the clash</p>
        </li>
      </ul>
      <p><req level="must" id="req-merge-combine">Note that "merge:
          combine" is deprecated, and MUST be considered undefined behavior when
        encountered.</req></p>
      <p>In order to apply the combination method, IDs of each control explicitly included are compared against one another. As IDs are unique across entire OSCAL documents, different imports or any groupings have no bearing on collision. Processing requirements for each method are described below.</p>
      <section id="no-merge-explicit">
        <head>No Combine Directive</head>
        <p><req level="must" id="req-merge-none">
            If no <src>merge</src> directive
            is given in the profile, or if a <src>merge</src> is given without a <src>combine</src>,
            merge conflicts MUST be treated as if <src>method: keep</src> was given. </req> For
          example, a profile with no <src>merge</src> directive: </p>
        <tagging whose="source_profile">
          
profile:
  imports:
    - href: #catalogURI
      include-all: ~ 
        </tagging>
        <p>is the same as</p>
        <tagging whose="source_profile">
          
profile:
  imports:
    - href: #catalogURI
      include-all: ~
  merge:
    combine:
      method: keep
      flat: ~ 
        </tagging>
      </section>
      <section id="no-merge-combination-rule">
        <head>
          <q>method:keep</q>
        </head>
        <p><req level="must" id="req-merge-keep">When a merge is indicated by
          <src>method:keep</src>, or when no merge directive is given, the
          <q>keep</q>combination rule is used. Any control with the same distinctive ID
          <xref rid="id" />MUST NOT not merged. (They are kept.)
        </req></p>
        <tagging whose="source_profile">
          
  merge:
    combine:
      method: keep 
        </tagging>
        <p>Under this directive, colliding controls will result in invalid results, as they will both appear in the results with the same ID. Accordingly, this setting may be useful in ensuring integrity of references to controls as given in the profile: if any included control is called only once, clashing controls will not be produced, disambiguating the result and avoiding validation errors.</p>
        <tagging whose="source_profile">
          
profile:
  imports:
    - href: #catalog1
      include-controls:
        - with-ids
            id: ac-1
            id: ac-2
    - href: #catalog1
      include-controls:
        - with-ids
            id: ac-1
            id: ac-2 
  merge:
    combine:
      method: keep
        </tagging>
        <p>In the intermediate (showing control inclusions):</p>
        <tagging whose="inter_catalog">
          
intermediate:
  inclusions:
    - explicitly-included-controls:
          - ac-1
          - ac-2
          - ac-1
          - ac-2 
        </tagging>
        <p>In this case, downstream errors should be expected: the two
          <code>ac-1</code> controls clash with each other, as do the two
          <code>ac-2</code> controls.
        </p>
        <p><req level="should" id="req-merge-keep-warning">Processors SHOULD provide a warning under the merge:keep directive when duplicate controls are detected.</req> <req level="may" id="req-merge-keep-error">The processor MAY throw an error and cease processing (short-circuiting a certain future error) when duplicate controls are detected under the merge:keep directive.</req></p>
      </section>
      <section id="use-first-combination-rule">
        <head>
          <q>method:use-first</q>
        </head>
        <tagging whose="source_profile">
          
  merge:
    combine:
      method: use-first 
        </tagging>
        <p><req level="must" id="req-merge-use-first">When the
          &quot;use-first&quot;combination rule is applied, and controls that share a distinctive ID are found, the first control encountered MUST be kept, the rest MUST be discarded.
          &quot;First&quot; MUST be determined by a top-down, depth-first traversal of the source profile&apos;s import hierarchy.
        </req></p>
        <mapping>
          <tagging whose="source_profile">
            
profile:
  imports:
    - href: #catalog1
      include-controls:
        - with-ids
            id: ac-1
            id: ac-3
    - href: #catalog1
      include-controls:
        - with-ids
            id: ac-1
            id: ac-2 
  merge:
    combine:
      method: use-first
          </tagging>
          <p>In the intermediate(showing control inclusions):</p>
          <tagging whose="inter_catalog">
            
intermediate:
  inclusions:
    - explicitly-included-controls:
          - ac-1 (From catalog1)
          - ac-3
          - ac-2 
          </tagging>
        </mapping>
      </section>
      <section id="merge-combination-rule">
        <head>
          <src>method:merge</src>
        </head>
        <p>Deprecated, unspecified behavior.</p>
      </section>
    </section>
    <section id="structuring-result">
      <head>The &quot;structuring&quot; Directive</head>
      <p>This section describes how a profile may dictate the structure of the target
        <tgt>catalog</tgt>, apart from its
        <tgt>metadata</tgt> or
        <tgt>back-matter</tgt>. <req level="must" id="req-stucture">Optionally, one of three &quot;structuring&quot; directives can be included as a child of
        <src>merge</src>:
        <src>flat</src>,
        <src>as-is</src>and
        <src>custom</src>. When one of these appears, it is the selected structuring directive. If more than one appears, processors MUST generate an error and cease processing.</req> Processing requirements for each are given below:
      </p>
      <section id="structure-none">
        <head>No Structuring Directive</head>
        <p><req level="must" id="req-structure-none">If no
          <src>merge</src> directive is given in the profile, or if a
          <src>merge</src> is given without a structuring directive, structuring the output MUST be treated as if the structuring directive
          <src>flat</src> was given. For example, a profile with no
          <src>merge</src> directive:
        </req></p>
        <tagging whose="source_profile">
          
profile:
  imports:
    - href: #catalogURI
      include-all: ~ 
        </tagging>
        <p>is the same as</p>
        <tagging whose="source_profile">
          
profile:
  imports:
    - href: #catalogURI
      include-all: ~
  merge:
    combine:
      method: keep 
      flat: ~ 
        </tagging>
      </section>
      <section id="merge-flat">
        <head>&quot;flat&quot;</head>
        <p><req level="must" id="req-merge-flat">Profiles with the &quot;flat&quot; merge directive MUST be resolved as unstructured catalogs, with no grouping or nesting of controls.</req></p>
        <p><req level="must" id="req-merge-flat-list">Unstructured catalog output MUST be produced by adhering to the following requirements:</req></p> <!-- TODO, ISSUE, REQ TAGGING OF LISTS -->
        <ul>
          <li>
            <p><req level="must" id="req-merge-flat-list-1">All included controls are output to the target as a flat list directly under &quot;catalog&quot;. </req></p>
          </li>
          <li>
            <p><req level="must" id="req-merge-flat-list-2">Any included &quot;loose params&quot; are output to the target as a flat list directly under &quot;catalog&quot;.</req></p>
          </li>
          <li><p><req level="must" id="req-merge-flat-list-3">Any groups are discarded.</req></p></li>
        </ul>
        <p>An example of flat structuring is provided below</p>
        <tagging whose="source_catalog">
          
catalog:
  groups:
    - groupA
      - ac-1
      - ac-2
    - groupB
      - bc-1 
        </tagging>
        <tagging whose="source_profile">
          
profile:
  imports:
    - href: #catalogURI
      include-controls:
        with-ids:
          - ac-1
          - ac-2
          - bc-1
  merge:
    combine:
      method: keep 
      flat: ~ 
        </tagging>
        <tagging whose="inter_catalog">
          
intermediate:
  controls:
    - ac-1
    - ac-2
    - bc-1 
        </tagging>
      </section>
      <section id="merge-as-is">
        <head>
          <q>as-is</q>
        </head>
        <p>An
          <src>as-is</src> directive is used to reproduce the structure of the source documents in the target catalog.
        </p>
        <p><req level="must" id="id-structure-as-is-list">Processors MUST handle the
          <src>as-is</src> directive by adhering to the following requirements:</req> <!-- TODO, ISSUE, REQ TAGGING OF LISTS -->
        </p>
        <ul>
          <li>
            <p><req level="must" id="id-structure-as-is-list-1">All included controls are output to the target, keeping the structure of the groups and nested controls. Any group that holds an included control MUST appear in the output with all of its non-control children intact. 
              If an included control has a parent control that was not included, that control's output location is "up-leveled", or made equal to the non-included parent. This applies recursively until the control is directly under either "catalog" or another included control.</req></p>
          </li>
          <li>
            <p><req level="must" id="id-structure-as-is-list-2">Any included &quot;loose params&quot; are output to the target as a flat list directly under &quot;catalog&quot;.</req></p>
          </li>
        </ul>
        <p>Example:</p>
        <tagging whose="source_catalog">
          
catalog:
  groups:
    - groupA
      - ac-1
      - ac-2
    - groupB
      - bc-1 
        </tagging>
        <tagging whose="source_profile">
          
profile:
  imports:
    - href: #catalogURI
      include-controls:
        with-ids:
          - ac-1
          - ac-2
          - bc-1
  merge:
    combine:
      method: keep 
      as-is: ~ 
        </tagging>
        <tagging whose="inter_catalog">
          
intermediate: 
#In this approach, the original hierarchy of the controls under the groups is stored,
#but is not shown in this example.
  controls:
    - ac-1
    - ac-2
    - bc-1
  groups:
    - groupA
    - groupB 
        </tagging>
      </section>
      <section id="merge-custom">
        <head>
          <q>custom</q>
        </head>
        <p>The
          <src>custom</src>directive provides the target catalog with a custom structure. A one-to-one mapping of the desired structure of the target catalog is defined alongside control matching instructions, resulting in a strictly controlled output catalog.
        </p>
        <section id="custom-groups">
          <head>Creating Custom Groups</head>
          <p><req level="must" id="req-custom-group">A
            <src>group</src>object given under
            <src>custom</src> MUST result in a
            <tgt>group</tgt> with the exact same content (excluding
            <src>insert-controls</src>) in the target catalog.
          </req></p>
          <p><req level="must" id="req-custom-group-contents">If the ID of the group matches the ID of a group that has been included during the import phase, all contents inside the group, including
            <src>title</src>,
            <src>param</src>,
            <src>prop</src> and
            <src>part</src> objects MUST be copied into the target, appearing in the same order as in the source.
          </req></p>
          <p>Note that groups defined in
            <src>custom</src> may vary from fully featured to minimally instantiated. This includes arbitrary nesting of such groups inside of one another. No groups other than those explicitly declared should appear in the output catalog.
          </p>
        </section>
        <section id="custom-selection">
          <head>Inserting Controls</head>
          <p>The
            <src>insert-controls</src> directive may appear anywhere under
            <src>custom</src>, whether as a direct child or inside any of the defined groups. Inside insert-controls,
            <src>include-controls</src> and
            <src>include-all</src> from the Import Phase
            <xref rid="import" />are used with the same basic behavior to configure which controls are selected and inserted at the current location.
          </p>
          <p>In order to provide clarity, controls that match the various conditions of these inclusion directives inside the
            <src>custom</src> object will be referred to as &quot;selected&quot; instead of &quot;included&quot;. Only directly selected controls will appear in the target catalog.
          </p>
          <p><req level="must" id="req-custom-select">When processing the control selection of a <src>custom</src> element, the behavior defined in this section MUST be followed to generate the output.</req></p>
          <p>A
            <src>insert-controls</src> with an
            <src>include-controls</src> child results in the following behavior:
          </p>
          <ul>
            <li>
              <p>
                <src>with-id</src>results in selecting and inserting, at that point inside the new grouping, the included controls with the
                <src>id</src>given by
                <src>with-id</src>. They should be given in the same order as they appear in the control selection(s).
              </p>
            </li>
            <li>
              <p>A
                <src>matching</src>directive results in selecting and inserting, at that point inside the new grouping, all included controls whose
                <src>id</src>match, as a Glob expression, the pattern given in the
                <src>pattern</src>. They are given in the same order as they appear in the input control selection(s).
              </p>
            </li>
          </ul>
          <p>An
            <src>insert-controls</src> with an
            <src>include-all</src> child results in all included controls being selected and inserted. They are given in the same order as they appeared in the input control selection(s).
          </p>
          <p>
            <src>insert-controls</src> can also indicate the order that the selected controls are to be emitted in the result catalog using an
            <src>order</src> child. Three values MUST be supported and handled as specified below:
          </p>
          <ul>
            <li>
              <p>
                <code>ascending</code>will sort all selected controls into ascending alphanumeric order by their ID.
              </p>
            </li>
            <li>
              <p>
                <code>descending</code>will sort all selected controls into descending alphanumeric order by their ID.
              </p>
            </li>
            <li>
              <p>
                <code>keep</code>indicates that controls should be inserted in the order of their appearance, using a depth-first traversal of the source profile&apos;s imports.
              </p>
            </li>
          </ul>
          <p><req level="must" id="req-custom-select-ignore">In the case that a control selection matches none of the included controls, it MUST be ignored.</req> <req level="should" id="req-custom-select-warning">In the case that a control selection matches none of the included controls, a warning SHOULD be provided.</req> If a control that was included by the Import Phase is never selected, no error occurs. That control simply does not appear in the output catalog.</p>
        </section>
      </section>
    </section>
    <section id="merge-wrapup">
      <head>Wrapping up the Merge Phase</head>
      <p>After the merge phase, the intermediate should now closely resemble the content and structure of the final output catalog. Controls and groups have been included, remapped, de-duplicated, then placed into their final location within the output&apos;s structure. Note: there is still an opportunity for included controls or groups to become referenced; and therefore, not eligible for pruning
        <xref rid="cleanup" />in the next phase.
      </p>
      <p>Regardless of any merge directives, there also likely remains &quot;loose params&quot; that have been propagated forward; these too must be persisted.</p>
    </section>
  </section>
  <section id="modify-phase">
    <head>Modify Phase</head>
    <p>There are two ways profiles may further modify the results of profile resolution: setting parameters and altering controls. These activities are defined as two child objects inside the third step of profile resolution, the Modify Phase.</p>
    <p>The following section contains requirements for processing the
      <src>modify</src> child of a source profile.
    </p>
    <section id="param-setting">
      <head>Setting Parameters</head>
      <p>Modification of parameter settings is indicated using the
        <src>set-parameter</src> object under
        <src>modify</src>. For this section, a given
        <src>set-parameter</src> object will be referred to as the
        source.
      </p>
      <p>Profile Resolution Tools MUST adhere to the following requirements for processing &quot;set-parameter&quot;:</p>
      <ul>
        <li>
          <p>First, the list of included params (among &quot;loose params&quot; and remaining included controls and groups) is searched for a param who has an &quot;id&quot; equal to this object&apos;s &quot;param-id&quot;. This is the &quot;target&quot;. <req level="should" id="req-modify-set-param-warning">If no such parameter is found, a warning SHOULD be issued.</req> <req level="must" id="req-modify-set-param-id-ignore">If no such parameter is found, processing MUST still continue.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-modify-set-param-objects1">For the following objects inside the source: class, depends-on, label, usage, values, select; the object MUST be copied into the target from the source, first removing any existing objects with the same name.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-modify-set-param-objects2">For the following objects inside the source: <src>prop</src>, <src>link</src>, <src>constraint</src>, <src>guideline</src>; the contents of the object MUST be added to the contents of the target object of the same name. If no such object exists in the target, it is created.</req></p>
        </li>
        <li> <p><req level="must" id="req-modify-set-param-objects3">For the following objects inside the source: <src>prop</src>, <src>link</src>; the object MUST be copied into the target from the source, first removing any existing objects with the same distinctive ID. (<xref rid="id"/>).</req></p></li>
        <li>
          <p><req level="must" id="req-modify-param-multi">If more than one
            <src>set-parameter</src> directive is given for the same parameter, all MUST BE applied, in the sequence given in the profile.</req>
          </p>
        </li>
      </ul>
    </section>
    <section id="control-altering">
      <head>Altering controls</head>
      <p>A control can be altered by an
        <src>alter</src>object inside &quot;modify&quot;. The
        <src>control-id</src>child object under the
        <src>alter</src>indicates the control to which the alteration is applied.
      </p>
      <section id="add-directive">
        <head>Adding contents to controls</head>
        <p>Contents may be added to controls using an add directive inside an alter directive. There are two forms of alteration: with implicit and explicit bindings.</p>
        <section id="add-to-control">
          <head>Implicit binding</head>
          <p><req level="must" id="req-modify-alter-add-implicit">An
            <src>add</src> directive with no
            <src>by-id</src> child MUST be considered an implicit binding, and will apply to the control as a whole.</req>
          </p>
          <p><req level="must" id="req-modify-alter-add-implicit0contents">The contents of an implicitly bound add directive MUST be added to the control contents in the target, either after its
            <tgt>title</tgt> when
            <src>position</src> is
            <code>starting</code>, or at the end if its position is
            <code>ending</code>, or if no valid position is given.</req>
          </p>
          <p><req level="must" id="req-modify-alter-add-implicit-position">When an add directive is implicitly bound, the
            <src>position</src> values
            <code>before</code> and
            <code>after</code> MUST be treated like
            <code>starting</code> and
            <code>ending</code>, respectively.</req>
          </p>
          <p>Control contents in catalogs must appear in the order
            <code>title</code>, <code>param</code>, <code>prop</code>, <code>link</code>, <code>part</code>, <code>control</code> per the OSCAL model documentation. <req level="must" id="req-modify-alter-add-implicit-order">After processing an implicitly bound add directive, the control contents MUST be sorted to appear in the required order: a new
            <tgt>prop</tgt> appears after any
            <src>prop</src> already in the control, when
            <src>position</src> is
            <code>ending</code>, or not given, or before any
            <src>prop</src> in the control when
            <src>position</src> is
            <code>starting</code>.</req>
          </p>

          <mapping>
            <p>An addition operating on a control with implicit binding and position
              <code>starting</code>
            </p>
            <tagging whose="source_catalog">
               
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready 
            </tagging>
            <tagging whose="source_profile">
               
alter:
  control-id: a1
  add:
    position: starting
    props:
      - name: basis
        value: enumerated
    parts:
      - name: caution
        prose: \\n\\nPending scheduled testing. 
            </tagging>
            <tagging whose="target_catalog">
               
control:
  id: a1
  title: Basic precautions
  props:
    - name: basis
      value: enumerated
    - name: status
      value: ready
  parts:
    - name: caution
      prose: \\n\\nPending scheduled testing. 
            </tagging>
            <p>Position is
              <code>starting</code>but the new
              <tgt>part</tgt>is added after the existing
              <tgt>prop</tgt>, because
              <tgt>prop</tgt>objects must always occur first.
            </p>
          </mapping>
          <mapping>
            <p>An addition operating on a control with implicit binding and position
              <code>ending</code>
            </p>
            <tagging whose="source_catalog">
               
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready 
            </tagging>
            <tagging whose="source_profile">
               
alter:
  control-id: a1
  add:
    position: starting
    props:
      - name: basis
        value: enumerated
    parts:
      - name: caution
        prose: \\n\\nPending scheduled testing. 
            </tagging>
            <tagging whose="target_catalog">
               
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready
    - name: basis
      value: enumerated
  parts:
    - name: caution
      prose: \\n\\nPending scheduled testing. 
            </tagging>
            <p>The
              <src>position</src>is
              <code>ending</code>so the new
              <tgt>prop</tgt>appears after the existing
              <tgt>prop</tgt>.
            </p>
          </mapping>
        </section>
        <section id="add-to-element">
          <head>Explicit binding</head>
          <p>An explicit binding on an addition permits inserting new contents anywhere in a control, not only at the top level. <req level="must" id="req-modify-alter-add-explicit">An
            <src>add</src> directive with a
            <src>by-id</src> child MUST be considered an explicit binding, and applies to only a single object inside the control.</req> <req level="must" id="req-modify-alter-add-explicit-id">When an add directive is explicitly bound, the value of the
            <src>by-id</src> child MUST correspond to the value of an
              <src>id</src> on an object inside the control, and not the control itself.</req> <req level="must" id="req-modify-alter-add-explicit-id-ignore">If
            <src>by-id</src> does not correspond to such a value, the
                <src>add</src> directive MUST be considered inoperative and ignored.</req> <req level="may" id="req-modify-alter-add-explicit-id-warning">An inoperative add directive MAY result in a warning.</req>
          </p>
          <p>The object with
            <src>id</src> equal to the value of
            <src>by-id</src> is considered the
            <term>target</term> of the addition.
          </p>
          <p><req level="must" id="req-modify-alter-add-explicit-inside">When
            <src>position</src> has a value of
            <code>starting</code>or
            <code>ending</code>, the contents of the source MUST be added inside the target, either at the start or end of its contents, respectively.</req>
          </p>
          <p><req level="must" id="req-modify-alter-add-explicit-outside">When
            <src>position</src> has a value of
            <code>before</code> or <code>after</code>, the contents of the source MUST be added outside the target, either directly before or after it, respectively.</req>
          </p>
          <mapping>
            <p>An addition operating on a control with explicit binding and position
              <code>after</code>
            </p>
            <tagging whose="source_catalog">
               
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready
  parts:
    - name: recommendations
      id: a1.b
      parts: 
        - name: task1
          id: a1.b1
          prose: Collect recycling for pickup
        - name: task2
          id: a1.b2
          prose: Sweep surfaces free of dust
            </tagging>
            <p>Note that the
              <src>add</src>directive identifies the object with
              <src>id</src>
              <code>a1.b1</code>as its target.
            </p>
            <tagging whose="source_profile">
               
alter:
  control-id: a1
  add:
    position: after
    by-id: a1.b1
    props:
      - name: basis
        value: allocated
    parts:
      - name: caution
        prose: Unavailable on weekends 
            </tagging>
            <tagging whose="target_catalog">
               
control:
  id: a1
  title: Basic precautions
  props:
    - name: status
      value: ready
  parts:
    - name: recommendations
      id: a1.b
      parts: 
        - name: task1
          id: a1.b1
          prose: Collect recycling for pickup
        - name: caution
          prose: Unavailable on weekends
        - name: task2
          id: a1.b2
          prose: Sweep surfaces free of dust
      props:
        - name: basis
          value: allocated
            </tagging>
            <p>The
              <src>position</src>is
              <code>after</code>so both objects inside
              <src>add</src>are added after (not inside) the target object. Since the target object is inside another
              <tgt>part</tgt>in the control, the new additions appear there as well.
            </p>
            <p>Note that the result in this case will be schema-invalid since a
              <tgt>prop</tgt>may not occur directly following a
              <tgt>part</tgt>. A better result can be obtained (a better target may be defined) by using two
              <src>add</src>directives, to insert the new
              <tgt>prop</tgt>separately before any
              <tgt>part</tgt>objects in the target.
            </p>
          </mapping>
        </section>
        <section id="nested-controls">
          <head>Modifying controls inside controls
          </head>
          <p>OSCAL supports controls inside controls in the form of
            <src>control</src> objects inside
            <src>control</src> objects. Because the semantics of the
            <src>add</src> and remove directives target any (object) contents of controls, they can be used to target these child controls for modification as well as other contents. <req level="must" id="req-modify-alter-add-nested">Profile resolution tools MUST be able to correctly handle add directives targetting nested controls. This includes directives that target a child control as well as directives that target a parent control and modify the child. </req> </p>
        </section>
      </section>
      <section id="remove-directive">
        <head>Removing contents from controls</head>
        <p>Contents inside controls can be removed from them in catalog targets. In combination with adding new contents, this feature can be used to edit controls as well as amend them.</p>
        <p>A
          <src>remove</src>directive inside an
          <src>alter</src> directive identifies an object or set of objects inside a control to be removed. It does this using any of five child objects.
        </p>
        <p><req level="must" id="req-modify-alter-remove-match"> An object inside the control MUST be removed from the output if and only if it meets all of the criteria given by the child objects of the remove directive.</req> When more than one child appears under the remove directive, an object would need to match all of them, otherwise it is not removed.</p>
        <ul>
          <li>
            <p>
              <req level="must" id="req-modify-alter-remove-by-id">The remove directive criteria <src>by-id</src> MUST match an object if and only if its value is identical to the <src>id</src> value of that object.</req> Because
              <src>id</src> values are unique, this criteria will result in the remove directive removing only a single object.
            </p>
          </li>
          <li>
            <p>
              <req level="must" id="req-modify-alter-remove-name-ref">The remove directive criteria <src>name-ref</src> MUST match an object if and only if its value is identical to the value of that object's <src>name</src> child.</req>
            </p>
          </li>
          <li>
            <p><req level="must" id="req-modify-alter-remove-ns-ref">The remove directive criterion <src>by-ns</src> MUST match an object if and only if its value is identical to the value of that object's <src>ns</src> child. This directive
              is intended to be used in combination with <src>by-name</src> but may also be used to match all objects assigned to a given namespace (<src>ns</src>). Note that <src>by-ns="http://csrc.nist.gov/ns/oscal"</src> will address objects assigned to that namespace by default (where no explicit <src>ns</src> is given).</req></p>
          </li>
          <li>
            <p><req level="must" id="req-modify-alter-remove-class-ref">The remove directive criterion <src>by-class</src> MUST match an object if and only if its value is identical to the value of that object's <src>class</src> child.</req></p>
          </li>
          <li>
            <p><req level="must" id="req-modify-alter-remove-item-name">The remove directive criteria <src>item-name</src> MUST match an object if and only if its value is identical to the value of that object's serialized name.</req> For example,
              <code>remove:item-name:prop</code> has the effect of removing all
              <src>prop</src>objects from inside the control.
            </p>
            <p><req level="must" id="req-modify-alter-remove-item-name-array">In serialization formats that represent objects as (unlabeled) members of arrays, an object's name MUST be referenced in its (implicit) singular form, not the name of its containing array.</req> For example, in the JSON format, <src>remove.item-name: "link"</src> would remove all members of the <src>links</src> array, along with the array itself (as being empty it would no longer be valid). </p>
          </li>
        </ul>
      </section>
    </section>
  </section>
  <section id="finalphase">
    <head>Final Operations</head>
    <section id="target-back-matter">
      <head>Backmatter Resolution</head>
      <p>
        <tgt>back-matter</tgt> in the result is produced by combining all objects within
        <src>back-matter</src> in all source catalogs, with the
        <src>back-matter</src> in the input profile.
      </p>
      <ul>
        <li><p><req level="must" id="req-backmatter">The output's backmatter MUST be generated by copying in each <src>resource</src> object from the backmatters of the imported catalogs/profiles in top-to-bottom order, then by copying in each <src>resource</src> object from the backmatter of the source profile itself. These objects MUST be processed in the order they are defined in each respective document.</req></p></li>
        <li>
          <p><req level="must" id="req-backmatter-dupe">If a given
            <src>resource</src> has the same
            <src>uuid</src> as a resource that has already been added, the previous resource MUST be removed, and the more recent one added, unless superseded by other requirements.</req>
          </p>
        </li>
        <li>
          <p><req level="must" id="req-backmatter-keep">A <src>resource</src> with a child <src>prop</src> of <src>name:keep</src> and <src>value:always</src> MUST NOT be replaced by the addition of another <src>resource</src>, unless the new resource also has a child <src>prop</src> of <src>name:keep</src> and <src>value:always</src>.</req></p>
        </li>
      </ul>
      <p><req level="may" id="req-backmatter-prune">Tools MAY check for pruning conditions
        <xref rid="cleanup" /> as resources are added as long as the final result is the same as if the pruning had taken place at the end of all resource addition.</req>
      </p>
      <p>Placing the keep always prop on a resource in a catalog has the effect of ensuring it will always appear in the output produced by any profile importing that catalog, even if nothing links to the resource. This version of the resource will also be the one copied, unless a later-imported catalog or importing profile offers its own version marked to keep always.</p>
    </section>
    <section id="target-metadata">
      <head>Metadata Resolution</head>
      <p>The following requirements MUST be followed with regards to the Metadata section of the output catalog:</p>
      <ul>
        <li>
          <p><req level="must" id="req-meta-uuid">The output catalog's metadata MUST have a unique top-level UUID (metadata:uuid). This UUID MAY be generated as seen fit by the tool, as long as it is reasonable to assume it is globally unique. It is RECOMMENDED that tools use a Version 4 UUID as specified in <a href="https://datatracker.ietf.org/doc/html/rfc4122">Section 4 of RFC 4122</a>.
          </req></p>
        </li>
        <li>
          <p><req level="must" id="req-meta-version">The value of metadata:version in the target MUST be set with a string that identifies the version of that document.</req> <req level="should" id="req-meta-version-track">The metadata:version SHOULD be used to track updates to this specific output document.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-meta-oscal-version">The value of metadata:oscal-version in the target MUST be set with a string that identifies the version of OSCAL used by this tool to resolve the profile (ex. 1.0.0). This value MUST be determined by compiling the oscal-versions from each imported document and the source profile, and taking the most recent minor version. If this version is more recent than what the resolution tool is using, then the value of oscal-version MUST be the version that the tool used internally.</req> <req level="must" id="req-meta-oscalversion-error">If any of the above OSCAL versions (imported document versions, source profile version, tool version) are of a different major version (the first digit differs), the tool SHOULD provide an error and cease processing.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-meta-last-modified">The value of metadata:last-modified in the target MUST be set with a valid timestamp. This value SHOULD represent the time that profile resolution occurred.</req></p>
        </li>
        <li>
          <p><req level="should" id="req-meta-source-profile">A child <src>prop</src> object with <src>name:source-profile</src> MUST be created. The <src>value</src> object of this <src>prop</src> SHOULD be set with a valid URI that points to the profile that resulted in this catalog. </req> 
            <req level="may" id="req-meta-source-profile-privacy"> If there are privacy or security concerns, the <src>value</src> object of this <src>prop</src> MAY be set to anything, in which case the simple existence of the source-profile property indicates that this is a resolved profile.</req></p>
        </li>
        <li>
          <p><req level="should" id="req-meta-resolution-tool">A child <src>prop</src> object with <src>name:resolution-tool</src> SHOULD be created. The <src>value</src> object of this <src>prop</src> in the target SHOULD be set with a string that represents the tool that was used to resolve this catalog.</req></p>
        </li>
        <li><p><req level="must" id="req-meta-keep">For any metadata:roles or metadata:parties that exist in the source catalogs, if they have a <src>prop</src> child with name:keep and value:always, they are to be copied as is into the output metadata.</req></p></li>
      </ul>
      <p>Beyond these requirements, tools are free to use any and all of the objects inside metadata to provide additional information downstream.</p>
      <p>Because of options in producing metadata and especially the requirement for a timestamp, developers and users should note that two different resolutions of the same profile will not, ordinarily, be identical inside
        <tgt>metadata</tgt>.
      </p>
    </section>
    <section id="cleanup">
      <head>Pruning and Ordering</head>
      <p><req level="should" id="req-prune">The processor SHOULD prune the resulting output catalog by removing unused objects.</req></p>
      <ul>
        <li>
          <p><req level="must" id="req-prune-keep">Any object that has a child <src>prop</src> with a <src>name</src> of "keep" and a <src>value</src> of "always" MUST NOT be pruned.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-prune-include">If an object was explicitly included in the
            <xref rid="select-phase" />, it MUST NOT be pruned.</req>
          </p>
        </li>
        <li>
          <p><req level="must" id="req-prune-custom">If an object was referenced in a <src>custom</src> section of the source profile, it MUST NOT be pruned.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-prune-modify">If an object was referenced in the <src>modify</src> section of the source profile, it MUST NOT be pruned. Any objects removed in that section are still removed.</req></p>
        </li>
        <li>
          <p><req level="must" id="req-prune-ref">If the object appears in a reference anywhere in the final result catalog, except in other objects that also meet all other pruning criteria, it MUST NOT be removed. A reference to a given object exists if <code>#{distinctiveID}</code> appears anywhere, where <code>{distinctiveID}</code> is the distinctive ID of the object
            <xref rid="id" />.</req>
          </p>
        </li>
      </ul>
      <p>Implementers should note that pruning need not take place after all other steps. As long as all above criteria are respected, pruning can happen at any time, and doing so is a likely performance and memory overhead improvement.</p>
      <p><req level="must" id="req-reorder">Tools MUST reorder the output catalog into canonical order
        <xref rid="order" />, except where this specification provides different ordering requirements.</req>
      </p>
    </section>
  </section>
  <section id="other">
    <head>Items of Note</head>
    <section id="id">
      <head>Distinct ID of Objects</head>
      <p>Whenever this specification refers to
        &quot;distinctiveness&quot;, it is to be interpreted as is defined in this section with regards to the object in question.
      </p>
      <p><req level="must" id="req-id-id">For the objects control, param, and group, distinctiveness MUST be determined by the value of the
        &quot;id&quot; child object.</req>
      </p>
      <p><req level="must" id="req-id-uuid">For the object resource, distinctiveness MUST be determined by the value of the
        &quot;uuid&quot;
        <xref rid="target-back-matter" />.</req>
      </p>
    </section>
    <section id="multiformat">
      <head>Dealing with Multiple Formats</head>
      <p><req level="should" id="req-multiformat">Profile Resolution tools SHOULD be able to handle source profiles, imported catalogs, and imported profiles that are serialized in XML, JSON, or YAML.</req> <req level="must" id="req-multiformat-differ">A different serialization format of any given input MUST NOT result in a differing output catalog.</req></p>
      <p>In order to help bootstrap this format management, the following resources are provided for implementers:</p>
      <ul>
        <li>
          <p>.
            <!-- TODO: Add links to OSCAL conversion libraries, format guidance pages, etc. -->
          </p>
        </li>
      </ul>
      <p>The following sections provide additional requirements and guidance for each format.</p>
      <section id="xmlrequirements">
        <head>Requirements and Guidance for XML Output</head>
        <p><req level="must" id="req-output-xml">The final Catalog output, if using XML, MUST be valid as defined by the XML model documentation for the OSCAL Catalog. See
          <a href="https://pages.nist.gov/OSCAL/reference/latest/complete/xml-definitions/">the complete XML reference</a> for model requirements.</req>
        </p> 
      </section>
      <section id="jsonrequirements">
        <head>Requirements and Guidance for JSON Output</head>
        <p><req level="must" id="req-output-json">The final Catalog output, if using JSON, MUST be valid as defined by the JSON model documentation for the OSCAL Catalog. See the
          <a href="https://pages.nist.gov/OSCAL/reference/latest/complete/json-reference/">complete JSON reference</a> for model requirements. </req>
        </p>
        <p>The JSON format, in general use, does not require the preservation of order of fields. As order matters in OSCAL, tools SHOULD adhere to the canonical OSCAL order
          <xref rid="order" /> when outputting a catalog in JSON.
        </p> 
      </section>
      <section id="yamlrequirements">
        <head>Requirements and Guidance for YAML Output</head>
        <p><req level="must" id="req-output-yaml">The final Catalog output, if using YAML, MUST be valid as defined by the JSON model documentation for the OSCAL Catalog. </req> YAML is considered a simple variation on the JSON format. Beyond cosmetic differences there are no differences in the information structure between these formats. Therefore, the
          <a href="https://pages.nist.gov/OSCAL/reference/latest/complete/json-reference/">complete JSON reference</a> provides model requirements.
        </p>
        <p>The YAML format, in general use, does not require the preservation of order of fields. As order matters in OSCAL, tools SHOULD adhere to the canonical OSCAL order
          <xref rid="order" /> when outputting a catalog in YAML.
        </p> 
      </section>
      <section id="order">
        <head>Order of objects in serialization</head>
        <p>In OSCAL, order of top level objects (those that are direct children of the root element) is considered important only when the XML format is used. To facilitate this, OSCAL provides the concept of
          <term>canonical order</term>. This order is provided by the OSCAL Metaschema files for a given document type (see
          <a href="https://pages.nist.gov/OSCAL/concepts/layer/overview/#modeling-approach">an overview of Metaschema</a>.
        </p>
        <p><req level="must" id="req-order">When the output format is XML, tools MUST use the OSCAL canonical order as described above. When using the YAML or JSON formats, order conveys no meaning, and is not considered important.</req></p>
      </section>
      <section id="comments-in-result">
        <head>Comments in result documents</head>
        <p>In an XML-based profile resolution, XML comments are one straightforward way for a processor to record events or conditions without affecting the output&apos;s nominal semantics. To support this, while two processors are obliged to return the same catalog XML for the same profile XML inputs, they are not required to match one another&apos;s comments, white space usage, attribute order, or processing instructions, only each other&apos;s objects, attributes and data content.</p>
        <p>One consequence of this is that processes intended to compare two profile resolutions may have to accommodate differences in comments, considering them as insignificant along with other differences in serialization.</p>
      </section>
    </section>
  </section>
</SPECIFICATION>
<!-- REMOVING INTRO
<section id="infocontext">
  <head>Informational Context and Scope</head>
  <p>A <term>profile</term>in OSCAL represents a selection and configuration of a set of <term>controls</term>. 
    In the normal case, the set of controls available to a profile is provided by a catalog.For example, the three NIST SP 800-53 profiles representing the impact baselines HIGH, MODERATE and LOW: call on a Catalog representing the families, 
    controls and control enhancements described in SP 800-53/53A. In a data processing system, this dependency can be modeled in the form of separate documents or data instances - the (nominal) <q>catalog</q>and its
    <q>profile</q>, the latter being a selection, adaptation and organization of controls, as distinct from the catalog from which those controls are derived.
  </p>
  <p>However, profiles may also select controls from profiles, thus deriving them from underlying catalogs as modified by those profiles. This feature enables an organization that wishes to promulgate guidelines or requirements to do so by publishing a set of customizations to an existing catalog, rather than create a catalog from scratch. Profiles can also arrange combinations of controls from more than one catalog or profile origin, making it possible to use them to support the creation of hybrid catalogs.</p>
  <p>In the general case OSCAL must support sourcing more than one catalog at once, in order to aggregate and organize controls from disparate sources. For example, it should be routine for a profile to acquire its controls from an authoritative standard catalog, plus a local supplement. But multiple catalog inputs, especially when they are produced and sourced independently of one another, may not combine without issues. In order to provide sensible and transparent results even for incoherent inputs, this specification defines these processes such that legible and testable results are produced even when they are formally invalid to constraints governing the outputs. Such downstream processing errors including validation errors are expected to be detectable and remediable. This especially applies to situations where multiple catalogs are sourced, or where the same catalog is sourced more than once, directly or indirectly.</p>
  <p>In order to support these semantics â€“ because whatever data set is sourced by a profile, it must
    <q>look like a catalog</q>â€“ the results of resolving a single profile must be in the form of a single catalog. Two different OSCAL processors that promise profile resolution, must deliver, for the same input, the same catalog with regard to its contents: which controls are included; their ordering (insofar as the target format represents ordering); and the structure (groups) in which they are embedded. This specification is designed to make this possible, by defining outputs with sufficient rigor that
    <q>the same</q>is meaningful and testable in this context.
  </p>
</section>
<section id="why-a-catalog">
 TODO: Needs more in-depth editing pass
  <head>Why resolve a profile as a catalog</head>
  <p>A profile is a representation of a delta, a
    <q>here to there</q>. As such, a profile might be conceived of as a recipe or instruction set â€“ a sequence of steps or procedures â€“ whereby to create an OSCAL catalog (set of controls describing security requirements) from an OSCAL catalog (set of controls describing security requirements). The primary use case for this is when we need to make a new catalog to apply to a system or set of systems, starting from a canonical, received, mandated or standard catalog with a more general scope.
  </p>
  <p>This is because although catalogs - for example, the controls described in NIST SP 800-53 - are published, available for use, and even standardized, they can never be used exactly in the form in which they are acquired. They must be taken from the packaging and placed into operational context before they mean anything. This typically requires that a few operations over
    <q>raw catalogs</q>be supported by a profiling mechanism. We must be able to select controls; we must be able to arrange them in order (or not); and we must be able to qualify or condition them by setting parameters defined for them and making adjustments to them.
  </p>
  <p>By representing the steps by which a base catalog can be sliced, sifted, amended and edited, into a (nominally) finished or ready set of control requirements, a profile makes it easier to codify and preserve even very incidental or temporary local revisions of a control catalog. Once expressed as a profile in OSCAL format, a set of amendments to a catalog (also known as &quot;tailoring&quot;) can be managed entirely separately and independently from the catalog. Because a conformant processor can always create the customized catalog by resolving the profile against its sources (executing the transformation described in this document), the profile can also be examined and used as a proxy for that catalog for other purposes. The customized catalog can be made available wherever and for whatever purposes it is needed, while its revision and maintenance can be focused on the profile.</p>
  <p>This separation of concerns - between the originating catalog authors, who describe policy in only general terms, and the authors of the
    <q>user manual</q>catalog, who must describe policy in very particular and local terms - is a necessary factor in supporting sustainable processes with the potential for automation and process improvement. An OSCAL profile bridges the gap between a set of general guidelines, and actionable rules. Only by examining the system in the context of the actual intentions appropriate to that system, can we properly assess its security. Profiles make this possible.
  </p>
  <p>In order for this to work, however, we need a process that can perform the necessary operations, to apply the delta to an unmodified catalog, to produce the local view of the catalog as modified. This is profile resolution.</p>
</section>
-->



================================================
FILE: src/specifications/profile-resolution/profile-resolution-unit-tests.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<test-suite xmlns="http://csrc.nist.gov/ns/metaschema/test-suite/1.0"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://csrc.nist.gov/ns/metaschema/test-suite/1.0 unit-tests.xsd">
   <test-collection name="Import Phase" location="requirement-tests/">
      <test-scenario name="req-include-all-asis">
         <example-description>relative URI</example-description>
         <addresses-requirement requirement-id="req-uri-resolve">Tools MUST resolve
            URIs by following Section 5 of RFC3986, with the exception of URI Fragments (URIs that start with
            "#"). URI Fragments MUST instead be resolved as defined in [Section internalref].</addresses-requirement>
         <addresses-requirement requirement-id="req-uri-base">For the purposes of resolving URIs
            using the above specification, the Base URI MUST be considered to be the absolute URI of
            the containing profile.</addresses-requirement>
         <addresses-requirement requirement-id="req-include-all">
            When
            an import provides the include-all directive, ALL controls and groups in the
            referenced document (including nested controls) MUST be included. </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-all-asis.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-include-all-asis.xml"/>
      </test-scenario>
      <test-scenario name="req-import-by-resource">
         <example-description>via internal reference to
              resource/rlink</example-description>
         <addresses-requirement requirement-id="req-uri-aquire">Tools MUST acquire resources at the resolved URI by following Section 5 of
              RFC3986, with the exception of URI Fragments (URIs that start with "#").
            URI Fragments MUST instead be acquired as defined in [Section internalref].
        </addresses-requirement>
         <addresses-requirement requirement-id="req-internal">In the context of the Import Phase,
            internal references will only appear as a reference to a profile or catalog that is in
            the resources section of the source. When tools encounter such a reference,
            they MUST locate the object in resources with the matching UUID value, and
            resolve the resource. By OSCAL model requirements, a given resource can have
            zero to many rlink objects and zero to one base64 objects;
            however, it must have at least one of the two present. Tools can assume that any of
            these each resolves to the same underlying OSCAL object, although potentially in
            different serialization formats. For deterministic resolution of these backmatter OSCAL
            objects, tools need to adhere to the following requirements: </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-import-by-resource.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML"
                              location="output-expected/req-import-by-resource.xml"/>
      </test-scenario>
      <test-scenario name="req-missing-resource">
         <example-description>PENDING rebase over latest from galtm missing resource</example-description>
         <addresses-requirement requirement-id="req-uri-error">In the case
            that acquiring a resource fails, the tool MUST cease processing and provide an error. In
            order to ensure profile resolution results in the same catalog regardless of which tool
            resolves it, all imports must successfully resolve. While this may cause inconvenience
            if resources are frequently not available, it ensures interoperability.</addresses-requirement>
         <addresses-requirement requirement-id="req-internal-error">If the object fetched cannot be found
            or is not a valid OSCAL object, the tool MUST cease processing and provide an
            error.</addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-missing-resource.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-missing-resource.xml"/>
      </test-scenario>
      <test-scenario name="req-broken-import">
         <example-description>PENDING rebase over latest from galtm</example-description>
         <addresses-requirement requirement-id="req-internal-error">If the object fetched cannot be found
            or is not a valid OSCAL object, the tool MUST cease processing and provide an
            error.</addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-broken-import.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-broken-import.xml"/>
      </test-scenario>
      <test-scenario name="req-chained-all-asis">
         <example-description>PENDING chained profiles</example-description>
         <addresses-requirement requirement-id="req-circular-resolve">If the resource acquired is an OSCAL Profile, the tool
            MUST apply this specification to resolve it, then continue processing having imported
            the resulting catalog.</addresses-requirement>
         <addresses-requirement requirement-id="req-resolve-profile">When a profile imports a profile,
            the subordinate profile SHOULD be resolved first into a catalog using this
            specification, before it is imported. </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-chained-all-asis.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-chained-all-asis.xml"/>
      </test-scenario>
      <test-scenario name="req-chained-deepA">
         <example-description>PENDING [bug repair] chained profile
              merged with controls from its own source catalog</example-description>
         <addresses-requirement requirement-id="req-resolve-profile">When a profile imports a profile,
            the subordinate profile SHOULD be resolved first into a catalog using this
            specification, before it is imported. </addresses-requirement>
         <addresses-requirement requirement-id="rq-multiple-imports">Note that this occurs even if the same catalog is imported
            multiple times: each distinct import collects controls into a separate
              selection</addresses-requirement>
         <addresses-requirement requirement-id="rq-multiple-merge">The control inclusions are combined and collapsed in the next
            phase of processing</addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-chained-deepA.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-chained-deepA.xml"/>
      </test-scenario>
      <test-scenario name="req-circular_import">
         <example-description>PENDING circular import detection</example-description>
         <addresses-requirement requirement-id="req-circular-error">If a processor encounters a circular
              import as described above (self-imports are inherently circular), the processor
            MUST cease processing and generate an error. </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-circular_import.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-circular_import.xml"/>
      </test-scenario>
      <test-scenario name="req-include-all-flat">
         <addresses-requirement requirement-id="req-include-all">
            When
            an import provides the include-all directive, ALL controls and groups in the
            referenced document (including nested controls) MUST be included. </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-all-flat.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-include-all-flat.xml"/>
      </test-scenario>
      <test-scenario name="req-include-by-id">
         <addresses-requirement requirement-id="req-include-by-id">When an import provides the
              include-controls directive, with a with-id child, all controls
            in the referenced document whose id match one of the listed id
            values MUST be included. </addresses-requirement>
         <addresses-requirement requirement-id="req-with-child-controls-yes">A with-child-controls:
                yes directive on an include-controls indicates that all
                descendant controls of the included control MUST also be included. </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-by-id.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-include-by-id.xml"/>
      </test-scenario>
      <test-scenario name="req-include-by-match">
         <addresses-requirement requirement-id="req-include-by-match">When an import provides the
          include-controls directive, with a
          matching child, all controls in the referenced document whose
          id matches one of the listed
          pattern values (Glob matching) MUST be included.
        </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-by-match.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-include-by-match.xml"/>
      </test-scenario>
      <test-scenario name="req-include-by-match-empty">
         <addresses-requirement requirement-id="req-include-by-match-empty">If a
          matching object is provided with no
          pattern, it MUST be treated as matching nothing. While not providing a pattern is technically valid, resolution tool implementers should be aware that it is generally undesirable, and warnings or notices to the user may be appropriate.
        </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-by-match-empty.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML"
                              location="output-expected/req-include-by-match-empty.xml"/>
      </test-scenario>
      <test-scenario name="req-with-child-controls-no">
         <addresses-requirement requirement-id="req-with-child-controls-no">A with-child-controls:
                no directive on an include-controls indicates that ONLY the
              matching control is included, any descendant children MUST NOT be included. </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-with-child-controls-no.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML"
                              location="output-expected/req-with-child-controls-no.xml"/>
      </test-scenario>
      <test-scenario name="req-with-child-controls-none">
         <addresses-requirement requirement-id="req-with-child-controls-none">If no
                with-child-controls is provided, the processor MUST consider the
              directive as being equivalent to one having with-child-controls:no.
          </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-with-child-controls-none.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML"
                              location="output-expected/req-with-child-controls-none.xml"/>
      </test-scenario>
      <test-scenario name="req-with-parent-controls-yes1">
         <example-description>PR
                https://github.com/usnistgov/OSCAL/pull/1207</example-description>
         <addresses-requirement requirement-id="req-with-parent-controls-yes">A with-parent-controls:
                yes directive on an include-controls indicates that all parent
                controls of the included control MUST also be included.</addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-with-parent-controls-yes1.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML"
                              location="output-expected/req-with-parent-controls-yes1.xml"/>
      </test-scenario>
      <test-scenario name="req-with-parent-controls-yes2">
         <example-description>PR
                https://github.com/usnistgov/OSCAL/pull/1207</example-description>
         <addresses-requirement requirement-id="req-with-parent-controls-yes">A with-parent-controls:
                yes directive on an include-controls indicates that all parent
                controls of the included control MUST also be included.</addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-with-parent-controls-yes2.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML"
                              location="output-expected/req-with-parent-controls-yes2.xml"/>
      </test-scenario>
      <test-scenario name="req-with-parent-controls-no1">
         <example-description>PENDING PR
                https://github.com/usnistgov/OSCAL/pull/1207</example-description>
         <addresses-requirement requirement-id="req-with-parent-controls-no">A with-parent-controls:
                no directive on an include-controls indicates that ONLY the
              matching control is included, any parent MUST NOT be included. </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-with-parent-controls-no1.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML"
                              location="output-expected/req-with-parent-controls-no1.xml"/>
      </test-scenario>
      <test-scenario name="req-with-parent-controls-none">
         <example-description>Neither setting is
                given</example-description>
         <addresses-requirement requirement-id="req-with-parent-controls-none">If no with-parent-controls is provided, the processor MUST
              consider the directive as being equivalent to one having
                with-parent-controls:yes. </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-with-parent-controls-none.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML"
                              location="output-expected/req-with-parent-controls-none.xml"/>
      </test-scenario>
      <test-scenario name="req-include-exclude1">
         <addresses-requirement requirement-id="req-exclude">Any control designated to be both
            included and excluded, MUST be excluded. This holds irrespective of the specificity of
            the selection for inclusion or exclusion.</addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-exclude1.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-include-exclude1.xml"/>
      </test-scenario>
      <test-scenario name="req-include-exclude2">
         <addresses-requirement requirement-id="req-exclude">Any control designated to be both
            included and excluded, MUST be excluded. This holds irrespective of the specificity of
            the selection for inclusion or exclusion.</addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-exclude2.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-include-exclude2.xml"/>
      </test-scenario>
      <test-scenario name="req-include-exclude3">
         <addresses-requirement requirement-id="req-exclude">Any control designated to be both
            included and excluded, MUST be excluded. This holds irrespective of the specificity of
            the selection for inclusion or exclusion.</addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-exclude3.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-include-exclude3.xml"/>
      </test-scenario>
      <test-scenario name="req-include-exclude4">
         <addresses-requirement requirement-id="req-exclude-additional">When exclude-controls
            has at least one with-ids or matching directive, the processor
            MUST follow the same rules as defined in the relevant sections above for these
            directives, but exclude instead of include any controls. All optional features
              (with-child-controls, etc.) also apply to exclusion directives. </addresses-requirement>
         <addresses-requirement requirement-id="req-redundant">A given import may have
            any number of inclusion statements and any number of exclusion statements. Their effect
            is cumulative; any control that is included (or excluded) more than once MUST be
            considered to be included (or excluded) only once. In other words, a given control being
            included or excluded more than once has no effect. Exclusion still takes priority over
            inclusion (see above). </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-exclude4.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-include-exclude4.xml"/>
      </test-scenario>
   </test-collection>
   <test-collection name="Merge Phase" location="requirement-tests/">
      <test-scenario name="keep-everything-twice">
         <addresses-requirement requirement-id="req-merge-none">
            If no merge directive
            is given in the profile, or if a merge is given without a combine,
            merge conflicts MUST be treated as if method: keep was given. </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="keep-everything-twice.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML"
                              location="output-expected/keep-everything-twice.xml"/>
      </test-scenario>
      <test-scenario name="req-include-all-flat">
         <addresses-requirement requirement-id="req-structure-none">If no
          merge directive is given in the profile, or if a
          merge is given without a structuring directive, structuring the output MUST be treated as if the structuring directive
          flat was given. For example, a profile with no
          merge directive:
        </addresses-requirement>
         <resolve-profile>
            <profile-source source-format="XML" location="req-include-all-flat.xml"/>
         </resolve-profile>
         <expected-resolution source-format="XML" location="output-expected/req-include-all-flat.xml"/>
      </test-scenario>
   </test-collection>
</test-suite>



================================================
FILE: src/specifications/profile-resolution/requirement-tests.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<!-- autogenerated 2021-12-14T16:02:57.305-05:00 following model in example-set.xspec-->
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
               xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
               xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
               stylesheet="../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
               run-as="external"
               xmlns:ov="http://csrc.nist.gov/ns/oscal/test/variable">
   <x:helper stylesheet="lib/oscal-profile-test-helper.xsl"/>
   
<!-- Validate this XSpec with lib/xspec-test-bindings.sch to check whether declared
     test bindings actually relate to anything -->
   
   <x:scenario label="Include all" pending="wap">
      <?test req-include-all?>
      <x:context href="requirement-tests/req-include-all_01.xml"/>
      <x:expect label="When an import provides the include-all directive, ALL controls and groups in the referenced document (including nested controls) MUST be included."
                select="opr:scrub(.)"
                href="requirement-tests/output-expected/req-include-all_01_RESOLVED.xml"/>
   </x:scenario>
 
</x:description>



================================================
FILE: src/specifications/profile-resolution/requirements-extract.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    exclude-result-prefixes="xs math"
   xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml"
   version="3.0">
    
    <xsl:output indent="true"/>
    
    <xsl:template match="/*">
        <xsl:copy>
            <xsl:apply-templates select="//req"/>
        </xsl:copy>
    </xsl:template>
    
    <xsl:template match="req" >
        <requirement>
            <xsl:copy-of select="@*"/>
            <xsl:where-populated>
                <text>
                    <xsl:apply-templates/>
                </text>
            </xsl:where-populated>
            <xsl:apply-templates select="eg" mode="eg"/>
        </requirement>
    </xsl:template>
    
    <xsl:template match="eg"/>
        
    
    <xsl:template match="eg" mode="eg">
        <xsl:variable name="status" select="ready"/>
        <test>
            <xsl:apply-templates select="@href"/>
            <xsl:if test="starts-with(.,'PENDING')">
                <xsl:attribute name="status">pending</xsl:attribute>
            </xsl:if>
            <xsl:apply-templates/>
        </test>
    </xsl:template>
    
    <xsl:template match="@href">
        <xsl:attribute name="file" select="."/>
    </xsl:template>
    
    <xsl:template match="xref">
        <xsl:apply-templates select="key('by-id',@rid)" mode="title"/>
    </xsl:template>
    
    <xsl:key name="by-id" match="*" use="@id"/>
    
    <xsl:template match="*" mode="title">
        <xsl:value-of select="head"/>
    </xsl:template>
    
    <xsl:template match="text()">
        <xsl:value-of select="replace(.,'\s+',' ')"/>
    </xsl:template>
    
</xsl:stylesheet>


================================================
FILE: src/specifications/profile-resolution/resolution-testing.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="lib/spec-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-model href="lib/specml.rnc" type="application/relax-ng-compact-syntax"?>

<!-- Edit this PI for checking up on test bindings -->
<?specml-spec profile-resolution-specml.xml?>
<TESTSETS xmlns="http://csrc.nist.gov/ns/oscal/specml">
   <requirement level="recommended" id="req-phase-order">
      <statement>It is strongly RECOMMENDED that implementations execute the following steps in the order that they are provided here (import, merge, modify).</statement>
      <test status="pending">PENDING test design</test>
   </requirement>
   <requirement level="must" id="req-uri-resolve">
      <statement>Tools MUST resolve URIs by following Section 5 of RFC3986, with the exception of URI Fragments (URIs that start with "#"). URI Fragments MUST instead be resolved as defined in Internal References.</statement>
      <test file="requirement-tests/req-include-all-asis.xml">relative URI</test>
   </requirement>
   <requirement level="must" id="req-uri-aquire">
      <statement>Tools MUST acquire resources at the resolved URI by following Section 5 of RFC3986, with the exception of URI Fragments (URIs that start with "#"). URI Fragments MUST instead be acquired as defined in Internal References. </statement>
      <test file="requirement-tests/req-import-by-resource.xml">via internal reference to resource/rlink</test>
   </requirement>
   <requirement level="must" id="req-uri-base">
      <statement>For the purposes of resolving URIs using the above specification, the Base URI MUST be considered to be the absolute URI of the containing profile.</statement>
      <test file="requirement-tests/req-include-all-asis.xml">URI base corresponds to document URI</test>
   </requirement>
   <requirement level="must" id="req-uri-error">
      <statement>In the case that acquiring a resource fails, the tool MUST cease processing and provide an error. In order to ensure profile resolution results in the same catalog regardless of which tool resolves it, all imports must successfully resolve. While this may cause inconvenience if resources are frequently not available, it ensures interoperability.</statement>
      <test file="requirement-tests/req-missing-resource.xml" status="pending">PENDING rebase over latest from galtm missing resource</test>
   </requirement>
   <requirement level="must" id="req-internal">
      <statement>In the context of the Import Phase, internal references will only appear as a reference to a profile or catalog that is in the resources section of the source. When tools encounter such a reference, they MUST locate the object in resources with the matching UUID value, and resolve the resource. By OSCAL model requirements, a given resource can have zero to many rlink objects and zero to one base64 objects; however, it must have at least one of the two present. Tools can assume that any of these each resolves to the same underlying OSCAL object, although potentially in different serialization formats. For deterministic resolution of these backmatter OSCAL objects, tools need to adhere to the following requirements: </statement>
      <test file="requirement-tests/req-import-by-resource.xml"/>
   </requirement>
   <requirement level="may" id="req-internal-resolve1">
      <statement>Tools MAY use any of the rlink or base64 objects present in the resource.</statement>
      <test status="pending">PENDING test design (support for either/both base64 and rlink)</test>
   </requirement>
   <requirement level="may" id="req-internal-resolve2">
      <statement>Tools MAY verify that each above objects resolves to the same underlying OSCAL object. If there are OSCAL Model content differences between the resolved objects, the tool SHOULD provide a warning. </statement>
      <test status="pending">PENDING test design (correspondence of base64 and rlink-nominated objects)</test>
   </requirement>
   <requirement level="must" id="req-internal-resolve3">
      <statement>When a rlink is encountered and is to be resolved, it MUST be resolved by using a HTTP request to retrieve a byte stream. </statement>
      <test status="pending">PENDING test design (retrieval)</test>
   </requirement>
   <requirement level="must" id="req-internal-resolve4">
      <statement>When a base64 is encountered and is to be resolved, it MUST be considered a Byte Stream.</statement>
      <test status="pending">PENDING test design (base64 integrity)</test>
   </requirement>
   <requirement level="must" id="req-internal-resolve5">
      <statement>Regardless of its source, the Byte Stream MUST be decoded based on the algorithm defined in  Section 4 RFC 4648. </statement>
      <test status="pending">PENDING test design (base64 integrity)</test>
   </requirement>
   <requirement level="must" id="req-internal-error">
      <statement>If the object fetched cannot be found or is not a valid OSCAL object, the tool MUST cease processing and provide an error.</statement>
      <test file="requirement-tests/req-missing-resource.xml" status="pending">PENDING rebase over latest from galtm</test>
      <test file="requirement-tests/req-broken-import.xml" status="pending">PENDING rebase over latest from galtm</test>
   </requirement>
   <requirement level="must" id="req-circular-resolve">
      <statement>If the resource acquired is an OSCAL Profile, the tool MUST apply this specification to resolve it, then continue processing having imported the resulting catalog.</statement>
      <test file="requirement-tests/req-chained-all-asis.xml" status="pending">PENDING chained profiles</test>
   </requirement>
   <requirement level="should" id="req-resolve-profile">
      <statement>When a profile imports a profile, the subordinate profile SHOULD be resolved first into a catalog using this specification, before it is imported. </statement>
      <test file="requirement-tests/req-chained-all-asis.xml" status="pending">PENDING chained profiles</test>
      <test file="requirement-tests/req-chained-deepA.xml" status="pending">PENDING [bug repair] chained profile merged with controls from its own source catalog</test>
   </requirement>
   <requirement level="must" id="req-circular-error">
      <statement>If a processor encounters a circular import as described above (self-imports are inherently circular), the processor MUST cease processing and generate an error. </statement>
      <test file="requirement-tests/req-circular_import.xml" status="pending">PENDING circular import detection</test>
   </requirement>
   <requirement id="rq-multiple-imports">
      <statement>Note that this occurs even if the same catalog is imported multiple times: each distinct import collects controls into a separate selection</statement>
      <test file="requirement-tests/req-chained-deepA.xml" status="pending">PENDING chained profiles</test>
   </requirement>
   <requirement id="rq-multiple-merge">
      <statement>The control inclusions are combined and collapsed in the next phase of processing</statement>
      <test file="requirement-tests/req-chained-deepA.xml" status="pending">PENDING chained profiles</test>
   </requirement>
   <requirement level="must" id="req-include-all">
      <statement> When an import provides the include-all directive, ALL controls and groups in the referenced document (including nested controls) MUST be included. </statement>
      <test file="requirement-tests/req-include-all-asis.xml"/>
      <test file="requirement-tests/req-include-all-flat.xml"/>
   </requirement>
   <requirement level="must" id="req-include-by-id">
      <statement>When an import provides the include-controls directive, with a with-id child, all controls in the referenced document whose id match one of the listed id values MUST be included. </statement>
      <test file="requirement-tests/req-include-by-id.xml"/>
   </requirement>
   <requirement level="must" id="req-include-by-match">
      <statement>When an import provides the include-controls directive, with a matching child, all controls in the referenced document whose id matches one of the listed pattern values (Glob matching) MUST be included. </statement>
      <test file="requirement-tests/req-include-by-match.xml"/>
   </requirement>
   <requirement level="must" id="req-include-by-match-empty">
      <statement>If a matching object is provided with no pattern, it MUST be treated as matching nothing. While not providing a pattern is technically valid, resolution tool implementers should be aware that it is generally undesirable, and warnings or notices to the user may be appropriate. </statement>
      <test file="requirement-tests/req-include-by-match-empty.xml"/>
   </requirement>
   <requirement level="must" id="req-with-child-controls-yes">
      <statement>A with-child-controls: yes directive on an include-controls indicates that all descendant controls of the included control MUST also be included. </statement>
      <test file="requirement-tests/req-include-by-id.xml"/>
   </requirement>
   <requirement level="must" id="req-with-child-controls-no">
      <statement>A with-child-controls: no directive on an include-controls indicates that ONLY the matching control is included, any descendant children MUST NOT be included. </statement>
      <test file="requirement-tests/req-with-child-controls-no.xml"/>
   </requirement>
   <requirement level="must" id="req-with-child-controls-none">
      <statement>If no with-child-controls is provided, the processor MUST consider the directive as being equivalent to one having with-child-controls:no. </statement>
      <test file="requirement-tests/req-with-child-controls-none.xml"/>
   </requirement>
   <requirement level="must" id="req-with-parent-controls-yes">
      <statement>A with-parent-controls: yes directive on an include-controls indicates that all parent controls of the included control MUST also be included.</statement>
      <test file="requirement-tests/req-with-parent-controls-yes1.xml">PR https://github.com/usnistgov/OSCAL/pull/1207</test>
      <test file="requirement-tests/req-with-parent-controls-yes2.xml">PR https://github.com/usnistgov/OSCAL/pull/1207</test>
   </requirement>
   <requirement level="must" id="req-with-parent-controls-no">
      <statement>A with-parent-controls: no directive on an include-controls indicates that ONLY the matching control is included, any parent MUST NOT be included. </statement>
      <test file="requirement-tests/req-with-parent-controls-no1.xml"
            status="pending">PENDING PR https://github.com/usnistgov/OSCAL/pull/1207</test>
   </requirement>
   <requirement level="must" id="req-with-parent-controls-none">
      <statement>If no with-parent-controls is provided, the processor MUST consider the directive as being equivalent to one having with-parent-controls:yes. </statement>
      <test file="requirement-tests/req-with-parent-controls-none.xml">Neither setting is given</test>
   </requirement>
   <requirement level="must" id="req-exclude">
      <statement>Any control designated to be both included and excluded, MUST be excluded. This holds irrespective of the specificity of the selection for inclusion or exclusion.</statement>
      <test file="requirement-tests/req-include-exclude1.xml"/>
      <test file="requirement-tests/req-include-exclude2.xml"/>
      <test file="requirement-tests/req-include-exclude3.xml"/>
   </requirement>
   <requirement level="must" id="req-exclude-additional">
      <statement>When exclude-controls has at least one with-ids or matching directive, the processor MUST follow the same rules as defined in the relevant sections above for these directives, but exclude instead of include any controls. All optional features (with-child-controls, etc.) also apply to exclusion directives. </statement>
      <test file="requirement-tests/req-include-exclude4.xml"/>
   </requirement>
   <requirement level="must" id="req-redundant">
      <statement>A given import may have any number of inclusion statements and any number of exclusion statements. Their effect is cumulative; any control that is included (or excluded) more than once MUST be considered to be included (or excluded) only once. In other words, a given control being included or excluded more than once has no effect. Exclusion still takes priority over inclusion (see above). </statement>
      <test file="requirement-tests/req-include-exclude4.xml"/>
   </requirement>
   <requirement level="must" id="req-loose-param">
      <statement>All loose params from both imported documents and the profile source MUST be included. These params will be kept in the final output if the document contains any references to them, and discarded otherwise. See Pruning and Ordering.</statement>
      <test file="requirement-tests/req-loose-params1.xml"/>
   </requirement>
   <requirement level="recommended" id="req-merge-order">
      <statement>It is RECOMMENDED that tools apply the "combine" directive to the intermediate generated by the Import phase first, then apply the "structuring" directive.</statement>
      <test status="pending">PENDING is this testable?</test>
   </requirement>
   <requirement level="must" id="req-merge-combine">
      <statement>Note that "merge: combine" is deprecated, and MUST be considered undefined behavior when encountered.</statement>
      <test status="pending">PENDING specification</test>
   </requirement>
   <requirement level="must" id="req-merge-none">
      <statement> If no merge directive is given in the profile, or if a merge is given without a combine, merge conflicts MUST be treated as if method: keep was given. </statement>
      <test file="requirement-tests/keep-everything-twice.xml"/>
   </requirement>
   <requirement level="must" id="req-merge-keep">
      <statement>When a merge is indicated by method:keep, or when no merge directive is given, the keepcombination rule is used. Any control with the same distinctive ID Distinct ID of ObjectsMUST NOT not merged. (They are kept.) </statement>
      <test file="requirement-tests/req-merge-keep1.xml"/>
      <test file="requirement-tests/req-merge-keep2.xml"/>
   </requirement>
   <requirement level="should" id="req-merge-keep-warning">
      <statement>Processors SHOULD provide a warning under the merge:keep directive when duplicate controls are detected.</statement>
      <test file="requirement-tests/req-merge-keep1.xml"/>
      <test file="requirement-tests/req-merge-keep2.xml"/>
   </requirement>
   <requirement level="may" id="req-merge-keep-error">
      <statement>The processor MAY throw an error and cease processing (short-circuiting a certain future error) when duplicate controls are detected under the merge:keep directive.</statement>
      <test file="requirement-tests/req-merge-keep1.xml"/>
      <test file="requirement-tests/req-merge-keep2.xml"/>
   </requirement>
   <requirement level="must" id="req-merge-use-first">
      <statement>When the "use-first"combination rule is applied, and controls that share a distinctive ID are found, the first control encountered MUST be kept, the rest MUST be discarded. "First" MUST be determined by a top-down, depth-first traversal of the source profile's import hierarchy. </statement>
      <test file="requirement-tests/req-merge-usefirst1.xml"/>
      <test file="requirement-tests/req-merge-usefirst2.xml"/>
   </requirement>
   <requirement level="must" id="req-stucture">
      <statement>Optionally, one of three "structuring" directives can be included as a child of merge: flat, as-isand custom. When one of these appears, it is the selected structuring directive. If more than one appears, processors MUST generate an error and cease processing.</statement>
      <test status="pending">PENDING how do we test this?</test>
   </requirement>
   <requirement level="must" id="req-structure-none">
      <statement>If no merge directive is given in the profile, or if a merge is given without a structuring directive, structuring the output MUST be treated as if the structuring directive flat was given. For example, a profile with no merge directive: </statement>
      <test file="requirement-tests/req-include-all-flat.xml"/>
   </requirement>
   <requirement level="must" id="req-merge-flat">
      <statement>Profiles with the "flat" merge directive MUST be resolved as unstructured catalogs, with no grouping or nesting of controls.</statement>
      <test file="requirement-tests/req-include-all-flat.xml"/>
   </requirement>
   <requirement level="must" id="req-merge-flat-list">
      <statement>Unstructured catalog output MUST be produced by adhering to the following requirements:</statement>
   </requirement>
   <requirement level="must" id="req-merge-flat-list-1">
      <statement>All included controls are output to the target as a flat list directly under "catalog". </statement>
      <test file="requirement-tests/req-include-all-flat.xml"/>
   </requirement>
   <requirement level="must" id="req-merge-flat-list-2">
      <statement>Any included "loose params" are output to the target as a flat list directly under "catalog".</statement>
      <test file="requirement-tests/req-loose-params2.xml"/>
   </requirement>
   <requirement level="must" id="req-merge-flat-list-3">
      <statement>Any groups are discarded.</statement>
      <test file="requirement-tests/req-include-all-flat.xml"/>
      <test file="requirement-tests/req-loose-params2.xml"/>
   </requirement>
   <requirement level="must" id="id-structure-as-is-list">
      <statement>Processors MUST handle the as-is directive by adhering to the following requirements:</statement>
   </requirement>
   <requirement level="must" id="id-structure-as-is-list-1">
      <statement>All included controls are output to the target, keeping the structure of the groups and nested controls. Any group that holds an included control MUST appear in the output with all of its non-control children intact. If an included control has a parent control that was not included, that control's output location is "up-leveled", or made equal to the non-included parent. This applies recursively until the control is directly under either "catalog" or another included control.</statement>
   </requirement>
   <requirement level="must" id="id-structure-as-is-list-2">
      <statement>Any included "loose params" are output to the target as a flat list directly under "catalog".</statement>
   </requirement>
   <requirement level="must" id="req-custom-group">
      <statement>A groupobject given under custom MUST result in a group with the exact same content (excluding insert-controls) in the target catalog. </statement>
   </requirement>
   <requirement level="must" id="req-custom-group-contents">
      <statement>If the ID of the group matches the ID of a group that has been included during the import phase, all contents inside the group, including title, param, prop and part objects MUST be copied into the target, appearing in the same order as in the source. </statement>
   </requirement>
   <requirement level="must" id="req-custom-select">
      <statement>When processing the control selection of a custom element, the behavior defined in this section MUST be followed to generate the output.</statement>
   </requirement>
   <requirement level="must" id="req-custom-select-ignore">
      <statement>In the case that a control selection matches none of the included controls, it MUST be ignored.</statement>
   </requirement>
   <requirement level="should" id="req-custom-select-warning">
      <statement>In the case that a control selection matches none of the included controls, a warning SHOULD be provided.</statement>
   </requirement>
   <requirement level="should" id="req-modify-set-param-warning">
      <statement>If no such parameter is found, a warning SHOULD be issued.</statement>
   </requirement>
   <requirement level="must" id="req-modify-set-param-id-ignore">
      <statement>If no such parameter is found, processing MUST still continue.</statement>
   </requirement>
   <requirement level="must" id="req-modify-set-param-objects1">
      <statement>For the following objects inside the source: class, depends-on, label, usage, values, select; the object MUST be copied into the target from the source, first removing any existing objects with the same name.</statement>
   </requirement>
   <requirement level="must" id="req-modify-set-param-objects2">
      <statement>For the following objects inside the source: props, links, constraints, guidelines; the contents of the object MUST be added to the contents of the target object of the same name. If no such object exists in the target, it is created.</statement>
   </requirement>
   <requirement level="must" id="req-modify-set-param-objects3">
      <statement>For the following objects inside the source: prop, link; the object MUST be copied into the target from the source, first removing any existing objects with the same distinctive ID. (Distinct ID of Objects).</statement>
   </requirement>
   <requirement level="must" id="req-modify-param-multi">
      <statement>If more than one set-parameter directive is given for the same parameter, all MUST BE applied, in the sequence given in the profile.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-implicit">
      <statement>An add directive with no by-id child MUST be considered an implicit binding, and will apply to the control as a whole.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-implicit0contents">
      <statement>The contents of an implicitly bound add directive MUST be added to the control contents in the target, either after its title when position is starting, or at the end if its position is ending, or if no valid position is given.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-implicit-position">
      <statement>When an add directive is implicitly bound, the position values before and after MUST be treated like starting and ending, respectively.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-implicit-order">
      <statement>After processing an implicitly bound add directive, the control contents MUST be sorted to appear in the required order: a new prop appears after any prop already in the control, when position is ending, or not given, or before any prop in the control when position is starting.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-explicit">
      <statement>An add directive with a by-id child MUST be considered an explicit binding, and applies to only a single object inside the control.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-explicit-id">
      <statement>When an add directive is explicitly bound, the value of the by-id child MUST correspond to the value of an id on an object inside the control, and not the control itself.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-explicit-id-ignore">
      <statement>If by-id does not correspond to such a value, the add directive MUST be considered inoperative and ignored.</statement>
   </requirement>
   <requirement level="may" id="req-modify-alter-add-explicit-id-warning">
      <statement>An inoperative add directive MAY result in a warning.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-explicit-inside">
      <statement>When position has a value of startingor ending, the contents of the source MUST be added inside the target, either at the start or end of its contents, respectively.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-explicit-outside">
      <statement>When position has a value of before or after, the contents of the source MUST be added outside the target, either directly before or after it, respectively.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-add-nested">
      <statement>Profile resolution tools MUST be able to correctly handle add directives targetting nested controls. This includes directives that target a child control as well as directives that target a parent control and modify the child. </statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-remove-match">
      <statement> An object inside the control MUST be removed from the output if and only if it meets all of the criteria given by the child objects of the remove directive.</statement>
      <test file="requirement-tests/req-modify-alter-remove-match1.xml"/>
   </requirement>
   <requirement level="must" id="req-modify-alter-remove-by-id">
      <statement>The remove directive criteria by-id MUST match an object if and only if its value is identical to the id value of that object.</statement>
      <test file="requirement-tests/req-modify-alter-remove-match1.xml"/>
   </requirement>
   <requirement level="must" id="req-modify-alter-remove-name-ref">
      <statement>The remove directive criteria name-ref MUST match an object if and only if its value is identical to the value of that object's name child.</statement>
      <test file="requirement-tests/req-modify-alter-remove-match1.xml"/>
   </requirement>
   <requirement level="must" id="req-modify-alter-remove-ns-ref">
      <statement>The remove directive criteria ns-ref MUST match an object if and only if its value is identical to the value of that object's ns child.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-remove-class-ref">
      <statement>The remove directive criteria class-ref MUST match an object if and only if its value is identical to the value of that object's class child.</statement>
   </requirement>
   <requirement level="must" id="req-modify-alter-remove-item-name">
      <statement>The remove directive criteria item-name MUST match an object if and only if its value is identical to the value of that object's serialized name.</statement>
      <test file="requirement-tests/req-modify-alter-remove-match1.xml"/>
   </requirement>
   <requirement level="must" id="req-modify-alter-remove-item-name-array">
      <statement>In serialization formats that use arrays of objects in the OSCAL model, an object's name MUST be referenced as singular form of its containing parent array. </statement>
   </requirement>
   <requirement level="must" id="req-backmatter">
      <statement>The output's backmatter MUST be generated by copying in each resource object from the backmatters of the imported catalogs/profiles in top-to-bottom order, then by copying in each resource object from the backmatter of the source profile itself. These objects MUST be processed in the order they are defined in each respective document.</statement>
   </requirement>
   <requirement level="must" id="req-backmatter-dupe">
      <statement>If a given resource has the same uuid as a resource that has already been added, the previous resource MUST be removed, and the more recent one added, unless superseded by other requirements.</statement>
   </requirement>
   <requirement level="must" id="req-backmatter-keep">
      <statement>A resource with a child prop of name:keep and value:always MUST NOT be replaced by the addition of another resource, unless the new resource also has a child prop of name:keep and value:always.</statement>
   </requirement>
   <requirement level="may" id="req-backmatter-prune">
      <statement>Tools MAY check for pruning conditions Pruning and Ordering as resources are added as long as the final result is the same as if the pruning had taken place at the end of all resource addition.</statement>
   </requirement>
   <requirement level="must" id="req-meta-uuid">
      <statement>The output catalog's metadata MUST have a unique top-level UUID (metadata:uuid). This UUID MAY be generated as seen fit by the tool, as long as it is reasonable to assume it is globally unique. It is RECOMMENDED that tools use a Version 4 UUID as specified in Section 4 of RFC 4122. </statement>
   </requirement>
   <requirement level="must" id="req-meta-version">
      <statement>The value of metadata:version in the target MUST be set with a string that identifies the version of that document.</statement>
   </requirement>
   <requirement level="should" id="req-meta-version-track">
      <statement>The metadata:version SHOULD be used to track updates to this specific output document.</statement>
   </requirement>
   <requirement level="must" id="req-meta-oscal-version">
      <statement>The value of metadata:oscal-version in the target MUST be set with a string that identifies the version of OSCAL used by this tool to resolve the profile (ex. 1.0.0). This value MUST be determined by compiling the oscal-versions from each imported document and the source profile, and taking the most recent minor version. If this version is more recent than what the resolution tool is using, then the value of oscal-version MUST be the version that the tool used internally.</statement>
      <test status="pending">PENDING https://github.com/usnistgov/OSCAL/issues/1313</test>
   </requirement>
   <requirement level="must" id="req-meta-oscalversion-error">
      <statement>If any of the above OSCAL versions (imported document versions, source profile version, tool version) are of a different major version (the first digit differs), the tool SHOULD provide an error and cease processing.</statement>
   </requirement>
   <requirement level="must" id="req-meta-last-modified">
      <statement>The value of metadata:last-modified in the target MUST be set with a valid timestamp. This value SHOULD represent the time that profile resolution occurred.</statement>
      <test status="pending">PENDING develop an external (XPath) test</test>
   </requirement>
   <requirement level="should" id="req-meta-source-profile">
      <statement>A child prop object with name:source-profile MUST be created. The value object of this prop SHOULD be set with a valid URI that points to the profile that resulted in this catalog. </statement>
   </requirement>
   <requirement level="may" id="req-meta-source-profile-privacy">
      <statement> If there are privacy or security concerns, the value object of this prop MAY be set to anything, in which case the simple existence of the source-profile property indicates that this is a resolved profile.</statement>
   </requirement>
   <requirement level="should" id="req-meta-resolution-tool">
      <statement>A child prop object with name:resolution-tool SHOULD be created. The value object of this prop in the target SHOULD be set with a string that represents the tool that was used to resolve this catalog.</statement>
   </requirement>
   <requirement level="must" id="req-meta-keep">
      <statement>For any metadata:roles or metadata:parties that exist in the source catalogs, if they have a prop child with name:keep and value:always, they are to be copied as is into the output metadata.</statement>
   </requirement>
   <requirement level="should" id="req-prune">
      <statement>The processor SHOULD prune the resulting output catalog by removing unused objects.</statement>
      <test file="requirement-tests/req-modify-alter-remove-match2.xml"/>
   </requirement>
   <requirement level="must" id="req-prune-keep">
      <statement>Any object that has a child prop with a name of "keep" and a value of "always" MUST NOT be pruned.</statement>
      <test file="requirement-tests/req-modify-alter-remove-match2.xml"/>
   </requirement>
   <requirement level="must" id="req-prune-include">
      <statement>If an object was explicitly included in the Including Controls, it MUST NOT be pruned.</statement>
      <test status="pending">PENDING How to test? isn't this just selection semantics</test>
   </requirement>
   <requirement level="must" id="req-prune-custom">
      <statement>If an object was referenced in a custom section of the source profile, it MUST NOT be pruned.</statement>
      <test status="pending">PENDING clarification</test>
   </requirement>
   <requirement level="must" id="req-prune-modify">
      <statement>If an object was referenced in the modify section of the source profile, it MUST NOT be pruned. Any objects removed in that section are still removed.</statement>
      <test status="pending">PENDING clarification</test>
   </requirement>
   <requirement level="must" id="req-prune-ref">
      <statement>If the object appears in a reference anywhere in the final result catalog, except in other objects that also meet all other pruning criteria, it MUST NOT be removed. A reference to a given object exists if #{distinctiveID} appears anywhere, where {distinctiveID} is the distinctive ID of the object Distinct ID of Objects.</statement>
      <test status="pending">PENDING clarification</test>
   </requirement>
   <requirement level="must" id="req-reorder">
      <statement>Tools MUST reorder the output catalog into canonical order Order of objects in serialization, except where this specification provides different ordering requirements.</statement>
      <test status="pending">PENDING how do we test?</test>
   </requirement>
   <requirement level="must" id="req-id-id">
      <statement>For the objects control, param, and group, distinctiveness MUST be determined by the value of the "id" child object.</statement>
      <test status="pending">PENDING how do we test? Query outputs for duplicate IDs? Example docs?</test>
   </requirement>
   <requirement level="must" id="req-id-uuid">
      <statement>For the object resource, distinctiveness MUST be determined by the value of the "uuid" Backmatter Resolution.</statement>
      <test status="pending">PENDING how do we test? Query outputs for duplicate UUIDs? Example docs?</test>
   </requirement>
   <requirement level="should" id="req-multiformat">
      <statement>Profile Resolution tools SHOULD be able to handle source profiles, imported catalogs, and imported profiles that are serialized in XML, JSON, or YAML.</statement>
      <test status="pending">PENDING how do we test?</test>
   </requirement>
   <requirement level="must" id="req-multiformat-differ">
      <statement>A different serialization format of any given input MUST NOT result in a differing output catalog.</statement>
      <test status="pending">PENDING how do we test?</test>
   </requirement>
   <requirement level="must" id="req-output-xml">
      <statement>The final Catalog output, if using XML, MUST be valid as defined by the XML model documentation for the OSCAL Catalog. See the complete XML reference for model requirements.</statement>
      <test status="pending">PENDING how do we test?</test>
   </requirement>
   <requirement level="must" id="req-output-json">
      <statement>The final Catalog output, if using JSON, MUST be valid as defined by the JSON model documentation for the OSCAL Catalog. See the complete JSON reference for model requirements. </statement>
      <test status="pending">PENDING how do we test?</test>
   </requirement>
   <requirement level="must" id="req-output-yaml">
      <statement>The final Catalog output, if using YAML, MUST be valid as defined by the JSON model documentation for the OSCAL Catalog. </statement>
      <test status="pending">PENDING how do we test?</test>
   </requirement>
   <requirement level="must" id="req-order">
      <statement>When the output format is XML, tools MUST use the OSCAL canonical order as described above. When using the YAML or JSON formats, order conveys no meaning, and is not considered important.</statement>
      <test status="pending">PENDING how do we test this?</test>
   </requirement>
</TESTSETS>



================================================
FILE: src/specifications/profile-resolution/spec-tester.py
================================================
#!/usr/bin/env python3

"""
A simple CLI application that tests profile resolver implementations against the adjacent
specification.

Caveats:
- XPath functionality will depend on the version of Python being used (newer is better).
- On some versions of Python, absolute selections (/root/item) are broken and will result in a
    warning, use relative selections instead (./item).
- Comparisons of multiple elements are not "smart". Unlike the OSCAL Deep Diff, this tool does not
    attempt to match items together. Selections should be written with this in mind (e.g. select a
    specific oscal:param instead of comparing all of them when order is not explicitly specified).

Future Improvements:
- TODO: Cache results of profile resolution in Driver class for commonly re-used sources
- TODO: Make failure condition more granular (e.g. add parameter to prevent failure on "should" levels)
"""

import argparse
import sys
import os.path
import subprocess
import tempfile
import shutil
import json
import logging
import time
from itertools import zip_longest
from xml.etree import ElementTree as ET

from typing import TypedDict, List, Dict, Set, Tuple, Optional


class Colors:
    """
    ANSI color codes

    Via https://gist.github.com/rene-d/9e584a7dd2935d0f461904b9f2950007
    """
    BLACK = "\033[0;30m"
    RED = "\033[0;31m"
    GREEN = "\033[0;32m"
    BROWN = "\033[0;33m"
    BLUE = "\033[0;34m"
    PURPLE = "\033[0;35m"
    CYAN = "\033[0;36m"
    LIGHT_GRAY = "\033[0;37m"
    DARK_GRAY = "\033[1;30m"
    LIGHT_RED = "\033[1;31m"
    LIGHT_GREEN = "\033[1;32m"
    YELLOW = "\033[1;33m"
    LIGHT_BLUE = "\033[1;34m"
    LIGHT_PURPLE = "\033[1;35m"
    LIGHT_CYAN = "\033[1;36m"
    LIGHT_WHITE = "\033[1;37m"
    BOLD = "\033[1m"
    FAINT = "\033[2m"
    ITALIC = "\033[3m"
    UNDERLINE = "\033[4m"
    BLINK = "\033[5m"
    NEGATIVE = "\033[7m"
    CROSSED = "\033[9m"
    END = "\033[0m"
    # cancel SGR codes if we don't write to a terminal
    if not __import__("sys").stdout.isatty():
        for _ in dir():
            if isinstance(_, str) and _[0] != "_":
                locals()[_] = ""
    else:
        # set Windows console in VT mode
        if __import__("platform").system() == "Windows":
            kernel32 = __import__("ctypes").windll.kernel32
            kernel32.SetConsoleMode(kernel32.GetStdHandle(-11), 7)
            del kernel32


class TestScenario(TypedDict):
    """A source profile along with the expected resulting profile and match expressions"""
    description: str
    source_profile_path: str
    expected_catalog_path: str
    selection_expressions: List[str]


class TestRequirement(TypedDict):
    """A single requirement composed of multiple test scenarios"""
    section_id: str
    requirement_id: str
    scenarios: List[TestScenario]


DRIVER_SOURCE_TOKEN = "{src}"
DRIVER_DESTINATION_TOKEN = "{dest}"


INDENT_TEXT = "  "


class Driver(object):
    """Handles running the profile resolver given a source file and destination path"""

    def __init__(self, command: str, workdir: Optional[str] = None,
                 logger: Optional[logging.Logger] = None) -> None:
        """
        Note: Creates a temporary directory as a side effect, consumer must call .cleanup() to remove
        """
        if not DRIVER_SOURCE_TOKEN in command:
            raise Exception(
                f"Command `{command}` does not contain source token '{DRIVER_SOURCE_TOKEN}'")
        if not DRIVER_DESTINATION_TOKEN in command:
            raise Exception(
                f"Command `{command}` does not contain source token '{DRIVER_DESTINATION_TOKEN}'")

        self.logger = logger if logger is not None else logging.getLogger(
            __name__)
        self.command = command
        self.workdir = workdir
        self.out_directory = tempfile.mkdtemp("oscal-pr-test-out")

        self.logger.debug(
            f"Created temporary output directory '{self.out_directory}'")

    def run(self, src_path, indent=0) -> ET.ElementTree:
        """
        Run the command specified by `self.command`, substituting `DRIVER_SOURCE_TOKEN` and
        `DRIVER_DESTINATION_TOKEN` with `src_path` and a generated output path respectively.

        Note: Places output files in a temporary directory, consumer must call .cleanup() to remove
        """
        src_name = os.path.basename(src_path)
        # some-profile.xml => some-profile_RESOLVED_$TIMESTAMP.xml
        dest_name = os.path.splitext(
            src_name)[0] + f"_RESOLVED_{time.strftime('%Y%m%d-%H%M%S')}.xml"
        dest_path = os.path.join(self.out_directory, dest_name)

        command = self.command\
            .replace(DRIVER_SOURCE_TOKEN, f"'{src_path}'")\
            .replace(DRIVER_DESTINATION_TOKEN, f"'{dest_path}'")

        self.logger.debug(f"{INDENT_TEXT*indent}Running command `{command}`")

        # Notice: this code does not protect against shell injection of any kind,
        # `self.command` and `src_path` must be trusted.
        ret = subprocess.run(command, shell=True,
                             capture_output=True, cwd=self.workdir)
        # TODO handle command failure

        if ret.returncode != 0:
            raise Exception(
                f"Process returned non-zero exit code, stderr:\n\n{ret.stderr}")

        return ET.parse(dest_path)

    def cleanup(self):
        """Delete temporary directory"""
        self.logger.debug(
            f"Removing temporary output directory '{self.out_directory}'")
        shutil.rmtree(self.out_directory)


def compare_elements(e1: Optional[ET.ElementTree], e2: Optional[ET.ElementTree], path=".",
                     e1Name="left", e2Name="right") -> Tuple[bool, List[str]]:
    """
    Compare two element trees returning if they are the same, and a list of changes in the form of
    XPath-like selections.

    Warning: This comparison function will likely fail on mixed content (e.g. markup) and in cases
    where the order of child elements is different.

    Note: comments added to some difference paths using XPath 2.0 (: comment syntax :)
    """

    differences: List[str] = []

    if e1 is None:
        differences.append(
            f"{path}/ (: tag mismatch: {e1Name}=None {e2Name}='{e2.tag}' :)")
    elif e2 is None:
        differences.append(
            f"{path}/ (: tag mismatch: {e1Name}='{e1.tag}' {e2Name}=None :)")
    else:
        if e1.tag != e2.tag:
            # Fail early if tags are mismatched, no point in comparing tag contents
            differences.append(
                f"{path}/ (: tag mismatch: {e1Name}='{e1.tag}', {e2Name}='{e2.tag}' :)")
        else:
            e1Text = (e1.text if e1.text is not None else "").strip()
            e2Text = (e2.text if e2.text is not None else "").strip()

            # TODO compare on mixed content?
            if e1Text != e2Text:
                differences.append(path + "/text()")

            e1AttribSet = set(e1.attrib.keys())
            e2AttribSet = set(e2.attrib.keys())

            for key in e1AttribSet.intersection(e2AttribSet):
                if e1.attrib[key] != e2.attrib[key]:
                    # Attribute value mismatch
                    differences.append(
                        f"{path}/@{key} (: attribute value mismatch: {e1Name}='{e1.attrib[key]}', {e2Name}='{e2.attrib[key]}' :)")

            # Attribute not present in one or the other
            for key in e1AttribSet.difference(e2AttribSet):
                differences.append(
                    f"{path}/@{key} (: attribute value mismatch: {e1Name}='{e1.attrib[key]}', {e2Name}=None :")
            for key in e2AttribSet.difference(e1AttribSet):
                differences.append(
                    f"{path}/@{key} (: attribute value mismatch: in {e1Name}=None, {e2Name}='{e2.attrib[key]}' :")

            for i, (c1, c2) in enumerate(zip_longest(e1, e2)):
                # zip_longest returns None for extra items of the shorter iterator
                # XPath starts lists with 1
                _, child_differences = compare_elements(
                    c1, c2, path=f"{path}/*[{i + 1}]", e1Name=e1Name, e2Name=e2Name)
                differences += child_differences

    return len(differences) == 0, differences


SCRIPT_DIR = os.path.dirname(os.path.realpath(__file__))
DEFAULT_TESTS_PATH = os.path.join(SCRIPT_DIR, "spec-tests.json")
DEFAULT_SPEC_PATH = os.path.join(SCRIPT_DIR, "profile-resolution-specml.xml")

QUERY_NS = {
    "specml": "http://csrc.nist.gov/ns/oscal/specml",
    "oscal": "http://csrc.nist.gov/ns/oscal/1.0"
}


class RequirementTests(object):
    def __init__(self, spec_path=DEFAULT_SPEC_PATH, tests_path=DEFAULT_TESTS_PATH,
                 logger: Optional[logging.Logger] = None) -> None:
        self.spec_path = spec_path
        self.tests_path = tests_path

        self.spec = ET.parse(self.spec_path)

        self.logger = logger if logger is not None else logging.getLogger(
            __name__)

        with open(self.tests_path) as tests_file:
            tests_json = json.loads(tests_file.read())
            # TODO any sort of input validation, this is currently at best a type hint
            self.tests: List[TestRequirement] = tests_json

        # used to resolve files relative to the spec file
        self.tests_workdir = os.path.dirname(self.tests_path)

        # K,V of section ids -> section titles
        self.section_heads: Dict[str, str] = {}
        # K,V of section ids -> requirement id -> requirement level
        # TODO parse out requirement text and store alongside level?
        self.section_requirements: Dict[str, Dict[str, str]] = {}

        # process spec file
        for section in self.spec.findall("specml:section", QUERY_NS):
            section_id = section.attrib['id']
            section_head = section.find("specml:head", QUERY_NS).text

            self.section_heads[section_id] = section_head
            self.section_requirements[section_id] = {}

            for requirement in section.findall(".//specml:req", QUERY_NS):
                requirement_id = requirement.attrib['id']
                requirement_level = requirement.attrib['level']

                self.section_requirements[section_id][requirement_id] = requirement_level

    def print_coverage(self):
        """
        Utility method that prints the test coverage against the spec
        """
        covered_tests: Dict[str, Set[str]] = {}

        for test in self.tests:
            if test["section_id"] not in covered_tests:
                covered_tests[test["section_id"]] = set()
            covered_tests[test["section_id"]].add(test["requirement_id"])

        for section_id, section_head in self.section_heads.items():
            requirements = set(self.section_requirements[section_id].keys())
            tested_requirements = covered_tests.get(section_id, set())
            covered_requirements = tested_requirements.intersection(
                requirements)
            uncovered_requirements = requirements.difference(
                tested_requirements)
            unknown_requirements = tested_requirements.difference(requirements)

            section_color = Colors.GREEN
            if len(requirements) == 0:
                section_color = Colors.DARK_GRAY
            elif len(tested_requirements) == 0:
                section_color = Colors.RED
            elif len(uncovered_requirements) > 0:
                section_color = Colors.YELLOW

            # Provide the user with information about extraneous requirements
            extra_warning = f"{Colors.RED}+{len(unknown_requirements)}" if len(
                unknown_requirements) > 0 else ""

            self.logger.info(
                f"{Colors.BOLD}{section_color}{section_head} ({section_id}): {len(covered_requirements)}/{len(requirements)} {extra_warning}{Colors.END}")

            for requirement_id, level in self.section_requirements[section_id].items():
                requirement_color = Colors.GREEN if requirement_id in tested_requirements else Colors.RED
                self.logger.info(
                    f"{INDENT_TEXT}{requirement_color}{section_id}/{requirement_id} - {level}{Colors.END}")

            # Warn the user of extraneous requirements in the section
            for requirement_id in unknown_requirements:
                self.logger.warning(
                    f"{INDENT_TEXT}{Colors.YELLOW}Unknown requirement id {requirement_id}{Colors.END}")

        # Warn the user of extraneous sections in the tests
        for section_id in set(covered_tests.keys()).difference(set(self.section_heads.keys())):
            self.logger.warning(
                f"{Colors.YELLOW}Unknown section id {section_id} containing {len(covered_tests[section_id])} requirements{Colors.END}")

    def run(self, command, do_cleanup=True) -> bool:
        driver = Driver(command, self.tests_workdir, logger=self.logger)

        suite_pass = True

        try:
            for test in self.tests:
                test_info = f"requirement({test['section_id']}/{test['requirement_id']})"
                self.logger.info(f"{Colors.BOLD}{test_info}{Colors.END}")
                if self._run_test(driver, test, indent=1):
                    self.logger.info(
                        f"{Colors.BOLD}{Colors.GREEN}{test_info}... PASS{Colors.END}")
                else:
                    self.logger.error(
                        f"{Colors.BOLD}{Colors.RED}{test_info}... FAIL{Colors.END}")
                    suite_pass = False
        finally:
            if do_cleanup:
                driver.cleanup()

        if suite_pass:
            self.logger.info(
                f"{Colors.GREEN}Spec suite {self.tests_path}... PASS{Colors.END}")
        else:
            self.logger.error(
                f"{Colors.RED}Spec suite {self.tests_path}... FAIL{Colors.END}")

        return suite_pass

    def _run_test(self, driver: Driver, requirement: TestRequirement, indent=0) -> bool:
        test_pass = True

        for scenario in requirement["scenarios"]:
            scenario_info = f"{INDENT_TEXT * indent}scenario(source='{scenario['source_profile_path']}', expected='{scenario['expected_catalog_path']}')"

            self.logger.info(f"{Colors.BOLD}{scenario_info}{Colors.END}")

            scenario_pass = self._run_test_scenario(
                driver, scenario, indent=indent + 1)

            if scenario_pass:
                self.logger.info(
                    f"{Colors.BOLD}{Colors.GREEN}{scenario_info}... PASS{Colors.END}")
            else:
                # TODO: param to fail if the level is not "must"
                self.logger.error(
                    f"{Colors.BOLD}{Colors.RED}{scenario_info}... FAIL{Colors.END}")
                test_pass = False

        return test_pass

    def _run_test_scenario(self, driver: Driver, scenario: TestScenario, indent=0) -> bool:
        """
        Runs a given test scenario, returning True if all selection expressions pass
        """

        self.logger.info(
            f"{Colors.BLUE}{INDENT_TEXT * indent}Description: {scenario['description']}{Colors.END}")

        # Correct for path relative to spec tests file
        expected_path = scenario["expected_catalog_path"]
        if not os.path.isabs(expected_path):
            expected_path = os.path.join(self.tests_workdir, expected_path)
        # TODO user friendly error if catalog path cannot be found
        expected = ET.parse(expected_path)

        # Driver already uses the spec tests file's parent dir as the cwd, no path correction needed
        result = driver.run(scenario["source_profile_path"], indent=indent + 1)

        # if no selection expressions exist, test still successfully produced an output
        scenario_pass = True
        for selection_expression in scenario["selection_expressions"]:
            result_selection = result.findall(selection_expression, QUERY_NS)
            expected_selection = expected.findall(
                selection_expression, QUERY_NS)

            for i, (result_elem, expected_elem) in enumerate(zip(result_selection, expected_selection)):
                # XPath starts lists with 1
                selection_expression_indexed = f"{selection_expression}{f'[{i + 1}]' if len(result_selection) > 1 or len(expected_selection) > 1 else ''}"
                same, differences = compare_elements(result_elem, expected_elem,
                                                     # XPath selection used for debugging. Only specify position predicate if necessary
                                                     selection_expression_indexed, e1Name="result", e2Name="expected")
                if same:
                    self.logger.debug(
                        f"{Colors.GREEN}{INDENT_TEXT * (indent + 1)}selection `{selection_expression_indexed}` result matched{Colors.END}")
                else:
                    scenario_pass = False
                    self.logger.error(
                        f"{Colors.RED}{INDENT_TEXT * indent}selection `{selection_expression_indexed}` result mismatch:{Colors.END}")
                    for difference in differences:
                        # Clean up tags in comments to use namespaces
                        difference = difference.replace(
                            f"{{{QUERY_NS['oscal']}}}", "oscal:")

                        self.logger.error(
                            f"{Colors.RED}{INDENT_TEXT * (indent + 1)}{difference}{Colors.END}")

            if len(result_selection) != len(expected_selection):
                self.logger.error(
                    f"{Colors.RED}{INDENT_TEXT * (indent + 1)}selection `{selection_expression}` result size mismatch (result={len(result_selection)}, expected={len(expected_selection)}){Colors.END}")
                scenario_pass = False

        return scenario_pass


if __name__ == '__main__':
    example_text = f"example: spec-tester.py run 'oscal-cli profile resolve --to=XML {DRIVER_SOURCE_TOKEN} {DRIVER_DESTINATION_TOKEN}'"

    parser = argparse.ArgumentParser(
        description='OSCAL profile-resolution testing harness', epilog=example_text)
    parser.add_argument(
        "--tests_path", default=DEFAULT_TESTS_PATH, help="Override the tests file")
    parser.add_argument(
        "--spec_path", default=DEFAULT_SPEC_PATH, help="Override the spec file")
    parser.add_argument("-v", "--verbose",
                        help="display debug information", action="store_true")

    subparsers = parser.add_subparsers(
        required=True, dest="action", description="valid subcommands")

    # "run" subcommand
    parser_run = subparsers.add_parser(
        'run', description='Run the spec tests', epilog=example_text)
    parser_run.add_argument(
        "command", help="The program to call, with the input profile and output path"
        f" replaced with {DRIVER_SOURCE_TOKEN} and {DRIVER_DESTINATION_TOKEN} respectively")

    parser.add_argument("-k", "--keep",
                        help="keep output directory", action="store_true")
    # "coverage" subcommand
    parser_coverage = subparsers.add_parser(
        'coverage', description='Report the coverage of the given tests file against the spec')

    args = parser.parse_args()

    # truncate log levels for prettier console formatting
    logging.addLevelName(logging.DEBUG, 'DEBG')
    logging.addLevelName(logging.INFO, 'INFO')
    logging.addLevelName(logging.WARNING, 'WARN')
    logging.addLevelName(logging.ERROR, 'ERRR')
    logging.addLevelName(logging.CRITICAL, 'CRIT')
    logging.basicConfig(format='%(levelname)s: %(message)s',
                        level=logging.DEBUG if args.verbose else logging.INFO)

    harness = RequirementTests(args.spec_path, args.tests_path)

    if args.action == "run":
        suite_pass = harness.run(args.command, do_cleanup=not args.keep)
        if not suite_pass:
            sys.exit(1)
    elif args.action == "coverage":
        harness.print_coverage()



================================================
FILE: src/specifications/profile-resolution/spec-tests.json
================================================
[
    {
        "section_id": "import",
        "requirement_id": "req-uri-resolve",
        "scenarios": [
            {
                "description": "Check that group and control titles match, signalling that URIs have been resolved",
                "source_profile_path": "requirement-tests/req-include-all-asis.xml",
                "expected_catalog_path": "requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml",
                "selection_expressions": [
                    "./oscal:group/oscal:title",
                    "./oscal:group/oscal:control/oscal:title"
                ]
            }
        ]
    }
]


================================================
FILE: src/specifications/profile-resolution/unit-tests.xsd
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns="http://csrc.nist.gov/ns/metaschema/test-suite/1.0"
    targetNamespace="http://csrc.nist.gov/ns/metaschema/test-suite/1.0" elementFormDefault="qualified">
  <xs:include schemaLocation="../../../build/metaschema-xslt/support/metaschema/schema/xml/metaschema-datatypes.xsd"/>
  
  <xs:element name="test-suite">
    <xs:complexType>
      <xs:sequence>
        <xs:element ref="test-collection" maxOccurs="unbounded"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
  <xs:element name="test-collection">
    <xs:complexType>
      <xs:sequence>
        <xs:element ref="test-scenario" maxOccurs="unbounded"/>
      </xs:sequence>
      <xs:attribute name="location" type="URIReferenceDatatype" use="required"/>
      <xs:attribute name="name" type="StringDatatype" use="required"/>
    </xs:complexType>
  </xs:element>
  <xs:element name="test-scenario">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="example-description" type="xs:string" minOccurs="0"
          maxOccurs="1"/>
        <xs:element name="addresses-requirement"  minOccurs="0"
          maxOccurs="unbounded">
          <xs:complexType mixed="true">
            <xs:attribute name="requirement-id" type="StringDatatype" use="required"/>
          </xs:complexType>
          
        </xs:element>
        <xs:choice>
          <xs:sequence>
            <xs:element ref="generate-schema"/>
            <xs:element name="validation-case" type="ContentCaseType" minOccurs="0"
              maxOccurs="unbounded"/>
          </xs:sequence>
          <xs:sequence>
            <xs:element ref="resolve-profile"/>
            <xs:element name="expected-resolution" type="SourceCaseType" minOccurs="0"
              maxOccurs="unbounded"/>
          </xs:sequence>
        </xs:choice>
      </xs:sequence>
      <xs:attribute name="name" type="StringDatatype" use="required"/>
    </xs:complexType>
  </xs:element>
  <xs:element name="generate-schema">
    <xs:complexType>
      <xs:sequence>
        <xs:element ref="metaschema"/>
        <xs:element name="generation-case" type="GenerationCaseType" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
      <xs:attribute name="generation-result" type="GenerationResultType" default="SUCCESS"/>
      <xs:attribute name="validation-result" type="ValidationResultType" default="VALID"/>
    </xs:complexType>
  </xs:element>
  <xs:element name="resolve-profile">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="profile-source" type="SourceCaseType" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
  <xs:element name="metaschema">
    <xs:complexType>
      <xs:attribute name="location" type="URIReferenceDatatype" use="required"/>
    </xs:complexType>
  </xs:element>

  <xs:complexType name="SourceCaseType">
    <xs:attribute name="source-format" use="required" type="FormatType"/>
    <xs:attribute name="location" type="URIReferenceDatatype" use="required"/>
  </xs:complexType>

  <xs:complexType name="ContentCaseType">
    <xs:complexContent>
      <xs:extension base="SourceCaseType">
        <xs:attribute name="validation-result" type="ValidationResultType" default="VALID"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  
  <xs:complexType name="GenerationCaseType">
    <xs:complexContent>
      <xs:extension base="SourceCaseType">
        <xs:attribute name="match-result" type="MatchResultType" default="MATCH"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  
  <xs:simpleType name="GenerationResultType">
    <xs:restriction base="TokenDatatype">
      <xs:enumeration value="SUCCESS">
        <xs:annotation>
          <xs:documentation>Generation succeeded.</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
      <xs:enumeration value="FAILURE">
        <xs:annotation>
          <xs:documentation>Generation resulted in failure caused by some error.</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
    </xs:restriction>
  </xs:simpleType>
  
  <xs:simpleType name="FormatType">
    <xs:restriction base="TokenDatatype">
      <xs:enumeration value="XML">
        <xs:annotation>
          <xs:documentation>Content is XML.</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
      <xs:enumeration value="JSON">
        <xs:annotation>
          <xs:documentation>Content is JSON.</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
      <xs:enumeration value="YAML">
        <xs:annotation>
          <xs:documentation>Content is YAML.</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
    </xs:restriction>
  </xs:simpleType>
  
  <xs:simpleType name="MatchResultType">
    <xs:restriction base="TokenDatatype">
      <xs:enumeration value="MATCH">
        <xs:annotation>
          <xs:documentation>The actual content matched the expectect content.</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
      <xs:enumeration value="MISMATCH">
        <xs:annotation>
          <xs:documentation>The actual content did not match the expectect content.</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
    </xs:restriction>
  </xs:simpleType>
  
  <xs:simpleType name="ValidationResultType">
    <xs:restriction base="TokenDatatype">
      <xs:enumeration value="VALID">
        <xs:annotation>
          <xs:documentation>Validation succeeded.</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
      <xs:enumeration value="INVALID">
        <xs:annotation>
          <xs:documentation>Validation resulted in failure caused by some content defect or error.</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
    </xs:restriction>
  </xs:simpleType>
</xs:schema>



================================================
FILE: src/specifications/profile-resolution/lib/build-examples-xspec.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml"
    version="3.0">

    <xsl:output indent="yes"/>

<!-- This XSLT produces a set of file-oriented XSpecs binding to files named in the Specification document
//req/@eg values -->

    <xsl:template match="/">
        <xsl:text>&#xA;</xsl:text>
        <xsl:comment expand-text="true"> autogenerated { current-dateTime() } following model in example-set.xspec</xsl:comment>
        <xsl:processing-instruction name="xml-model">href="lib/xspec-test-dev.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"</xsl:processing-instruction>
        <xsl:processing-instruction name="xml-stylesheet">type="text/css" href="lib/xspec-oxygen.css"</xsl:processing-instruction>
        <xsl:processing-instruction name="specification" expand-text="true">{ replace(document-uri(/),'.*/','') }</xsl:processing-instruction>
        <x:description stylesheet="../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
            run-as="external">

            <!-- x:description/@run-as='external' permits the context item to be determined dynamically per scenario
                cf https://github.com/xspec/xspec/wiki/External-Transformation#global-context-item
                
                helper function for cleaning up whitespace:
                  see https://github.com/xspec/xspec/wiki/Integrating-Your-Own-Test-Helpers for
                  for an example see https://github.com/xspec/xspec/blob/master/tutorial/helper/ws-only-text/href_stylesheet.xspec
    -->

            <x:helper stylesheet="lib/oscal-profile-test-helper.xsl"/>
            <!-- looking at all the profile documents in the same directory as this XSLT -->

            <xsl:apply-templates select="*" mode="make-file-scenario"/>

        </x:description>

    </xsl:template>

    <xsl:template match="SPECIFICATION" mode="make-file-scenario" expand-text="true">
        <xsl:for-each-group select="//eg" group-by="@href">
            <x:scenario label="{ current-grouping-key() }">
                <x:context href="{ current-grouping-key() }"/>
                <xsl:apply-templates select="current-group()"
                    mode="make-file-scenario"/>
            </x:scenario>
        </xsl:for-each-group>
    </xsl:template>

    <xsl:template match="head" mode="make-file-scenario"/>
        

    <xsl:template match="section" mode="test-header">
        <!--<xsl:apply-templates select="parent::section" mode="#current"/>-->
        <!--<xsl:text> </xsl:text>-->
        <xsl:number level="multiple" format="1.1"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates select="head"/>
        <xsl:text> | </xsl:text>
    </xsl:template>
    
    <xsl:template match="req" mode="test-header">
        <xsl:apply-templates select="ancestor::section[1]" mode="#current"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates/>
    </xsl:template>
    
<!-- dropped in default (no mode) traversal -->
    <xsl:template match="eg"/>
            
    
    
    <xsl:template match="eg" mode="make-file-scenario" expand-text="true">
        <xsl:apply-templates select="ancestor::req" mode="#current">
            <xsl:with-param name="eg" select="."/>
        </xsl:apply-templates>
    </xsl:template>
    
    <xsl:template match="req" mode="make-file-scenario" expand-text="true">
        <xsl:param  required="true" name="eg" as="element(eg)?" />
        <xsl:variable name="test-header">
            <xsl:apply-templates select="." mode="test-header"/>
        </xsl:variable>
            
        <x:scenario label="{ $test-header => normalize-space() }">
            <xsl:if test="starts-with($eg,'PENDING')">
                <xsl:attribute name="pending">[spec]</xsl:attribute>
            </xsl:if>
            <xsl:call-template name="make-file-scenario">
                <xsl:with-param name="req-id" select="@id"/>
                <xsl:with-param name="egfile" select="$eg/@href"/>
            </xsl:call-template>
        </x:scenario>
        
    </xsl:template>
    
    <xsl:template name="make-file-scenario" expand-text="true">
        <xsl:param name="req-id" as="xs:string" required="true"/>
        <xsl:param name="egfile" as="xs:string?" required="true"/>
        <xsl:variable name="basename" as="xs:string" select="$egfile => substring-after('requirement-tests/') => replace('\.xml$','')"/>
           <xsl:processing-instruction name="requirement">{ $req-id} </xsl:processing-instruction>
            <!--<x:context href="requirement-tests/{ $egfile }"/>-->
            
            <x:expect label="Resolution of { $basename }.xml" select="opr:scrub(.)" href="requirement-tests/output-expected/{$basename}_RESOLVED.xml"/>
    </xsl:template>

    <xsl:template match="xref" expand-text="true">
        <xsl:text>[Section {@rid}]</xsl:text>
    </xsl:template>
</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/build-reqs-xspec.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml"
    version="3.0">

    <xsl:output indent="yes"/>

    <xsl:template match="/">
        <xsl:text>&#xA;</xsl:text>
        <xsl:comment expand-text="true"> autogenerated { current-dateTime() } following model in example-set.xspec</xsl:comment>
        <xsl:processing-instruction name="xml-model">href="lib/xspec-test-dev.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"</xsl:processing-instruction>
        <xsl:processing-instruction name="xml-stylesheet">type="text/css" href="lib/xspec-oxygen.css"</xsl:processing-instruction>
        <xsl:processing-instruction name="specification" expand-text="true">{ replace(document-uri(/),'.*/','') }</xsl:processing-instruction>
        <x:description stylesheet="../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
            run-as="external">

            <!-- x:description/@run-as='external' permits the context item to be determined dynamically per scenario
                cf https://github.com/xspec/xspec/wiki/External-Transformation#global-context-item
                
                helper function for cleaning up whitespace:
                  see https://github.com/xspec/xspec/wiki/Integrating-Your-Own-Test-Helpers for
                  for an example see https://github.com/xspec/xspec/blob/master/tutorial/helper/ws-only-text/href_stylesheet.xspec
    -->

            <x:helper
                stylesheet="lib/oscal-profile-test-helper.xsl"/>
            <!-- looking at all the profile documents in the same directory as this XSLT -->

            
            <xsl:apply-templates select="//req" mode="make-file-scenario"/>

        </x:description>

    </xsl:template>

    <xsl:template match="section" mode="test-header">
        <!--<xsl:apply-templates select="parent::section" mode="#current"/>-->
        <!--<xsl:text> </xsl:text>-->
        <xsl:number level="multiple" format="1.1"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates select="head"/>
        <xsl:text> | </xsl:text>
    </xsl:template>
    
    
    <xsl:template match="req" mode="test-header">
        <xsl:apply-templates select="ancestor::section[1]" mode="#current"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates/>
    </xsl:template>
    
    <xsl:template match="eg"/>
        
    <xsl:template match="req" mode="make-file-scenario" expand-text="true">
        <xsl:variable name="me" select="."/>
        <xsl:variable name="test-header">
            <xsl:apply-templates select="$me" mode="test-header"/>
        </xsl:variable>
        
        <x:scenario label="{ $test-header => normalize-space() }">
            <xsl:if test="empty(descendant::eg/@href)">
                <xsl:attribute name="pending">[dev]</xsl:attribute>
            </xsl:if>
            <xsl:apply-templates select="descendant::eg" mode="make-file-scenario"/>
        </x:scenario>
    </xsl:template>
    
    <xsl:template mode="make-file-scenario" match="eg" expand-text="true">
        <xsl:variable name="basename" as="xs:string" select="@href => substring-after('requirement-tests/') => replace('\.xml$','')"/>
        <x:scenario label="Example TBD - {.}">
            <xsl:if test="not(matches(@href,'\S')) or starts-with(.,'PENDING')">
                <xsl:attribute name="pending">{ replace(.,'^PENDING:?\s*','') }</xsl:attribute>
            </xsl:if>
                
            <xsl:if test="matches(@href,'\S')">
                    <xsl:attribute name="label">Example { $basename }.xml - {.}</xsl:attribute>
                    <xsl:processing-instruction name="requirement">{ ancestor::req[1]/@id } </xsl:processing-instruction>
                    <x:context href="{ @href }"/>
                    <x:expect label="Resolution of { $basename }.xml" select="opr:scrub(.)"
                        href="requirement-tests/output-expected/{$basename}_RESOLVED.xml"/>
                </xsl:if>
                
            
        </x:scenario>
    </xsl:template>
    
    <xsl:template match="xref" expand-text="true">
        <xsl:text>[Section {@rid}]</xsl:text>
    </xsl:template>
</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/build-testharness.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml"
    exclude-result-prefixes="#all"
    version="3.0">

    <xsl:output indent="yes"/>

    <xsl:template match="/">
        <xsl:text>&#xA;</xsl:text>
        
        <!--<xsl:processing-instruction name="xml-model">href="lib/xspec-test-dev.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"</xsl:processing-instruction>
        <xsl:processing-instruction name="xml-stylesheet">type="text/css" href="lib/xspec-oxygen.css"</xsl:processing-instruction>-->
        <!--<xsl:processing-instruction name="specification" expand-text="true">{ replace(document-uri(/),'.*/','') }</xsl:processing-instruction>-->
        <test-suite xmlns="http://csrc.nist.gov/ns/metaschema/test-suite/1.0"
            xsi:schemaLocation="http://csrc.nist.gov/ns/metaschema/test-suite/1.0 unit-tests.xsd">
            <xsl:apply-templates/>
        </test-suite>
        
    </xsl:template>

    <xsl:template match="/*/head"/>
    
    <xsl:template priority="22" match="section[empty(.//eg/@href)]"/>
    
    <xsl:template match="section" mode="test-header">
        <!--<xsl:apply-templates select="parent::section" mode="#current"/>-->
        <!--<xsl:text> </xsl:text>-->
        <xsl:number level="multiple" format="1.1"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates select="head"/>
        <xsl:text> | </xsl:text>
    </xsl:template>
    
    
    <xsl:template match="req" mode="test-header">
        <xsl:apply-templates select="ancestor::section[1]" mode="#current"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates/>
    </xsl:template>
    
    <xsl:template match="eg"/>
        
    
    
    <xsl:template match="SPECIFICATION/section">
        <test-collection name="{head/normalize-space(.)}" location="requirement-tests/">
            <xsl:for-each-group select=".//eg[@href]" group-by="@href">
                
       
        <xsl:variable name="basename" as="xs:string" select="current-grouping-key() => substring-after('requirement-tests/') => replace('\.xml$','')"/>
        
        <test-scenario name="{ $basename }">
            <xsl:if test="matches(.,'\S')">
            <example-description>
                <xsl:apply-templates/>
            </example-description>
            </xsl:if>
            <xsl:for-each select="current-group()/parent::req">
            <addresses-requirement requirement-id="{ @id }">
                <xsl:apply-templates select="."/> <!-- note no mode -->
            </addresses-requirement>
            </xsl:for-each>
                <resolve-profile>
                    <profile-source source-format="XML" location="{ @href/replace(.,'.*/','') }"/>
                </resolve-profile>
            <expected-resolution source-format="XML" location="output-expected/{ @href/replace(.,'.*/','') }"/>
            </test-scenario>
            </xsl:for-each-group>
            
        <!--<x:scenario label="Example TBD - {.}">
            <xsl:if test="not(matches(@href,'\S')) or starts-with(.,'PENDING')">
                <xsl:attribute name="pending">{ replace(.,'^PENDING:?\s*','') }</xsl:attribute>
            </xsl:if>
                
            <xsl:if test="matches(@href,'\S')">
                    <xsl:attribute name="label">Example { $basename }.xml - {.}</xsl:attribute>
                    <xsl:processing-instruction name="requirement">{ ancestor::req[1]/@id } </xsl:processing-instruction>
                    <x:context href="{ @href }"/>
                    <x:expect label="Resolution of { $basename }.xml" select="opr:scrub(.)"
                        href="requirement-tests/output-expected/{$basename}_RESOLVED.xml"/>
                </xsl:if>
                
            
        </x:scenario>-->
        </test-collection>
    </xsl:template>
    
    <xsl:template match="xref" expand-text="true">
        <xsl:text>[Section {@rid}]</xsl:text>
    </xsl:template>
</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/build-xspec.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml"
    version="3.0">

    <xsl:output indent="yes"/>

<!-- This XSLT produces a set of file-oriented XSpecs binding to files named in the Specification document
//req/@eg values -->

    <xsl:template match="/">
        <xsl:text>&#xA;</xsl:text>
        <xsl:comment expand-text="true"> autogenerated { current-dateTime() } following model in example-set.xspec</xsl:comment>
        <xsl:processing-instruction name="xml-model">href="lib/xspec-test-dev.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"</xsl:processing-instruction>
        <xsl:processing-instruction name="xml-stylesheet">type="text/css" href="lib/xspec-oxygen.css"</xsl:processing-instruction>
        <xsl:processing-instruction name="specification" expand-text="true">{ replace(document-uri(/),'.*/','') }</xsl:processing-instruction>
        <x:description stylesheet="../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
            run-as="external">

            <!-- x:description/@run-as='external' permits the context item to be determined dynamically per scenario
                cf https://github.com/xspec/xspec/wiki/External-Transformation#global-context-item
                
                helper function for cleaning up whitespace:
                  see https://github.com/xspec/xspec/wiki/Integrating-Your-Own-Test-Helpers for
                  for an example see https://github.com/xspec/xspec/blob/master/tutorial/helper/ws-only-text/href_stylesheet.xspec
    -->

            <x:helper stylesheet="lib/oscal-profile-test-helper.xsl"/>
            <!-- looking at all the profile documents in the same directory as this XSLT -->

            <xsl:apply-templates select="*" mode="make-file-scenario"/>

        </x:description>

    </xsl:template>

    <xsl:template match="SPECIFICATION" mode="make-file-scenario" expand-text="true">
        <xsl:for-each-group select="descendant::req" group-by="@eg/tokenize(.,'\s+')">
            <x:scenario label="{ current-grouping-key() }">
                <x:context href="requirement-tests/{ current-grouping-key() }"/>
                <xsl:apply-templates select="current-group()"
                    mode="make-file-scenario">
                    <xsl:with-param name="filename" select="current-grouping-key()"/>
                </xsl:apply-templates>
            </x:scenario>
        </xsl:for-each-group>
    </xsl:template>

    <xsl:template match="head" mode="make-file-scenario"/>
        

    <xsl:template match="section" mode="test-header">
        <!--<xsl:apply-templates select="parent::section" mode="#current"/>-->
        <!--<xsl:text> </xsl:text>-->
        <xsl:number level="multiple" format="1.1"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates select="head"/>
        <xsl:text> | </xsl:text>
    </xsl:template>
    
    <xsl:template match="req" mode="test-header">
        <xsl:apply-templates select="ancestor::section[1]" mode="#current"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates/>
    </xsl:template>
    
    <!--<xsl:template match="req" mode="make-file-scenario" expand-text="true">
        <xsl:variable name="me" select="."/>
        <xsl:variable name="test-header">
            <xsl:apply-templates select="$me" mode="test-header"/>
        </xsl:variable>
            
        <x:scenario label="{ $test-header => normalize-space() }">
            <xsl:if test="not(matches(@eg,'\S'))">
                <xsl:attribute name="pending">[dev]</xsl:attribute>
            </xsl:if>
            <xsl:iterate select="@eg/tokenize(.,'\s+')">
            <xsl:call-template name="make-file-scenario">
                <xsl:with-param name="req-id" select="$me/@id"/>
                <xsl:with-param name="filename" select="."/>
            </xsl:call-template>
        </xsl:iterate>
        </x:scenario>
        
    </xsl:template>-->
    
    <xsl:template match="req" mode="make-file-scenario" expand-text="true">
        <xsl:param name="filename" as="xs:string" required="true"/>
        <xsl:variable name="filepath" as="xs:string">requirement-tests/{$filename}</xsl:variable>
        <xsl:variable name="test-header">
            <xsl:apply-templates select="." mode="test-header"/>
        </xsl:variable>
        
        <x:scenario label="{ $test-header => normalize-space() }">
            <xsl:text>&#xA;      </xsl:text>
            <xsl:processing-instruction name="requirement">{ @id } </xsl:processing-instruction>
            <!--<x:context href="requirement-tests/{ $filename }"/>-->
            
            <x:expect label="Resolution of { $filename }" select="opr:scrub(.)"
                href="requirement-tests/output-expected/{ replace($filename,'\.xml$','_RESOLVED') }.xml"/>
        </x:scenario>
    </xsl:template>

    <xsl:template match="xref" expand-text="true">
        <xsl:text>[Section {@rid}]</xsl:text>
    </xsl:template>
</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/html-to-specml.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    xpath-default-namespace="http://www.w3.org/1999/xhtml"
    exclude-result-prefixes="xs math"
    version="3.0">

    <xsl:output cdata-section-elements="tagging"/>
    <xsl:mode on-no-match="shallow-copy"/>

    <xsl:template match="*">
        <xsl:element name="{local-name()}">
            <xsl:apply-templates select="node() | @*"/>
        </xsl:element>
    </xsl:template>

    <xsl:template match="/html">
        <xsl:apply-templates select="body"/>
    </xsl:template>

    <xsl:template match="body">
        <SPECIFICATION>
            <xsl:apply-templates/>
        </SPECIFICATION>
    </xsl:template>

    <xsl:template match="pre">
        <tagging>
            <xsl:apply-templates/>
        </tagging>
    </xsl:template>

    <xsl:template match="pre/code">
        <xsl:apply-templates/>
    </xsl:template>

    <xsl:template match="h6 | h5 | h4 |h3 | h2">
        <head>
            <xsl:apply-templates/>
        </head>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/illustrate-resolution.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    exclude-result-prefixes="xs math"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    version="3.0">
    
<!--    For a profile, produces an HTML with views of sources and resolution result.
    
    Resolution results are read from `output-expected`
    (but they could be generated dynamically)
    -->
    
<!-- Limitations:
    Reads only catalogs as imports, not profiles
    Display is optimized for SP800-53/B case
      nested parts not shown in patches
      doesn't handle glob matching
      doesn't match remove except by @id
      
    -->
    <xsl:strip-space elements="*"/>
     
     <xsl:output method="html" html-version="5"/>
    
    
     
    <xsl:template match="/">
         <html>
             <head>
                 <xsl:call-template name="style"/>
             </head>
             <body>
                 <section id="import-maps">
                     <xsl:apply-templates select="*/child::import" mode="show-import"/>
                 </section>
                 <section id="profile-map">
                     <xsl:apply-templates select="*" mode="show-profile"/>
                 </section>
                 <section id="result-map">
                     <xsl:apply-templates select="*" mode="show-result"/>
                 </section>
             </body>
         </html>
     </xsl:template>
    
    <xsl:template match="import[starts-with(@href,'#')]" mode="show-import">
        <xsl:apply-templates select="." mode="head"/>
        <xsl:variable name="imported" select="key('cross-reference',@href)/rlink[ends-with(@href,'.xml') or matches(@media-type,'xml')][1]/@href"/>
        <xsl:call-template name="draw-import">
            <xsl:with-param name="href" select="$imported"/>
        </xsl:call-template>
    </xsl:template>
    
    <xsl:template match="import" mode="show-import">
        <xsl:apply-templates select="." mode="head"/>
        <xsl:call-template name="draw-import">
            <xsl:with-param name="href" select="@href"/>
        </xsl:call-template>
    </xsl:template>
    
    <xsl:template name="draw-import" expand-text="true">
        <xsl:param name="href" required="yes"/>
        <xsl:choose>
            <xsl:when test="doc-available(resolve-uri($href,document-uri(/)))">
                <xsl:for-each select="document($href)">
                    <h4>In { name(child::*) }<code> { $href }</code></h4>
                    <div class="docmap">
                        <xsl:apply-templates mode="drawtree"/>
                    </div>
                </xsl:for-each>
            </xsl:when>
            <xsl:otherwise expand-text="true">
                <h5 style="font-style:italic">No document found at { $href }</h5>
            </xsl:otherwise>
        </xsl:choose>
        
        
    </xsl:template>
    
    
    <xsl:template match="import" mode="head" expand-text="true">
        <h3>Importing <code>{ @href }</code></h3>
    </xsl:template>
    
    
    
    <xsl:key name="cross-reference" match="resource" use="'#' || @id"/>
    <xsl:key name="cross-reference" match="resource" use="'#' || @uuid"/>
    
    <xsl:template match="profile" mode="show-profile" expand-text="true">
        <h3>Profile <code>{ document-uri(/) => replace('.*/','') }</code></h3>
        <div class="docmap">
            <xsl:apply-templates select="." mode="drawtree"/>
        </div>
    </xsl:template>
    
    <xsl:template match="profile" mode="show-result" expand-text="true">
        <xsl:variable name="where">{ /document-uri(.) }</xsl:variable>
        <xsl:variable name="resolvedname">{ $where => replace('.+/','') => replace('\.xml$','_RESOLVED.xml') }</xsl:variable>
        <xsl:variable name="resultpath">output-expected/{ $resolvedname }</xsl:variable>
        <h3>Result <code>{ $resultpath }</code></h3>
        <div class="docmap">
            <xsl:apply-templates select="document($resultpath,/)" mode="drawtree"/>
        </div>
    </xsl:template>
    
    <xsl:template match="metadata" mode="drawtree"/>
    
    <xsl:template match="back-matter" mode="drawtree"/>
    
    <xsl:template match="title | prop | link | param/*" mode="drawtree"/>
    
    <xsl:template match="set-parameter/*" mode="drawtree"/>
    
    <xsl:template match="text()" mode="drawtree"/>
    
    <xsl:template match="*" mode="drawtree">
        <details class="element" open="open">
            <summary>
            <div class="eflex">
                <xsl:apply-templates select="." mode="tag"/>
                <xsl:apply-templates select="." mode="contents"/>
            </div>
            </summary>
            <xsl:apply-templates mode="#current"/>
        </details>
    </xsl:template>
    
    <xsl:template match="param | part | *[empty(child::*)] | add | remove | set-parameter" priority="-0.1" mode="drawtree">
        <div class="element">
            <div class="eflex">
                <xsl:apply-templates select="." mode="tag"/>
                <xsl:apply-templates select="." mode="contents"/>
            </div>
        </div>
    </xsl:template>
    
    <xsl:template match="*" mode="contents">
        <xsl:where-populated>
            <div class="cnts">
                <xsl:apply-templates select="@*" mode="contents"/>
            </div>
        </xsl:where-populated>
    </xsl:template>
    
    <xsl:template match="param | set-parameter | add"  mode="contents">
        <xsl:where-populated>
            <div class="cnts">
                <xsl:apply-templates select="*" mode="#current"/>
            </div>
        </xsl:where-populated>
    </xsl:template>
    
    <xsl:template match="group | control"  mode="contents">
        <xsl:where-populated>
            <div class="cnts">
                <xsl:apply-templates select="title" mode="contents"/>
            </div>
        </xsl:where-populated>
    </xsl:template>
    
    <xsl:template match="part"  mode="contents">
        <xsl:where-populated>
            <div class="cnts">
                <xsl:apply-templates select="descendant::insert" mode="contents"/>
            </div>
        </xsl:where-populated>
    </xsl:template>
    
    <xsl:template match="param/* | set-parameter/* | add/* | insert | title" mode="contents">
        <xsl:where-populated>
            <div class="cnts-row">
                <xsl:apply-templates select="." mode="tag"/>
            </div>
        </xsl:where-populated>
    </xsl:template>
    
    <xsl:template match="@*" mode="contents" expand-text="true"/>
    
    <xsl:template match="*" mode="tag" expand-text="true">
        <p class="tag">{ name() }</p>
    </xsl:template>
    
    <xsl:template match="profile | profile//*" priority="-0.1" mode="tag" expand-text="true">
        <p class="tag drctv">{ name() }</p>
    </xsl:template>
    
    <xsl:template match="import" mode="tag" expand-text="true">
        <p class="tag drctv">
            <xsl:text>import</xsl:text>
            <span class="flag">
                <xsl:apply-templates select="." mode="get-href"/>
            </span>
        </p>
    </xsl:template>
    
    <!-- support link to resource here -->
    <xsl:template mode="get-href" match="import">
        <xsl:value-of select="@href"/>
    </xsl:template>
    
    <xsl:template match="with-id" mode="tag" expand-text="true">
        <p class="flsb drctv tag ID_{ . }" onclick="flashClass('ID_{ . }')">with-id <span class="flag">{ . }</span></p>
    </xsl:template>
    
    <xsl:template match="set-parameter" mode="tag" expand-text="true">
        <p class="tag drctv flsb ID_{ @param-id }" onclick="flashClass('ID_{ @param-id }')">set-parameter <span class="flag">{ @param-id }</span></p>
    </xsl:template>
    
    <xsl:template match="alter" mode="tag" expand-text="true">
        <p class="flsb drctv tag ID_{ @control-id }" onclick="flashClass('ID_{ @control-id }')">alter <span class="flag">{ @control-id }</span></p>
    </xsl:template>
    
    <xsl:template match="group[exists(@id)]" mode="tag" expand-text="true">
        <p class="flsb tag ID_{ @id }" onclick="flashClass('ID_{ @id }')">{ local-name() } <span class="flag">{ @id }</span></p>
    </xsl:template>
    
    <xsl:template match="control | param" mode="tag" expand-text="true">
        <p class="tag flsb ID_{ @id }" onclick="flashClass('ID_{ @id }')">{ local-name() } <span class="flag">{ @id }</span></p>
    </xsl:template>
    
    <xsl:template match="resource" mode="tag" expand-text="true">
        <p class="tag flsb ID_{ @uuid }" onclick="flashClass('ID_{ @uuid }')">resource <span class="flag">{ @uuid }</span></p>
    </xsl:template>
    
    <xsl:template match="insert" mode="tag" expand-text="true">
        <p class="tag flsb ID_{ @id-ref}" onclick="flashClass('ID_{ @id-ref }')">insert <b>{ @type }</b> <span class="flag">{ @id-ref }</span></p>
    </xsl:template>
    
    <xsl:template match="combine" mode="tag" expand-text="true">
        <p class="tag drctv">combine <span class="flag">{ @method }</span></p>
    </xsl:template>
    
    <xsl:template match="as-is" mode="tag" expand-text="true">
        <p class="tag drctv">{ local-name() } <span class="flag">{ . }</span></p>
    </xsl:template>
    
    <xsl:template match="label | value" mode="tag" expand-text="true">
        <!-- link builds from @id or @param-id of param or set-parameter parent -->
        <xsl:variable name="id">ID_{ parent::*/(@id,@param-id)[1] }-{ local-name(.) }</xsl:variable>
        <p class="flsb tag { $id }" onclick="flashClass('{ $id }')">{ local-name() } <span class="flag">{ . }</span></p>
    </xsl:template>
    
    <xsl:template match="rlink" mode="tag" expand-text="true">
        <p class="tag">rlink <span class="flag">{ @href }</span></p>
    </xsl:template>
    
    <xsl:template match="title" mode="tag" expand-text="true">
        <p class="tag">title <span class="flag"><xsl:apply-templates select="." mode="inline"/></span></p>
    </xsl:template>

    <xsl:template match="prop[@id] | part[@id]" mode="tag" expand-text="true">
        <p class="flsb tag ID_{ @id }" onclick="flashClass('ID_{ @id }')"> { local-name(.) } <b>{ @name }</b> <span class="flag">{ @id }</span> { [1 to count(child::*) ] ! 'â–®' }</p>
    </xsl:template>
    
    
    <xsl:template match="prop | part" mode="tag" expand-text="true">
        <p class="tag">  { local-name(.) } <b>{ @name }</b><span class="flag">{ @value }</span></p>
    </xsl:template>
  
    <xsl:template match="usage | constraint | guideline | select" mode="tag" expand-text="true">
        <p class="flsb tag">{ local-name() } { (1 to count(child::*)) ! 'â–®' }</p>
    </xsl:template>
    
    <xsl:template match="include-controls/@with-child-controls" mode="contents" expand-text="true">
        <div class="cnts-row">
            <p class="tag drctv">with child controls <span class="flag">{ . } </span></p>
        </div>
    </xsl:template>
    
    <xsl:template match="remove/@*" mode="contents" expand-text="true">
        <div class="cnts-row">
            <p class="tag drctv">{ replace(local-name(.),'\-',' ') } <span class="flag">{ . } </span></p>
        </div>
    </xsl:template>
    

    <xsl:template name="style" xml:space="preserve">
      <style type="text/css">

body { display: grid; grid-template-columns: 1fr 1fr 1fr;
       grid-column-gap: 1vw;
       font-family: sans-serif }
       
body > section {  border: thin solid black; padding: 0.4em; margin-top: 1em; max-height: 90vh; overflow: auto }

.docmap p { margin: 0em }

.docmap .element { outline: medium solid transparent }
.docmap .element:hover { outline: medium solid #FDD7E4 }

.docmap details.element { padding-left: 1em; margin-top: 0.2em }
.docmap div.element { padding-left: 1em; margin-left: 1em; margin-top: 0.2em }

details.element:not([open]) div.cnts { display: none }

summary { display: list-item; list-style-position: outside; margin-left: 1em }

div.eflex { display: inline-flex; align-items: start; gap:0.2em }

div.eflex > * { flex: initial }

p.tag { display: inline-block; background-color: midnightblue; color: white; padding: 0.4em; border-radius: 0.2em  }
p.tag span.flag { display: inline-block; background-color: white; color: black;
  padding: 0.1em; margin-left: 0.5em; }

div.cnts  p.tag { margin-top:0.2em }
p.tag.drctv { background-color: slategrey }

div.cnts { display: inline-block; font-size: 80% }

p.flsb:hover { background-color: royalblue }

p.tag.ON { transition: background-color 0s, font-size 0.3s ease-out;
      font-size: 120%;
      background-color: steelblue !important }

      h3 code { background-color: gainsboro }

            </style>
            <script type="text/javascript" >
                 function flashClass(elemID) {
                 let ilk = document.getElementsByClassName(elemID);
                 for (let i of ilk) { i.classList.toggle('ON'); }
            }
            </script>
        </xsl:template>
     
</xsl:stylesheet>


================================================
FILE: src/specifications/profile-resolution/lib/oscal-expected.sch
================================================
<?xml version="1.0" encoding="UTF-8"?>
<sch:schema xmlns:sch="http://purl.oclc.org/dsdl/schematron" queryBinding="xslt2"
    xmlns:sqf="http://www.schematron-quickfix.com/validator/process"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    
    <!--
        Tests OSCAL for tightness.
        Use IN ADDITION to appropriate schema validation
        Applies to profiles, catalogs, and resolution results (catalogs)
    -->
    
    <sch:ns uri="http://csrc.nist.gov/ns/oscal/1.0" prefix="o"/>
    
    <xsl:key name="internal-link" match="o:*[starts-with(@href,'#')]" use="@href"/>
    
    <xsl:key name="internal-resource" match="o:resource" use="'#' || @uuid"/>
    
    <sch:pattern>
        <sch:rule context="o:link[@rel='resource']">
            <sch:assert test="exists(key('internal-resource',@href))">Link corresponds to no resource in this document.</sch:assert>
        </sch:rule>
        <sch:rule context="o:resource">
            <sch:let name="exception" value="o:prop[@name='keep']/@value='always'"/>
            <sch:assert test="$exception or exists(key('internal-link',('#' || @uuid)))">Resource has no links.</sch:assert>
        </sch:rule>
    </sch:pattern>
    
</sch:schema>


================================================
FILE: src/specifications/profile-resolution/lib/oscal-profile-test-helper.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    exclude-result-prefixes="#all"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0"
    default-mode="scrubbing">

    <!--

    
    XSLT provides utility functionality for testing OSCAL profile resolution.
    
    Function opr:scrub-document returns an OSCAL catalog or profile with 'cosmetic' whitespace removed,
    for clean comparison.
    
    -->

    <xsl:output method="xml"/>
    
    <xsl:strip-space
        elements="catalog metadata param control group back-matter prop link part usage constraint guideline select remarks description test revisions revision role location party responsible-party address external-id resource citation rlink base64"/>


    <!--All assemblies defined in the catalog model:
        
        https://raw.githubusercontent.com/wendellpiez/OSCAL/profile-resolution-update-v1a/xml/schema/oscal_catalog_schema.xsd
        
        //xs:element[ends-with(@type,'ASSEMBLY') or exists(xs:complexType[not(@mixed='true')])]/@name => distinct-values() => string-join(' | ')
        
        
        catalog | metadata | param | control | group | back-matter | prop | link | part | usage | constraint | guideline | select | remarks | description | test | revisions | revision | role | location | party | responsible-party | address | external-id | resource | citation | rlink | base64
        
        
    -->
    <!--<xsl:template match="/">
        <xsl:param name="source" select="." as="document-node()"/>
        <xsl:document>
          <xsl:apply-templates select="$source" mode="scrubbing"/>
        </xsl:document>
    </xsl:template>-->

    <xsl:function name="opr:scrub" as="document-node()">
        <xsl:param name="n" as="node()"/>
        <xsl:document>
          <xsl:apply-templates select="$n" mode="scrubbing"/>
        </xsl:document>
    </xsl:function>
    
    <xsl:template mode="scrubbing" match="* | text() | @*">
        <xsl:copy>
            <xsl:apply-templates mode="#current" select="@*"/>
            <xsl:apply-templates mode="#current"/>
        </xsl:copy>
    </xsl:template>

    <!-- defends against whitespace/indentation glitches -->
    <xsl:template mode="scrubbing" match="text()[matches(.,'\S') => not()]">
        <xsl:variable name="wrapper" select="ancestor::p[1] | ancestor::li[1]"/>
        <xsl:if test="not(. is $wrapper/descendant::text()[1]) and not(. is $wrapper/descendant::text()[last()])">
            <xsl:next-match/>
        </xsl:if>
    </xsl:template>

    <xsl:template mode="scrubbing" match="catalog/metadata/prop[@name='resolution-tool']/@value">
        <xsl:attribute name="value">...</xsl:attribute>
    </xsl:template>

    <xsl:template mode="scrubbing" match="catalog/metadata/link[@rel='source-profile']/@href">
        <xsl:attribute name="href">...</xsl:attribute>
    </xsl:template>

    <xsl:template mode="scrubbing" match="last-modified">
        <xsl:copy>...</xsl:copy>
    </xsl:template>
    
    <xsl:template mode="scrubbing" match="catalog/@uuid">
        <xsl:attribute name="uuid">...</xsl:attribute>
    </xsl:template>
    
    <xsl:template mode="scrubbing" match="catalog | metadata | param | control | group | back-matter | prop | link | part | usage | constraint | guideline | select | remarks | description | test | revisions | revision | role | location | party | responsible-party | address | external-id | resource | citation | rlink | base64">
        <xsl:copy>
            <xsl:apply-templates mode="#current" select="@*"/>
            <!-- strips comments and PIs too!  -->
            <xsl:apply-templates mode="#current" select="child::*"/>
        </xsl:copy>
    </xsl:template>

    
</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/reqs-md-punchlist.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns="http://csrc.nist.gov/ns/oscal/specml"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml" version="3.0">

    <xsl:output indent="yes"/>

    <!-- This XSLT produces a set of file-oriented XSpecs binding to files named in the Specification document
//req/@eg values -->

    <xsl:output method="text"/>


    <xsl:template match="SPECIFICATION" expand-text="true">
        <xsl:variable name="items" as="element()*">
            <xsl:apply-templates select="//req" mode="line-item"/>
        </xsl:variable>
        <xsl:apply-templates select="$items" mode="md"/>
    </xsl:template>

    <xsl:template match="item" mode="md">
        <xsl:text expand-text="true">&#xA;- [{ if (eg/@href != '') then 'x' else ' ' }] </xsl:text>
        <xsl:apply-templates mode="#current"/>
    </xsl:template>

    <xsl:template match="eg" mode="md">
        <xsl:text expand-text="true"> [test { @href ! ('`' || . || '`')} </xsl:text>
        <xsl:apply-templates/>
        <xsl:text>]</xsl:text>
    </xsl:template>

    <xsl:template match="@id" mode="md" expand-text="true">`{.}`</xsl:template>

    <xsl:mode name="line-item" on-no-match="shallow-copy"/>

    <xsl:template match="req" mode="line-item">
        <item>
            <xsl:text expand-text="true">`{ @id }`</xsl:text>
            <xsl:apply-templates select="." mode="test-header"/>
            <xsl:apply-templates mode="#current"/>
            <xsl:copy-of select="eg"/>
        </item>
    </xsl:template>

    <xsl:template match="eg" mode="line-item"/>

    <xsl:template match="head" mode="make-file-scenario"/>

    <xsl:template match="section" mode="test-header">
        <!--<xsl:apply-templates select="parent::section" mode="#current"/>-->
        <xsl:text> *</xsl:text>
        <xsl:number level="multiple" format="1.1"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates select="head"/>
        <xsl:text>* </xsl:text>

    </xsl:template>

    <xsl:template match="req" mode="test-header">
        <xsl:apply-templates select="ancestor::section[1]" mode="#current"/>
    </xsl:template>

    <xsl:template match="text()" mode="#all">
        <xsl:text expand-text="true">{ replace(.,'\s+',' ') }</xsl:text>
    </xsl:template>

    <xsl:template match="xref" expand-text="true">
        <xsl:text>[Section {@rid}]</xsl:text>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/spec-checkup.sch
================================================
<?xml version="1.0" encoding="UTF-8"?>
<sch:schema
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:sch="http://purl.oclc.org/dsdl/schematron" queryBinding="xslt2"
    xmlns:sqf="http://www.schematron-quickfix.com/validator/process">

    <sch:ns uri="http://csrc.nist.gov/ns/oscal/specml" prefix="os"/>
    <sch:ns uri="http://www.jenitennison.com/xslt/xspec" prefix="x"/>
    <sch:ns uri="http://csrc.nist.gov/ns/oscal/1.0" prefix="o"/>
    
    <sch:let name="test-filenames" value="/processing-instruction('specml-testset')/normalize-space(.)"/>
    <sch:let name="test-set" value="document($test-filenames,/)"/>
    
    <sch:let name="known-tests" value="$test-set/*/os:requirement/os:test"/>
    
    <sch:let name="spec-filename" value="/processing-instruction('specml-spec')/normalize-space(.)"/>
    <sch:let name="spec" value="document($spec-filename,/)"/>
    
    
    <sch:pattern>
        <sch:rule context="os:section">
            <sch:assert test="count(ancestor::os:section) lt 5">section is too deep</sch:assert>
        </sch:rule>
    </sch:pattern>
    
    <sch:let name="all-requirements" value="//os:req"/>
    
    <sch:pattern>
        <sch:rule context="os:req">
            <sch:let name="me" value="."/>
            <sch:let name="mine" value="$known-tests[parent::*/@id = $me/@id]"/>
            <sch:assert test="count($all-requirements[@id=$me/@id]) eq 1">Requirement id '<sch:value-of select="@id"/>' is not distinct</sch:assert>
            <sch:assert test="exists($mine)">No test is given for requirement "<sch:value-of select="@id"/>"</sch:assert>
            <sch:report role="warn" test="$mine/@status = 'pending'">Requirement <sch:value-of select="if (count($mine[@status = 'pending']) gt 1) then 'tests are' else 'test is'"/> marked 'pending'</sch:report>
            <!--<sch:let name="paths" value="descendant::os:eg"/>
            <sch:let name="missing-eg" value="$paths[not(doc-available( resolve-uri(.,base-uri($me)) ))]"/>
            <sch:assert test="empty($missing-eg)">No file found for example(s) <sch:value-of select="os:and-sequence($missing-eg)"/></sch:assert>
            
            <sch:let name="not-profile-eg" value="$paths[not(.=$missing-eg)][empty(document(.,$me)/o:profile)]"/>
            <sch:assert test="empty($not-profile-eg)">Example files(s) not an OSCAL profile: <sch:value-of select="os:and-sequence($not-profile-eg)"/></sch:assert>-->
            </sch:rule>
        
        <!--<sch:rule context="os:eg">
            <sch:let name="stub" value="starts-with(.,'PENDING')"/>
            <sch:let name="missing" value="not(doc-available( resolve-uri(@href,base-uri(.)) ))"/>
            <sch:let name="not-profile-eg" value=".[not($missing)]/empty(document(@href,root())/o:profile) "/>
            <sch:report test="$missing and not($stub)">No file found for example(s) <sch:value-of select="@href"/></sch:report>
            <sch:report test="$not-profile-eg and not($stub)">Example <sch:value-of select="@href"/> is not an OSCAL profile</sch:report>
        </sch:rule>-->
        
        <sch:rule context="os:requirement">
            <sch:assert test="@id = $spec//os:req/@id">Requirement id '<sch:value-of select="@id"/>' is not found in specification <sch:value-of select="$spec-filename"/></sch:assert>
            <sch:assert role="warn" test="exists(os:test)">Requirement has no testing indicated</sch:assert>
        </sch:rule>
        
    </sch:pattern>
    
    <xsl:function name="os:or-sequence" as="xs:string">
        <xsl:param name="seq" as="item()*"/>
        <xsl:value-of>
            <xsl:iterate select="$seq">
                <xsl:if test="position() gt 1">
                    <xsl:choose>
                        <xsl:when test="position() eq last()"> or </xsl:when>
                        <xsl:otherwise>, </xsl:otherwise>
                    </xsl:choose>
                </xsl:if>
                <xsl:value-of select="."/>
            </xsl:iterate>
        </xsl:value-of>
    </xsl:function>
    
    <xsl:function name="os:and-sequence" as="xs:string">
        <xsl:param name="seq" as="item()*"/>
        <xsl:value-of>
            <xsl:iterate select="$seq">
                <xsl:if test="position() gt 1">
                    <xsl:choose>
                        <xsl:when test="position() eq last()"> and </xsl:when>
                        <xsl:otherwise>, </xsl:otherwise>
                    </xsl:choose>
                </xsl:if>
                <xsl:value-of select="."/>
            </xsl:iterate>
        </xsl:value-of>
    </xsl:function>
    
</sch:schema>



================================================
FILE: src/specifications/profile-resolution/lib/specml-html-hugo-uswds.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    xmlns="http://www.w3.org/1999/xhtml"
    exclude-result-prefixes="xs math"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml"
    version="3.0">

    <xsl:import href="specml-html-xslt1.xsl"/>

    <xsl:output method="xml"/>

    <xsl:template name="yaml-header">
        <xsl:text>---</xsl:text>
        <xsl:text>&#xA;title: OSCAL Profile Resolution Specification Draft</xsl:text>
        <xsl:text>&#xA;description: Working draft of the profile resolution specification.</xsl:text>
        <!--<xsl:text>&#xA;custom_css:</xsl:text>
        <xsl:text>&#xA;  - /css/oscal-specs.css</xsl:text>-->
        <xsl:text>&#xA;toc:</xsl:text>
        <xsl:text>&#xA;  enabled: true</xsl:text>
        <xsl:text>&#xA;  headingselectors: "h1, h2, h3, h4, h5"</xsl:text>
        <xsl:text>&#xA;---&#xA;</xsl:text>
    </xsl:template>

    <xsl:template match="SPECIFICATION">
        <xsl:call-template name="yaml-header"/>
        <xsl:variable name="page">
          <xsl:apply-templates/>
        </xsl:variable>
        <!-- Micropipeline postprocesses the results -->
        <xsl:apply-templates select="$page" mode="for-serialization"/>
        <!--</div>-->
    </xsl:template>

    <xsl:template match="tagging">
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="tagging" mode="for-serialization">
        <xsl:text disable-output-escaping="true">{{&lt; highlight xml>}}</xsl:text>
        <xsl:value-of select="string(.)" disable-output-escaping="yes"/>
        <xsl:text disable-output-escaping="true">{{&lt;/highlight>}}</xsl:text>
    </xsl:template>

    <xsl:template match="* | @*" mode="for-serialization">
        <xsl:element name="{local-name()}">
            <xsl:copy-of select="@*"/>
            <xsl:apply-templates select="node()" mode="#current"/>
        </xsl:element>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/specml-html-preview.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    xmlns="http://www.w3.org/1999/xhtml"
    exclude-result-prefixes="xs math"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml"
    version="3.0"
    expand-text="true">

    <xsl:import href="specml-html-xslt1.xsl"/>

    <xsl:output method="xhtml" html-version="5.0" use-character-maps="html-safe"/>

    <xsl:character-map name="html-safe">
        <xsl:output-character character=">" string=">" />
    </xsl:character-map>

    <xsl:template match="SPECIFICATION">
        <html>
            <head>
                <title>{ child::head } Specification</title>
                <!--<script type="text/javascript" src="https://livejs.com/live.js"></script>-->
                <xsl:call-template name="css"/>
            </head>
            <body>
                <aside class="navpanel">
                <nav class="toc">
                    <h3>{ child::head } Specification</h3>
                    <xsl:call-template name="toc"/>
                </nav>
                <div class="rqrmts">
                    <h3>Requirements</h3>
                    <xsl:call-template name="requirements"/>
                </div>
                </aside>
                <main>
                    <xsl:apply-templates/>
                </main>
            </body>
        </html>
    </xsl:template>

    <xsl:template name="css">
        <xsl:variable name="display-font" as="xs:string"> 'Corbel', sans-serif </xsl:variable>
        <style type="text/css">

body {{ line-height: 140%; font-family: "Cambria", serif }}

* {{ box-sizing: border-box }}

aside.navpanel {{ position: fixed; overflow-y: scroll; max-width: 36%; top: 1em; bottom: 0px; font-family: { $display-font } }}

aside.navpanel div.rqrmts * {{ margin: 0em }}

.req {{ background-color: pink; padding: 0.2em; font-size: 110%; margin-top: 0.2em !important }}
div.rqrmts .req {{ font-size: 90%; border-top: thin solid red; border-bottom: thin solid red }}
.req.should {{ background-color: peachpuff; border-top: thin solid orange; border-bottom: thin solid orange }}
.req.may {{ background-color: cornsilk; border-top: thin solid gold; border-bottom: thin solid gold }}
.req.recommended {{ background-color: mintcream; border-top: thin solid blue; border-bottom: thin solid blue }}

span.reqlabel {{ background-color: mintcream; color: forestgreen; margin-right: 0.4em; padding: 0.1em; border: thin solid green }} 

.toc ul   {{ list-style: none; padding-left: 1em }}

main      {{ margin-left: 40%; max-width: 48em }}

details {{ margin-top: 1.5em }}

details details {{ border-left: thin solid black; padding-left: 1em }}

summary > * {{ display: inline }}

pre {{ white-space:  pre-wrap }}

h1, h2, h3, h4, h5, h6 {{  font-family: { $display-font } }}

code.src {{ font-size:90%; font-weight:bold; background-color: lightsteelblue; padding: 0.2em }}
code.tgt {{ font-size:90%; font-weight:bold; background-color: lemonchiffon; padding: 0.2em }}
code.int {{ font-size:90%; font-weight:bold; background-color: pink; padding: 0.2em }}
b.term, b.xpath {{ font-family: { $display-font } }}

.secnum {{ padding: 0.2em; color: midnightblue; font-weight: bold; font-size: 110% }}

a {{ color: inherit }}
a.linked {{ color: inherit }}
.toc a {{ text-decoration: none }}

span.req {{ color: royalblue }}
span.req:hover {{ background-color: beige }}

.example {{ padding: 0.5em; border: thin dotted black; margin-top: 1em  }}
.example > *:first-child {{ margin-top: 0em }}

.example.source_profile-tagging {{  background-color: lightsteelblue }}
.example.source_catalog-tagging {{  background-color: powderblue }}
.example.target_catalog-tagging {{  background-color: lemonchiffon }}
.example.inter_catalog-tagging {{  background-color: lemonchiffon }}

.revisit {{ font-style: italic; color: red; background-color: yellow }}

.xref {{ font-weight: bold; font-family: { $display-font } }}

        </style>
    </xsl:template>

    <xsl:template name="requirements">
        <xsl:apply-templates mode="requirements" select="section"/>
    </xsl:template>

    <!-- In this mode we want no text by default   -->
    <xsl:template match="*" mode="requirements">
        <xsl:apply-templates select="*" mode="#current"/>
    </xsl:template>
    
    <xsl:template match="section" mode="requirements">
        <xsl:apply-templates select="head | p | ul | section" mode="#current"/>
    </xsl:template>
    
    <xsl:template match="head" mode="requirements">
        <h5>
            <!--mode toc provides number and link-->
            <xsl:apply-templates select="." mode="toc"/>
        </h5>
    </xsl:template>
    
    <xsl:template match="p" mode="requirements">
        <xsl:apply-templates select=".//req" mode="#current"/>
    </xsl:template>
    
    <!-- overriding imported template to provide link to index  -->
    <xsl:template match="req">
        <span class="{local-name()} {@level}">
            <xsl:copy-of select="@id"/>
            <a href="#ix-{@id}">
              <xsl:apply-templates select="." mode="reqlabel"/>
            </a>
            <xsl:apply-templates/>
        </span>
    </xsl:template>
    
    <xsl:template match="req" mode="requirements">
        <p class="req { @level }" id="ix-{@id}">
            <a href="#{@id}">
                <xsl:apply-templates select="." mode="reqlabel"/>
            </a>
            <xsl:text> </xsl:text>
            <xsl:apply-templates/>
            
        </p>
    </xsl:template>
    
    <xsl:template name="toc">
        <ul>
            <xsl:apply-templates mode="toc" select="section"/>
        </ul>
    </xsl:template>

    <xsl:template mode="toc" match="*"/>

    <xsl:template mode="toc" match="head">
        <a href="#{generate-id(.)}-head">
            <xsl:apply-templates select="." mode="header-text"/>
        </a>
    </xsl:template>

    <xsl:template mode="toc" match="section">
        <li>
            <xsl:apply-templates select="head" mode="toc"/>
            <xsl:for-each-group select="section" group-by="true()">
                <ul>
                    <xsl:apply-templates mode="toc" select="current-group()"/>
                </ul>
            </xsl:for-each-group>
        </li>
    </xsl:template>

    <xsl:template match="section" mode="secno">
        <span class="secnum">
          <xsl:number level="multiple" count="section" format="1.1"/>
        </span>
    </xsl:template>
    
    <xsl:template match="head" mode="header-text">
        <xsl:apply-templates select="parent::section" mode="secno"/>
        <xsl:text> </xsl:text>
        <xsl:apply-templates/>
    </xsl:template>

    <xsl:template match="section">
        <details open="open">
            <summary>
                <xsl:apply-templates select="head"/>
            </summary>
            <xsl:apply-templates select="* except head"/>
        </details>
    </xsl:template>

    <xsl:template match="mapping">
      <xsl:apply-templates/>
        <xsl:for-each select="attribute::unit-test">
            <p class="unit-test">Unit test: <a href="{.}">{ . }</a></p>
        </xsl:for-each>
    </xsl:template>

    <xsl:template match="tagging" mode="tagging-label">
        <h4 class="label">Source data:</h4>
    </xsl:template>

    <xsl:template match="tagging[@whose='target_catalog']" mode="tagging-label">
        <h4 class="label">Target (catalog):</h4>
    </xsl:template>

    <xsl:template match="tagging[@whose='source_catalog']" mode="tagging-label">
        <h4 class="label">Source (catalog):</h4>
    </xsl:template>

    <xsl:template match="tagging[@whose='source_profile']" mode="tagging-label">
        <h4 class="label">Source (profile):</h4>
    </xsl:template>
    
    <xsl:template match="tagging[@whose='inter_catalog']" mode="tagging-label">
        <h4 class="label">Intermediate (catalog):</h4>
    </xsl:template>

    <xsl:template match="tagging">
        <div class="{@whose}-tagging example">
            <xsl:apply-templates select="." mode="tagging-label"/>
         <xsl:next-match/>
        </div>
    </xsl:template>

    <xsl:template match="xsi:* | @xsi:*" mode="cleanup-sample" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>

    <xsl:template match="* | @*" mode="cleanup-sample">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates select="@* | node()" mode="#current"/>
        </xsl:copy>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/specml-html-static.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    xmlns="http://www.w3.org/1999/xhtml"
    exclude-result-prefixes="xs math"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml"
    version="3.0"
    expand-text="true">

    <xsl:import href="specml-html-xslt1.xsl"/>

    <xsl:output method="xhtml" html-version="5.0" use-character-maps="html-safe"/>

    <xsl:character-map name="html-safe">
        <xsl:output-character character=">" string=">" />
    </xsl:character-map>

    <xsl:template match="SPECIFICATION">
        <html>
            <head>
                <title>{ child::head } Specification</title>
                <xsl:call-template name="css"/>
            </head>
            <body>
            <aside class="toc">
                <h3>{ child::head } Specification</h3>
                <xsl:call-template name="toc"/>
            </aside>
                <main>
                    <xsl:apply-templates/>
                </main>
            </body>
        </html>
    </xsl:template>

    <xsl:template name="css">
        <xsl:variable name="display-font" as="xs:string"> 'Corbel', sans-serif </xsl:variable>
        <style type="text/css">

body {{ line-height: 140%; font-family: "Cambria", serif }}

* {{ box-sizing: border-box }}

aside.toc {{ position: fixed; overflow-y: scroll; max-width: 36%; top: 1em; bottom: 0px; font-family: { $display-font } }}
.toc ul   {{ list-style: none; padding-left: 1em }}

main      {{ margin-left: 40%; max-width: 48em }}

details {{ margin-top: 1.5em }}

details details {{ margin-left: 2em; border-left: thin solid black; padding-left: 1em }}

summary > * {{ display: inline }}

pre {{ white-space:  pre-wrap }}

h1, h2, h3, h4, h5, h6 {{  font-family: { $display-font } }}

code.src {{ font-size:90%; font-weight:bold; background-color: lightsteelblue; padding: 0.2em }}
code.tgt {{ font-size:90%; font-weight:bold; background-color: lemonchiffon; padding: 0.2em }}
b.term, b.xpath {{ font-family: { $display-font } }}

.secnum {{ padding: 0.2em; color: midnightblue; font-weight: bold; font-size: 110% }}

a {{ color: inherit }}
a.linked {{ color: inherit }}
.toc a {{ text-decoration: none }}


.example {{ padding: 0.5em; border: thin dotted black; margin-top: 1em  }}
.example > *:first-child {{ margin-top: 0em }}

.example.source_profile-tagging {{  background-color: lightsteelblue }}
.example.source_catalog-tagging {{  background-color: powderblue }}
.example.target_catalog-tagging {{  background-color: lemonchiffon }}

.revisit {{ font-style: italic; color: red; background-color: yellow }}

.xref {{ font-weight: bold; font-family: { $display-font } }}

        </style>
    </xsl:template>


    <xsl:template name="toc">
        <ul>
            <xsl:apply-templates mode="toc" select="section"/>
        </ul>
    </xsl:template>

    <xsl:template mode="toc" match="*"/>

    <xsl:template mode="toc" match="head">
        <a href="#{generate-id(.)}-head">
            <xsl:apply-templates select="." mode="header-text"/>
        </a>
    </xsl:template>

    <xsl:template mode="toc" match="section">
        <li>
            <xsl:apply-templates select="head" mode="toc"/>
            <xsl:for-each-group select="section" group-by="true()">
                <ul>
                    <xsl:apply-templates mode="toc" select="current-group()"/>
                </ul>
            </xsl:for-each-group>
        </li>
    </xsl:template>

    <xsl:template match="head" mode="header-text">
        <span class="secnum">
          <xsl:number level="multiple" count="section" format="1.1"/>
        </span>
        <xsl:text> </xsl:text>
        <xsl:apply-templates/>
    </xsl:template>

    <xsl:template match="section">
        <details open="open">
            <summary>
                <xsl:apply-templates select="head"/>
            </summary>
            <xsl:apply-templates select="* except head"/>
        </details>
    </xsl:template>

    <xsl:template match="cf">
        <details style="border: thin solid black; padding: 0.5em">
            <summary>
                <xsl:next-match/>
            </summary>
            <pre class="cf">
               <xsl:variable name="cleaned-up-sample">
                   <xsl:apply-templates mode="cleanup-sample" select="document(@file, /)"/>
               </xsl:variable>
               <xsl:sequence select="serialize($cleaned-up-sample)"/>
      </pre>
        </details>
    </xsl:template>

    <xsl:template match="mapping">
      <xsl:apply-templates/>
        <xsl:for-each select="attribute::unit-test">
            <p class="unit-test">Unit test: <a href="{.}">{ . }</a></p>
        </xsl:for-each>
    </xsl:template>

    <xsl:template match="tagging" mode="tagging-label">
        <h4 class="label">Source data:</h4>
    </xsl:template>

    <xsl:template match="tagging[@whose='target_catalog']" mode="tagging-label">
        <h4 class="label">Target (catalog):</h4>
    </xsl:template>

    <xsl:template match="tagging[@whose='source_catalog']" mode="tagging-label">
        <h4 class="label">Source (catalog):</h4>
    </xsl:template>

    <xsl:template match="tagging[@whose='source_profile']" mode="tagging-label">
        <h4 class="label">Source (profile):</h4>
    </xsl:template>

    <xsl:template match="tagging">
        <div class="{@whose}-tagging example">
            <xsl:apply-templates select="." mode="tagging-label"/>
         <xsl:next-match/>
        </div>
    </xsl:template>

    <xsl:template match="xsi:* | @xsi:*" mode="cleanup-sample" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>

    <xsl:template match="* | @*" mode="cleanup-sample">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates select="@* | node()" mode="#current"/>
        </xsl:copy>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/specml-html-xslt1.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"
   xmlns:o="http://csrc.nist.gov/ns/oscal/specml"
   xmlns="http://www.w3.org/1999/xhtml"
    exclude-result-prefixes="o">

   <xsl:strip-space elements="o:SPECIFICATION o:div o:ul o:li o:section o:mapping o:cf"/>

   <xsl:output method="html" omit-xml-declaration="yes"/>

   <xsl:template match="o:SPECIFICATION">
      <body>
         <xsl:apply-templates/>
      </body>
   </xsl:template>

   <!-- suppress since the page template produces the page header from YAML metadata -->
   <xsl:template match="o:SPECIFICATION/o:head">

   </xsl:template>

   <xsl:template match="o:head" mode="header-text">
     <xsl:apply-templates/>
   </xsl:template>

   <xsl:template match="o:head">
      <h1 id="{generate-id()}-head">
         <xsl:apply-templates select="." mode="header-text"/>
      </h1>
   </xsl:template>

   <xsl:template priority="1" match="o:section/o:head">
      <h2 id="{generate-id()}-head">
         <xsl:apply-templates select="." mode="header-text"/>
      </h2>
   </xsl:template>

   <xsl:template priority="2" match="o:section/o:section/o:head">
      <h3 id="{generate-id()}-head">
         <xsl:apply-templates select="." mode="header-text"/>
      </h3>
   </xsl:template>

   <xsl:template priority="2" match="o:div/o:head">
      <h3 class="divhead" id="{generate-id()}-head">
         <xsl:apply-templates select="." mode="header-text"/>
      </h3>
   </xsl:template>

   <xsl:template priority="3" match="o:section/o:section/o:section/o:head">
      <h4 id="{generate-id()}-head">
         <xsl:apply-templates select="." mode="header-text"/>
      </h4>
   </xsl:template>

   <xsl:template priority="4" match="o:section/o:section/o:section/o:section/o:head">
      <h5 id="{generate-id()}-head">
         <xsl:apply-templates select="." mode="header-text"/>
      </h5>
   </xsl:template>

   <xsl:template priority="5" match="o:section/o:section/o:section/o:section/o:section/o:head">
      <h6 id="{generate-id()}-head">
         <xsl:apply-templates select="." mode="header-text"/>
      </h6>
   </xsl:template>

   <xsl:template match="o:p">
      <p>
        <xsl:apply-templates/>
      </p>
   </xsl:template>

   <xsl:template match="o:term">
      <b class="{local-name()}">
        <xsl:apply-templates/>
      </b>
   </xsl:template>

   <xsl:template match="o:q">
      <q class="{local-name()}">
         <xsl:apply-templates/>
      </q>
   </xsl:template>

   <!--<xsl:template match="o:div">
      <div class="{local-name()}">
         <xsl:apply-templates/>
      </div>
   </xsl:template>-->

   <xsl:template match="o:src">
      <code class="src">
         <xsl:apply-templates/>
      </code>
   </xsl:template>

   <xsl:template match="o:tgt">
      <code class="tgt">
         <xsl:apply-templates/>
      </code>
   </xsl:template>
   
   <xsl:template match="o:int">
      <code class="int">
         <xsl:apply-templates/>
      </code>
   </xsl:template>
   
   <xsl:template match="o:ul">
      <ul>
         <xsl:apply-templates/>
      </ul>
   </xsl:template>

   <xsl:key match="*[@id]" use="@id" name="by-id"/>

   <xsl:template match="o:xref">
      <xsl:text>[See: </xsl:text>
      <xsl:for-each select="key('by-id',@rid)/o:head">
         <a href="#{generate-id()}-head" class="xref">
            <xsl:apply-templates select="." mode="header-text"/>
         </a>
      </xsl:for-each>
      <xsl:text>]</xsl:text>
   </xsl:template>

   <xsl:template match="o:li">
      <li>
         <xsl:apply-templates/>
      </li>
   </xsl:template>

   <xsl:template match="o:code">
      <code class="{local-name()}">
         <xsl:apply-templates/>
      </code>
   </xsl:template>

   <xsl:template match="o:a">
      <a class="{local-name()}">
         <xsl:copy-of select="@href"/>
         <xsl:apply-templates/>
      </a>
   </xsl:template>

   <xsl:template match="o:em">
      <em class="{local-name()}">
         <xsl:apply-templates/>
      </em>
   </xsl:template>
   
   <xsl:template match="o:req">
      <span class="{local-name()} {@level}">
         <xsl:copy-of select="@id"/>
         <xsl:apply-templates select="." mode="reqlabel"/>
         <xsl:apply-templates/>
      </span>
   </xsl:template>
   
   <xsl:template match="o:req" mode="reqlabel">
      <span class="reqlabel">
         <xsl:value-of select="@id"/>
      </span>
   </xsl:template>
   
   <xsl:template match="o:xpath">
      <b class="{local-name()}">
         <xsl:apply-templates/>
      </b>
   </xsl:template>

   <!--<xsl:template match="o:section">
      <section class="{local-name()}">
         <xsl:apply-templates/>
      </section>
   </xsl:template>-->

   <xsl:template match="o:mapping">
      <div class="mapping">
         <xsl:apply-templates/>
      </div>
   </xsl:template>

   <xsl:template match="o:tagging">
      <pre class="{local-name()}">
         <xsl:apply-templates/>
      </pre>
   </xsl:template>

   <xsl:template match="o:revisit">
      <span class="revisit">
        <xsl:apply-templates/>
      </span>
   </xsl:template>

   <xsl:template match="o:cf">
      <p class="{local-name()}">
         <b>See file:</b>
         <xsl:text> </xsl:text>
         <code class="filename">
            <xsl:value-of select="@file"/>
         </code>
      </p>
   </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/specml-html-xslt3.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    xmlns="http://www.w3.org/1999/xhtml"
    exclude-result-prefixes="xs math"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml"
    version="3.0">

    <xsl:import href="specml-html-xslt1.xsl"/>

    <xsl:template match="cf">
        <details style="border: thin solid black; padding: 0.5em">
            <summary>
                <xsl:next-match/>
            </summary>
            <pre class="cf">
               <xsl:sequence select="serialize(document(@file, /))"/>
      </pre>
        </details>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/specifications/profile-resolution/lib/specml-tidy-config.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<refactoringOperationDescriptor 
    xmlns="http://www.oxygenxml.com/ns/xmlRefactoring" 
    id="tidySpecML" 
    name="Tidy (reformat) SpecML">
	<description>Basic whitespace cleanup</description>    
	<script type="XSLT" href="specml-tidy.xsl"/>
	<category>NIST ITL/CSD SpecML</category>
</refactoringOperationDescriptor>



================================================
FILE: src/specifications/profile-resolution/lib/specml-tidy.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns="http://csrc.nist.gov/ns/oscal/specml"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/specml">
    
    <!-- Greedy stripper from everything but 'tagging' -->
    <xsl:strip-space elements="*"/>
    <xsl:preserve-space elements="tagging"/>
    
    <xsl:mode on-no-match="shallow-copy"/>
    
    <xsl:output indent="no" cdata-section-elements="tagging"/>
    
    <!-- element-only elements        
  let $all := //*/name() => distinct-values()
  let $mixed := //text()[normalize-space(.)]/name(..) => distinct-values()
  let $empties := //*[empty(*) and not(normalize-space()]/name() => distinct-values()
  return ($all[not(.=($mixed,$empty))] ! (. || '/*') ) => string-join(' | ')

-->  
    
    <xsl:template
        match="SPECIFICATION/* | section/* | ul/* | li/* | mapping/*">
        <!--LF before start tag if no one has given an LF before us -->
        
        <xsl:call-template name="leading-indent"/>
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <xsl:apply-templates/>
            <!-- indent for end tag *only* for element-only, not their children -->
            <xsl:apply-templates select="." mode="end-tag-ws"/>
        </xsl:copy>
        <!--LF after end tag-->
        <xsl:text>&#xA;</xsl:text>
    </xsl:template>
    
    <xsl:template name="leading-indent">
        <xsl:if test="empty(preceding-sibling::*)">
            <xsl:text>&#xA;</xsl:text>
        </xsl:if>
        <!-- indent -->
        <xsl:for-each select="ancestor::*">
            <xsl:text>  </xsl:text>
        </xsl:for-each>
    </xsl:template>
    
    <!-- will match any element not element-only -->
    <xsl:template match="*" mode="end-tag-ws"/>
    
    <!--this time matching element-only, but not their children -->
    <xsl:template
        match="SPECIFICATION | section | ul | li | mapping" mode="end-tag-ws">
        <xsl:for-each select="ancestor::*">
            <xsl:text>  </xsl:text>
        </xsl:for-each>
    </xsl:template>
    
    <xsl:template priority="101" match="tagging">
        <xsl:call-template name="leading-indent"/>
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <xsl:text>&#xA;</xsl:text>
            <!-- trimming leading and trailing whitespace only -->
            <xsl:value-of select="replace(string(),'^\s+|\s$','','s')"/>
        </xsl:copy>
        <!--LF after end tag-->
        <xsl:text>&#xA;</xsl:text>
    </xsl:template>

    <xsl:template match="p//text()">
        <xsl:variable name="soonest" select="ancestor::p/descendant::text()[normalize-space(.)][1]"/>
        <xsl:variable name="latest"  select="ancestor::p/descendant::text()[normalize-space(.)][last()]"/>
        <xsl:choose>
            <!-- A text node after this paragraph's last interesting text node is discarded -->
            <xsl:when test=". >> $latest"/>
            <!-- Also a text node before this paragraph's first interesting text node -->
            <xsl:when test="$soonest >> ."/>
            <xsl:otherwise>
                <xsl:next-match/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>
    
    <!-- Adds extra whitespace padding to inline markup -->
    <xsl:template match="p//*">
        <xsl:variable name="first" as="text()" select="ancestor::p/descendant::text()[normalize-space(.)][1]"/>
        <xsl:variable name="last"  as="text()" select="ancestor::p/descendant::text()[normalize-space(.)][last()]"/>
        <xsl:variable name="next"  as="xs:string?" select="following-sibling::node()[1]/normalize-space(.)"/>
        <!-- pad if something interesting has appeared first -->
        <xsl:if test=". >> $first">
            <xsl:text> </xsl:text>
        </xsl:if>
        <xsl:next-match/>
        <!-- pad again to replace trimmed space -->
        <xsl:if test="$last >> . and ($next ! matches(.,'^[\s\w]'))">
            <xsl:text> </xsl:text>
        </xsl:if>
    </xsl:template>
    
    <xsl:template match="text()">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>
    
</xsl:stylesheet>


================================================
FILE: src/specifications/profile-resolution/lib/specml.css
================================================

@namespace url(http://csrc.nist.gov/ns/oscal/specml);

* { display: block }

SPECIFICATION { font-family: 'Corbel'; padding: 0.5rem }

head { font-size: 150% }

div head { font-size: 90%; font-weight: bold }

p { margin-top: 1em }

li p { margin-top: 0.5em }


ul { margin-top: 1em; list-style: circle }

ul ul { margin-top: 0.5em }

li { margin-left: 2em ; display: list-item }

div { margin-top: 1em; border: thin solid black; padding: 0.5em; background-color: gainsboro;
    -oxy-foldable:true;
    -oxy-not-foldable-child: head }

section { margin-top: 1em; border: thin dotted black; padding: 0.5em;
    -oxy-foldable:true;
    -oxy-not-foldable-child: head }

section:before { content: 'section ' oxy_textfield(
            edit, "@id"  ) }

em { display: inline; font-style: italic }

strong { display: inline; font-weight: bold }

code { display: inline; font-family: monospace; font-size: 90% }

q { display: inline; quotes: "\201C" "\201D" "\2018" "\2019"; }

q:before {
    content: open-quote;
}
q:after {
    content: close-quote;
}

term { display: inline; font-family: sans-serif; font-weight: bold; font-size: 80% }

req { display: inline; font-family: sans-serif; font-size: 90%; color: darkred; background-color: #f8d0e7 }
req:before { content: oxy_textfield(
                edit, '@id',
                columns, 20)
}

revisit { display: inline; font-family: sans-serif; font-size: 90%; color: darkorange; background-color: yellow }

propose { display: inline; font-family: sans-serif; font-size: 90%; color: steelblue; background-color: gainsboro }

tagging { font-family: monospace; white-space: pre-wrap; padding: 0.5em; margin: 0.5em 0em; font-size: 80%; line-height: 130% }
tagging[whose=source_catalog] { background-color: #FFF0F0 }
tagging[whose=source_profile] { background-color: #F0FFF0 }
tagging[whose=target_catalog] { background-color: #F0F0FF }
tagging[whose=inter_catalog] { background-color: #F0F0FF }

hi { display: inline; font-style: italic; font-weight: bold; color: grey }
tagging[whose=source_catalog] hi { background-color: #FFCCCC }
tagging[whose=source_profile] hi { background-color: #CCFFCC }
tagging[whose=target_catalog] hi { background-color: #CCCCFF }
tagging[whose=inter_catalog] { background-color: #CCCCFF }

tagging:after {
    content:
        oxy_combobox(
            edit, "@whose",
            editable, false,
            values, "source_catalog, source_profile, target_catalog, inter_catalog");
}

eg {
     background-color: white; padding: 0em 0.5em; border: thin solid black;
     content:
            'unit test: ' oxy_urlChooser(
              edit, "@href",
              columns 32) }

mapping { background-color: gainsboro; border: medium double black; padding: 0.5em; margin: 1em 0em }

cf { background-color: pink; font-family: sans-serif; font-weight: bold; font-size: 80% }

cf:before {
     content:
            'example: ' oxy_urlChooser(
              edit, "@file",
              columns 35) }

xref { display: inline }


xref:after { content: oxy_combobox(
            edit, "@rid",
            editable, false
            )}

xref:before { font-weight: bold; font-size: 80%; content: " [See section \201C" oxy_xpath(
  'for $t in (@rid) return //section[@id=$t]/string(head)')  "\201D] " }

tgt { display: inline; color: midnightblue; font-weight: bold; font-size: 90%; font-family: sans-serif }

int { display: inline; color: pink; font-weight: bold; font-size: 90%; font-family: sans-serif }

src { display: inline; color: darkgreen; font-weight: bold; font-size: 90%; font-family: sans-serif }

xpath { display: inline; font-family: sans-serif; font-size: 90%; font-weight: bold }


section head { font-size: 130% }

section section head { font-size: 110%; font-style: italic }

section section section head { font-size: 100% }

section section section section head { font-size: 90% }



================================================
FILE: src/specifications/profile-resolution/lib/specml.rnc
================================================
default namespace = "http://csrc.nist.gov/ns/oscal/specml"

datatypes dtd="http://relaxng.org/ns/compatibility/datatypes/1.0"

# Lightweight syntax sugar over tiny HTML subset

start        = spec.elem | tests.elem

spec.elem    = element SPECIFICATION { head.elem?, misc, section.elem+ }

tests.elem    = element TESTSETS { requirement.elem* }

head.elem    = element head { inline-mixed }

misc         = (p.elem | ul.elem | div.elem | tagging.elem | cf.elem | mapping.elem)*

blocks       = (p.elem | ul.elem)*

p.elem       = element p { inline-mixed }

ul.elem      = element ul { li.elem+ }

li.elem      = element li { blocks+ }

div.elem     = element div { head.elem?, misc }

tagging.elem = element tagging { attribute whose { text }, (text | hi | revisit)* }

cf.elem = element cf { attribute file { text }?, empty }

mapping.elem = element mapping { head.elem?, (blocks*, tagging.elem)*, blocks* }

section.elem = element section { attribute id { xsd:ID }?, head.elem, misc, section.elem* }

inline-mixed = (text | a | code | term | revisit | propose | em | strong | q | src | tgt | xpath | xref | int | req)*

req = element req { attribute id { xsd:ID }?, attribute level { text }?, inline-mixed }
a       = element a       { attribute href { text }, text }
code    = element code    { text }
term    = element term    { text }
revisit = element revisit { inline-mixed }
propose = element propose { inline-mixed }
q       = element q       { inline-mixed }
em      = element em      { text }
strong  = element strong  { text }
src     = element src     { text }
tgt     = element tgt     { text }
xpath   = element xpath   { text }
xref    = element xref    { attribute rid { dtd:IDREF }, empty }
int     = element int     { text }
# hi combines em and strong inside tagging
hi      = element hi      { text }

requirement.elem = element requirement { attribute level { 'may' | 'should' | 'must' | 'recommended' }?, attribute id { xsd:ID }?, element statement { text }?, test.elem* }

test.elem = element test { attribute status { text }?, attribute file { xsd:anyURI }?, text }


================================================
FILE: src/specifications/profile-resolution/lib/xspec-oxygen.css
================================================
@namespace x "http://www.jenitennison.com/xslt/xspec";

* { display: block }

/*
 * 
 * 
 * 
 * 
 *
 * */

x|description { font-family: sans-serif }

/* x|helper      { } */



x|scenario { margin-top: 1em; border: thin solid purple; padding: 0.5em;
  background-color: lightgreen; line-height: 1.8em }

x|scenario[pending] { background-color: gainsboro }

x|scenario[pending=clarification] { background-color: peachpuff }

x|scenario:before {
    content: "Scenario: "
    oxy_textfield(
          edit, '@label',
          columns, 120);
}

x|scenario[pending]:before {
    content:
    "Scenario: Pending "
        oxy_textfield(
            edit, "@pending",
            values, "deployment, repair, update, discussion",
            color, "blue",
            columns, 10) " "
        oxy_textfield(
          edit, '@label',
          columns, 120);
}

x|context { }


x|context:before {
    content: "Testing context:"
        oxy_urlChooser(        
        edit, "@href",
        columns 50);
}


x|expect { }


x|expect:before {
    content: "Expecting:"
        oxy_urlChooser(        
        edit, "@href",
        columns 55);
}






================================================
FILE: src/specifications/profile-resolution/lib/xspec-test-dev.sch
================================================
<?xml version="1.0" encoding="UTF-8"?>
<sch:schema
    xmlns:s="http://csrc.nist.gov/ns/oscal/specml"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:sch="http://purl.oclc.org/dsdl/schematron" queryBinding="xslt2"
    xmlns:sqf="http://www.schematron-quickfix.com/validator/process">
    
    <!--Use for validating XSpec tests.
    
    Assesses coverage by:
      reporting where bindings to tests are broken
      reporting examples or results not found -->
    
    <sch:ns uri="http://www.jenitennison.com/xslt/xspec" prefix="x"/>
    <sch:ns uri="http://csrc.nist.gov/ns/oscal/specml"   prefix="s"/>
    
    <sch:let name="specxml" value="/processing-instruction('specification')/document(normalize-space(.),.)"/>
    
    <xsl:key name="requirement-codes" match="s:req" use="@id"/>
    
    <sch:pattern>
        <sch:rule context="x:description/processing-instruction('specification')">
            <sch:assert test="exists(document(normalize-space(.),.))">No specification found at <sch:value-of select="."/></sch:assert>
        </sch:rule>
        <sch:rule context="x:scenario[empty(x:scenario)]">
                <sch:assert test="exists(processing-instruction('requirement')) or exists(@pending)">Scenario given without any test bindings</sch:assert>
            
            <!-- Turn these on when ready -->
            <sch:report role="warning" test="false() and exists(@pending)" sqf:fix="remove-pending">Test is pending</sch:report>
            <sch:assert role="info" test="true() or exists(@pending)" sqf:fix="add-pending-deployment add-pending-repair add-pending-update add-pending-discussion">Test is ready</sch:assert>
            <sqf:fix id="remove-pending">
                <sqf:description>
                    <sqf:title>Stage as ready</sqf:title>
                </sqf:description>
                <sqf:delete match="@pending"/>
            </sqf:fix>
            <!--<sqf:fix id="add-pending-selecting">
                <sqf:description>
                    <sqf:title>Add pending</sqf:title>
                </sqf:description>
                
                <sqf:user-entry name="pending_value" default="'discussion'">
                    <sqf:description>
                        <sqf:title>Pending value</sqf:title>
                    </sqf:description>
                    
                </sqf:user-entry>
                <sqf:add node-type="attribute" target="pending" select="$pending_value"/>                
            </sqf:fix>-->
            <sqf:fix id="add-pending-deployment">
                <sqf:description>
                    <sqf:title>Restage pending deployment</sqf:title>
                </sqf:description>
                
                <sqf:add node-type="attribute" target="pending">deployment</sqf:add>
            </sqf:fix>
            <sqf:fix id="add-pending-repair">
                <sqf:description>
                    <sqf:title>Restage pending repair</sqf:title>
                </sqf:description>
                <sqf:add node-type="attribute" target="pending">repair</sqf:add>
            </sqf:fix>
            <sqf:fix id="add-pending-update">
                <sqf:description>
                    <sqf:title>Restage pending update</sqf:title>
                </sqf:description>
                <sqf:add node-type="attribute" target="pending">update</sqf:add>
            </sqf:fix>
            <sqf:fix id="add-pending-discussion">
                <sqf:description>
                    <sqf:title>Restage pending discussion</sqf:title>
                </sqf:description>
                <sqf:add node-type="attribute" target="pending">discussion</sqf:add>
            </sqf:fix>
        </sch:rule>
        
        <sch:rule context="x:scenario/processing-instruction('requirement')">
            <sch:let name="requirement-id" value="normalize-space(.)"/>
            <sch:assert test="exists($specxml/key('requirement-codes',$requirement-id))">Rule not found in spec</sch:assert>
        </sch:rule>
        <sch:rule context="x:context[exists(@href)]">
            <sch:assert test="exists(../@pending) or (resolve-uri(@href,document-uri(/)) => doc-available())">No test input found in location <sch:value-of select="@href"/></sch:assert>
        </sch:rule>
        <sch:rule context="x:expect[exists(@href)]">
            <sch:assert test="exists(../@pending) or (resolve-uri(@href,document-uri(/)) => doc-available())">No test result found in location <sch:value-of select="@href"/></sch:assert>
        </sch:rule>
    </sch:pattern>
      
    
      
</sch:schema>


================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/assess-test-coverage.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    exclude-result-prefixes="#all"
    version="3.0">
    
    <xsl:output indent="yes"/>
    
    
    <xsl:template match="/">
        <html>
            <head>
                <xsl:call-template name="style"/>
            </head>
            <body>
    
                <xsl:comment expand-text="true"> autogenerated { current-dateTime() } </xsl:comment>
                
                <xsl:variable name="collection-at" as="xs:string" expand-text="true">{ document-uri(document('')) ! replace(.,'/[^/]+$','') }?select=*_profile.xml</xsl:variable>
                
                
                <xsl:call-template name="element-block">
                    <xsl:with-param name="elements" select="collection($collection-at)/*"/>
                </xsl:call-template>
            </body>
        </html>
    </xsl:template>
    
    
    <xsl:template name="element-block" expand-text="true">
        <xsl:param name="elements" required="true"/>
        <xsl:where-populated>
            <xsl:for-each-group select="$elements" group-by="name()">
                <div class="e">
                    <p class="eline">
                        <span class="ename">{ current-grouping-key() }</span>
                        <xsl:call-template name="linkfiles"/>
                    </p>
                    <xsl:where-populated>
                        <xsl:call-template name="attribute-block">
                            <xsl:with-param name="attributes" select="current-group()/(attribute::* except @uuid)"/>
                        </xsl:call-template>
                    </xsl:where-populated>
                    <xsl:call-template name="element-block">
                        <xsl:with-param name="elements" select="current-group()/child::*"></xsl:with-param>
                    </xsl:call-template>
                </div>
            </xsl:for-each-group>                
            
        </xsl:where-populated>
    </xsl:template>
    
    <xsl:template name="linkfiles" expand-text="true">
        <xsl:for-each-group select="current-group()" group-by="document-uri(/)">
            <xsl:variable name="localname" select="replace(current-grouping-key(), '.*/', '')"/>
            <a class="filelink" href="{ $localname }">{ $localname }</a>
        </xsl:for-each-group>
    </xsl:template>

    
    
    <xsl:template name="attribute-block" expand-text="true">
        <xsl:param name="attributes" required="true"/>
        <xsl:where-populated>
            <xsl:for-each-group select="$attributes" group-by="name()">
                <details class="a">
                    <summary class="aname">@{ current-grouping-key() } - { count(current-group()) } ({ current-group()=>distinct-values()=>count() })</summary>
                    <div class="alinkset">
                        <xsl:for-each-group select="current-group()" group-by="normalize-space(.)">
                        <p class="avaluelinks">
                            <span class="avalue">{ current-grouping-key() }</span>
                            <xsl:call-template name="linkfiles"/>
                        </p>    
                        </xsl:for-each-group>
                    </div>
                </details>
            </xsl:for-each-group>                
            
        </xsl:where-populated>
    </xsl:template>
    
    <xsl:template name="style" xml:space="preserve">
      <style type="text/css">

html, body { font-family: sans-serif }

p { margin: 0em }

.e, .a { outline: thin solid black }

details { padding-left: 1em; margin: 0.3em }
div     { padding-left: 1em; margin-left: 1em; margin: 0.3em }

summary { display: list-item; list-style-position: outside; margin-left: 1em }

a.filelink { font-size: 80% ; display: inline-block; padding: 0.2em; border: thin solid darkgrey; color: darkgrey; background-color: gainsboro; margin: 0.2em; text-decoration: none; border-radius: 0.2em  }

p:hover a.filelink { color: black }

            </style>
           <!-- <script type="text/javascript" >
                 function flashClass(elemID) {
                 let ilk = document.getElementsByClassName(elemID);
                 for (let i of ilk) { i.classList.toggle('ON'); }
            }
            </script>-->
        </xsl:template>
    
</xsl:stylesheet>


================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/base-test_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:07.701-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="cb1ec926-3441-458f-8cce-ea11308c9d37">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:35.84-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls with-child-controls="yes">
         <with-id>a1</with-id>
         <with-id>b1</with-id>
         <with-id>c1</with-id>
         <with-id>c3</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/base2-test_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:08.131-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="427f8c54-c3af-4ca3-a92c-f6abaa015ba5"><!-- Like base-test_profile, except references the catalog in a resource.   -->
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:37.3-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="#0050231f-4fd0-43d6-8fa0-431367cd83e1">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>b1</with-id>
         <with-id>c1</with-id>
         <with-id>c3</with-id>
      </include-controls>
   </import>
   <back-matter>
      <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e1">
         <rlink href="catalogs/abc-simple_catalog.xml"/>
      </resource>
   </back-matter>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/broken_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:08.349-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="4cdfbf46-f785-40da-a975-c97407177933">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:38.564-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="missing_profile.xml">
      <include-controls>
         <with-id>a1</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/build-xspec.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    exclude-result-prefixes="xs math"
    version="3.0">
    
    <xsl:output indent="yes"/>
    
    <xsl:template match="/">
        <xsl:text>&#xA;</xsl:text>
        <xsl:comment expand-text="true"> autogenerated { current-dateTime() } following model in example-set.xspec</xsl:comment>
        <x:description stylesheet="../../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
            run-as="external">
            
            <!-- x:description/@run-as='external' permits the context item to be determined dynamically per scenario
    cf https://github.com/xspec/xspec/wiki/External-Transformation#global-context-item
    
    helper function for cleaning up whitespace:
      see https://github.com/xspec/xspec/wiki/Integrating-Your-Own-Test-Helpers for
      for an example see https://github.com/xspec/xspec/blob/master/tutorial/helper/ws-only-text/href_stylesheet.xspec
    -->
         
            <x:helper stylesheet="../../../utils/util/resolver-pipeline/oscal-profile-test-helper.xsl" />
<!-- looking at all the profile documents in the same directory as this XSLT -->
            <xsl:variable name="collection-at" as="xs:string" expand-text="true">{ document-uri(document('')) ! replace(.,'/[^/]+$','') }?select=*_profile.xml</xsl:variable>
            
            <xsl:message expand-text="true">looking for profile examples in { $collection-at }</xsl:message>
            <xsl:apply-templates select="collection($collection-at)" mode="make-file-scenario"/>
            
        </x:description>
        
    </xsl:template>
    
    <xsl:template match="/" mode="make-file-scenario">
        <xsl:variable name="filepath" select="document-uri(/)"/>
        <xsl:variable name="filename" select="replace($filepath,'.+/','')"/>
        <xsl:variable name="basename" select="replace($filename,'\.xml$','')"/>
        <x:scenario label="Testing { $filename }">
            <x:context href="{ $filename }"/>
            <x:expect label="Resolution of { $filename }" select="opr:scrub(.)"
                href="output-expected/{ $basename }_RESOLVED.xml"/>
        </x:scenario>
    </xsl:template>
    
</xsl:stylesheet>


================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/circular_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:08.516-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="de92ec95-2f16-4bfb-8d4f-68e8fca078b6">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:39.562-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="home_profile.xml">
      <include-controls>
         <with-id>a1</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/example-set.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    stylesheet="../../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
    run-as="external">
    <!--<x:param name="top-uuid">00000000-0000-4000-A000-000000000000</x:param>
        <x:param name="uuid-method" select="'user-provided'"/>-->
    
<!-- x:description/@run-as='external' permits the context item to be determined dynamically per scenario
    cf https://github.com/xspec/xspec/wiki/External-Transformation#global-context-item
    
    helper function for cleaning up whitespace:
      see https://github.com/xspec/xspec/wiki/Integrating-Your-Own-Test-Helpers for
      for an example see https://github.com/xspec/xspec/blob/master/tutorial/helper/ws-only-text/href_stylesheet.xspec
    -->
    
    <x:helper stylesheet="../../../utils/util/resolver-pipeline/oscal-profile-test-helper.xsl" />
    
    <x:scenario label="Base test">
        <x:context href="base-test_profile.xml"/>
        <x:expect label="Base test - fully resolved" select="opr:scrub(.)"
            href="output-expected/base-test_profile_RESOLVED.xml"/>
    </x:scenario>
    
    <x:scenario label="Working test">
        <x:context href="full-test_profile.xml"/>
        <x:expect label="Full test - fully resolved" select="opr:scrub(.)"
            href="output-expected/full-test_profile_RESOLVED.xml"/>
    </x:scenario>
    
    <x:scenario label="scrub-ws" >
        <x:variable name="opr:controlx">
            <control id="a1"   xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                <title>Control A1</title>
                <param id="param-a1.a">
                    <label>a1.a parameter</label>
                    <value>a1.a value</value>
                </param>
                <prop name="place" value="1st"/>
                <part id="a1-stmt" name="statement">
                    <p>A1 aaaaa aaaaaaaaaa</p>
                    <p>Parameter A.a is set: 
                        <insert type="param" id-ref="param-A.a"/>
                    </p>
                    <p>Parameter a1.a is set: 
                        <insert type="param" id-ref="param-a1.a"/>
                    </p>
                </part>
            </control>
        </x:variable>
        <x:call function="opr:scrub">
            <x:param select="$opr:controlx"/>
        </x:call>
        <x:expect label="whitespace normalized">
            <control id="a1">
                <title>Control A1</title>
                <param id="param-a1.a">
                    <label>a1.a parameter</label>
                    <value>a1.a value</value>
                </param>
                <prop name="place" value="1st"/>
                <part id="a1-stmt" name="statement">
                    <p>A1 aaaaa aaaaaaaaaa</p>
                    <p>Parameter A.a is set: 
                        <insert type="param" id-ref="param-A.a"/></p>
                    <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
                </part>
            </control>
        </x:expect>
    </x:scenario>
</x:description>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/exclude-call-test_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:27:30.52-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="d8234e93-48db-41e5-9649-dd2d1936dd69">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:40.346-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml"><!-- includes all controls except a1 -->
      <include-all/>
      <exclude-controls>
         <with-id>a1</with-id>
      </exclude-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/full-set.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<!-- autogenerated 2021-12-14T16:02:57.305-05:00 following model in example-set.xspec-->
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
               xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
               xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
               stylesheet="../../../utils/util/resolver-pipeline/oscal-profile-RESOLVE.xsl"
               run-as="external"
               xmlns:ov="http://csrc.nist.gov/ns/oscal/test/variable">
   <x:helper stylesheet="../../../utils/util/resolver-pipeline/oscal-profile-test-helper.xsl"/>
   
   <x:scenario label="Base test">
      <!-- Alternative model for test scrubbing both the result and the expected
           result for comparison -->
      <x:context href="base-test_profile.xml"/>
      <x:variable name="ov:expected-output"
         href="output-expected/base-test_profile_RESOLVED.xml"/>
      <x:expect label="Base test - fully resolved"
         test="opr:scrub($x:result)" select="opr:scrub($ov:expected-output)"/>
   </x:scenario>
   
   <x:scenario label="Testing base-test_profile.xml">
      
      <x:context href="base-test_profile.xml"/>
      <x:expect label="Resolution of base-test_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/base-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing base2-test_profile.xml">
      <x:context href="base2-test_profile.xml"/>
      <x:expect label="Resolution of base2-test_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/base2-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing broken_profile.xml">
      <x:context href="broken_profile.xml"/>
      <x:expect label="Resolution of broken_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/broken_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing circular_profile.xml">
      <x:context href="circular_profile.xml"/>
      <x:expect label="Resolution of circular_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/circular_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing exclude-call-test_profile.xml">
      <x:context href="exclude-call-test_profile.xml"/>
      <x:expect label="Resolution of exclude-call-test_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/exclude-call-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing full-test_profile.xml">
      <x:context href="full-test_profile.xml"/>
      <x:expect label="Resolution of full-test_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/full-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing home_profile.xml">
      <x:context href="home_profile.xml"/>
      <x:expect label="Resolution of home_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/home_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing import-twice_profile.xml">
      <x:context href="import-twice_profile.xml"/>
      <x:expect label="Resolution of import-twice_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/import-twice_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing include-all-no-children-test_profile.xml">
      <x:context href="include-all-no-children-test_profile.xml"/>
      <x:expect label="Resolution of include-all-no-children-test_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/include-all-no-children-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing include-all-test_profile.xml">
      <x:context href="include-all-test_profile.xml"/>
      <x:expect label="Resolution of include-all-test_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/include-all-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing include-call-with-children-test_profile.xml">
      <x:context href="include-call-with-children-test_profile.xml"/>
      <x:expect label="Resolution of include-call-with-children-test_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/include-call-with-children-test_profile_RESOLVED.xml"/>
      <x:expect label="Includes grandparent in result" test="$x:result//o:control/@id = 'c3'"/>
      <x:expect label="Includes grandchild in result"  test="$x:result//o:control/@id = 'c3.a-1'"/>
      <x:expect label="Is missing a control not included"   test="not( $x:result//o:control/@id = 'c2' )"/>
   </x:scenario>
   <x:scenario label="Testing include-loose-param-test_profile.xml">
      <x:context href="include-loose-param-test_profile.xml"/>
      <x:expect label="Resolution of include-loose-param-test_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/include-loose-param-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing include-match-test_profile.xml">
      <x:context href="include-match-test_profile.xml"/>
      <x:expect label="Resolution of include-match-test_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/include-match-test_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing merge-implicit-keep_profile.xml">
      <x:context href="merge-implicit-keep_profile.xml"/>
      <x:expect label="Resolution of merge-implicit-keep_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/merge-implicit-keep_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing merge-keep-resources_profile.xml">
      <x:context href="merge-keep-resources_profile.xml"/>
      <x:expect label="Resolution of merge-keep-resources_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/merge-keep-resources_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing merge-keep_profile.xml">
      <x:context href="merge-keep_profile.xml"/>
      <x:expect label="Resolution of merge-keep_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/merge-keep_profile_RESOLVED.xml"/>
   </x:scenario>
   <x:scenario label="Testing modify-adds_profile.xml">
      <x:context href="modify-adds_profile.xml"/>
      <x:expect label="Resolution of modify-adds_profile.xml"
                select="opr:scrub(.)"
                href="output-expected/modify-adds_profile_RESOLVED.xml"/>
   </x:scenario>
</x:description>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/full-test_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/css" href="../author/CSS/oscal.css"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:08.783-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="01a4b0a1-a424-4e72-9681-04e23cf3ecbf"><!-- Same as base-text, except the 'full' catalog has parameters and subcontrols  -->
   <metadata>
      <title>Full test Profile</title>
      <last-modified>2020-05-30T14:39:41.149-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-full_catalog.xml">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>b1</with-id>
         <with-id>c1</with-id>
         <with-id>c3</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/home_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:08.918-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="072ff754-196e-4441-b4c2-54550251a2ac">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:41.965-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="circular_profile.xml">
      <include-controls>
         <with-id>a1</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/import-twice_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.051-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="d36cab7c-4973-465a-b79f-6d26420fcf11"><!-- Like base-test_profile, except references the catalog in a resource.   -->
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:42.758-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="#7c688dca-f0dc-4d09-b6f0-f562165ad7d9">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>b1</with-id>
         <with-id>c1</with-id>
         <with-id>c3</with-id>
      </include-controls>
   </import>
   <import href="#7c688dca-f0dc-4d09-b6f0-f562165ad7d9">
      <include-controls>
         <with-id>b1</with-id>
         <with-id>c1</with-id>
         <with-id>c3</with-id>
      </include-controls>
   </import>
   <back-matter>
      <resource uuid="7c688dca-f0dc-4d09-b6f0-f562165ad7d9">
         <rlink href="catalogs/abc-simple_catalog.xml"/>
      </resource>
   </back-matter>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/include-all-no-children-test_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.312-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="5054b568-6c10-476d-913a-004426b3c6b4">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:44.216-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <!-- The full catalog includes subcontrols, which are to be left behind. -->
   <import href="catalogs/abc-full_catalog.xml">
      <include-all/>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/include-all-test_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.444-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="980104c1-e170-423a-94bf-ae0b42668a32">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:44.948-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-full_catalog.xml">
      <include-all/>
   </import>
   <merge>
      <as-is>true</as-is>
   </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/include-call-with-children-test_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.58-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="ff18dea5-a79b-4d55-a72a-e65e23a215f3">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:45.684-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls with-child-controls="yes">
         <with-id>a1</with-id>
         <with-id>b1</with-id>
         <with-id>c1</with-id>
         <with-id>c3</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/include-loose-param-test_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.71-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="041c76ec-9577-4fc4-bd8f-58cdc42b5a11">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:46.462-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-full_catalog.xml">
      <include-controls><!-- a1 includes an insert[@param-id="A.a"], so that parameter should be propagated. -->
         <with-id>a1</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/include-match-test_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.89-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="3ad7db02-7024-4176-af24-8090182356d5">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:47.217-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls>
         <matching pattern="^a"/>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/merge-implicit-keep_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:10.057-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="b5b1aa2d-4355-4da4-b5b2-c8222853ef66">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:47.95-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="#9c745ccc-6a85-4172-a752-11c786910e3c">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>b1</with-id>
      </include-controls>
   </import>
   <import href="#9c745ccc-6a85-4172-a752-11c786910e3c">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>b1</with-id>
      </include-controls>
   </import>
   <back-matter>
      <resource uuid="9c745ccc-6a85-4172-a752-11c786910e3c">
         <rlink href="catalogs/abc-simple_catalog.xml"/>
      </resource>
   </back-matter>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/merge-keep-resources_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:10.188-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="4a04fd18-f117-49ac-9a41-2d53c9c3eb72">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:48.703-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="#01ecd6cc-e281-472c-bb7a-0394bdf938f2">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>b2</with-id>
      </include-controls>
   </import>
   <back-matter>
      <resource uuid="01ecd6cc-e281-472c-bb7a-0394bdf938f2">
         <rlink href="catalogs/abc-full_catalog.xml"/>
      </resource>
      <resource uuid="761205f0-fd61-42d3-9c66-2fb89e844a19">
         <title>Risk Management Framework for Information Systems and Organizations: A System Life Cycle Approach for Security and Privacy</title>
         <prop name="keep" value="always"/>
         <document-id scheme="https://www.doi.org/">...doi...</document-id>
         <rlink href="https://csrc.nist.gov/publications/detail/sp/800-37/rev-2/final"/>
      </resource>
   </back-matter>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/merge-keep_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:10.321-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="b359559f-3c86-4e62-85a8-f96125e74751">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:49.443-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="#a097e626-2606-4213-8ae0-390e3d3d2aaa">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>b1</with-id>
      </include-controls>
   </import>
   <import href="#a097e626-2606-4213-8ae0-390e3d3d2aaa">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>b1</with-id>
      </include-controls>
   </import>
   <merge>
      <combine method="keep"/>
   </merge>
   <back-matter>
      <resource uuid="a097e626-2606-4213-8ae0-390e3d3d2aaa">
         <rlink href="catalogs/abc-simple_catalog.xml"/>
      </resource>
   </back-matter>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/modify-adds_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:10.45-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="036213db-02d3-4234-8963-b83f79634e36">
   <metadata>
      <title>Example</title>
      <last-modified>2020-05-30T14:39:50.536-04:00</last-modified>
      <version>1.2</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="#4d263315-ebac-45cc-801e-f5a986cd59a9">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>a3</with-id>
      </include-controls>
   </import>
   <merge>
      <combine method="keep"/>
      <as-is>true</as-is>
   </merge>
   <modify>
      <set-parameter param-id="a1_prm1">
         <constraint>
            <description>
               <p>at least every 3 years</p>
            </description>
         </constraint>
      </set-parameter>
      <set-parameter param-id="a3_prm1">
         <constraint>
            <description>
               <p>at least annually</p>
            </description>
         </constraint>
      </set-parameter>
      <alter control-id="a1"><!-- OK control -->
         <add position="starting" by-id="a1">
            <prop name="CORE" ns="https://fedramp.gov/ns/oscal" value="core"/>
         </add>
         <add position="starting" by-id="a1_prm1"><!-- OK parameter -->
            <prop name="annotated" ns="https://fedramp.gov/ns/oscal" value="param-prop"/>
         </add>
         <add position="before" by-id="a1_prm1"><!-- parameter child -->
         	<param id="new_prm">
         	   <prop name="annotated" ns="https://fedramp.gov/ns/oscal" value="new-param"/>
         	   <label>A1 Parameter New</label>
         	</param>
         </add>
         <add position="starting" by-id="a1-stmt"><!-- part -->
            <prop name="conformity"
                  ns="https://fedramp.gov/ns/oscal"
                  value="assessment-objective"/>
            <prop name="method" class="fedramp" value="EXAMINE"/>
         </add>
         <add position="after" by-id="a1-stmt"><!-- part child -->
         	<part name="statement" id="new-part">
         	   <p>A1 bbbbb <insert type="param" id-ref="new_prm"/> bbbbb</p>
         	</part>
         </add>
         <add position="ending" by-id="a1-stmt"><!-- part child -->
            <part name="statement" id="new-part2">
	           <p>A1 ccc <insert type="param" id-ref="new_prm"/> ccc</p>
	        </part>
	     </add>
      </alter>
   </modify>
   <back-matter>
      <resource uuid="4d263315-ebac-45cc-801e-f5a986cd59a9">
         <rlink href="catalogs/abc-simple_catalog.xml"/>
      </resource>
   </back-matter>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/profile-element-usage-survey.html
================================================
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      
      <style type="text/css">

html, body { font-family: sans-serif }

p { margin: 0em }

.e, .a { outline: thin solid black }

details { padding-left: 1em; margin: 0.3em }
div     { padding-left: 1em; margin-left: 1em; margin: 0.3em }

summary { display: list-item; list-style-position: outside; margin-left: 1em }

a.filelink { font-size: 80% ; display: inline-block; padding: 0.2em; border: thin solid darkgrey; color: darkgrey; background-color: gainsboro; margin: 0.2em; text-decoration: none; border-radius: 0.2em  }

p:hover a.filelink { color: black }

            </style>
      </head>
   <body><!-- autogenerated 2021-12-21T16:54:57.773-05:00 -->
      <div class="e">
         <p class="eline"><span class="ename">profile</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="broken_profile.xml">broken_profile.xml</a><a class="filelink" href="circular_profile.xml">circular_profile.xml</a><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="home_profile.xml">home_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="include-all-no-children-test_profile.xml">include-all-no-children-test_profile.xml</a><a class="filelink" href="include-all-test_profile.xml">include-all-test_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
         <div class="e">
            <p class="eline"><span class="ename">metadata</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="broken_profile.xml">broken_profile.xml</a><a class="filelink" href="circular_profile.xml">circular_profile.xml</a><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="home_profile.xml">home_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="include-all-no-children-test_profile.xml">include-all-no-children-test_profile.xml</a><a class="filelink" href="include-all-test_profile.xml">include-all-test_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            <div class="e">
               <p class="eline"><span class="ename">title</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="broken_profile.xml">broken_profile.xml</a><a class="filelink" href="circular_profile.xml">circular_profile.xml</a><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="home_profile.xml">home_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="include-all-no-children-test_profile.xml">include-all-no-children-test_profile.xml</a><a class="filelink" href="include-all-test_profile.xml">include-all-test_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            </div>
            <div class="e">
               <p class="eline"><span class="ename">last-modified</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="broken_profile.xml">broken_profile.xml</a><a class="filelink" href="circular_profile.xml">circular_profile.xml</a><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="home_profile.xml">home_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="include-all-no-children-test_profile.xml">include-all-no-children-test_profile.xml</a><a class="filelink" href="include-all-test_profile.xml">include-all-test_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            </div>
            <div class="e">
               <p class="eline"><span class="ename">version</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="broken_profile.xml">broken_profile.xml</a><a class="filelink" href="circular_profile.xml">circular_profile.xml</a><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="home_profile.xml">home_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="include-all-no-children-test_profile.xml">include-all-no-children-test_profile.xml</a><a class="filelink" href="include-all-test_profile.xml">include-all-test_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            </div>
            <div class="e">
               <p class="eline"><span class="ename">oscal-version</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="broken_profile.xml">broken_profile.xml</a><a class="filelink" href="circular_profile.xml">circular_profile.xml</a><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="home_profile.xml">home_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="include-all-no-children-test_profile.xml">include-all-no-children-test_profile.xml</a><a class="filelink" href="include-all-test_profile.xml">include-all-test_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            </div>
         </div>
         <div class="e">
            <p class="eline"><span class="ename">import</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="broken_profile.xml">broken_profile.xml</a><a class="filelink" href="circular_profile.xml">circular_profile.xml</a><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="home_profile.xml">home_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="include-all-no-children-test_profile.xml">include-all-no-children-test_profile.xml</a><a class="filelink" href="include-all-test_profile.xml">include-all-test_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            <details class="a">
               <summary class="aname">@href - 20 (11)</summary>
               <div class="alinkset">
                  <p class="avaluelinks"><span class="avalue">catalogs/abc-simple_catalog.xml</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">#0050231f-4fd0-43d6-8fa0-431367cd83e1</span><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">missing_profile.xml</span><a class="filelink" href="broken_profile.xml">broken_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">home_profile.xml</span><a class="filelink" href="circular_profile.xml">circular_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">catalogs/abc-full_catalog.xml</span><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="include-all-no-children-test_profile.xml">include-all-no-children-test_profile.xml</a><a class="filelink" href="include-all-test_profile.xml">include-all-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">circular_profile.xml</span><a class="filelink" href="home_profile.xml">home_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">#7c688dca-f0dc-4d09-b6f0-f562165ad7d9</span><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">#9c745ccc-6a85-4172-a752-11c786910e3c</span><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">#01ecd6cc-e281-472c-bb7a-0394bdf938f2</span><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">#a097e626-2606-4213-8ae0-390e3d3d2aaa</span><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a></p>
                  <p class="avaluelinks"><span class="avalue">#4d263315-ebac-45cc-801e-f5a986cd59a9</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
               </div>
            </details>
            <div class="e">
               <p class="eline"><span class="ename">include-controls</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="broken_profile.xml">broken_profile.xml</a><a class="filelink" href="circular_profile.xml">circular_profile.xml</a><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="home_profile.xml">home_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
               <details class="a">
                  <summary class="aname">@with-child-controls - 2 (1)</summary>
                  <div class="alinkset">
                     <p class="avaluelinks"><span class="avalue">yes</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a></p>
                  </div>
               </details>
               <div class="e">
                  <p class="eline"><span class="ename">with-id</span><a class="filelink" href="base-test_profile.xml">base-test_profile.xml</a><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="broken_profile.xml">broken_profile.xml</a><a class="filelink" href="circular_profile.xml">circular_profile.xml</a><a class="filelink" href="full-test_profile.xml">full-test_profile.xml</a><a class="filelink" href="home_profile.xml">home_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="include-call-with-children-test_profile.xml">include-call-with-children-test_profile.xml</a><a class="filelink" href="include-loose-param-test_profile.xml">include-loose-param-test_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
               </div>
               <div class="e">
                  <p class="eline"><span class="ename">matching</span><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a></p>
                  <details class="a">
                     <summary class="aname">@pattern - 1 (1)</summary>
                     <div class="alinkset">
                        <p class="avaluelinks"><span class="avalue">^a</span><a class="filelink" href="include-match-test_profile.xml">include-match-test_profile.xml</a></p>
                     </div>
                  </details>
               </div>
            </div>
            <div class="e">
               <p class="eline"><span class="ename">include-all</span><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a><a class="filelink" href="include-all-no-children-test_profile.xml">include-all-no-children-test_profile.xml</a><a class="filelink" href="include-all-test_profile.xml">include-all-test_profile.xml</a></p>
            </div>
            <div class="e">
               <p class="eline"><span class="ename">exclude-controls</span><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a></p>
               <div class="e">
                  <p class="eline"><span class="ename">with-id</span><a class="filelink" href="exclude-call-test_profile.xml">exclude-call-test_profile.xml</a></p>
               </div>
            </div>
         </div>
         <div class="e">
            <p class="eline"><span class="ename">back-matter</span><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            <div class="e">
               <p class="eline"><span class="ename">resource</span><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
               <div class="e">
                  <p class="eline"><span class="ename">rlink</span><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                  <details class="a">
                     <summary class="aname">@href - 7 (2)</summary>
                     <div class="alinkset">
                        <p class="avaluelinks"><span class="avalue">catalogs/abc-simple_catalog.xml</span><a class="filelink" href="base2-test_profile.xml">base2-test_profile.xml</a><a class="filelink" href="import-twice_profile.xml">import-twice_profile.xml</a><a class="filelink" href="merge-implicit-keep_profile.xml">merge-implicit-keep_profile.xml</a><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                        <p class="avaluelinks"><span class="avalue">https://csrc.nist.gov/publications/detail/sp/800-37/rev-2/final</span><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a></p>
                     </div>
                  </details>
               </div>
               <div class="e">
                  <p class="eline"><span class="ename">title</span><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a></p>
               </div>
               <div class="e">
                  <p class="eline"><span class="ename">prop</span><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a></p>
                  <details class="a">
                     <summary class="aname">@name - 1 (1)</summary>
                     <div class="alinkset">
                        <p class="avaluelinks"><span class="avalue">keep</span><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a></p>
                     </div>
                  </details>
                  <details class="a">
                     <summary class="aname">@value - 1 (1)</summary>
                     <div class="alinkset">
                        <p class="avaluelinks"><span class="avalue">always</span><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a></p>
                     </div>
                  </details>
               </div>
               <div class="e">
                  <p class="eline"><span class="ename">document-id</span><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a></p>
                  <details class="a">
                     <summary class="aname">@scheme - 1 (1)</summary>
                     <div class="alinkset">
                        <p class="avaluelinks"><span class="avalue">https://www.doi.org/</span><a class="filelink" href="merge-keep-resources_profile.xml">merge-keep-resources_profile.xml</a></p>
                     </div>
                  </details>
               </div>
            </div>
         </div>
         <div class="e">
            <p class="eline"><span class="ename">merge</span><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            <div class="e">
               <p class="eline"><span class="ename">combine</span><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
               <details class="a">
                  <summary class="aname">@method - 2 (1)</summary>
                  <div class="alinkset">
                     <p class="avaluelinks"><span class="avalue">keep</span><a class="filelink" href="merge-keep_profile.xml">merge-keep_profile.xml</a><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                  </div>
               </details>
            </div>
            <div class="e">
               <p class="eline"><span class="ename">as-is</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            </div>
         </div>
         <div class="e">
            <p class="eline"><span class="ename">modify</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
            <div class="e">
               <p class="eline"><span class="ename">set-parameter</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
               <details class="a">
                  <summary class="aname">@param-id - 2 (2)</summary>
                  <div class="alinkset">
                     <p class="avaluelinks"><span class="avalue">a1_prm1</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                     <p class="avaluelinks"><span class="avalue">a3_prm1</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                  </div>
               </details>
               <div class="e">
                  <p class="eline"><span class="ename">constraint</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                  <div class="e">
                     <p class="eline"><span class="ename">description</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                     <div class="e">
                        <p class="eline"><span class="ename">p</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="e">
               <p class="eline"><span class="ename">alter</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
               <details class="a">
                  <summary class="aname">@control-id - 1 (1)</summary>
                  <div class="alinkset">
                     <p class="avaluelinks"><span class="avalue">a1</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                  </div>
               </details>
               <div class="e">
                  <p class="eline"><span class="ename">add</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                  <details class="a">
                     <summary class="aname">@position - 2 (1)</summary>
                     <div class="alinkset">
                        <p class="avaluelinks"><span class="avalue">starting</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                     </div>
                  </details>
                  <details class="a">
                     <summary class="aname">@by-id - 2 (2)</summary>
                     <div class="alinkset">
                        <p class="avaluelinks"><span class="avalue">a1</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                        <p class="avaluelinks"><span class="avalue">a1-stmt</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                     </div>
                  </details>
                  <div class="e">
                     <p class="eline"><span class="ename">prop</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                     <details class="a">
                        <summary class="aname">@name - 3 (3)</summary>
                        <div class="alinkset">
                           <p class="avaluelinks"><span class="avalue">CORE</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                           <p class="avaluelinks"><span class="avalue">conformity</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                           <p class="avaluelinks"><span class="avalue">method</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                        </div>
                     </details>
                     <details class="a">
                        <summary class="aname">@ns - 2 (1)</summary>
                        <div class="alinkset">
                           <p class="avaluelinks"><span class="avalue">https://fedramp.gov/ns/oscal</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                        </div>
                     </details>
                     <details class="a">
                        <summary class="aname">@value - 3 (3)</summary>
                        <div class="alinkset">
                           <p class="avaluelinks"><span class="avalue">core</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                           <p class="avaluelinks"><span class="avalue">assessment-objective</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                           <p class="avaluelinks"><span class="avalue">EXAMINE</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                        </div>
                     </details>
                     <details class="a">
                        <summary class="aname">@class - 1 (1)</summary>
                        <div class="alinkset">
                           <p class="avaluelinks"><span class="avalue">fedramp</span><a class="filelink" href="modify-adds_profile.xml">modify-adds_profile.xml</a></p>
                        </div>
                     </details>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/scrub-testing.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    stylesheet="../../../utils/util/resolver-pipeline/oscal-profile-test-helper.xsl"
       xmlns="http://csrc.nist.gov/ns/oscal/1.0"
       run-as="external">
    
    <!-- Turns out this won't test in XSpec due to its handling of ws-only text nodes -->
    <x:scenario label="scrub-ws" >
        <x:context mode="scrubbing">
            <control id="a1">
                <title>Control A1</title>
                <param id="param-a1.a">
                    <label>a1.a parameter</label>
                    <value>a1.a value</value>
                </param>
                <prop name="place" value="1st"/>
                <part id="a1-stmt" name="statement">
                    <p>A1 aaaaa aaaaaaaaaa</p>
                    <p xml:space="preserve">Parameter A.a is set: <insert type="param" id-ref="param-A.a"/>
                    </p>
                    <p xml:space="preserve">Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/>
                      </p>
                </part>
            </control>
        </x:context>
        <x:expect label="whitespace normalized">
            <control id="a1">
                <title>Control A1</title>
                <param id="param-a1.a">
                    <label>a1.a parameter</label>
                    <value>a1.a value</value>
                </param>
                <prop name="place" value="1st"/>
                <part id="a1-stmt" name="statement">
                    <p>A1 aaaaa aaaaaaaaaa</p>
                    <p xml:space="preserve">Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
                    <p xml:space="preserve">Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
                </part>
            </control>
        </x:expect>
    </x:scenario>
</x:description>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/without-parent_profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:07.701-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="cb1ec926-3441-458f-8cce-ea11308c9d37">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:35.84-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-multiple-children_catalog.xml">
      <include-controls  with-parent-controls="no">
         <with-id>a1.a</with-id>
         <with-id>a1.c</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/catalogs/abc-full_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T14:13:38.826-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         uuid="6498eb6e-8653-4470-8b97-54054d3ba886"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd">
   <metadata>
      <title>ABC Catalog</title>
      <last-modified>2020-05-30T14:51:38.311-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0-rc2</oscal-version>
   </metadata>
   <group>
      <title>Group A of C</title>
      <param id="param-A.a">
         <label>A.a parameter</label>
         <value>A.a value</value>
      </param>
      <param id="param-A.b">
         <select>
            <choice>A.b parameter selection choice 1</choice>
            <choice>A.b parameter selection choice 2</choice>
            <choice>A.b parameter selection choice 3</choice>
         </select>
      </param>
      <control id="a1">
         <title>Control A1</title>
         <param id="param-a1.a">
            <label>a1.a parameter</label>
            <value>a1.a value</value>
         </param>
         <prop name="label" value="1st"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
            <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
            <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="2nd"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
            <p>Parameter A.b is set: <insert type="param" id-ref="param-A.b"/>
            </p>
         </part>
      </control>
      <control id="a3">
         <title>Control A3</title>
         <prop name="label" value="3rd"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group B of C</title>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="4th"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="5th"/>
         <link rel="citation" href="#4a3990e7-2020-4b8f-902c-d679ebea2b58"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
            <p>Also, we <a href="#4a3990e7-2020-4b8f-902c-d679ebea2b58">refer to a citation</a>.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="6th"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="7th"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
            <p>We cite a document with an anchor: <a href="somedoc#citation">... citation ...</a>.</p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <prop name="label" value="8th"/>
         <link rel="citation" href="#ef4c1cf0-a3cc-4354-bdd5-690466f61d4f"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="9th"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="10th"/>
            <part name="statement" id="c3.a-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="11th"/>
               <part name="statement" id="c3.a-1-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
   </group>
   <back-matter>
      <resource uuid="4a3990e7-2020-4b8f-902c-d679ebea2b58">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="ef4c1cf0-a3cc-4354-bdd5-690466f61d4f">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="70830fd9-7899-40f8-acfe-70a5d1a56353">
      	 <prop name="keep" value="always"/>
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/catalogs/abc-multiple-children_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:12:31.584-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         uuid="6c5149e8-f3a6-437c-8035-025e9b5fc0bf"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd">
   <metadata>
      <title>Alphabet Catalog</title>
      <last-modified>2020-05-30T14:51:41.185-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0-rc2</oscal-version>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 ccccc cccccccccccccc.</p>
      </part>
      <control id="a1.a">
         <title>Control A1-A</title>
         <prop name="label" value="second"/>
         <part name="statement" id="a1.a-stmt">
            <p>A1 A ccccc cccccccccccccc.</p>
         </part>
      </control>
      <control id="a1.b">
         <title>Control A1-B</title>
         <prop name="label" value="third"/>
         <part name="statement" id="a1.b-stmt">
            <p>A1 B ccccc cccccccccccccc.</p>
         </part>
      </control>
      <control id="a1.c">
         <title>Control A1-C</title>
         <prop name="label" value="fourth"/>
         <part name="statement" id="a1.c-stmt">
            <p>A1 C ccccc cccccccccccccc.</p>
         </part>
      </control>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/catalogs/abc-simple_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:12:31.584-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         uuid="6c5149e8-f3a6-437c-8035-025e9b5fc0bf"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd">
   <metadata>
      <title>Alphabet Catalog</title>
      <last-modified>2020-05-30T14:51:41.185-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0-rc2</oscal-version>
   </metadata>
   <group>
      <title>Group A of C</title>
      <control id="a1">
         <title>Control A1</title>
         <param id="a1_prm1">
            <label>A1 Parameter 1</label>
         </param>
         <prop name="label" value="first"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="second"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
         </part>
      </control>
      <control id="a3">
         <title>Control A3</title>
         <param id="a3_prm1">
            <label>A3 Parameter 1</label>
         </param>
         <prop name="label" value="third"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa <insert type="param" id-ref="a3_prm1"/> aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group B of C</title>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="fourth"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="fifth"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="sixth"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <prop name="label" value="eighth"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3.a-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3.a-1-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/catalogs/xyz-tiny_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-stylesheet type="text/css" href="../../../../../../src/utils/util/author/CSS/oscal-author.css" title="Authoring" alternate="no"?>
<!-- Modified by conversion XSLT 2021-04-05T11:12:31.775-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="160a974c-2aaf-45cd-b504-44bb86bebada">
   <metadata>
      <title>XYZ Tiny Catalog</title>
      <last-modified>2020-05-30T14:51:42.355-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0-rc2</oscal-version>
   </metadata>
   <group>
      <title>Group X of XYZ</title>
      <control id="x1">
         <title>Control X1</title>
      </control>
      <control id="x2">
         <title>Control X2</title>
      </control>
      <control id="x3">
         <title>Control X3</title>
      </control>
   </group>
   <group>
      <title>Group Y of XYZ</title>
      <control id="y1">
         <title>Control Y1</title>
      </control>
      <control id="y2">
         <title>Control Y2</title>
      </control>
      <control id="y3">
         <title>Control Y3</title>
      </control>
   </group>
   <group>
      <title>Group Z of XYZ</title>
      <control id="z1">
         <title>Control Z1</title>
      </control>
      <control id="z2">
         <title>Control Z2</title>
      </control>
      <control id="z3">
         <title>Control Z3</title>
         <control id="z3.a">
            <title>Control Z3-A</title>
            <control id="z3.a-1">
               <title>Control Z3-A-1</title>
            </control>
         </control>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/base-test_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
   uuid="4e44c016-f69e-4ef0-9041-7c3afc2c6ae7">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:48.692-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../base-test_profile.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label"
         value="ninth" />
      <part name="statement"
         id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="c3.a">
      <title>Control C3-A</title>
      <prop name="label"
         value="tenth" />
      <part name="statement" id="c3.a-stmt">
         <p>C3 A ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="c3.a-1">
      <title>Control C3-A-1</title>
      <prop name="label" value="eleventh" />
      <part name="statement" id="c3.a-1-stmt">
         <p>C3 A-1 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/base2-test_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="9231b676-9e4a-49b4-95e8-8ccf493886a1">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:49.259-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../base2-test_profile.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/broken_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="13aa2216-8e4e-458d-a2ba-2b25cf2716f6">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:49.676-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../broken_profile.xml"/>
   </metadata>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/circular_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="f8758e01-a1cb-46f6-92ad-2ebc7ae37e86">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:49.96-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../circular_profile.xml"/>
   </metadata>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/exclude-call-test_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="1c6e3724-6374-408a-8f82-ea8c90af956c">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:50.316-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../exclude-call-test_profile.xml"/>
   </metadata>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="second"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <param id="a3_prm1">
         <label>A3 Parameter 1</label>
      </param>
      <prop name="label" value="third"/>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa <insert type="param" id-ref="a3_prm1"/> aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="fifth"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
      </part>
   </control>
   <control id="b3">
      <title>Control B3</title>
      <prop name="label" value="sixth"/>
      <part name="statement" id="b3-stmt">
         <p>B3 bbbb bbbbbbb bbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c2">
      <title>Control C2</title>
      <prop name="label" value="eighth"/>
      <part name="statement" id="c2-stmt">
         <p>C2 cccccccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="c3.a">
      <title>Control C3-A</title>
      <prop name="label" value="tenth"/>
      <part name="statement" id="c3.a-stmt">
         <p>C3 A ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="c3.a-1">
      <title>Control C3-A-1</title>
      <prop name="label" value="eleventh"/>
      <part name="statement" id="c3.a-1-stmt">
         <p>C3 A-1 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/full-test_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="ef3d784c-f899-4b0e-b56a-3578b7a32ec3">
   <metadata>
      <title>Full test Profile</title>
      <last-modified>2021-04-06T15:00:50.63-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../full-test_profile.xml"/>
   </metadata>
   <param id="param-A.a">
      <label>A.a parameter</label>
      <value>A.a value</value>
   </param>
   <control id="a1">
      <title>Control A1</title>
      <param id="param-a1.a">
         <label>a1.a parameter</label>
         <value>a1.a value</value>
      </param>
      <prop name="label" value="1st"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
         <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
         <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="4th"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="7th"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
         <p>We cite a document with an anchor: <a href="somedoc#citation">... citation ...</a>.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="9th"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
   <back-matter>
      <resource uuid="70830fd9-7899-40f8-acfe-70a5d1a56353">
      	 <prop name="keep" value="always"/>
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/home_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="477417f2-c8a6-4bd1-8c22-0a3b9051dc12">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:50.936-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../home_profile.xml"/>
   </metadata>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/import-twice_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="b50eaaa0-d7f6-4f9b-9402-cc38d19bab10">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:51.268-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../import-twice_profile.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/include-all-no-children-test_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="d6d77a7a-b17e-4e93-84a8-412c793b1f41">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:51.584-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../include-all-no-children-test_profile.xml"/>
   </metadata>
   <param id="param-A.a">
      <label>A.a parameter</label>
      <value>A.a value</value>
   </param>
   <param id="param-A.b">
      <select>
         <choice>A.b parameter selection choice 1</choice>
         <choice>A.b parameter selection choice 2</choice>
         <choice>A.b parameter selection choice 3</choice>
      </select>
   </param>
   <control id="a1">
      <title>Control A1</title>
      <param id="param-a1.a">
         <label>a1.a parameter</label>
         <value>a1.a value</value>
      </param>
      <prop name="label" value="1st"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
         <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
         <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
      </part>
   </control>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="2nd"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
         <p>Parameter A.b is set: <insert type="param" id-ref="param-A.b"/>
         </p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <prop name="label" value="3rd"/>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="4th"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="5th"/>
      <link rel="citation" href="#4a3990e7-2020-4b8f-902c-d679ebea2b58"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
         <p>Also, we <a href="#4a3990e7-2020-4b8f-902c-d679ebea2b58">refer to a citation</a>.</p>
      </part>
   </control>
   <control id="b3">
      <title>Control B3</title>
      <prop name="label" value="6th"/>
      <part name="statement" id="b3-stmt">
         <p>B3 bbbb bbbbbbb bbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="7th"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
         <p>We cite a document with an anchor: <a href="somedoc#citation">... citation ...</a>.</p>
      </part>
   </control>
   <control id="c2">
      <title>Control C2</title>
      <prop name="label" value="8th"/>
      <link rel="citation" href="#ef4c1cf0-a3cc-4354-bdd5-690466f61d4f"/>
      <part name="statement" id="c2-stmt">
         <p>C2 cccccccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="9th"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="c3.a">
      <title>Control C3-A</title>
      <prop name="label" value="10th"/>
      <part name="statement" id="c3.a-stmt">
         <p>C3 A ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="c3.a-1">
      <title>Control C3-A-1</title>
      <prop name="label" value="11th"/>
      <part name="statement" id="c3.a-1-stmt">
         <p>C3 A-1 ccccc cccccccccccccc.</p>
      </part>
   </control>
   <back-matter>
      <resource uuid="4a3990e7-2020-4b8f-902c-d679ebea2b58">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="ef4c1cf0-a3cc-4354-bdd5-690466f61d4f">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="70830fd9-7899-40f8-acfe-70a5d1a56353">
      	 <prop name="keep" value="always"/>
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/include-all-test_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="c222a47f-0003-4e31-b5cd-316889392d38">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:51.847-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../include-all-test_profile.xml"/>
   </metadata>
   <group>
      <title>Group A of C</title>
	   <param id="param-A.a">
	      <label>A.a parameter</label>
	      <value>A.a value</value>
	   </param>
	   <param id="param-A.b">
	      <select>
	         <choice>A.b parameter selection choice 1</choice>
	         <choice>A.b parameter selection choice 2</choice>
	         <choice>A.b parameter selection choice 3</choice>
	      </select>
	   </param>
	   <control id="a1">
	      <title>Control A1</title>
	      <param id="param-a1.a">
	         <label>a1.a parameter</label>
	         <value>a1.a value</value>
	      </param>
	      <prop name="label" value="1st"/>
	      <part name="statement" id="a1-stmt">
	         <p>A1 aaaaa aaaaaaaaaa</p>
	         <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
	         <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
	      </part>
	   </control>
	   <control id="a2">
	      <title>Control A2</title>
	      <prop name="label" value="2nd"/>
	      <part name="statement" id="a2-stmt">
	         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
	         <p>Parameter A.b is set: <insert type="param" id-ref="param-A.b"/>
	         </p>
	      </part>
	   </control>
	   <control id="a3">
	      <title>Control A3</title>
	      <prop name="label" value="3rd"/>
	      <part name="statement" id="a3-stmt">
	         <p>A3 aaaaa aaaaaaaaaa</p>
	      </part>
	   </control>
   </group>
   <group>
	   <title>Group B of C</title>
	   <control id="b1">
	      <title>Control B1</title>
	      <prop name="label" value="4th"/>
	      <part name="statement" id="b1-stmt">
	         <p>B1 bbbb bbbbbbb.</p>
	      </part>
	   </control>
	   <control id="b2">
	      <title>Control B2</title>
	      <prop name="label" value="5th"/>
	      <link rel="citation" href="#4a3990e7-2020-4b8f-902c-d679ebea2b58"/>
	      <part name="statement" id="b2-stmt">
	         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
	         <p>Also, we <a href="#4a3990e7-2020-4b8f-902c-d679ebea2b58">refer to a citation</a>.</p>
	      </part>
	   </control>
	   <control id="b3">
	      <title>Control B3</title>
	      <prop name="label" value="6th"/>
	      <part name="statement" id="b3-stmt">
	         <p>B3 bbbb bbbbbbb bbbb.</p>
	      </part>
	   </control>
   </group>
   <group>
      <title>Group C of C</title>
	   <control id="c1">
	      <title>Control C1</title>
	      <prop name="label" value="7th"/>
	      <part name="statement" id="c1-stmt">
	         <p>C1 ccccc ccc ccccccccccccccccc.</p>
	         <p>We cite a document with an anchor: <a href="somedoc#citation">... citation ...</a>.</p>
	      </part>
	   </control>
	   <control id="c2">
	      <title>Control C2</title>
	      <prop name="label" value="8th"/>
	      <link rel="citation" href="#ef4c1cf0-a3cc-4354-bdd5-690466f61d4f"/>
	      <part name="statement" id="c2-stmt">
	         <p>C2 cccccccc ccccccccccccccccc.</p>
	      </part>
	   </control>
	   <control id="c3">
	      <title>Control C3</title>
	      <prop name="label" value="9th"/>
	      <part name="statement" id="c3-stmt">
	         <p>C3 ccccc cccccccccccccc.</p>
	      </part>
		   <control id="c3.a">
		      <title>Control C3-A</title>
		      <prop name="label" value="10th"/>
		      <part name="statement" id="c3.a-stmt">
		         <p>C3 A ccccc cccccccccccccc.</p>
		      </part>
			   <control id="c3.a-1">
			      <title>Control C3-A-1</title>
			      <prop name="label" value="11th"/>
			      <part name="statement" id="c3.a-1-stmt">
			         <p>C3 A-1 ccccc cccccccccccccc.</p>
			      </part>
			   </control>
		   </control>
	   </control>
    </group>
   <back-matter>
      <resource uuid="4a3990e7-2020-4b8f-902c-d679ebea2b58">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="ef4c1cf0-a3cc-4354-bdd5-690466f61d4f">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="70830fd9-7899-40f8-acfe-70a5d1a56353">
      	 <prop name="keep" value="always"/>
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/include-call-with-children-test_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
   uuid="4e44c016-f69e-4ef0-9041-7c3afc2c6ae7">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:48.692-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../base-test_profile.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label"
         value="ninth" />
      <part name="statement"
         id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="c3.a">
      <title>Control C3-A</title>
      <prop name="label"
         value="tenth" />
      <part name="statement"
         id="c3.a-stmt">
         <p>C3 A ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="c3.a-1">
      <title>Control C3-A-1</title>
      <prop name="label"
         value="eleventh" />
      <part name="statement"
         id="c3.a-1-stmt">
         <p>C3 A-1 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>


================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/include-loose-param-test_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="d6685fdc-63ea-43de-97c5-abf3bb3d7444">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:52.401-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../include-loose-param-test_profile.xml"/>
   </metadata>
   <param id="param-A.a">
      <label>A.a parameter</label>
      <value>A.a value</value>
   </param>
   <control id="a1">
      <title>Control A1</title>
      <param id="param-a1.a">
         <label>a1.a parameter</label>
         <value>a1.a value</value>
      </param>
      <prop name="label" value="1st"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
         <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
         <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
      </part>
   </control>
   <back-matter>
      <resource uuid="70830fd9-7899-40f8-acfe-70a5d1a56353">
      	 <prop name="keep" value="always"/>
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/include-match-test_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="fce2fed7-5209-424d-ad58-f4ed6d150398">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:52.649-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../include-match-test_profile.xml"/>
   </metadata>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/merge-implicit-keep_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="9a0deca4-a8ec-460e-828f-eacd665c8822">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:52.97-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../merge-implicit-keep_profile.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/merge-keep-resources_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="d79cb711-19da-45dd-899d-e04ce44c4176">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:53.229-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../merge-keep-resources_profile.xml"/>
   </metadata>
   <param id="param-A.a">
      <label>A.a parameter</label>
      <value>A.a value</value>
   </param>
   <control id="a1">
      <title>Control A1</title>
      <param id="param-a1.a">
         <label>a1.a parameter</label>
         <value>a1.a value</value>
      </param>
      <prop name="label" value="1st"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
         <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
         <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
      </part>
   </control>
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="5th"/>
      <link rel="citation" href="#4a3990e7-2020-4b8f-902c-d679ebea2b58"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
         <p>Also, we <a href="#4a3990e7-2020-4b8f-902c-d679ebea2b58">refer to a citation</a>.</p>
      </part>
   </control>
   <back-matter>
      <resource uuid="4a3990e7-2020-4b8f-902c-d679ebea2b58">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="70830fd9-7899-40f8-acfe-70a5d1a56353">
      	 <prop name="keep" value="always"/>
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="761205f0-fd61-42d3-9c66-2fb89e844a19">
         <title>Risk Management Framework for Information Systems and Organizations: A System Life Cycle Approach for Security and Privacy</title>
         <prop name="keep" value="always"/>
         <document-id scheme="https://www.doi.org/">...doi...</document-id>
         <rlink href="https://csrc.nist.gov/publications/detail/sp/800-37/rev-2/final"/>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/merge-keep_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="2c8b2fbe-c635-4f3e-b14b-a70aadd5f40b">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2021-04-06T15:00:53.459-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../merge-keep_profile.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/modify-adds_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="24814035-640b-46a4-906c-edb27a992357">
   <metadata>
      <title>Example</title>
      <last-modified>2021-04-06T15:00:53.695-04:00</last-modified>
      <version>1.2</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../modify-adds_profile.xml"/>
   </metadata>
   <group>
      <title>Group A of C</title>
      <control id="a1">
         <title>Control A1</title>
         <param id="new_prm">
            <prop name="annotated" ns="https://fedramp.gov/ns/oscal" value="new-param"/>
            <label>A1 Parameter New</label>
       	 </param>
         <param id="a1_prm1">
            <prop name="annotated" ns="https://fedramp.gov/ns/oscal" value="param-prop"/>
            <label>A1 Parameter 1</label>
            <constraint>
               <description>
                  <p>at least every 3 years</p>
               </description>
            </constraint>
         </param>
         <prop name="CORE" ns="https://fedramp.gov/ns/oscal" value="core"/>
         <prop name="label" value="first"/>
         <part name="statement" id="a1-stmt">
            <prop name="conformity"
                  ns="https://fedramp.gov/ns/oscal"
                  value="assessment-objective"/>
            <prop name="method" class="fedramp" value="EXAMINE"/>
            <p>A1 aaaaa <insert type="param" id-ref="a1_prm1"/> aaaaaaaaaa</p>
            <part name="statement" id="new-part2">
	           <p>A1 ccc <insert type="param" id-ref="new_prm"/> ccc</p>
	        </part>
         </part>
         <part name="statement" id="new-part">
            <p>A1 bbbbb <insert type="param" id-ref="new_prm"/> bbbbb</p>
         </part>
      </control>
      <control id="a3">
         <title>Control A3</title>
         <param id="a3_prm1">
            <label>A3 Parameter 1</label>
            <constraint>
               <description>
                  <p>at least annually</p>
               </description>
            </constraint>
         </param>
         <prop name="label" value="third"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa <insert type="param" id-ref="a3_prm1"/> aaaaaaaaaa</p>
         </part>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/profile-resolution-examples/output-expected/without-parent_profile_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="00000000-0000-4000-B000-000000000000">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-12-26T16:13:57.7747599-05:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <prop name="resolution-tool" value="some value"/>
      <link rel="source-profile" href="../without-parent_profile.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="a1.a">
      <title>Control A1-A</title>
      <prop name="label" value="second"/>
      <part name="statement" id="a1.a-stmt">
         <p>A1 A ccccc cccccccccccccc.</p>
      </part>
   </control>
   <control id="a1.c">
      <title>Control A1-C</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="a1.c-stmt">
         <p>A1 C ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/keep-everything-twice.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/abc-mixed-up_catalog.xml">
        <include-all/>
    </import>
    <import href="catalogs/abc-mixed-up_catalog.xml">
        <include-all/>
    </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-broken-import.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/missing-catalog.xml">
        <include-all/>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-chained-all-asis.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-04-18T15:14:17.679398100-04:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <!-- Points to a profile, which must be resolved to produce the catalog   -->
    <import href="req-include-all-asis.xml">
        <include-all/>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-chained-deepA.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-04-18T15:14:17.679398100-04:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <!-- Points to a profile, which must be resolved to produce the catalog   -->
    <import href="req-include-all-asis.xml">
        <include-controls with-child-controls="yes">
            <with-id>a1</with-id>
            <with-id>b1</with-id>
            <with-id>c1</with-id>
            <with-id>c3</with-id>
        </include-controls>
    </import>
    <import href="catalogs/abc-mixed-up_catalog.xml">
        <include-controls with-child-controls="yes">
            <with-id>a3</with-id>
            <with-id>b3</with-id>
        </include-controls>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-circular_import.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:08.516-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="de92ec95-2f16-4bfb-8d4f-68e8fca078b6">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:39.562-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="req-circular_importer.xml">
      <include-controls>
         <with-id>a1</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-circular_importer.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:08.516-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="de92ec95-2f16-4bfb-8d4f-68e8fca078b6">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:39.562-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="req-circular_import.xml">
      <include-controls>
         <with-id>a1</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-import-by-resource.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="#449ce77c-24d3-4740-b0bd-1b37239437ff">
        <include-all/>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
    <back-matter>
        <resource uuid="449ce77c-24d3-4740-b0bd-1b37239437ff">
            <rlink href="catalogs/abc-mixed-up_catalog.xml"/>
        </resource>
    </back-matter>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-all-asis.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/abc-mixed-up_catalog.xml">
        <include-all/>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-all-flat.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="b636f129-d980-41c8-95e3-d3649a1fd546">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-02-15T13:33:09.325121-05:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-mixed-up_catalog.xml">
      <include-all/>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-by-id.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.58-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="ff18dea5-a79b-4d55-a72a-e65e23a215f3">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:45.684-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls with-child-controls="yes">
         <with-id>a1</with-id>
         <with-id>b1</with-id>
         <with-id>c1</with-id>
         <with-id>c3</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-by-match-empty.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.89-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="3ad7db02-7024-4176-af24-8090182356d5">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:47.217-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls>
         <matching/>
         <matching pattern=""/>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-by-match.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.89-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="3ad7db02-7024-4176-af24-8090182356d5">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:47.217-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls>
         <matching pattern="a*"/>
         <matching pattern="?1"/>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-exclude1.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.89-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="3ad7db02-7024-4176-af24-8090182356d5">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:47.217-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls>
         <matching pattern="a*"/>
         <matching pattern="?1"/>
      </include-controls>
      <exclude-controls>
         <with-id>a1</with-id>
      </exclude-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-exclude2.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.89-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="3ad7db02-7024-4176-af24-8090182356d5">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:47.217-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls>
         <matching pattern="a*"/>
      </include-controls>
      <exclude-controls>
         <matching pattern="?1"/>
      </exclude-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-exclude3.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.89-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="3ad7db02-7024-4176-af24-8090182356d5">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:47.217-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls>
         <matching pattern="a1"/>
         <matching pattern="b2"/>
         <matching pattern="c3"/>
      </include-controls>
      <exclude-controls>
         <matching pattern="?1"/>
      </exclude-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-exclude4.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.89-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="3ad7db02-7024-4176-af24-8090182356d5">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:47.217-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls with-child-controls="no">
         <matching pattern="a1"/>
         <matching pattern="b2"/>
         <matching pattern="c3"/>
      </include-controls>
      <exclude-controls>
         <matching pattern="?1"/>
      </exclude-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-include-exclude5.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.89-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="3ad7db02-7024-4176-af24-8090182356d5">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:47.217-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls with-child-controls="no">
         <matching pattern="a1"/>
         <matching pattern="b2"/>
         <matching pattern="b2"/>
         <matching pattern="b2"/>
         <matching pattern="b2"/>
         <matching pattern="c3"/>
      </include-controls>
      <exclude-controls>
         <matching pattern="?1"/>
      </exclude-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-loose-params1.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/loose-parameters.xml">
        <include-all/>
        <exclude-controls>
            <with-id>c2</with-id><!-- note parameter c2p should come through -->
        </exclude-controls>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-loose-params2.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/loose-parameters.xml">
        <include-all/>
        <exclude-controls>
            <with-id>c2</with-id><!-- note parameter c2p should come through -->
        </exclude-controls>
    </import>
    <merge>
        <flat/>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-merge-keep1.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/abc-simple_catalog.xml">
        <include-all/>
    </import>
    <import href="catalogs/abc-mixed-up_catalog.xml">
        <include-all/>
    </import>
    <merge>
        <combine method="keep"/>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-merge-keep2.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/abc-simple_catalog.xml">
        <include-all/>
    </import>
    <import href="catalogs/abc-mixed-up_catalog.xml">
        <include-all/>
    </import>
    <merge>
        <combine method="keep"/>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-merge-usefirst1.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/abc-simple_catalog.xml">
        <include-all/>
    </import>
    <import href="catalogs/abc-mixed-up_catalog.xml">
        <include-all/>
    </import>
    <merge>
        <combine method="use-first"/>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-merge-usefirst2.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/abc-simple_catalog.xml">
        <include-all/>
    </import>
    <import href="catalogs/abc-mixed-up_catalog.xml">
        <include-all/>
    </import>
    <merge>
        <combine method="use-first"/>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-missing-resource.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="#449ce77c-24d3-4740-b0bd-1b37239437f0">
        <include-all/>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
    <back-matter>
        <resource uuid="449ce77c-24d3-4740-b0bd-1b37239437f0">
            <rlink href="catalogs/abc-mixed-up_catalog-missing.xml"/>
        </resource>
    </back-matter>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-modify-alter-remove-match1.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="b636f129-d980-41c8-95e3-d3649a1fd546">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-02-15T13:33:09.325121-05:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-mixed-up_catalog.xml">
      <include-all/>
      <exclude-controls>
         <matching pattern="b*"/>
      </exclude-controls>
   </import>
   <modify>
      <alter control-id="a1">
         <remove by-name="label"/><!-- removes a prop -->
      </alter>
      <alter control-id="a2">
         <remove by-item-name="part"/><!-- removes a part -->
      </alter>
      <alter control-id="a3"><!-- leaves a param -->
         <remove by-item-name="prop"/><!-- removes a part -->
         <remove by-item-name="part"/><!-- removes a part -->
      </alter>
      <alter control-id="c3.a">
         <remove by-name="label" by-item-name="part"/><!-- should be a no-op -->
      </alter>
      <alter control-id="c2">
         <remove by-id="c2-stmt"/><!-- removed a part -->
         <remove by-id="c3-stmt"/><!-- should be a no-op -->
      </alter>
   </modify>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-modify-alter-remove-match2.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="b636f129-d980-41c8-95e3-d3649a1fd546">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-02-15T13:33:09.325121-05:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/busy_catalog.xml">
      <include-all/>
      <exclude-controls>
         <matching pattern="b*"/>
      </exclude-controls>
   </import>
   <modify>
      <alter control-id="a1">
         <remove by-name="label"/><!-- removes a prop -->
         <remove by-name="extra" by-ns="http://csrc.nist.gov/ns/oscal"/><!-- removes three props, leaves one -->
      </alter>
      <alter control-id="a2">
         <remove by-name="label"/><!-- removes a prop -->
         <remove by-name="extra" by-class="special"/><!-- removes one prop -->
      </alter>
      <alter control-id="a3">
         <remove by-name="label"/><!-- removes a prop -->
         <remove by-name="extra"/><!-- removes four props -->
      </alter>
      <alter control-id="a4">
         <remove by-name="extra" by-ns="http://somens.url"/><!-- removes one prop-->
      </alter>
      <alter control-id="a5">
         <remove by-ns="http://somens.url"/><!-- removes one prop-->
      </alter>
   </modify>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-spoofing-resource.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!DOCTYPE profile [
<!ENTITY spoof SYSTEM "spoofed-resource.xml"> ]>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="#449ce77c-24d3-4740-b0bd-1b37239437f0">
        <include-all/>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
    <back-matter>
        &spoof;
    </back-matter>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-structure-asis1.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/abc-crazy_catalog.xml">
        <include-all/>
        <exclude-controls with-child-controls="yes">
            <with-id>c3</with-id><!-- should also drop its group -->
        </exclude-controls>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-structure-asis2.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="0a281290-eb91-423f-9430-576e8099cae4">
    <metadata>
        <title>Test Profile</title>
        <last-modified>2022-02-14T17:44:59.245623-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0.0</oscal-version>
    </metadata>
    <import href="catalogs/abc-crazy_catalog.xml">
        <include-all/>
        <exclude-controls>
            <with-id>c3</with-id><!-- should keep descendant controls -->
            <matching pattern="b*"/><!-- should drop group -->
        </exclude-controls>
    </import>
    <merge>
        <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-with-child-controls-no.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.58-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="ff18dea5-a79b-4d55-a72a-e65e23a215f3">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:45.684-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls with-child-controls="no">
         <with-id>a1</with-id>
         <with-id>b1</with-id>
         <with-id>c1</with-id>
         <with-id>c3</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-with-child-controls-none.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.58-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="ff18dea5-a79b-4d55-a72a-e65e23a215f3">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2020-05-30T14:39:45.684-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls>
         <with-id>a1</with-id>
         <with-id>b1</with-id>
         <with-id>c1</with-id>
         <with-id>c3</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-with-parent-controls-no1.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.58-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="4909dc72-134f-42d1-bca7-8a48978cd3ce">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-26T16:46:04.8198642-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls with-parent-controls="yes" with-child-controls="yes">
         <with-id>c3</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-with-parent-controls-none.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.58-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="8f921ee8-e1ef-49c5-a286-2617808e5303">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-26T17:19:08.8113625-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls>
         <with-id>c3.a</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-with-parent-controls-yes1.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.58-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="6007afa0-bf97-4113-a94c-9652c2438245">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-26T17:09:44.5371952-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls with-parent-controls="yes" with-child-controls="yes">
         <with-id>c3.a</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/req-with-parent-controls-yes2.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:09.58-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="6007afa0-bf97-4113-a94c-9652c2438245">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-26T17:09:44.5371952-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="catalogs/abc-simple_catalog.xml">
      <include-controls with-parent-controls="yes" with-child-controls="no">
         <with-id>c3.a</with-id>
      </include-controls>
   </import>
</profile>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/spoofed-resource.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<resource uuid="449ce77c-24d3-4740-b0bd-1b37239437f0">
  <rlink href="catalogs/abc-mixed-up_catalog.xml"/>
</resource>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/catalogs/abc-crazy_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T14:13:38.826-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         uuid="6498eb6e-8653-4470-8b97-54054d3ba886"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd">
   <metadata>
      <title>ABC Catalog</title>
      <last-modified>2020-05-30T14:51:38.311-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <group>
      <title>Group A of C</title>
      <param id="param-A.a">
         <label>A.a parameter</label>
         <value>A.a value</value>
      </param>
      <param id="param-A.b">
         <select>
            <choice>A.b parameter selection choice 1</choice>
            <choice>A.b parameter selection choice 2</choice>
            <choice>A.b parameter selection choice 3</choice>
         </select>
      </param>
      <control id="a1">
         <title>Control A1</title>
         <param id="param-a1.a">
            <label>a1.a parameter</label>
            <value>a1.a value</value>
         </param>
         <prop name="label" value="1st"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
            <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
            <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="2nd"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
            <p>Parameter A.b is set: <insert type="param" id-ref="param-A.b"/>
            </p>
         </part>
      </control>
      <control id="a3">
         <title>Control A3</title>
         <prop name="label" value="3rd"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group B of C</title>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="4th"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="5th"/>
         <link rel="reference" href="#4a3990e7-2020-4b8f-902c-d679ebea2b58"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
            <p>Also, we <a href="#4a3990e7-2020-4b8f-902c-d679ebea2b58">refer to a citation</a>.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="6th"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <part name="overview">
         <p>Group C of C contains subgroups CA and CB.</p></part>
      <group id="CA">
         <title>Group CA</title>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="7th"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
            <p>We cite a document with an anchor: <a href="somedoc#citation">... citation ...</a>.</p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <prop name="label" value="8th"/>
         <link rel="reference" href="#ef4c1cf0-a3cc-4354-bdd5-690466f61d4f"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc.</p>
         </part>
      </control>
      </group>
      <group id="CB">
         <title>Group CB</title>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="9th"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="10th"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="11th"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
      </group>
   </group>
   <back-matter>
      <resource uuid="4a3990e7-2020-4b8f-902c-d679ebea2b58">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="ef4c1cf0-a3cc-4354-bdd5-690466f61d4f">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="70830fd9-7899-40f8-acfe-70a5d1a56353">
      	<prop name="keep" value="always"/>
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/catalogs/abc-full_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T14:13:38.826-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         uuid="6498eb6e-8653-4470-8b97-54054d3ba886"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd">
   <metadata>
      <title>ABC Catalog</title>
      <last-modified>2020-05-30T14:51:38.311-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <group>
      <title>Group A of C</title>
      <param id="param-A.a">
         <label>A.a parameter</label>
         <value>A.a value</value>
      </param>
      <param id="param-A.b">
         <select>
            <choice>A.b parameter selection choice 1</choice>
            <choice>A.b parameter selection choice 2</choice>
            <choice>A.b parameter selection choice 3</choice>
         </select>
      </param>
      <control id="a1">
         <title>Control A1</title>
         <param id="param-a1.a">
            <label>a1.a parameter</label>
            <value>a1.a value</value>
         </param>
         <prop name="label" value="1st"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
            <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
            <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="2nd"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
            <p>Parameter A.b is set: <insert type="param" id-ref="param-A.b"/>
            </p>
         </part>
      </control>
      <control id="a3">
         <title>Control A3</title>
         <prop name="label" value="3rd"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group B of C</title>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="4th"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="5th"/>
         <link rel="reference" href="#4a3990e7-2020-4b8f-902c-d679ebea2b58"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
            <p>Also, we <a href="#4a3990e7-2020-4b8f-902c-d679ebea2b58">refer to a citation</a>.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="6th"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="7th"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
            <p>We cite a document with an anchor: <a href="somedoc#citation">... citation ...</a>.</p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <prop name="label" value="8th"/>
         <link rel="reference" href="#ef4c1cf0-a3cc-4354-bdd5-690466f61d4f"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="9th"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="10th"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="11th"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
   </group>
   <back-matter>
      <resource uuid="4a3990e7-2020-4b8f-902c-d679ebea2b58">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="ef4c1cf0-a3cc-4354-bdd5-690466f61d4f">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="70830fd9-7899-40f8-acfe-70a5d1a56353">
      	 <prop name="keep" value="always"/>
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/catalogs/abc-mixed-up_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         uuid="4b22b835-c62f-44d2-89ac-e5a8f26e4ebe"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd">
   <metadata>
      <title>Mixed up Alphabet Catalog</title>
      <last-modified>2022-02-14T17:26:02.616123-05:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <group>
      <title>Group B of C</title>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="fifth"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
         </part>
      </control>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="fourth"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="sixth"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group A of C</title>
      <control id="a3">
         <title>Control A3</title>
         <param id="a3_prm1">
            <label>A3 Parameter 1</label>
         </param>
         <prop name="label" value="third"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="second"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
         </part>
      </control>
      <control id="a1">
         <title>Control A1</title>
         <param id="a1_prm1">
            <label>A1 Parameter 1</label>
         </param>
         <prop name="label" value="first"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <prop name="label" value="eighth"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc.</p>
         </part>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/catalogs/abc-simple_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:12:31.584-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         uuid="6c5149e8-f3a6-437c-8035-025e9b5fc0bf"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd">
   <metadata>
      <title>Alphabet Catalog</title>
      <last-modified>2020-05-30T14:51:41.185-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <group>
      <title>Group A of C</title>
      <control id="a1">
         <title>Control A1</title>
         <param id="a1_prm1">
            <label>A1 Parameter 1</label>
         </param>
         <prop name="label" value="first"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="second"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
         </part>
      </control>
      <control id="a3">
         <title>Control A3</title>
         <param id="a3_prm1">
            <label>A3 Parameter 1</label>
         </param>
         <prop name="label" value="third"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group B of C</title>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="fourth"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="fifth"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="sixth"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <prop name="label" value="eighth"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/catalogs/busy_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T14:13:38.826-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         uuid="6498eb6e-8653-4470-8b97-54054d3ba886"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd">
   <metadata>
      <title>ABC Catalog</title>
      <last-modified>2020-05-30T14:51:38.311-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <group>
      <title>Group A of C</title>
      <param id="param-A.a">
         <label>A.a parameter</label>
         <value>A.a value</value>
      </param>
      <param id="param-A.b">
         <select>
            <choice>A.b parameter selection choice 1</choice>
            <choice>A.b parameter selection choice 2</choice>
            <choice>A.b parameter selection choice 3</choice>
         </select>
      </param>
      <param id="param-A.c">
         <label>A.c parameter</label>
         <usage><p>UNUSED</p></usage>
      </param>
      
      <control id="a1">
         <title>Control A1</title>
         <param id="param-a1.a">
            <label>a1.a parameter</label>
            <value>a1.a value</value>
         </param>
         <prop name="label" value="1st"/>
         <prop name="extra" value="ex1"/>
         <prop name="extra" value="ex2" ns="http://csrc.nist.gov/ns/oscal"/>
         <prop name="extra" value="ex3" ns="http://somens.url"/>
         <prop name="extra" value="ex4" class="special"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
            <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
            <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="2nd"/>
         <prop name="extra" value="ex1"/>
         <prop name="extra" value="ex2"/>
         <prop name="extra" value="ex3" ns="http://somens.url"/>
         <prop name="extra" value="ex4" class="special"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
            <p>Parameter A.b is set: <insert type="param" id-ref="param-A.b"/>
            </p>
         </part>
      </control>
      <control id="a3">
         <title>Control A3</title>
         <prop name="extra" value="ex1"/>
         <prop name="extra" value="ex2"/>
         <prop name="extra" value="ex3" ns="http://somens.url"/>
         <prop name="extra" value="ex4" class="special"/>
         <prop name="label" value="3rd"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
      <control id="a4">
         <title>Control A4</title>
         <prop name="extra" value="ex1"/>
         <prop name="extra" value="ex2"/>
         <prop name="extra" value="ex3" ns="http://somens.url"/>
         <prop name="extra" value="ex4" class="special"/>
         <prop name="label" value="3rd"/>
         <part name="statement" id="a3-stmt">
            <p>A4 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
      <control id="a5">
         <title>Control A5</title>
         <prop name="extra" value="ex1"/>
         <prop name="extra" value="ex2"/>
         <prop name="extra" value="ex3" ns="http://somens.url"/>
         <prop name="extra" value="ex4" class="special"/>
         <prop name="label" value="3rd"/>
         <part name="statement" id="a3-stmt">
            <p>A5 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <back-matter>
      <resource uuid="4a3990e7-2020-4b8f-902c-d679ebea2b58">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="ef4c1cf0-a3cc-4354-bdd5-690466f61d4f">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="70830fd9-7899-40f8-acfe-70a5d1a56353">
      	<prop name="keep" value="always"/>
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/catalogs/loose-parameters.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         uuid="e597b49b-e3cb-44be-a155-8601c368d7aa"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 ../../../../../xml/schema/oscal_catalog_schema.xsd">
   <metadata>
      <title>Loose Parameters</title>
      <last-modified>2022-04-26T15:43:06.6638546-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <param id="floatA">
      <label>floating param</label>
      <guideline><p>When referenced from anywhere, this should float through.</p></guideline>
   </param>
   <group id="GRP">
      <title>Group of Controls</title>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3-stmt">
                  <p>Making reference to a parameter in another control, like this: <insert type="param" id-ref="c2p"/>.</p>
               </part>
            </control>
         </control>
      </control>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc. <insert type="param" id-ref="floatA"/></p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <param id="c2p">
            <label>param floating in C2</label>
            <guideline><p>If Control C2 is missing, should be floating free.</p></guideline>
         </param>
         <prop name="label" value="eighth"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc. <insert type="param" id-ref="c2p"/></p>
         </part>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/catalogs/xyz-tiny_catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-stylesheet type="text/css" href="../../../../../../src/utils/util/author/CSS/oscal-author.css" title="Authoring" alternate="no"?>
<!-- Modified by conversion XSLT 2021-04-05T11:12:31.775-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="160a974c-2aaf-45cd-b504-44bb86bebada">
   <metadata>
      <title>XYZ Tiny Catalog</title>
      <last-modified>2020-05-30T14:51:42.355-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <group>
      <title>Group X of XYZ</title>
      <control id="x1">
         <title>Control X1</title>
      </control>
      <control id="x2">
         <title>Control X2</title>
      </control>
      <control id="x3">
         <title>Control X3</title>
      </control>
   </group>
   <group>
      <title>Group Y of XYZ</title>
      <control id="y1">
         <title>Control Y1</title>
      </control>
      <control id="y2">
         <title>Control Y2</title>
      </control>
      <control id="y3">
         <title>Control Y3</title>
      </control>
   </group>
   <group>
      <title>Group Z of XYZ</title>
      <control id="z1">
         <title>Control Z1</title>
      </control>
      <control id="z2">
         <title>Control Z2</title>
      </control>
      <control id="z3">
         <title>Control Z3</title>
         <control id="z3.a">
            <title>Control Z3-A</title>
            <control id="z3.a-1">
               <title>Control Z3-A-1</title>
            </control>
         </control>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/illustrations/req-include-all-asis-view.html
================================================
<!DOCTYPE HTML><html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      
      <style type="text/css">

body { display: grid; grid-template-columns: 1fr 1fr 1fr;
       grid-column-gap: 1vw;
       font-family: sans-serif }
       
body > section {  border: thin solid black; padding: 0.4em; margin-top: 1em; max-height: 90vh; overflow: auto }

.docmap p { margin: 0em }

.docmap .element { outline: medium solid transparent }
.docmap .element:hover { outline: medium solid #FDD7E4 }

.docmap details.element { padding-left: 1em; margin-top: 0.2em }
.docmap div.element { padding-left: 1em; margin-left: 1em; margin-top: 0.2em }

details.element:not([open]) div.cnts { display: none }

summary { display: list-item; list-style-position: outside; margin-left: 1em }

div.eflex { display: inline-flex; align-items: start; gap:0.2em }

div.eflex > * { flex: initial }

p.tag { display: inline-block; background-color: midnightblue; color: white; padding: 0.4em; border-radius: 0.2em  }
p.tag span.flag { display: inline-block; background-color: white; color: black;
  padding: 0.1em; margin-left: 0.5em; }

div.cnts  p.tag { margin-top:0.2em }
p.tag.drctv { background-color: slategrey }

div.cnts { display: inline-block; font-size: 80% }

p.flsb:hover { background-color: royalblue }

p.tag.ON { transition: background-color 0s, font-size 0.3s ease-out;
      font-size: 120%;
      background-color: steelblue !important }

      h3 code { background-color: gainsboro }

            </style>
      <script type="text/javascript">
                 function flashClass(elemID) {
                 let ilk = document.getElementsByClassName(elemID);
                 for (let i of ilk) { i.classList.toggle('ON'); }
            }
            </script>
      </head>
   <body>
      <section id="import-maps">
         <h3>Importing <code>catalogs/abc-mixed-up_catalog.xml</code></h3>
         <h4>In catalog<code> catalogs/abc-mixed-up_catalog.xml</code></h4>
         <div class="docmap">
            <details class="element" open>
               <summary>
                  <div class="eflex">
                     <p class="tag">catalog</p>
                  </div>
               </summary>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag">group</p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Group B of C</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_b2" onclick="flashClass('ID_b2')">control <span class="flag">b2</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control B2</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_b2-stmt" onclick="flashClass('ID_b2-stmt')"> part <b>statement</b><span class="flag">b2-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_b1" onclick="flashClass('ID_b1')">control <span class="flag">b1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control B1</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_b1-stmt" onclick="flashClass('ID_b1-stmt')"> part <b>statement</b><span class="flag">b1-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_b3" onclick="flashClass('ID_b3')">control <span class="flag">b3</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control B3</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_b3-stmt" onclick="flashClass('ID_b3-stmt')"> part <b>statement</b><span class="flag">b3-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag">group</p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Group A of C</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_a3" onclick="flashClass('ID_a3')">control <span class="flag">a3</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control A3</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="tag flsb ID_a3_prm1" onclick="flashClass('ID_a3_prm1')">param <span class="flag">a3_prm1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="flsb tag ID_a3_prm1-label" onclick="flashClass('ID_a3_prm1-label')">label <span class="flag">A3 Parameter 1</span></p>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_a3-stmt" onclick="flashClass('ID_a3-stmt')"> part <b>statement</b><span class="flag">a3-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_a2" onclick="flashClass('ID_a2')">control <span class="flag">a2</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control A2</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_a2-stmt" onclick="flashClass('ID_a2-stmt')"> part <b>statement</b><span class="flag">a2-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_a1" onclick="flashClass('ID_a1')">control <span class="flag">a1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control A1</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="tag flsb ID_a1_prm1" onclick="flashClass('ID_a1_prm1')">param <span class="flag">a1_prm1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="flsb tag ID_a1_prm1-label" onclick="flashClass('ID_a1_prm1-label')">label <span class="flag">A1 Parameter 1</span></p>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_a1-stmt" onclick="flashClass('ID_a1-stmt')"> part <b>statement</b><span class="flag">a1-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag">group</p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Group C of C</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c3" onclick="flashClass('ID_c3')">control <span class="flag">c3</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C3</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                        </div>
                     </div>
                     <details class="element" open>
                        <summary>
                           <div class="eflex">
                              <p class="tag flsb ID_c3.a" onclick="flashClass('ID_c3.a')">control <span class="flag">c3.a</span></p>
                              <div class="cnts">
                                 <div class="cnts-row">
                                    <p class="tag">title <span class="flag">Control C3-A</span></p>
                                 </div>
                              </div>
                           </div>
                        </summary>
                        <div class="element">
                           <div class="eflex">
                              <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                           </div>
                        </div>
                        <details class="element" open>
                           <summary>
                              <div class="eflex">
                                 <p class="tag flsb ID_c3.a-1" onclick="flashClass('ID_c3.a-1')">control <span class="flag">c3.a-1</span></p>
                                 <div class="cnts">
                                    <div class="cnts-row">
                                       <p class="tag">title <span class="flag">Control C3-A-1</span></p>
                                    </div>
                                 </div>
                              </div>
                           </summary>
                           <div class="element">
                              <div class="eflex">
                                 <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                              </div>
                           </div>
                        </details>
                     </details>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c1" onclick="flashClass('ID_c1')">control <span class="flag">c1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C1</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c1-stmt" onclick="flashClass('ID_c1-stmt')"> part <b>statement</b><span class="flag">c1-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c2" onclick="flashClass('ID_c2')">control <span class="flag">c2</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C2</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c2-stmt" onclick="flashClass('ID_c2-stmt')"> part <b>statement</b><span class="flag">c2-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
               </details>
            </details>
         </div>
      </section>
      <section id="profile-map">
         <h3>Profile <code>req-include-all-asis.xml</code></h3>
         <div class="docmap">
            <details class="element" open>
               <summary>
                  <div class="eflex">
                     <p class="tag drctv">profile</p>
                  </div>
               </summary>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag drctv">import<span class="flag">catalogs/abc-mixed-up_catalog.xml</span></p>
                     </div>
                  </summary>
                  <div class="element">
                     <div class="eflex">
                        <p class="tag drctv">include-all</p>
                     </div>
                  </div>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag drctv">merge</p>
                     </div>
                  </summary>
                  <div class="element">
                     <div class="eflex">
                        <p class="tag drctv">as-is <span class="flag">true</span></p>
                     </div>
                  </div>
               </details>
            </details>
         </div>
      </section>
      <section id="result-map">
         <h3>Result <code>output-expected/req-include-all-asis_RESOLVED.xml</code></h3>
         <div class="docmap">
            <details class="element" open>
               <summary>
                  <div class="eflex">
                     <p class="tag">catalog</p>
                  </div>
               </summary>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag">group</p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Group B of C</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_b2" onclick="flashClass('ID_b2')">control <span class="flag">b2</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control B2</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_b2-stmt" onclick="flashClass('ID_b2-stmt')"> part <b>statement</b><span class="flag">b2-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_b1" onclick="flashClass('ID_b1')">control <span class="flag">b1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control B1</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_b1-stmt" onclick="flashClass('ID_b1-stmt')"> part <b>statement</b><span class="flag">b1-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_b3" onclick="flashClass('ID_b3')">control <span class="flag">b3</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control B3</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_b3-stmt" onclick="flashClass('ID_b3-stmt')"> part <b>statement</b><span class="flag">b3-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag">group</p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Group A of C</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_a3" onclick="flashClass('ID_a3')">control <span class="flag">a3</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control A3</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="tag flsb ID_a3_prm1" onclick="flashClass('ID_a3_prm1')">param <span class="flag">a3_prm1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="flsb tag ID_a3_prm1-label" onclick="flashClass('ID_a3_prm1-label')">label <span class="flag">A3 Parameter 1</span></p>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_a3-stmt" onclick="flashClass('ID_a3-stmt')"> part <b>statement</b><span class="flag">a3-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_a2" onclick="flashClass('ID_a2')">control <span class="flag">a2</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control A2</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_a2-stmt" onclick="flashClass('ID_a2-stmt')"> part <b>statement</b><span class="flag">a2-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_a1" onclick="flashClass('ID_a1')">control <span class="flag">a1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control A1</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="tag flsb ID_a1_prm1" onclick="flashClass('ID_a1_prm1')">param <span class="flag">a1_prm1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="flsb tag ID_a1_prm1-label" onclick="flashClass('ID_a1_prm1-label')">label <span class="flag">A1 Parameter 1</span></p>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_a1-stmt" onclick="flashClass('ID_a1-stmt')"> part <b>statement</b><span class="flag">a1-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag">group</p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Group C of C</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c3" onclick="flashClass('ID_c3')">control <span class="flag">c3</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C3</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                        </div>
                     </div>
                     <details class="element" open>
                        <summary>
                           <div class="eflex">
                              <p class="tag flsb ID_c3.a" onclick="flashClass('ID_c3.a')">control <span class="flag">c3.a</span></p>
                              <div class="cnts">
                                 <div class="cnts-row">
                                    <p class="tag">title <span class="flag">Control C3-A</span></p>
                                 </div>
                              </div>
                           </div>
                        </summary>
                        <div class="element">
                           <div class="eflex">
                              <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                           </div>
                        </div>
                        <details class="element" open>
                           <summary>
                              <div class="eflex">
                                 <p class="tag flsb ID_c3.a-1" onclick="flashClass('ID_c3.a-1')">control <span class="flag">c3.a-1</span></p>
                                 <div class="cnts">
                                    <div class="cnts-row">
                                       <p class="tag">title <span class="flag">Control C3-A-1</span></p>
                                    </div>
                                 </div>
                              </div>
                           </summary>
                           <div class="element">
                              <div class="eflex">
                                 <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                              </div>
                           </div>
                        </details>
                     </details>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c1" onclick="flashClass('ID_c1')">control <span class="flag">c1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C1</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c1-stmt" onclick="flashClass('ID_c1-stmt')"> part <b>statement</b><span class="flag">c1-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c2" onclick="flashClass('ID_c2')">control <span class="flag">c2</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C2</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c2-stmt" onclick="flashClass('ID_c2-stmt')"> part <b>statement</b><span class="flag">c2-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
               </details>
            </details>
         </div>
      </section>
   </body>
</html>


================================================
FILE: src/specifications/profile-resolution/requirement-tests/illustrations/req-include-by-id-view.html
================================================
<!DOCTYPE HTML><html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      
      <style type="text/css">

body { display: grid; grid-template-columns: 1fr 1fr 1fr;
       grid-column-gap: 1vw;
       font-family: sans-serif }
       
body > section {  border: thin solid black; padding: 0.4em; margin-top: 1em; max-height: 90vh; overflow: auto }

.docmap p { margin: 0em }

.docmap .element { outline: medium solid transparent }
.docmap .element:hover { outline: medium solid #FDD7E4 }

.docmap details.element { padding-left: 1em; margin-top: 0.2em }
.docmap div.element { padding-left: 1em; margin-left: 1em; margin-top: 0.2em }

details.element:not([open]) div.cnts { display: none }

summary { display: list-item; list-style-position: outside; margin-left: 1em }

div.eflex { display: inline-flex; align-items: start; gap:0.2em }

div.eflex > * { flex: initial }

p.tag { display: inline-block; background-color: midnightblue; color: white; padding: 0.4em; border-radius: 0.2em  }
p.tag span.flag { display: inline-block; background-color: white; color: black;
  padding: 0.1em; margin-left: 0.5em; }

div.cnts  p.tag { margin-top:0.2em }
p.tag.drctv { background-color: slategrey }

div.cnts { display: inline-block; font-size: 80% }

p.flsb:hover { background-color: royalblue }

p.tag.ON { transition: background-color 0s, font-size 0.3s ease-out;
      font-size: 120%;
      background-color: steelblue !important }

      h3 code { background-color: gainsboro }

            </style>
      <script type="text/javascript">
                 function flashClass(elemID) {
                 let ilk = document.getElementsByClassName(elemID);
                 for (let i of ilk) { i.classList.toggle('ON'); }
            }
            </script>
      </head>
   <body>
      <section id="import-maps">
         <h3>Importing <code>catalogs/abc-simple_catalog.xml</code></h3>
         <h4>In catalog<code> catalogs/abc-simple_catalog.xml</code></h4>
         <div class="docmap">
            <details class="element" open>
               <summary>
                  <div class="eflex">
                     <p class="tag">catalog</p>
                  </div>
               </summary>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag">group</p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Group A of C</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_a1" onclick="flashClass('ID_a1')">control <span class="flag">a1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control A1</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="tag flsb ID_a1_prm1" onclick="flashClass('ID_a1_prm1')">param <span class="flag">a1_prm1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="flsb tag ID_a1_prm1-label" onclick="flashClass('ID_a1_prm1-label')">label <span class="flag">A1 Parameter 1</span></p>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_a1-stmt" onclick="flashClass('ID_a1-stmt')"> part <b>statement</b><span class="flag">a1-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_a2" onclick="flashClass('ID_a2')">control <span class="flag">a2</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control A2</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_a2-stmt" onclick="flashClass('ID_a2-stmt')"> part <b>statement</b><span class="flag">a2-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_a3" onclick="flashClass('ID_a3')">control <span class="flag">a3</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control A3</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="tag flsb ID_a3_prm1" onclick="flashClass('ID_a3_prm1')">param <span class="flag">a3_prm1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="flsb tag ID_a3_prm1-label" onclick="flashClass('ID_a3_prm1-label')">label <span class="flag">A3 Parameter 1</span></p>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_a3-stmt" onclick="flashClass('ID_a3-stmt')"> part <b>statement</b><span class="flag">a3-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag">group</p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Group B of C</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_b1" onclick="flashClass('ID_b1')">control <span class="flag">b1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control B1</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_b1-stmt" onclick="flashClass('ID_b1-stmt')"> part <b>statement</b><span class="flag">b1-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_b2" onclick="flashClass('ID_b2')">control <span class="flag">b2</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control B2</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_b2-stmt" onclick="flashClass('ID_b2-stmt')"> part <b>statement</b><span class="flag">b2-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_b3" onclick="flashClass('ID_b3')">control <span class="flag">b3</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control B3</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_b3-stmt" onclick="flashClass('ID_b3-stmt')"> part <b>statement</b><span class="flag">b3-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag">group</p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Group C of C</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c1" onclick="flashClass('ID_c1')">control <span class="flag">c1</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C1</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c1-stmt" onclick="flashClass('ID_c1-stmt')"> part <b>statement</b><span class="flag">c1-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c2" onclick="flashClass('ID_c2')">control <span class="flag">c2</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C2</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c2-stmt" onclick="flashClass('ID_c2-stmt')"> part <b>statement</b><span class="flag">c2-stmt</span> â–®</p>
                        </div>
                     </div>
                  </details>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c3" onclick="flashClass('ID_c3')">control <span class="flag">c3</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C3</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                        </div>
                     </div>
                     <details class="element" open>
                        <summary>
                           <div class="eflex">
                              <p class="tag flsb ID_c3.a" onclick="flashClass('ID_c3.a')">control <span class="flag">c3.a</span></p>
                              <div class="cnts">
                                 <div class="cnts-row">
                                    <p class="tag">title <span class="flag">Control C3-A</span></p>
                                 </div>
                              </div>
                           </div>
                        </summary>
                        <div class="element">
                           <div class="eflex">
                              <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                           </div>
                        </div>
                        <details class="element" open>
                           <summary>
                              <div class="eflex">
                                 <p class="tag flsb ID_c3.a-1" onclick="flashClass('ID_c3.a-1')">control <span class="flag">c3.a-1</span></p>
                                 <div class="cnts">
                                    <div class="cnts-row">
                                       <p class="tag">title <span class="flag">Control C3-A-1</span></p>
                                    </div>
                                 </div>
                              </div>
                           </summary>
                           <div class="element">
                              <div class="eflex">
                                 <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                              </div>
                           </div>
                        </details>
                     </details>
                  </details>
               </details>
            </details>
         </div>
      </section>
      <section id="profile-map">
         <h3>Profile <code>req-include-by-id.xml</code></h3>
         <div class="docmap">
            <details class="element" open>
               <summary>
                  <div class="eflex">
                     <p class="tag drctv">profile</p>
                  </div>
               </summary>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag drctv">import<span class="flag">catalogs/abc-simple_catalog.xml</span></p>
                     </div>
                  </summary>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag drctv">include-controls</p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag drctv">with child controls <span class="flag">yes </span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb drctv tag ID_a1" onclick="flashClass('ID_a1')">with-id <span class="flag">a1</span></p>
                        </div>
                     </div>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb drctv tag ID_b1" onclick="flashClass('ID_b1')">with-id <span class="flag">b1</span></p>
                        </div>
                     </div>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb drctv tag ID_c1" onclick="flashClass('ID_c1')">with-id <span class="flag">c1</span></p>
                        </div>
                     </div>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb drctv tag ID_c3" onclick="flashClass('ID_c3')">with-id <span class="flag">c3</span></p>
                        </div>
                     </div>
                  </details>
               </details>
            </details>
         </div>
      </section>
      <section id="result-map">
         <h3>Result <code>output-expected/req-include-by-id_RESOLVED.xml</code></h3>
         <div class="docmap">
            <details class="element" open>
               <summary>
                  <div class="eflex">
                     <p class="tag">catalog</p>
                  </div>
               </summary>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag flsb ID_a1" onclick="flashClass('ID_a1')">control <span class="flag">a1</span></p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Control A1</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <div class="element">
                     <div class="eflex">
                        <p class="tag flsb ID_a1_prm1" onclick="flashClass('ID_a1_prm1')">param <span class="flag">a1_prm1</span></p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="flsb tag ID_a1_prm1-label" onclick="flashClass('ID_a1_prm1-label')">label <span class="flag">A1 Parameter 1</span></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="element">
                     <div class="eflex">
                        <p class="flsb tag ID_a1-stmt" onclick="flashClass('ID_a1-stmt')"> part <b>statement</b><span class="flag">a1-stmt</span> â–®</p>
                     </div>
                  </div>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag flsb ID_b1" onclick="flashClass('ID_b1')">control <span class="flag">b1</span></p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Control B1</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <div class="element">
                     <div class="eflex">
                        <p class="flsb tag ID_b1-stmt" onclick="flashClass('ID_b1-stmt')"> part <b>statement</b><span class="flag">b1-stmt</span> â–®</p>
                     </div>
                  </div>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag flsb ID_c1" onclick="flashClass('ID_c1')">control <span class="flag">c1</span></p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Control C1</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <div class="element">
                     <div class="eflex">
                        <p class="flsb tag ID_c1-stmt" onclick="flashClass('ID_c1-stmt')"> part <b>statement</b><span class="flag">c1-stmt</span> â–®</p>
                     </div>
                  </div>
               </details>
               <details class="element" open>
                  <summary>
                     <div class="eflex">
                        <p class="tag flsb ID_c3" onclick="flashClass('ID_c3')">control <span class="flag">c3</span></p>
                        <div class="cnts">
                           <div class="cnts-row">
                              <p class="tag">title <span class="flag">Control C3</span></p>
                           </div>
                        </div>
                     </div>
                  </summary>
                  <div class="element">
                     <div class="eflex">
                        <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                     </div>
                  </div>
                  <details class="element" open>
                     <summary>
                        <div class="eflex">
                           <p class="tag flsb ID_c3.a" onclick="flashClass('ID_c3.a')">control <span class="flag">c3.a</span></p>
                           <div class="cnts">
                              <div class="cnts-row">
                                 <p class="tag">title <span class="flag">Control C3-A</span></p>
                              </div>
                           </div>
                        </div>
                     </summary>
                     <div class="element">
                        <div class="eflex">
                           <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                        </div>
                     </div>
                     <details class="element" open>
                        <summary>
                           <div class="eflex">
                              <p class="tag flsb ID_c3.a-1" onclick="flashClass('ID_c3.a-1')">control <span class="flag">c3.a-1</span></p>
                              <div class="cnts">
                                 <div class="cnts-row">
                                    <p class="tag">title <span class="flag">Control C3-A-1</span></p>
                                 </div>
                              </div>
                           </div>
                        </summary>
                        <div class="element">
                           <div class="eflex">
                              <p class="flsb tag ID_c3-stmt" onclick="flashClass('ID_c3-stmt')"> part <b>statement</b><span class="flag">c3-stmt</span> â–®</p>
                           </div>
                        </div>
                     </details>
                  </details>
               </details>
            </details>
         </div>
      </section>
   </body>
</html>


================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/keep-everything-twice_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="f7a050b7-16f6-488f-b596-f184cc044280">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-25T16:32:27.0669689-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="keep-everything-twice.xml"/>
   </metadata>
   <!-- note that constraints over id should make these results invalid  -->
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="fifth"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="b3">
      <title>Control B3</title>
      <prop name="label" value="sixth"/>
      <part name="statement" id="b3-stmt">
         <p>B3 bbbb bbbbbbb bbbb.</p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <param id="a3_prm1">
         <label>A3 Parameter 1</label>
      </param>
      <prop name="label" value="third"/>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="second"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
      </part>
   </control>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a-1">
            <title>Control C3-A-1</title>
            <prop name="label" value="eleventh"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A-1 ccccc cccccccccccccc.</p>
            </part>
         </control>
      </control>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c2">
      <title>Control C2</title>
      <prop name="label" value="eighth"/>
      <part name="statement" id="c2-stmt">
         <p>C2 cccccccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="fifth"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="b3">
      <title>Control B3</title>
      <prop name="label" value="sixth"/>
      <part name="statement" id="b3-stmt">
         <p>B3 bbbb bbbbbbb bbbb.</p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <param id="a3_prm1">
         <label>A3 Parameter 1</label>
      </param>
      <prop name="label" value="third"/>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="second"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
      </part>
   </control>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a-1">
            <title>Control C3-A-1</title>
            <prop name="label" value="eleventh"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A-1 ccccc cccccccccccccc.</p>
            </part>
         </control>
      </control>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c2">
      <title>Control C2</title>
      <prop name="label" value="eighth"/>
      <part name="statement" id="c2-stmt">
         <p>C2 cccccccc ccccccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-chained-all-asis_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="90ece0fd-0f0a-4fc3-b623-0b047aa7921e">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-18T15:24:15.880015-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-chained-all-asis.xml"/>
      <link rel="resolution-source" href="req-include-all-asis.xml"/>
   </metadata>
   <group>
      <title>Group B of C</title>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="fifth"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
         </part>
      </control>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="fourth"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="sixth"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group A of C</title>
      <control id="a3">
         <title>Control A3</title>
         <param id="a3_prm1">
            <label>A3 Parameter 1</label>
         </param>
         <prop name="label" value="third"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="second"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
         </part>
      </control>
      <control id="a1">
         <title>Control A1</title>
         <param id="a1_prm1">
            <label>A1 Parameter 1</label>
         </param>
         <prop name="label" value="first"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <prop name="label" value="eighth"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc.</p>
         </part>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-chained-deepA_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0" uuid="f64f5d0e-f7eb-4b1d-b234-cffdaab8f4f8">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-25T15:47:00.2942155-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-chained-deepA.xml"/>
   </metadata>
   <group>
      <title>Group B of C</title>
      <control id="b1"><!-- via req-include-all-asis.xml -->
         <title>Control B1</title>
         <prop name="label" value="fourth"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="sixth"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group A of C</title>
      <control id="a3">
         <title>Control A3</title>
         <param id="a3_prm1">
            <label>A3 Parameter 1</label>
         </param>
         <prop name="label" value="third"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
      <control id="a1"><!-- via req-include-all-asis.xml -->
         <title>Control A1</title>
         <param id="a1_prm1">
            <label>A1 Parameter 1</label>
         </param>
         <prop name="label" value="first"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c3"><!-- via req-include-all-asis.xml -->
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
      <control id="c1"><!-- via req-include-all-asis.xml -->
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
         </part>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-circular_import_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="941045b5-7e4f-4528-9537-88f890540c32">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-18T15:24:16.5210188-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-circular_import.xml"/>
   </metadata>
   <ERROR level="fatal">Import of href="req-circular_importer.xml" fails - circular import</ERROR>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-import-by-resource_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="df7094f5-22ff-4052-a231-b5a0c23a0b9b">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-18T15:24:17.90803-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-import-by-resource.xml"/>
   </metadata>
   <group>
      <title>Group B of C</title>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="fifth"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
         </part>
      </control>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="fourth"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="sixth"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group A of C</title>
      <control id="a3">
         <title>Control A3</title>
         <param id="a3_prm1">
            <label>A3 Parameter 1</label>
         </param>
         <prop name="label" value="third"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="second"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
         </part>
      </control>
      <control id="a1">
         <title>Control A1</title>
         <param id="a1_prm1">
            <label>A1 Parameter 1</label>
         </param>
         <prop name="label" value="first"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <prop name="label" value="eighth"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc.</p>
         </part>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-all-asis_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="b6d24151-eb31-41a4-8bbe-aab29bb75cc4">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-02-15T13:27:39.019088-05:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-all-asis.xml"/>
   </metadata>
   <group>
      <title>Group B of C</title>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="fifth"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
         </part>
      </control>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="fourth"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="sixth"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group A of C</title>
      <control id="a3">
         <title>Control A3</title>
         <param id="a3_prm1">
            <label>A3 Parameter 1</label>
         </param>
         <prop name="label" value="third"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="second"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
         </part>
      </control>
      <control id="a1">
         <title>Control A1</title>
         <param id="a1_prm1">
            <label>A1 Parameter 1</label>
         </param>
         <prop name="label" value="first"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
         </part>
      </control>
      <control id="c2">
         <title>Control C2</title>
         <prop name="label" value="eighth"/>
         <part name="statement" id="c2-stmt">
            <p>C2 cccccccc ccccccccccccccccc.</p>
         </part>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-all-flat_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="4ad6497f-8f00-4f61-a279-4ed9b3088a60">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-02-15T16:39:33.396588-05:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-all-flat.xml"/>
   </metadata>
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="fifth"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="b3">
      <title>Control B3</title>
      <prop name="label" value="sixth"/>
      <part name="statement" id="b3-stmt">
         <p>B3 bbbb bbbbbbb bbbb.</p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <param id="a3_prm1">
         <label>A3 Parameter 1</label>
      </param>
      <prop name="label" value="third"/>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="second"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
      </part>
   </control>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a-1">
            <title>Control C3-A-1</title>
            <prop name="label" value="eleventh"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A-1 ccccc cccccccccccccc.</p>
            </part>
         </control>
      </control>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c2">
      <title>Control C2</title>
      <prop name="label" value="eighth"/>
      <part name="statement" id="c2-stmt">
         <p>C2 cccccccc ccccccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-by-id_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="4793f015-b0db-44d4-a145-9256ffaf7b8e">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-19T15:51:51.3807658-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-by-id.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a-1">
            <title>Control C3-A-1</title>
            <prop name="label" value="eleventh"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A-1 ccccc cccccccccccccc.</p>
            </part>
         </control>
      </control>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-by-match-empty_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="424d0a68-cb4e-4bd6-aef8-b2c23af679d2">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-19T16:10:50.306097-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-by-match-empty.xml"/>
   </metadata>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-by-match_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="f206ec86-3fe7-4694-b9f7-581c6c37755c">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-19T16:07:09.7400721-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-by-match.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="second"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <param id="a3_prm1">
         <label>A3 Parameter 1</label>
      </param>
      <prop name="label" value="third"/>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-exclude1_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="46fb1cbc-e13c-4dda-82c6-af5783163b66">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-20T11:25:08.5989517-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-exclude1.xml"/>
   </metadata>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="second"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <param id="a3_prm1">
         <label>A3 Parameter 1</label>
      </param>
      <prop name="label" value="third"/>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-exclude2_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="6f457bf5-50c6-4b0b-aa8e-a9d812efa489">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-20T11:27:11.0114457-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-exclude2.xml"/>
   </metadata>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="second"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <param id="a3_prm1">
         <label>A3 Parameter 1</label>
      </param>
      <prop name="label" value="third"/>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-exclude3_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="dce8a59e-d0a7-4222-b3a2-9cdcee1e12f6">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-20T11:29:12.5084741-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-exclude3.xml"/>
   </metadata>
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="fifth"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-exclude4_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="21a14237-59cf-4227-8f96-31b4a2372495">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-25T16:18:40.4891642-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-exclude4.xml"/>
   </metadata>
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="fifth"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-include-exclude5_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="30a5bef7-aa54-413d-86ed-c927523b18c6">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-25T16:20:19.1426274-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-include-exclude5.xml"/>
   </metadata>
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="fifth"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-loose-params1_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="00000000-0000-4000-B000-000000000000">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-06-13T13:51:15.3863601-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>TODO: Not implemented yet</oscal-version>
      <prop name="resolution-tool"
            value="OSCAL Profile Resolver XSLT Pipeline OPRXP"/>
      <link href="requirement-tests/req-loose-params1.xml"
            rel="source-profile"/>
   </metadata>
   <param id="floatA">
      <label>floating param</label>
      <guideline><p>When referenced from anywhere, this should float through.</p></guideline>
   </param>
   <param id="c2p">
      <label>param floating in C2</label>
      <guideline><p>If Control C2 is missing, should be floating free.</p></guideline>
   </param>
   <group id="GRP">
      <title>Group of Controls</title>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3-stmt">
                  <p>Making reference to a parameter in another control, like this: <insert type="param" id-ref="c2p"/>.</p>
               </part>
            </control>
         </control>
      </control>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc. <insert type="param" id-ref="floatA"/>
            </p>
         </part>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-loose-params2_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="00000000-0000-4000-B000-000000000000">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-06-14T10:12:38.6256557-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>TODO: Not implemented yet</oscal-version>
      <prop name="resolution-tool"
            value="OSCAL Profile Resolver XSLT Pipeline OPRXP"/>
      <link href="requirement-tests/req-loose-params2.xml"
            rel="source-profile"/>
   </metadata>
   <param id="floatA">
      <label>floating param</label>
      <guideline><p>When referenced from anywhere, this should float through.</p></guideline>
   </param>
   <param id="c2p">
      <label>param floating in C2</label>
      <guideline><p>If Control C2 is missing, should be floating free.</p></guideline>
   </param>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a-1">
            <title>Control C3-A-1</title>
            <prop name="label" value="eleventh"/>
            <part name="statement" id="c3-stmt">
               <p>Making reference to a parameter in another control, like this: <insert type="param" id-ref="c2p"/>.</p>
            </part>
         </control>
      </control>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc. <insert type="param" id-ref="floatA"/>
         </p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-merge-usefirst1_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="00000000-0000-4000-B000-000000000000">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-06-13T14:18:05.6425797-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>TODO: Not implemented yet</oscal-version>
      <prop name="resolution-tool"
            value="OSCAL Profile Resolver XSLT Pipeline OPRXP"/>
      <link href="requirement-tests/req-merge-usefirst1.xml"
            rel="source-profile"/>
   </metadata>
   <group>
      <title>Group A of C</title>
      <control id="a1">
         <title>Control A1</title>
         <param id="a1_prm1">
            <label>A1 Parameter 1</label>
         </param>
         <prop name="label" value="first"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group B of C</title>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="fourth"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c1">
         <title>Control C1</title>
         <prop name="label" value="seventh"/>
         <part name="statement" id="c1-stmt">
            <p>C1 ccccc ccc ccccccccccccccccc.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group B of C</title>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="fifth"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group A of C</title>
      <control id="a3">
         <title>Control A3</title>
         <param id="a3_prm1">
            <label>A3 Parameter 1</label>
         </param>
         <prop name="label" value="third"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <control id="c3">
         <title>Control C3</title>
         <prop name="label" value="ninth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="tenth"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="eleventh"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </control>
   </group>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-merge-usefirst2_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="00000000-0000-4000-B000-000000000000">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-06-13T14:20:25.5347906-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>TODO: Not implemented yet</oscal-version>
      <prop name="resolution-tool"
            value="OSCAL Profile Resolver XSLT Pipeline OPRXP"/>
      <link href="requirement-tests/req-merge-usefirst2.xml"
            rel="source-profile"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="second"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <param id="a3_prm1">
         <label>A3 Parameter 1</label>
      </param>
      <prop name="label" value="third"/>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="b2">
      <title>Control B2</title>
      <prop name="label" value="fifth"/>
      <part name="statement" id="b2-stmt">
         <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
      </part>
   </control>
   <control id="b3">
      <title>Control B3</title>
      <prop name="label" value="sixth"/>
      <part name="statement" id="b3-stmt">
         <p>B3 bbbb bbbbbbb bbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c2">
      <title>Control C2</title>
      <prop name="label" value="eighth"/>
      <part name="statement" id="c2-stmt">
         <p>C2 cccccccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a-1">
            <title>Control C3-A-1</title>
            <prop name="label" value="eleventh"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A-1 ccccc cccccccccccccc.</p>
            </part>
         </control>
      </control>
   </control>
   
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-modify-alter-remove-match1_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="f5e749ae-2d5a-47a6-970e-62fffe85fa62">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-06-15T10:30:30.4321464-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>TODO: Not implemented yet</oscal-version>
      <prop name="resolution-tool"
            value="OSCAL Profile Resolver XSLT Pipeline OPRXP"/>
      <link href="file:/C:/Users/wap1/Documents/usnistgov/OSCAL-dev/src/specifications/profile-resolution/requirement-tests/req-modify-alter-remove-match1.xml"
            rel="source-profile"/>
   </metadata>
   <control id="a3">
      <title>Control A3</title>
      <param id="a3_prm1">
         <label>A3 Parameter 1</label>
      </param>
   </control>
   <control id="a2">
      <title>Control A2</title>
      <prop name="label" value="second"/>
   </control>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a-1">
            <title>Control C3-A-1</title>
            <prop name="label" value="eleventh"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A-1 ccccc cccccccccccccc.</p>
            </part>
         </control>
      </control>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c2">
      <title>Control C2</title>
      <prop name="label" value="eighth"/>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-modify-alter-remove-match2_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="85c7333c-5880-4d80-83ea-e9d4aa71f4ce">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-06-15T16:22:58.1586252-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>TODO: Not implemented yet</oscal-version>
      <prop name="resolution-tool"
            value="OSCAL Profile Resolver XSLT Pipeline OPRXP"/>
      <link href="file:/C:/Users/wap1/Documents/usnistgov/OSCAL-dev/src/specifications/profile-resolution/requirement-tests/req-modify-alter-remove-match2.xml"
            rel="source-profile"/>
   </metadata>
   <param id="param-A.a">
      <label>A.a parameter</label>
      <value>A.a value</value>
   </param>
   <param id="param-A.b">
      <select>
         <choice>A.b parameter selection choice 1</choice>
         <choice>A.b parameter selection choice 2</choice>
         <choice>A.b parameter selection choice 3</choice>
      </select>
   </param>
   <control id="a1">
      <title>Control A1</title>
      <param id="param-a1.a">
         <label>a1.a parameter</label>
         <value>a1.a value</value>
      </param>
      <prop name="extra" value="ex3" ns="http://somens.url"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
         <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/>
         </p>
         <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/>
         </p>
      </part>
   </control>
   <control id="a2">
      <title>Control A2</title>
      <prop name="extra" value="ex1"/>
      <prop name="extra" value="ex2"/>
      <prop name="extra" value="ex3" ns="http://somens.url"/>
      <part name="statement" id="a2-stmt">
         <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
         <p>Parameter A.b is set: <insert type="param" id-ref="param-A.b"/>
         </p>
      </part>
   </control>
   <control id="a3">
      <title>Control A3</title>
      <part name="statement" id="a3-stmt">
         <p>A3 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="a4">
      <title>Control A4</title>
      <prop name="extra" value="ex1"/>
      <prop name="extra" value="ex2"/>
      <prop name="extra" value="ex4" class="special"/>
      <prop name="label" value="3rd"/>
      <part name="statement" id="a3-stmt">
         <p>A4 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="a5">
      <title>Control A5</title>
      <prop name="extra" value="ex1"/>
      <prop name="extra" value="ex2"/>
      <prop name="extra" value="ex4" class="special"/>
      <prop name="label" value="3rd"/>
      <part name="statement" id="a3-stmt">
         <p>A5 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-structure-asis1_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="00000000-0000-4000-B000-000000000000">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-06-14T10:31:48.9825185-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>TODO: Not implemented yet</oscal-version>
      <prop name="resolution-tool"
            value="OSCAL Profile Resolver XSLT Pipeline OPRXP"/>
      <link href="requirement-tests/req-structure-asis1.xml"
            rel="source-profile"/>
   </metadata>
   <group>
      <title>Group A of C</title>
      <control id="a1">
         <title>Control A1</title>
         <param id="param-a1.a">
            <label>a1.a parameter</label>
            <value>a1.a value</value>
         </param>
         <prop name="label" value="1st"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
            <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/>
            </p>
            <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/>
            </p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="2nd"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
            <p>Parameter A.b is set: <insert type="param" id-ref="param-A.b"/>
            </p>
         </part>
      </control>
      <control id="a3">
         <title>Control A3</title>
         <prop name="label" value="3rd"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group B of C</title>
      <control id="b1">
         <title>Control B1</title>
         <prop name="label" value="4th"/>
         <part name="statement" id="b1-stmt">
            <p>B1 bbbb bbbbbbb.</p>
         </part>
      </control>
      <control id="b2">
         <title>Control B2</title>
         <prop name="label" value="5th"/>
         <link rel="reference" href="#4a3990e7-2020-4b8f-902c-d679ebea2b58"/>
         <part name="statement" id="b2-stmt">
            <p>B2 bbb bbbbbbbbbbb bbbbbbbbbbbb.</p>
            <p>Also, we <a href="#4a3990e7-2020-4b8f-902c-d679ebea2b58">refer to a citation</a>.</p>
         </part>
      </control>
      <control id="b3">
         <title>Control B3</title>
         <prop name="label" value="6th"/>
         <part name="statement" id="b3-stmt">
            <p>B3 bbbb bbbbbbb bbbb.</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <part name="overview">
         <p>Group C of C contains subgroups CA and CB.</p>
      </part>
      <group id="CA">
         <title>Group CA</title>
         <control id="c1">
            <title>Control C1</title>
            <prop name="label" value="7th"/>
            <part name="statement" id="c1-stmt">
               <p>C1 ccccc ccc ccccccccccccccccc.</p>
               <p>We cite a document with an anchor: <a href="somedoc#citation">... citation ...</a>.</p>
            </part>
         </control>
         <control id="c2">
            <title>Control C2</title>
            <prop name="label" value="8th"/>
            <link rel="reference" href="#ef4c1cf0-a3cc-4354-bdd5-690466f61d4f"/>
            <part name="statement" id="c2-stmt">
               <p>C2 cccccccc ccccccccccccccccc.</p>
            </part>
         </control>
      </group>
   </group>
   <back-matter>
      <resource uuid="4a3990e7-2020-4b8f-902c-d679ebea2b58">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
      <resource uuid="ef4c1cf0-a3cc-4354-bdd5-690466f61d4f">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-structure-asis2_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="00000000-0000-4000-B000-000000000000">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-06-14T10:33:37.4077081-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>TODO: Not implemented yet</oscal-version>
      <prop name="resolution-tool"
            value="OSCAL Profile Resolver XSLT Pipeline OPRXP"/>
      <link href="requirement-tests/req-structure-asis2.xml"
            rel="source-profile"/>
   </metadata>
   <group>
      <title>Group A of C</title>
      <control id="a1">
         <title>Control A1</title>
         <param id="param-a1.a">
            <label>a1.a parameter</label>
            <value>a1.a value</value>
         </param>
         <prop name="label" value="1st"/>
         <part name="statement" id="a1-stmt">
            <p>A1 aaaaa aaaaaaaaaa</p>
            <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/>
            </p>
            <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/>
            </p>
         </part>
      </control>
      <control id="a2">
         <title>Control A2</title>
         <prop name="label" value="2nd"/>
         <part name="statement" id="a2-stmt">
            <p>A2 aaa aaaaaaaaaa aaaaaaaaaaaaa</p>
            <p>Parameter A.b is set: <insert type="param" id-ref="param-A.b"/>
            </p>
         </part>
      </control>
      <control id="a3">
         <title>Control A3</title>
         <prop name="label" value="3rd"/>
         <part name="statement" id="a3-stmt">
            <p>A3 aaaaa aaaaaaaaaa</p>
         </part>
      </control>
   </group>
   <group>
      <title>Group C of C</title>
      <part name="overview">
         <p>Group C of C contains subgroups CA and CB.</p>
      </part>
      <group id="CA">
         <title>Group CA</title>
         <control id="c1">
            <title>Control C1</title>
            <prop name="label" value="7th"/>
            <part name="statement" id="c1-stmt">
               <p>C1 ccccc ccc ccccccccccccccccc.</p>
               <p>We cite a document with an anchor: <a href="somedoc#citation">... citation ...</a>.</p>
            </part>
         </control>
         <control id="c2">
            <title>Control C2</title>
            <prop name="label" value="8th"/>
            <link rel="reference" href="#ef4c1cf0-a3cc-4354-bdd5-690466f61d4f"/>
            <part name="statement" id="c2-stmt">
               <p>C2 cccccccc ccccccccccccccccc.</p>
            </part>
         </control>
      </group>
      <group id="CB">
         <title>Group CB</title>
         <control id="c3.a">
            <title>Control C3-A</title>
            <prop name="label" value="10th"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A ccccc cccccccccccccc.</p>
            </part>
            <control id="c3.a-1">
               <title>Control C3-A-1</title>
               <prop name="label" value="11th"/>
               <part name="statement" id="c3-stmt">
                  <p>C3 A-1 ccccc cccccccccccccc.</p>
               </part>
            </control>
         </control>
      </group>
   </group>
   <back-matter>
      <resource uuid="ef4c1cf0-a3cc-4354-bdd5-690466f61d4f">
         <citation>
            <text>A citation to an out of line document.</text>
         </citation>
      </resource>
   </back-matter>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-with-child-controls-no_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="993ecb6b-a87f-49f0-8f3b-4454bdeff8d5">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-19T16:25:49.1221541-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-with-child-controls-no.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-with-child-controls-none_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="5f42683a-3ec8-42c3-a737-91d84d5540d0">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-19T16:27:33.9704261-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-with-child-controls-none.xml"/>
   </metadata>
   <control id="a1">
      <title>Control A1</title>
      <param id="a1_prm1">
         <label>A1 Parameter 1</label>
      </param>
      <prop name="label" value="first"/>
      <part name="statement" id="a1-stmt">
         <p>A1 aaaaa aaaaaaaaaa</p>
      </part>
   </control>
   <control id="b1">
      <title>Control B1</title>
      <prop name="label" value="fourth"/>
      <part name="statement" id="b1-stmt">
         <p>B1 bbbb bbbbbbb.</p>
      </part>
   </control>
   <control id="c1">
      <title>Control C1</title>
      <prop name="label" value="seventh"/>
      <part name="statement" id="c1-stmt">
         <p>C1 ccccc ccc ccccccccccccccccc.</p>
      </part>
   </control>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-with-parent-controls-no1_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0" uuid="46abd95c-a95f-4bbd-b874-daaa2080d284">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-26T17:10:21.286142-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-with-parent-controls-no1.xml"/>
   </metadata>
   <control id="c3.a">
      <title>Control C3-A</title>
      <prop name="label" value="tenth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 A ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a-1">
         <title>Control C3-A-1</title>
         <prop name="label" value="eleventh"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A-1 ccccc cccccccccccccc.</p>
         </part>
      </control>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-with-parent-controls-none_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="d8952eb1-57fc-4ca5-b7a3-461f3e310882">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-26T17:19:59.7102091-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-with-parent-controls-none.xml"/>
   </metadata>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
      </control>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-with-parent-controls-yes1_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="c9fae162-e184-4f25-9987-ee7ab3e59a10">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-26T17:11:18.9602994-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-with-parent-controls-yes1.xml"/>
   </metadata>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
         <control id="c3.a-1">
            <title>Control C3-A-1</title>
            <prop name="label" value="eleventh"/>
            <part name="statement" id="c3-stmt">
               <p>C3 A-1 ccccc cccccccccccccc.</p>
            </part>
         </control>
      </control>
   </control>
</catalog>



================================================
FILE: src/specifications/profile-resolution/requirement-tests/output-expected/req-with-parent-controls-yes2_RESOLVED.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="c9fae162-e184-4f25-9987-ee7ab3e59a10">
   <metadata>
      <title>Test Profile</title>
      <last-modified>2022-04-26T17:11:18.9602994-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0</oscal-version>
      <link rel="resolution-source" href="req-with-parent-controls-yes2.xml"/>
   </metadata>
   <control id="c3">
      <title>Control C3</title>
      <prop name="label" value="ninth"/>
      <part name="statement" id="c3-stmt">
         <p>C3 ccccc cccccccccccccc.</p>
      </part>
      <control id="c3.a">
         <title>Control C3-A</title>
         <prop name="label" value="tenth"/>
         <part name="statement" id="c3-stmt">
            <p>C3 A ccccc cccccccccccccc.</p>
         </part>
      </control>
   </control>
</catalog>



================================================
FILE: src/utils/readme.md
================================================
# OSCAL Utilities

The OSCAL project maintains [a list of tools for OSCAL on our web site](https://pages.nist.gov/OSCAL/tools/ "OSCAL tools page").

Additionally, we maintain a repository of tools at https://github.com/usnistgov/oscal-tools; and members of the community offer OSCAL tools, frequently in open repositories free to use, which we do not maintain.

Functionality archived here includes:

`resolver-pipeline` a demonstration implementation of OSCAL Profile resolution.

`oscal-content-validator.py` - a Python shell for configuration and running (XML and JSON )schema validation.



================================================
FILE: src/utils/oscal-content-validator.py
================================================
#!/usr/bin/python3

import sys
import io
import json
import argparse
from jsonschema import validate
import xmlschema
from ruamel.yaml import YAML


def _get_oscal_file_type(filename):
    if filename.endswith("json"):
        return "json"
    elif filename.endswith("xml") or filename.endswith("xsd"):
        return "xml"
    elif filename.endswith("yaml") or filename.endswith("yml"):
        return "yaml"
    else:
        raise("Not a valid OSCAL file.")


def read_file(filename, ftype):
    with io.open(filename, 'r', encoding="utf-8") as f:
        if ftype == "json":
            filedata = json.load(f)
        if ftype == "yaml":
            yaml = YAML()
            filedata = yaml.load(f)
        else:
            filedata = f.read()
    return filedata, ftype


def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument("-s", "--oscal-schema", default=False, required=True,
                        action="store", dest="oscal_schema",
                        help="An OSCAL schema file.")
    parser.add_argument("-f", "--oscal-file", default=False, required=True,
                        action="store", dest="oscal_file",
                        help="An OSCAL data file.")
    return parser.parse_args()


def oscal_validator(oscal_schema, oscal_data):
    schema, stype = read_file(oscal_schema, _get_oscal_file_type(oscal_schema))
    data, ftype = read_file(oscal_data, _get_oscal_file_type(oscal_data))

    if ftype == 'json' or ftype == 'yaml':
        # Yaml files are validated using the json schema
        validate(data, schema)
    if ftype == 'xml':
        xmlschema.validate(data, schema)


def main():
    args = parse_args()

    oscal_validator(args.oscal_schema, args.oscal_file)


if __name__ == "__main__":
    main()



================================================
FILE: src/utils/requirements.txt
================================================
jsonschema==4.4.0
ruamel.yaml==0.17.10
xmlschema==1.9.2


================================================
FILE: src/utils/resolver-pipeline/Makefile
================================================
SHELL:=/usr/bin/env bash

OSCAL_DIR:=../../../
METASCHEMA_XSLT_DIR:=$(OSCAL_DIR)/build/metaschema-xslt
XSPEC_DIR:=$(METASCHEMA_XSLT_DIR)/support/xspec
XSPEC_COMMAND:=$(XSPEC_DIR)/bin/xspec.sh
POM_FILE:=$(METASCHEMA_XSLT_DIR)/support/pom.xml

TEST_DIR:=./testing/xspec
# Must be an absolute path due to maven issues
# (maven's copy dependency plugin resolves paths relative to the POM file)
SUPPORT_DIR:=$(shell pwd)/java_modules

$(SUPPORT_DIR):
	mkdir -p "$(SUPPORT_DIR)"
	mvn --quiet -f $(POM_FILE) \
		dependency:copy-dependencies \
		-DoutputDirectory="$(SUPPORT_DIR)"

.PHONY: test
test: $(SUPPORT_DIR) $(wildcard *.xsl)
	TEST_DIR=$(TEST_DIR) \
		XSPEC_COMMAND=$(XSPEC_COMMAND) \
		SAXON_CP="$(SUPPORT_DIR)/*" \
		./testing/test.sh

.PHONY: clean
clean:
	rm -fr $(SUPPORT_DIR)
	rm -fr $(TEST_DIR)



================================================
FILE: src/utils/resolver-pipeline/message-handler.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet
    xmlns:mh="http://csrc.nist.gov/ns/message"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    exclude-result-prefixes="#all"
    version="3.0">
    
    <xsl:template name="mh:message-handler">
        <xsl:param name="text" as="xs:string"/>
        <xsl:param name="message-type" as="xs:string?"/><!-- e.g., 'Error', 'Warning' -->
        <xsl:param name="error-code" as="xs:string?"/>
        <xsl:param name="terminate" as="xs:boolean" select="false()"/>
        <xsl:message expand-text="yes" terminate="{$terminate}">{
            string-join(($message-type, $error-code, $text),': ')
            }</xsl:message>
    </xsl:template>

</xsl:stylesheet>


================================================
FILE: src/utils/resolver-pipeline/oscal-profile-resolve-finish.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="2.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    exclude-result-prefixes="#all"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0" >

    <xsl:template match="* | @*" mode="#all">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates mode="#current" select="node() | @*"/>
        </xsl:copy>
    </xsl:template>

    <!-- Finalizing profile resolution into a catalog:
         - Reordering metadata, group and control contents to valid order
         - Removing loose orphan parameters
           - Orphans given inside controls are retained
         - Removing extra elements of types that permit at most one
           - Use [last()] instead of [1] to accommodate the case of
             replacing a title during modify phase. The modify phase
             adds the title following the original one.
           - Some "[last()]" expressions are expected to have no effect
             if input documents are schema-valid but are included to
             avoid producing schema-invalid output.
         - Removing unclaimed inventory, defined as any 'resource'
           in back matter without something somewhere linking to it

         What we are not doing:
         - Removing broken links
         - Remove opr and xsi namespaces (that happens in the shell)
    -->
<!-- An XQuery run on a metaschema can return a sequence of instructions

    let $where := 'metadata'
    for $n in (//*:define-assembly[@name=$where]/*:model/*/(@name | @ref))
    return <apply-templates mode="#current" select="{ $n }"/>

    Caveat: This query does not account for elements that can occur at most once,
    or aliasing via use-name.
    -->

    <xsl:template match="catalog">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates mode="#current" select="@*"/>
            <xsl:apply-templates mode="#current" select="metadata[last()]"/>
            <xsl:apply-templates mode="#current" select="opr:*"/>
            <xsl:apply-templates mode="#current" select="param"/>
            <xsl:apply-templates mode="#current" select="control"/>
            <xsl:apply-templates mode="#current" select="group"/>
            <xsl:apply-templates mode="#current" select="back-matter[last()]"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="metadata">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates mode="#current" select="@*"/>
            <xsl:apply-templates mode="#current" select="title[last()]"/>
            <xsl:apply-templates mode="#current" select="published[last()]"/>
            <xsl:apply-templates mode="#current" select="last-modified[last()]"/>
            <xsl:apply-templates mode="#current" select="version[last()]"/>
            <xsl:apply-templates mode="#current" select="oscal-version[last()]"/>
            <xsl:apply-templates mode="#current" select="revisions[last()]"/>
            <xsl:apply-templates mode="#current" select="document-id"/>
            <xsl:apply-templates mode="#current" select="prop"/>
            <xsl:apply-templates mode="#current" select="link"/>
            <xsl:apply-templates mode="#current" select="role"/>
            <xsl:apply-templates mode="#current" select="location"/>
            <xsl:apply-templates mode="#current" select="party"/>
            <xsl:apply-templates mode="#current" select="responsible-party"/>
            <xsl:apply-templates mode="#current" select="remarks[last()]"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="group">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates mode="#current" select="@*"/>
            <xsl:apply-templates mode="#current" select="title[last()]"/>
            <xsl:apply-templates mode="#current" select="param"/>
            <xsl:apply-templates mode="#current" select="prop"/>
            <xsl:apply-templates mode="#current" select="link"/>

            <xsl:apply-templates mode="#current" select="part"/>
            <xsl:apply-templates mode="#current" select="control"/>
            <xsl:apply-templates mode="#current" select="group"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="control">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates mode="#current" select="@*"/>
            <!-- Keep only the last title. There could be multiple titles if
                modify phase processed alter/add/title. -->
            <xsl:apply-templates mode="#current" select="title[last()]"/>
            <xsl:apply-templates mode="#current" select="param"/>
            <xsl:apply-templates mode="#current" select="prop"/>
            <xsl:apply-templates mode="#current" select="link"/>
            <xsl:apply-templates mode="#current" select="part"/>
            <xsl:apply-templates mode="#current" select="control"/>
        </xsl:copy>
    </xsl:template>

    <xsl:key name="param-insertions" match="insert[@type='param']" use="@id-ref"/>

    <!-- Suppress loose param elements that do not have corresponding insert element(s)
        and that do not have an explicit instruction to keep them. -->
    <xsl:template match="catalog/param[empty(key('param-insertions',@id))][not(prop[@name='keep'][@value='always'])]
        | group/param[empty(key('param-insertions',@id))][not(prop[@name='keep'][@value='always'])]"/>

    <!-- Don't copy back-matter wrapper if it has no contents in result -->
    <xsl:template match="back-matter">
        <xsl:where-populated>
            <xsl:next-match/>
        </xsl:where-populated>
    </xsl:template>

    <xsl:key name="cross-reference" match="*[starts-with(@href,'#')]" use="substring-after(@href,'#')"/>

    <!-- Suppress resource elements that are not referenced and that do not
        have an explicit instruction to keep them. -->
    <xsl:template match="resource[empty(key('cross-reference',@uuid))][not(prop[@name='keep'][@value='always'])]"/>

</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/oscal-profile-resolve-functions.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="2.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    exclude-result-prefixes="xs math o"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0">

    <!-- XSD regex metacharacters except '*' and '?' https://www.w3.org/TR/xmlschema11-2/#regex-char-metachar -->
    <xsl:variable name="metachars" select="('.', '\', '+', '{', '}', '(', ')', '|', '[', ']')"/>
    <xsl:variable name="metachar-match" select="'(' || string-join( ($metachars ! ('\' || .)),'|') || ')'"/>

    <xsl:function name="o:glob-as-regex">
        <xsl:param name="glob" as="xs:string"/>
        <xsl:variable name="escaped" select="replace($glob,$metachar-match,'\\$1')"/>
        <!-- replace ? with . and * with .* -->
        <xsl:sequence select="'^' || ($escaped => replace('\?','.') => replace('\*','.*') ) || '$'"/>
        <!--<xsl:sequence select="$escaped"/>-->
    </xsl:function>

</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/oscal-profile-resolve-merge.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:mh="http://csrc.nist.gov/ns/message"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    exclude-result-prefixes="xs math o opr"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0" >

    <xsl:import href="message-handler.xsl"/>

    <xsl:variable name="in_xspec" as="xs:boolean" select="false()"/>
    <xsl:variable name="true-content" as="xs:string+" select="('true','1')"/>

    <xsl:template match="* | @*" mode="#all">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates mode="#current" select="node() | @*"/>
        </xsl:copy>
    </xsl:template>

<!-- TODO; exception handling such as unmatched document element (i.e., not already 'catalog' with 'selection' children)    -->
    <!-- With no combination rule, we simply emit parameters and controls -->
    <xsl:template match="/*" priority="1">
        <!-- emitting nothing as this is input is erroneous; a catalog will match one of the following
            templates not this one. -->
    </xsl:template>

    <!-- If there is no selection and no merge (i.e., we don't reach one of
        the higher-priority templates that match catalog), pass the catalog
        through unchanged. -->
    <xsl:template match="catalog" priority="2" as="element(catalog)">
        <xsl:copy-of select="."/>
    </xsl:template>

    <!-- If there is a selection but neither merge/as-is nor merge/custom,
        use flat structuring. -->
    <xsl:template match="catalog[exists(selection)]" priority="10" as="element(catalog)">
        <catalog>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates select="metadata"/>
            <xsl:apply-templates select="selection"/>
            <xsl:apply-templates select="modify"/>
            <xsl:where-populated>
                <back-matter>
                    <xsl:sequence select="back-matter/* | selection/back-matter/*"/>
                </back-matter>
            </xsl:where-populated>
        </catalog>
    </xsl:template>

    <!-- If there is a merge/as-is directive, we go down that branch.
        If there is also a merge/custom directive, we apply the
        higher-priority template instead of this one. -->
    <xsl:template match="catalog[merge/as-is=$true-content]" priority="12" as="element(catalog)">
        <xsl:call-template name="detect-multiple-structuring-directives"/>
        <catalog>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates select="metadata"/>
            <xsl:variable name="merged-selections">
                <xsl:call-template name="o:merge-groups-as-is">
                    <xsl:with-param name="merging" select="selection"/>
                </xsl:call-template>
            </xsl:variable>
            <!-- not copying the selection elements, only their contents -->
            <xsl:for-each select="$merged-selections/selection">
                <xsl:sequence select="* except back-matter"/>
            </xsl:for-each>
            <!-- copying 'modify' unchanged through this transformation -->
            <xsl:apply-templates select="modify"/>
            <xsl:call-template name="combine-back-matter"/>
        </catalog>
    </xsl:template>


    <!-- If there is a merge/custom directive, we go down that branch. -->
    <xsl:template match="catalog[exists(merge/custom)]" priority="13" as="element(catalog)">
        <xsl:call-template name="detect-multiple-structuring-directives"/>
        <catalog>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates select="metadata"/>

            <xsl:apply-templates select="merge/custom" mode="o:custom-merge"/>

            <!-- copying 'modify' unchanged through this transformation -->
            <xsl:apply-templates select="modify"/>
            <xsl:call-template name="combine-back-matter"/>
        </catalog>
    </xsl:template>

    <xsl:template name="detect-multiple-structuring-directives" as="empty-sequence()">
        <xsl:context-item as="element(catalog)" use="required"/>
        <xsl:variable name="flat" as="element(flat)*" select="merge/flat[.=$true-content]"/>
        <xsl:variable name="as-is" as="element(as-is)*" select="merge/as-is[.=$true-content]"/>
        <xsl:variable name="custom" as="element(custom)*" select="merge/custom"/>
        <xsl:if test="count($flat) + count($as-is) + count($custom) gt 1">
            <xsl:call-template name="mh:message-handler">
                <xsl:with-param name="text">Found multiple structuring directives. Choose at most one from: flat (default), as-is, custom.</xsl:with-param>
                <xsl:with-param name="message-type">Error</xsl:with-param>
                <xsl:with-param name="terminate" select="true()"/>
            </xsl:call-template>
        </xsl:if>
    </xsl:template>

    <xsl:template name="combine-back-matter" as="element(back-matter)?">
        <xsl:context-item as="element(catalog)" use="required"/>
        <xsl:where-populated>
            <back-matter>
                <!-- Using combination logic on back matter elements. -->
                <xsl:for-each-group select="back-matter/* | selection/back-matter/*" group-by="(@opr:id,@uuid,generate-id())[1]">
                    <xsl:variable name="last" as="element(resource)" select="current-group()[last()]"/>
                    <!-- The final phase needs the ability to keep unreferenced
                            back matter items based on keep instructions, so the merge
                            phase must preserve these items. -->
                    <xsl:variable name="keepers" as="element(resource)*"
                        select="current-group()[child::prop[@name='keep' and @value='always']]"/>
                    <xsl:call-template name="combine-elements">
                        <!-- Take last one in group because of spec requirement
                            id="req-backmatter-dupe". -->
                        <!-- Take last item with keep instruction, because
                            of spec requirement id="req-backmatter-keep". -->
                        <xsl:with-param name="who" select="$keepers[last()] | $last" as="element(resource)+"/>
                    </xsl:call-template>
                </xsl:for-each-group>
            </back-matter>
        </xsl:where-populated>
    </xsl:template>

    <xsl:template match="selection">
        <xsl:apply-templates select="param   | .//group/param"/>
        <xsl:apply-templates select="control | .//group/control"/>
    </xsl:template>

    <!-- Process children but do not copy <custom> tags themselves. -->
    <xsl:template match="custom" mode="o:custom-merge">
        <xsl:apply-templates mode="#current"/>
    </xsl:template>

    <!-- Apply the requested ordering.
        Creating the properly combined sequence of inserted controls
        is in downstream template. -->
    <xsl:template match="insert-controls" mode="o:custom-merge">
        <xsl:variable name="inserted-controls" as="element()*">
            <xsl:apply-templates mode="#current"/>
        </xsl:variable>
        <xsl:variable name="keep-order" select="not(@order = ('descending','ascending'))" as="xs:boolean"/>
        <xsl:variable name="sort-order" select="@order[.='descending'],'ascending'"/>
        <!-- Setting sort-key to '1' sorts into given order -->
        <xsl:perform-sort select="$inserted-controls">
            <xsl:sort select="if ($keep-order) then '1' else @id" 
                order="{$sort-order[1]}"/>
        </xsl:perform-sort>
    </xsl:template>

    <xsl:include href="select-or-custom-merge.xsl"/>

    <!-- Combine selected controls.
        Creating the sequence of controls ($who) is in code shared with
        selection phase. -->
    <xsl:template match="include-all | include-controls" mode="o:custom-merge">
        <xsl:variable name="who" as="element(o:control)*">
            <xsl:apply-templates select="ancestor::*[last()]//selection" mode="o:select">
                <xsl:with-param tunnel="yes" name="import-instruction" select="ancestor::insert-controls"/>
            </xsl:apply-templates>
        </xsl:variable>
        <xsl:call-template name="combine-elements">
            <xsl:with-param name="who" select="$who"/>
        </xsl:call-template>
    </xsl:template>

    <!-- No-op because exclusion logic is handled in the code shared with
            selection phase. -->
    <xsl:template match="exclude-controls" mode="o:custom-merge"/>

    <!-- In o:select mode, process children of selection or group to reach
        controls, which are handled in select-or-custom-merge.xsl. -->
    <xsl:template match="selection | selection//group" mode="o:select">
        <xsl:apply-templates select="group | control" mode="#current"/>
    </xsl:template>

    <xsl:template name="o:merge-groups-as-is">
        <xsl:context-item as="element()" use="optional"/>
        <xsl:param name="merging" select="()" as="element()*"/>
        <xsl:for-each-group select="$merging" group-by="(@uuid,@opr:id,@id,generate-id())[1]">
            <xsl:variable name="merged" select="current-group()" as="element()+"/>
            <xsl:for-each select="$merged[1]">
                <xsl:copy copy-namespaces="no">
                    <xsl:apply-templates select="$merged/@*"/>
                    <xsl:apply-templates select="title"/>
                    <xsl:apply-templates select="$merged/(* except (title | param | control | group) )"/>

                    <xsl:call-template name="combine-elements">
                        <xsl:with-param name="who" select="$merged/param"/>
                    </xsl:call-template>
                    <xsl:call-template name="combine-elements">
                        <xsl:with-param name="who" select="$merged/control"/>
                    </xsl:call-template>

                    <xsl:call-template name="o:merge-groups-as-is">
                        <xsl:with-param name="merging" select="$merged/group[exists(descendant::control)]"/>
                    </xsl:call-template>

                </xsl:copy>
            </xsl:for-each>
        </xsl:for-each-group>
    </xsl:template>

    <xsl:template name="combine-elements">
        <xsl:context-item as="element()" use="required"/>
        <xsl:param name="who" as="element()*"/>
        <xsl:apply-templates select="ancestor-or-self::catalog" mode="o:combine-elements">
            <xsl:with-param name="elements" select="$who"/>
        </xsl:apply-templates>
    </xsl:template>

    <!-- 'visitor pattern' uses the profile element as a handler for dispatching control merge logic
         for a set of controls.
         Think of this as a function "merge-elements" that merges an arbitrary set of elements
         with the combination method as an argument.
    -->

    <xsl:template priority="10" match="catalog[merge/combine/@method='merge']" mode="o:combine-elements">
        <xsl:param name="elements" as="element()*" required="yes"/>
        <!-- All the elements coming in have the same name but different opr:id
             we operate on controls and parameters (not groups or group contents otherwise) -->
        <!-- further, we assume all controls or all parameters -->
        <xsl:variable name="uri-qualified-name" as="function(*)"
            select="function($node as element()) as xs:string {
                'Q{' || namespace-uri($node) || '}' || local-name($node)
            }"/>
        <xsl:variable name="element-names" as="xs:string*"
            select="$elements ! $uri-qualified-name(.)"/>
        <xsl:if test="$element-names != $element-names">
            <!-- If we get here for a valid profile, it is an XSLT bug rather than a user error. -->
            <xsl:call-template name="mh:message-handler">
                <xsl:with-param name="text">Combining elements of different types is not supported.</xsl:with-param>
                <xsl:with-param name="message-type">Error</xsl:with-param>
                <xsl:with-param name="terminate" select="$in_xspec"/>
            </xsl:call-template>
        </xsl:if>
        <xsl:for-each-group select="$elements" group-by="(@opr:id,@id,generate-id())[1]">
            <xsl:variable name="merged" select="current-group()" as="element()+"/>
            <xsl:for-each select="$merged[1]">
                <xsl:copy copy-namespaces="no">
                    <xsl:apply-templates select="$merged/@*"/>
                    <xsl:apply-templates select="$merged/*"/>
                </xsl:copy>
            </xsl:for-each>
        </xsl:for-each-group>
    </xsl:template>

    <xsl:template priority="10" match="catalog[merge/combine/@method='use-first']" mode="o:combine-elements">
        <xsl:param name="elements" as="element()*" required="yes"/>
        <xsl:apply-templates select="$elements[1]"/>
    </xsl:template>

    <!--[merge/combine/@method='keep'] is the default handling -->
    <xsl:template priority="5" match="catalog" mode="o:combine-elements">
        <xsl:param name="elements" as="element()*" required="yes"/>
        <xsl:apply-templates select="$elements"/>
    </xsl:template>

    <!-- Scrubbing opr:id values on the way out - we don't need them. -->
    <xsl:template match="@opr:id"/>

</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/oscal-profile-resolve-metadata.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:mh="http://csrc.nist.gov/ns/message"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:u="http://csrc.nist.gov/ns/uuid"
    xmlns:v="http://csrc.nist.gov/ns/version"
    exclude-result-prefixes="xs math o opr u v"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0" >

    
    <!-- How to specify top-level UUID for result catalog:

        a) When oscal-profile-RESOLVE.xsl invokes this transform,
        it passes in a precomputed value for $top-uuid-computed.

        b) Any other caller of this transform should pass in
        $uuid-method and, if applicable, $top-uuid and $uuid-service,
        but not $top-uuid-computed. As a result, this transform
        will compute $top-uuid-computed.
        -->

    <!-- uuid-method-choice.xsl has global parameters
        $uuid-method, $top-uuid, and $uuid-service. -->
    <xsl:import href="uuid-method-choice.xsl"/>

    <!-- version-util.xsl has semantic version comparison. -->
    <xsl:import href="version-util.xsl"/>
    
    <!-- Top-level UUID for result catalog. -->
    <xsl:param name="top-uuid-computed"  as="xs:string">
        <xsl:call-template name="u:determine-uuid"/>
    </xsl:param>

    <xsl:param name="profile-origin-uri">urn:UNKNOWN</xsl:param>

    <!-- If true, do not record profile URI in output catalog's source-profile
        metadata, due to privacy or security concerns. This parameter is
        passed from oscal-profile-RESOLVE.xsl and the end user can override it. -->
    <xsl:param name="hide-source-profile-uri" as="xs:boolean" select="false()"/>

    <xsl:variable name="source-profile" as="xs:string"
        select="if ($hide-source-profile-uri) then 'profile' else $profile-origin-uri"/>

    <xsl:template match="/ | * | @*" mode="#all">
        <xsl:copy>
            <xsl:apply-templates mode="#current" select="node() | @*"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="profile" priority="1">
        <catalog uuid="{ $top-uuid-computed }">
            <!-- Rewriting top-level @id -->
            <!--<xsl:if test="function-available('uuid:randomUUID')" xmlns:uuid="java:java.util.UUID">
                <xsl:attribute name="uuid" select="uuid:randomUUID()"/>
            </xsl:if>-->
            <xsl:apply-templates/>
        </catalog>
    </xsl:template>

    <xsl:template match="profile/metadata">
        <xsl:variable name="leaders" select="(title | published | last-modified | version | oscal-version | document-id)"/>
        <xsl:copy>
            <xsl:apply-templates mode="#current" select="@*"/>
            <xsl:apply-templates mode="#current" select="$leaders"/>
            <xsl:apply-templates mode="#current" select="prop"/>
            <prop name="resolution-tool" value="OSCAL Profile Resolver XSLT Pipeline OPRXP"/>
            <link href="{$source-profile}" rel="source-profile"/>
            <xsl:apply-templates mode="#current" select="* except ($leaders | prop)"/>
            <!--<xsl:apply-templates select="../selection" mode="imported-metadata"/>-->
        </xsl:copy>
    </xsl:template>

    <xsl:template match="last-modified">
        <xsl:copy>
            <xsl:value-of select="current-dateTime()"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="profile/metadata/oscal-version">
        <xsl:copy>
            <xsl:sequence select="opr:oscal-version(
                .,
                ancestor::profile/selection/metadata/oscal-version/normalize-space()
                )"/>
        </xsl:copy>
    </xsl:template>

    <!-- Return the oscal-version of the source profile.
        Perform error checking as in requirement
        "req-meta-oscalversion-error".
    -->
    <xsl:function name="opr:oscal-version" as="xs:string" visibility="public">
        <!-- Without visiblity="public" the XSpec test returns
            XTDE0041: Cannot invoke function opr:oscal-version#2 externally, because it is not public
        -->
        <xsl:param name="source" as="xs:string"/>
        <xsl:param name="imported" as="xs:string*"/>

        <xsl:variable name="options" as="map(*)"
            select="map{
            'normalize-space': true(),
            'supply-missing-zeros': true(),
            'remove-leading-zeros': true(),
            'allow-empty-string': true()
            }"/>
        <xsl:for-each select="$imported">
            <xsl:if test="v:compare($source, ., $options) eq xs:integer(-1)">
                <xsl:call-template name="mh:message-handler">
                    <xsl:with-param name="message-type" select="'Error'"/>
                    <xsl:with-param name="terminate" select="true()"/>
                    <xsl:with-param name="text" expand-text="yes">Import uses oscal-version of {.
                        }, which is newer than profile oscal-version of {
                        $source}.</xsl:with-param>
                </xsl:call-template>
            </xsl:if>
        </xsl:for-each>
        <!-- Return the version from the source parameter. -->
        <xsl:sequence select="$source"/>
    </xsl:function>

    <!--<xsl:template match="selection" mode="imported-metadata">
        <resource id="{@id}-RESOURCE" rel="imported">
            <xsl:copy-of select="metadata/title" copy-namespaces="no"/>
            <rlink href="{@opr:src}"/>
        </resource>
    </xsl:template>-->
    
    <xsl:template match="selection/metadata"/>
    
</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/oscal-profile-resolve-modify.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0"
    exclude-result-prefixes="#all"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:mh="http://csrc.nist.gov/ns/message"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:oscal="http://csrc.nist.gov/ns/oscal/1.0"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0" >

    <xsl:import href="message-handler.xsl"/>

    <xsl:key name="alteration-for-control-id" match="alter"         use="@control-id"/>
    <xsl:key name="addition-by-id-ref"        match="add"           use="@by-id"/>
    <xsl:key name="parameter-setting-for-id"  match="set-parameter" use="@param-id"/>

    <xsl:variable name="oscal-versionless-ns" select="'http://csrc.nist.gov/ns/oscal'"/>

    <xsl:template match="node() | @*">
        <xsl:copy>
            <xsl:apply-templates select="node() | @*"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="catalog">
        <xsl:copy>
            <xsl:apply-templates select="@*"/>
            <xsl:apply-templates>
                <!-- $modifications tunnel parameter is used by templates for
                    param, control, and descendants of control. --> 
                <xsl:with-param name="modifications" tunnel="yes" select="child::modify"/>
            </xsl:apply-templates>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="modify" as="empty-sequence()">
        <!-- No output is required, but invoke template to warn if set-parameter
            does not match anything. -->
        <xsl:apply-templates select="set-parameter"/>
    </xsl:template>

    <xsl:template match="set-parameter" as="empty-sequence()">
        <xsl:if test="not(@param-id = ancestor::catalog/descendant::param/@id)">
            <xsl:call-template name="mh:message-handler">
                <xsl:with-param name="text" expand-text="yes">set-parameter with param-id=&quot;{@param-id}&quot; does not match any param id.</xsl:with-param>
                <xsl:with-param name="message-type">Warning</xsl:with-param>
            </xsl:call-template>
        </xsl:if>
    </xsl:template>

    <!-- priority to override template match="control//*" -->
    <xsl:template match="param" priority="2">
        <xsl:param name="modifications" tunnel="yes" as="element(modify)?" required="yes"/>
        <xsl:variable name="id" select="@id"/>
<!-- depending on 'merge' behavior there could be multiple settings. combine/use-first should keep only the first setting in the first profile with such a setting. combine/merge should remove all duplicates by value. combine/keep should keep all parameter settings contents even when results are invalid. These operations are assumed to be performed in the merge phase. -->
        <xsl:variable name="settings" as="element(set-parameter)*"
            select="$modifications/key('parameter-setting-for-id',$id,.)"/>
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <!--param contains: prop, link, label, usage, constraint, guideline, value or select, remarks
            set-parameter contains: prop, link, label, usage, constraint, guideline, value or select-->
            
            <!-- Any prop with a uuid value replaces an earlier one with that uuid.
                Gather them in order in a document, and then determine which ones
                to suppress from output. -->
            <xsl:variable name="all-props" as="document-node()">
                <xsl:document>
                    <xsl:sequence select="prop, $settings/prop"/>
                </xsl:document>
            </xsl:variable>
            <xsl:sequence select="$all-props/prop[not(@uuid = following-sibling::prop/@uuid)]"/>
            <xsl:sequence select="link, $settings/link"/>
            <xsl:sequence select="(label, $settings/label)[last()]"/>
            <xsl:sequence select="(usage, $settings/usage)[last()]"/>
            <xsl:sequence select="constraint,$settings/constraint"/>
            <xsl:sequence select="guideline, $settings/guideline"/>
            <xsl:sequence select="(value, select, $settings/(value,select))[last()]"/>
            <xsl:sequence select="remarks"/>
        </xsl:copy>
    </xsl:template>

    <!-- When matching a control, insert content as indicated by <add> and copy everything else. -->

    <xsl:template match="control" priority="2">
        <xsl:param name="modifications" tunnel="yes" as="element(modify)?" required="yes"/>
        <!--<xsl:variable name="modifications" select="/*/modify"/>-->
        <xsl:variable name="id" select="@id"/>
        <xsl:variable name="patches-to-id-targeting-ancestor" select="oscal:patches-to-id-targeting-ancestor(., $modifications)" as="element(add)*"/>
        <!-- condition not(@by-id != $id) includes any addition without an @by-id, or whose @by-id is the control id -->
        <xsl:variable name="implicit-patches-to-id" select="$modifications/key('alteration-for-control-id',$id,.)/add[not(@by-id != $id)]" as="element(add)*"/>

        <xsl:copy-of select="$patches-to-id-targeting-ancestor[@position = 'before']/*"/>
        <xsl:if test="not(ancestor::control and oscal:removable(.,$modifications))">
            <xsl:copy>
                <xsl:copy-of select="@*"/>
                <xsl:apply-templates select="title" mode="#current"/>
                <xsl:copy-of select="(
                    $implicit-patches-to-id[@position=('before','starting')] | 
                    $patches-to-id-targeting-ancestor[@position='starting']
                    )/*"/>
    
                <xsl:apply-templates select="* except title" mode="#current"/>
                <!--<xsl:message expand-text="true">{ string-join((* except title)/(name() || '#' || @id), ', ') }</xsl:message>-->
    
                <xsl:copy-of select="(
                    $implicit-patches-to-id[not(@position = ('before','starting'))] | 
                    $patches-to-id-targeting-ancestor[empty(@position) or @position='ending' or not(@position=('before','after','starting','ending'))]
                    )/*"/><!-- TODO: Revisit after approach to #1311 is clarified -->
    
            </xsl:copy>
        </xsl:if>
        <xsl:copy-of select="$patches-to-id-targeting-ancestor[@position = 'after']/*"/>
    </xsl:template>

    <!-- Find <add> elements that reference the $here element by ID,
        from the given <modify> element. -->
    <xsl:function name="oscal:patches-to-id-targeting-ancestor" as="element(add)*">
        <xsl:param name="here" as="element()"/>
        <xsl:param name="modifications" as="element(modify)?"/>
        <xsl:variable name="controls" select="$here/ancestor-or-self::control" as="element(control)*"/>
        <xsl:variable name="alterations" as="element(alter)*"
            select="for $control in $controls return $modifications/key('alteration-for-control-id',$control/@id,.)"/>
        <!-- Key retrievals scoped to alterations...   -->
        <xsl:sequence select="$alterations/key('addition-by-id-ref',$here/@id,.)"/>
    </xsl:function>

    <xsl:template match="control//*">
        <xsl:param name="modifications" tunnel="yes" as="element(modify)?" required="yes"/>
        <!--<xsl:variable name="modifications" select="/*/modify"/>-->
        <xsl:variable name="patches-to-id" select="oscal:patches-to-id-targeting-ancestor(., $modifications)" as="element(add)*"/>

        <!-- $patches-before contains 'add' elements marked as patching before this element, by its @id -->
        <xsl:variable name="patches-before" select="$patches-to-id[@position='before']"/>

        <xsl:copy-of select="$patches-before/*"/>
        <xsl:if test="not(oscal:removable(.,$modifications))">
            <xsl:copy>
                <xsl:apply-templates select="@*" mode="#current"/>
                <xsl:apply-templates select="title" mode="#current"/>

                <xsl:variable name="patches-starting" select="$patches-to-id[@position='starting']"/>
                <xsl:copy-of select="$patches-starting/*"/>

                <xsl:apply-templates select="node() except title" mode="#current"/>

                <xsl:variable name="patches-ending" select="$patches-to-id[empty(@position) or @position='ending' or not(@position=('before','after','starting','ending'))]"/>
                <xsl:copy-of select="$patches-ending/*"/>
            </xsl:copy>
        </xsl:if>

        <!-- Reverse logic for 'after' patches. -->
        <xsl:variable name="patches-after" select="$patches-to-id[@position='after']"/>
        <xsl:copy-of select="$patches-after/*"/>

    </xsl:template>

    <!-- Return true if the $who element is meant to be removed, according to $mods -->
    <xsl:function name="oscal:removable" as="xs:boolean">
        <xsl:param name="who" as="element()"/><!-- Descendant of control -->
        <xsl:param name="mods" as="element(modify)?"/>
        <xsl:variable name="home" as="element()+" select="$who/ancestor::control"/>
        <xsl:variable name="alterations" as="element(alter)*" select="$mods/key('alteration-for-control-id',$home/@id,.)"/>
        <xsl:variable name="removals" as="element(remove)*" select="$alterations/remove"/>        
        <xsl:sequence select="some $r in $removals satisfies oscal:remove-match($who,$r)"/>
    </xsl:function>

    <!-- For a given element $who and removal element $removal, return true if $removal indicates
        that $who should be removed. In practice, $who is a descendant of control. -->
    <!-- $removal has this form, where attributes that appear must have nonempty values:
        <remove by-item-name="..." by-id="..." by-class="..." by-name="..." by-ns=".."/>-->
    <xsl:function name="oscal:remove-match" as="xs:boolean">
        <xsl:param name="who" as="element()"/>
        <xsl:param name="removal" as="element(remove)"/>
        <xsl:variable name="item-okay" as="xs:boolean"  select="empty($removal/@by-item-name) or ($removal/@by-item-name = local-name($who))"/>
        <xsl:variable name="id-okay" as="xs:boolean"    select="empty($removal/@by-id)    or ($removal/@by-id = $who/@id)"/>
        <xsl:variable name="name-okay" as="xs:boolean"  select="empty($removal/@by-name)  or ($removal/@by-name = $who/@name)"/>
        <xsl:variable name="ns-okay" as="xs:boolean"    select="empty($removal/@by-ns[not(. = $oscal-versionless-ns)])
            or ($removal/@by-ns = $who/@ns/normalize-space(.))"/>
        <xsl:variable name="oscal-ns-okay" as="xs:boolean" select="empty($removal/@by-ns[. = $oscal-versionless-ns])
            or (($who/@ns/normalize-space(.) = $oscal-versionless-ns) or empty($who/@ns))"/>
        <xsl:variable name="class-okay" as="xs:boolean" select="empty($removal/@by-class) or ($removal/@by-class = $who/@class)"/>
        <xsl:variable name="removal-includes-specifier" as="xs:boolean" select="exists($removal/(@by-item-name|@by-id|@by-name|@by-ns|@by-class))"/>
        <xsl:sequence select="$removal-includes-specifier and ($item-okay and $id-okay and $name-okay and $ns-okay and $oscal-ns-okay and $class-okay)"/>
    </xsl:function>

</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/oscal-profile-resolve-select.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    exclude-result-prefixes="xs math o"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0">

    <!-- Purpose: perform operations supporting the selection stage of OSCAL profile resolution. -->
    <!-- XSLT version: 3.0 -->

    <xsl:strip-space elements="catalog group control param guideline select part
        metadata back-matter annotation party person org rlink address resource role responsible-party citation
        profile import merge custom modify include-controls exclude-controls set alter add"/>

    <!--<xsl:param name="profile-origin-uri"   required="yes" as="xs:anyURI"/>-->
    <xsl:param name="uri-stack-in" select="()" as="xs:anyURI*"/>

<!-- The default processing is to pass everything through.
     Note: The source catalog includes other contents besides selected controls
           that may be required in the result. Examples are elements in the back
           matter, loose parameters (not declared inside controls) and groups and
           their contents apart from controls.
           These elements are also copied into the result.
           A post-process (filter) will be applied to remove them in a later stage. -->

    <xsl:template match="* | @*" mode="#all">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates mode="#current" select="node() | @*"/>
        </xsl:copy>
    </xsl:template>

    <!-- Making the default handling explicit. -->
    <xsl:template match="comment() | processing-instruction()" mode="#all"/>

    <!-- We catch the unmoded template only once, at the top; other matches will be in mode o:select   -->
    <xsl:template match="profile">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates mode="o:select" select="node() | @*">
                <xsl:with-param name="uri-stack" tunnel="yes" select="$uri-stack-in"/>
            </xsl:apply-templates>
        </xsl:copy>
    </xsl:template>

<!-- We reach a profile document in mode o:select only by way of an import/@href (see below)
     when we do, we have to see to it that we haven't already been called; if
     not, we execute the Ourobouros function, which calls the parent wrapper RESOLVE pipeline
     to return a catalog. -->
    <xsl:template match="profile" mode="o:select">
        <xsl:param name="uri-stack" tunnel="yes" select="()"/>
        <!-- $uri-stack contains an import call stack trace from the point of entry -->
        <xsl:variable name="uri-here" select="base-uri(.)"/>
        <xsl:if test="not($uri-here = $uri-stack)">
          <!--<xsl:sequence select="o:resolve-profile(.,$uri-stack)"/>-->
            <xsl:copy copy-namespaces="no">
                <opr:warning>
                    <xsl:text>profile '</xsl:text>
                    <xsl:value-of select="$uri-here"/>
                    <xsl:text>' picked up - and dropped - on import - we do only catalogs so far</xsl:text>
                </opr:warning>
                <!--<xsl:apply-templates mode="o:select" select="node() | @*">
                    <xsl:with-param name="uri-stack" tunnel="yes" select="$uri-stack,$uri-here"/>
                </xsl:apply-templates>-->
            </xsl:copy>
        </xsl:if>

    </xsl:template>

    <xsl:template match="catalog" mode="o:select">
        <selection opr:src="{base-uri(root())}">
            <xsl:copy-of select="@* except @xsi:*" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <xsl:apply-templates mode="#current"/>
        </selection>
    </xsl:template>

    <!--<xsl:template match="catalog/metadata" mode="o:select">
        <metadata>
            <new-metadata-here/>
        </metadata>
    </xsl:template>-->

    <xsl:key name="cross-reference" match="resource" use="'#' || @uuid"/>

    <xsl:template priority="2" mode="o:select" match="import[starts-with(@href,'#')]">
        <xsl:apply-templates mode="o:import" select="key('cross-reference',@href)">
            <xsl:with-param name="import-instruction" select="." tunnel="yes"/>
        </xsl:apply-templates>
    </xsl:template>

    <xsl:template match="resource" mode="o:import">
        <xsl:variable name="linked-xml" select="child::rlink[ends-with(@href,'.xml') or matches(@media-type,'xml')][1]"/>
        <xsl:choose>
            <xsl:when test="exists($linked-xml)">
                <xsl:apply-templates mode="o:select" select="o:resource-or-error($linked-xml/@href)"/>
            </xsl:when>
            <xsl:otherwise>
                <xsl:message terminate="yes"
                    expand-text="yes">Document not acquired for resource with uuid {@uuid
                    }: No rlink with media-type='xml' or href ending with '.xml'</xsl:message>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>

    <xsl:template priority="1" mode="o:select" match="import">

<!-- OSCAL issue        -->
        <xsl:variable name="linked-resource" select="key('cross-reference',@href)"/>
        <xsl:apply-templates select="$linked-resource" mode="o:import">
            <xsl:with-param name="import-instruction" select="." tunnel="yes"/>
        </xsl:apply-templates>
        <xsl:apply-templates mode="#current" select="o:resource-or-error(@href)">
            <xsl:with-param name="import-instruction" select="." tunnel="yes"/>
        </xsl:apply-templates>
    </xsl:template>

    <!-- We want a group even if there is nothing to put in it, for potential merging downstream  -->
    <xsl:template match="group" mode="o:select">
        <xsl:copy copy-namespaces="no">
            <!-- add an ID for downstream processing when the source has none -->
            <xsl:call-template name="add-process-id"/>
            <xsl:apply-templates mode="o:select" select="node() | @*"/>
        </xsl:copy>
    </xsl:template>

    <!-- Parameters are always passed through until later stages. -->
    <xsl:template match="param" mode="o:select">
        <xsl:copy copy-namespaces="no">
            <xsl:call-template name="add-process-id"/>
            <xsl:apply-templates mode="#current" select="node() | @*"/>
        </xsl:copy>
    </xsl:template>

    <!-- A citation or resource is included if it is targeted as an internal link -->
    <!--<xsl:template match="back-matter/*" mode="o:select">
        <xsl:param name="import-instruction" tunnel="yes" required="yes"/>
        <xsl:variable name="called-by" select="key('internal-links',@id)"/>
        <xsl:variable name="calling-params" select="$called-by/ancestor::param"/>
        <xsl:variable name="calling-controls" select="($called-by/ancestor::control[1],$calling-params/key('param-insertions',@id)/ancestor::control[1])"/>

        <xsl:if test="some $c in $calling-controls satisfies o:selects($import-instruction,$c)">
            <xsl:next-match/>
        </xsl:if>
    </xsl:template>-->

    <!-- Returns a document when found, a fatal error when not. -->
    <xsl:function name="o:resource-or-error" as="document-node()">
        <xsl:param name="href" as="attribute(href)"/>
        <xsl:variable name="resolved-href" select="resolve-uri($href,$href/base-uri())"/>
        <xsl:assert test="doc-available($resolved-href)"
            expand-text="yes">Document not acquired: {$href} resolved as {
            $resolved-href} (as OSCAL XML)</xsl:assert>
        <xsl:sequence select="document($resolved-href)"/>
    </xsl:function>

    <xsl:include href="select-or-custom-merge.xsl"/>

    <xsl:function name="o:resolve-profile">
        <xsl:param name="profile" as="element(profile)"/>
        <xsl:param name="uri-stack" as="xs:anyURI*"/>
        <xsl:variable name="runtime-params" as="map(xs:QName,item()*)">
            <xsl:map>
                <xsl:map-entry key="QName('','profile-origin-uri')" select="base-uri($profile)"/>
                <xsl:map-entry key="QName('','path-to-source')"     select="'.'"/>
                <xsl:map-entry key="QName('','uri-stack-in')"       select="$uri-stack"/>
            </xsl:map>
        </xsl:variable>
        <xsl:variable name="runtime" as="map(xs:string, item())">
            <xsl:map>
                <xsl:map-entry key="'xslt-version'"        select="3.0"/>
                <xsl:map-entry key="'stylesheet-location'" select="'oscal-profile-RESOLVE.xsl'"/>
                <xsl:map-entry key="'source-node'"         select="root($profile)"/>
                <xsl:map-entry key="'stylesheet-params'"   select="$runtime-params"/>
            </xsl:map>
        </xsl:variable>

        <!-- The function returns a map; primary results are under 'output'
             unless a base output URI is given
             https://www.w3.org/TR/xpath-functions-31/#func-transform -->
        <xsl:sequence select="transform($runtime)?output"/>
        <!--<xsl:call-template name="alert">
            <xsl:with-param name="msg" expand-text="true"> ... applied step { count(.|preceding-sibling::*) }: XSLT { $xslt-spec } ... </xsl:with-param>
        </xsl:call-template>-->
    </xsl:function>


</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/oscal-profile-resolve.sh
================================================
#!/usr/bin/env bash
# OSCAL Profile Resolution Pipeline Wrapper

set -Eeuo pipefail

usage() {
    cat <<EOF
Usage: $(basename "${BASH_SOURCE[0]}") TARGET_PROFILE OUTPUT_BASELINE [ADDITIONAL_ARGS]

Runs the OSCAL Profile Resolution Pipeline on the TARGET_PROFILE.

Additional arguments should be specified in the `key=value` format.
EOF
}

if ! [ -x "$(command -v mvn)" ]; then
  echo 'Error: Maven (mvn) is not in the PATH, is it installed?' >&2
  exit 1
fi

[[ -z "${1-}" ]] && { echo "Error: TARGET_PROFILE not specified"; usage; exit 1; }
TARGET_PROFILE=$1
[[ -z "${2-}" ]] && { echo "Error: OUTPUT_BASELINE not specified"; usage; exit 1; }
OUTPUT_BASELINE=$2

ADDITIONAL_ARGS=$(shift 2; echo $@)

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd)"
OSCAL_DIR="${SCRIPT_DIR}/../../.."
POM_FILE="${OSCAL_DIR}/build/pom.xml"
ENTRY_STYLESHEET="${SCRIPT_DIR}/oscal-profile-RESOLVE.xsl"

mvn \
    -f $POM_FILE \
    exec:java \
    -Dexec.mainClass="net.sf.saxon.Transform" \
    -Dexec.args="-t -s:$TARGET_PROFILE -xsl:$ENTRY_STYLESHEET -o:$OUTPUT_BASELINE $ADDITIONAL_ARGS"



================================================
FILE: src/utils/resolver-pipeline/oscal-profile-RESOLVE.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:u="http://csrc.nist.gov/ns/uuid"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    exclude-result-prefixes="#all"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0">

    <!--

    An XSLT 3.0 stylesheet using XPath 3.1 functions including transform()

    This XSLT orchestrates a sequence of transformations over its input.

    The first transformation, "selection", aggregates the source with external (referenced) contents.

    Subsequent transformations, "merge" and "modify", are self-contained: all inputs are included.

    -->

    <xsl:output method="xml" indent="yes"/>

    <!-- uuid-method-choice.xsl has global parameters
        $uuid-method, $top-uuid, and $uuid-service. -->
    <xsl:import href="uuid-method-choice.xsl"/>

    <xsl:strip-space
        elements="catalog group control param guideline select part
        metadata back-matter annotation party person org rlink address resource role responsible-party citation
        profile import merge custom modify include exclude set alter add"/>

    <!-- Turning $trace to 'on' will
         - emit runtime messages with each transformation, and
         - retain opr:ERROR and opr:WARNING messages in results. -->

    <xsl:param name="trace" as="xs:string">off</xsl:param>
    
    <xsl:param name="uri-stack" as="xs:anyURI*" select="()"/>
    
    <!-- $path-to-source should point back to the location of the source catalog (or profile) from its result,
         so '..' is appropriate when writing results down a directory. -->
    <xsl:param name="path-to-source" as="xs:string?"/>

    <xsl:variable name="louder" select="$trace = 'on'"/>

    <xsl:variable name="home" select="/"/>

    <!-- If true, do not record profile URI in output catalog's source-profile
        metadata, due to privacy or security concerns. -->
    <xsl:param name="hide-source-profile-uri" as="xs:boolean" select="false()"/>

    <!-- The $transformation-sequence declares transformations to be applied in order. -->
    <xsl:variable name="transformation-sequence">
        <opr:transform version="2.0">oscal-profile-resolve-select.xsl</opr:transform>
        <opr:transform version="2.0">oscal-profile-resolve-metadata.xsl</opr:transform>
        <opr:transform version="2.0">oscal-profile-resolve-merge.xsl</opr:transform>
        <opr:transform version="2.0">oscal-profile-resolve-modify.xsl</opr:transform>
        <opr:transform version="2.0">oscal-profile-resolve-finish.xsl</opr:transform>
        <opr:finalize/>
    </xsl:variable>

    <!-- Entry point traps the root node of the source and passes it down the chain of transformation references -->
    <xsl:template match="/" name="profile-resolve">
        <xsl:param name="source" select="." as="document-node()"/>
        <!-- Each element inside $transformation-sequence is processed in turn.
             Each represents a stage in processing.
             The result of each processing step is passed to the next step as its input, until no steps are left. -->
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" expand-text="yes"> RESOLVING PROFILE { base-uri($source) } </xsl:with-param>
        </xsl:call-template>
        <xsl:iterate select="$transformation-sequence/*">
            <xsl:param name="doc" select="$source" as="document-node()"/>
            <xsl:on-completion select="$doc"/>
            <xsl:next-iteration>
                <xsl:with-param name="doc">
                    <xsl:apply-templates mode="opr:execute" select=".">
                        <xsl:with-param name="sourcedoc" select="$doc"/>
                    </xsl:apply-templates>
                </xsl:with-param>
            </xsl:next-iteration>
        </xsl:iterate>
    </xsl:template>


    <xsl:template mode="opr:provide-parameters" match="opr:transform"/>
    
    <xsl:template mode="opr:provide-parameters" match="opr:transform[.='oscal-profile-resolve-metadata.xsl']">
        <xsl:map-entry key="QName('','top-uuid-computed')">
            <xsl:call-template name="u:determine-uuid"/>
        </xsl:map-entry>
        <xsl:map-entry key="QName('','hide-source-profile-uri')" select="$hide-source-profile-uri"/>
    </xsl:template>
    
    <!-- for opr:transformation, the semantics are "apply this XSLT" -->
    <xsl:template mode="opr:execute" match="opr:transform">
        <xsl:param name="sourcedoc" as="document-node()"/>
        <xsl:variable name="xslt-spec" select="."/>
        <xsl:variable name="runtime-params" as="map(xs:QName,item()*)">
            <xsl:map>
                <xsl:map-entry key="QName('','profile-origin-uri')" select="base-uri($home)"/>
                <xsl:map-entry key="QName('','path-to-source')"     select="$path-to-source"/>
                <xsl:map-entry key="QName('','uri-stack-in')"       select="($uri-stack, base-uri($home))"/>
                <xsl:apply-templates select="." mode="opr:provide-parameters"/>
            </xsl:map>
        </xsl:variable>
        <!--<xsl:variable name="runtime" select="map {
                    'xslt-version': xs:decimal($xslt-spec/@version),
                    'stylesheet-location': string($xslt-spec),
                    'source-node': $sourcedoc,
                    'stylesheet-params': $runtime-params
                    }"/>-->
        <xsl:variable name="runtime" as="map(xs:string, item())">
            <xsl:map>
                <xsl:map-entry key="'xslt-version'" select="xs:decimal($xslt-spec/@version)"/>
                <xsl:map-entry key="'stylesheet-location'" select="string($xslt-spec)"/>
                <xsl:map-entry key="'source-node'" select="$sourcedoc"/>
                <xsl:map-entry key="'stylesheet-params'" select="$runtime-params"/>
            </xsl:map>
        </xsl:variable>

        <!-- The function returns a map; primary results are under 'output'
             unless a base output URI is given
             https://www.w3.org/TR/xpath-functions-31/#func-transform -->
        <xsl:sequence select="transform($runtime)?output"/>
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" expand-text="true"> ... applied step { count(.|preceding-sibling::*) }: XSLT { $xslt-spec } ... </xsl:with-param>
        </xsl:call-template>
    </xsl:template>

    <!-- The finalize step performs any last cleanup. -->
    <xsl:template mode="opr:execute" match="opr:finalize">
        <xsl:param name="sourcedoc" as="document-node()"/>
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" expand-text="true"> ... applied step {
                count(.|preceding-sibling::*) }: finalize ... </xsl:with-param>
        </xsl:call-template>

        <xsl:apply-templates select="$sourcedoc" mode="opr:finalize"/>
    </xsl:template>

    <!-- Not knowing any better, any other execution step passes through its source. -->
    <xsl:template mode="opr:execute" match="*">
        <xsl:param name="sourcedoc" as="document-node()"/>
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" expand-text="true"> ... applied step { count(.|preceding-sibling::*) }: { name() } ...</xsl:with-param>
        </xsl:call-template>
                <xsl:sequence select="$sourcedoc"/>
    </xsl:template>

    <!-- Mode 'opr:finalize' makes final adjustments. -->

    <!-- Here we wipe traces of XSD.   -->
    <xsl:template mode="opr:finalize" match="@xsi:*"/>

    <!-- Likewise, intermediate processing directives. -->
    <xsl:template mode="opr:finalize" match="opr:* | @opr:*"/>

    <!-- But keep warnings and errors when tracing. -->
    <xsl:template mode="opr:finalize" match="opr:ERROR[$louder] | opr:WARNING[$louder]">
        <xsl:copy-of copy-namespaces="no" select="."/>
        <xsl:call-template name="alert">
            <xsl:with-param name="msg" select="string(.)"/>
        </xsl:call-template>
    </xsl:template>

    <!-- In 'finalize' mode, copying everything else without namespaces. -->
    <xsl:template mode="opr:finalize" match="node() | @*">
        <xsl:copy copy-namespaces="no">
            <xsl:apply-templates select="node() | @*" mode="#current"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template name="alert">
        <xsl:param name="msg"/>
        <xsl:if test="$louder">
            <xsl:message>
                <xsl:sequence select="$msg"/>
            </xsl:message>
        </xsl:if>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/oscal-profile-test-helper.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    exclude-result-prefixes="#all"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0">

    <!--

    
    XSLT provides utility functionality for testing OSCAL profile resolution.
    
    Function opr:scrub-document returns an OSCAL catalog or profile with 'cosmetic' whitespace removed,
    for clean comparison.
    
    -->

    <xsl:output method="xml"/>
    
    <xsl:strip-space
        elements="catalog metadata param control group back-matter prop link part usage constraint guideline select remarks description test revisions revision role location party responsible-party address external-id resource citation rlink base64"/>


    <!--All assemblies defined in the catalog model:
        
        https://raw.githubusercontent.com/wendellpiez/OSCAL/profile-resolution-update-v1a/xml/schema/oscal_catalog_schema.xsd
        
        //xs:element[ends-with(@type,'ASSEMBLY') or exists(xs:complexType[not(@mixed='true')])]/@name => distinct-values() => string-join(' | ')
        
        
        catalog | metadata | param | control | group | back-matter | prop | link | part | usage | constraint | guideline | select | remarks | description | test | revisions | revision | role | location | party | responsible-party | address | external-id | resource | citation | rlink | base64
        
        
    -->
    <xsl:template match="/">
        <xsl:param name="source" select="." as="document-node()"/>
        <xsl:document>
          <xsl:apply-templates select="$source" mode="scrubbing"/>
        </xsl:document>
    </xsl:template>

    <xsl:function name="opr:scrub" as="document-node()">
        <xsl:param name="n" as="node()"/>
        <xsl:document>
          <xsl:apply-templates select="$n" mode="scrubbing"/>
        </xsl:document>
    </xsl:function>
    
    <xsl:template mode="scrubbing" match="* | text() | @*">
        <xsl:copy>
            <xsl:apply-templates mode="#current" select="@*"/>
            <xsl:apply-templates mode="#current"/>
        </xsl:copy>
    </xsl:template>

    <!-- defends against whitespace/indentation glitches -->
    <xsl:template mode="scrubbing" match="text()[matches(.,'\S') => not()]">
        <xsl:variable name="wrapper" select="ancestor::p[1] | ancestor::li[1]"/>
        <xsl:if test="not(. is $wrapper/descendant::text()[1]) and not(. is $wrapper/descendant::text()[last()])">
            <xsl:next-match/>
        </xsl:if>
    </xsl:template>

    <xsl:template mode="scrubbing" match="catalog/metadata/prop[@name='resolution-tool']/@value">
        <xsl:attribute name="value">...</xsl:attribute>
    </xsl:template>

    <xsl:template mode="scrubbing" match="catalog/metadata/link[@rel='source-profile']/@href">
        <xsl:attribute name="href">...</xsl:attribute>
    </xsl:template>

    <xsl:template mode="scrubbing" match="last-modified">
        <xsl:copy>...</xsl:copy>
    </xsl:template>
    
    <xsl:template mode="scrubbing" match="catalog/@uuid">
        <xsl:attribute name="uuid">...</xsl:attribute>
    </xsl:template>
    
    <xsl:template mode="scrubbing" match="catalog | metadata | param | control | group | back-matter | prop | link | part | usage | constraint | guideline | select | remarks | description | test | revisions | revision | role | location | party | responsible-party | address | external-id | resource | citation | rlink | base64">
        <xsl:copy>
            <xsl:apply-templates mode="#current" select="@*"/>
            <!-- strips comments and PIs too!  -->
            <xsl:apply-templates mode="#current" select="child::*"/>
        </xsl:copy>
    </xsl:template>

    
</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/random-util.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math" exclude-result-prefixes="xs math r"
    xmlns:r="http://csrc.nist.gov/ns/random" version="3.0">

    <!-- from the spec https://www.w3.org/TR/xpath-functions-31/#func-random-number-generator

declare %public function r:random-sequence($length as xs:integer) as xs:double* {
  r:random-sequence($length, fn:random-number-generator())
};

declare %private function r:random-sequence($length as xs:integer,
                                            $G as map(xs:string, item())) {
  if ($length eq 0)
  then ()
  else ($G?number, r:random-sequence($length - 1, $G?next()))
};

r:random-sequence(200);

v4 UUID
   hex fields 8 4 4 4 12
     place 13 = 4
     place 17 = 8-b

    -->
    <xsl:output indent="yes"/>

    <!-- Set $germ to a string for reproducible outputs of r:make-uuid.
         Pass in a blind value - and don't save it - for irreproducible outputs. -->

    <xsl:param name="germ" select="current-dateTime() || base-uri(/)"/>

    <!-- for testing random number features   -->
    <xsl:template match="/" name="xsl:initial-template" expand-text="true">
        <!--<uuid><xsl:value-of select="uuid:randomUUID()" xmlns:uuid="java:java.util.UUID"/></uuid>-->
        <randomness>
            <now>{ r:make-uuid(current-dateTime()) }</now>
            <germ>{ r:make-uuid($germ) }</germ>
            <a>{ r:make-uuid('a') }</a>
            <a>{ r:make-uuid('a') }</a>
            <b>{ r:make-uuid('b') }</b>
            <ten>
                <xsl:for-each select="r:make-uuid-sequence($germ, 10)">
                    <uuid>{ . }</uuid>
                </xsl:for-each>
            </ten>
        </randomness>
    </xsl:template>

    <!-- r:make-uuid produces one v4 UUID. Output is repeatable for a given seed.
         If the random-number-generator() function is not available,
         this function returns an empty sequence. -->
    <xsl:function name="r:make-uuid" as="xs:string?">
        <xsl:param name="seed" as="item()"/>
        <xsl:sequence select="r:make-uuid-sequence($seed, 1)"/>
    </xsl:function>

    <!-- r:make-uuid-sequence produces a sequence of $seq-length v4 UUIDs.
         Output is repeatable for a given seed. If the random-number-generator()
         function is not available, this function returns an empty sequence. -->
    <xsl:function name="r:make-uuid-sequence" as="xs:string*">
        <xsl:param name="seed" as="item()"/>
        <xsl:param name="seq-length" as="xs:integer"/>
        <xsl:variable name="uuid-v4-template" as="xs:string">________-____-4___-=___-____________</xsl:variable>
        <!--                                                 a847eaab-cec8-41bd-98e2-02d02900b554            -->
        <xsl:sequence select="r:make-random-string-sequence($seed, $seq-length, $uuid-v4-template)"/>
    </xsl:function>

    <!-- r:make-random-string-sequence produces a sequence of $seq-length strings.
         The $template parameter specifies the pattern of characters in each
         string, where:
           * '_' becomes a random hex value 0-9a-f
           * '=' becomes one of '8','9','a','b' at random
           * Any other character is copied to the output string
         Output is repeatable for a given seed. If the random-number-generator()
         function is not available, this function returns an empty sequence. -->
    <xsl:function name="r:make-random-string-sequence" as="xs:string*">
        <xsl:param name="seed" as="item()"/>
        <xsl:param name="seq-length" as="xs:integer"/>
        <xsl:param name="template" as="xs:string"/>
        <xsl:sequence use-when="function-available('random-number-generator')">
            <xsl:variable name="PRNG" as="map(xs:string, item())" select="random-number-generator($seed)"/>
            <xsl:variable name="template-length" as="xs:integer" select="string-length($template)"/>
            <xsl:variable name="template-char-seq" as="xs:string*"
                select="$template ! string-to-codepoints(.) ! codepoints-to-string(.)"/>
            <!-- Draw one long stream from PRNG over sequence of characters in concatenated template,
                advancing state in each iteration. -->
            <xsl:variable name="random-chars" as="xs:string">
                <xsl:value-of>
                    <xsl:iterate select="for $idx in (1 to $seq-length) return $template-char-seq">
                        <xsl:param name="PRNG" as="map(xs:string, item())" select="$PRNG"/>
                        <xsl:apply-templates select="current()" mode="uuid-char">
                            <xsl:with-param name="PRNG" select="$PRNG"/>
                        </xsl:apply-templates>
                        <xsl:next-iteration>
                            <xsl:with-param name="PRNG" select="$PRNG?next()"/>
                        </xsl:next-iteration>
                    </xsl:iterate>
                </xsl:value-of>
            </xsl:variable>
            <!-- Divide $random-chars into nonoverlapping strings:
                $seq-length of them, each of length $template-length. -->
            <xsl:sequence select="for $idx in (0 to $seq-length - 1)
                return substring($random-chars, 1 + $idx * $template-length, $template-length)"/>
        </xsl:sequence>
    </xsl:function>

    <xsl:variable name="hex-digits" select="tokenize('0 1 2 3 4 5 6 7 8 9 a b c d e f', ' ')"/>

    <xsl:template match=".[. = '_']" mode="uuid-char">
        <xsl:param name="PRNG" as="map(xs:string, item())"/>
        <xsl:sequence select="$PRNG?permute($hex-digits)[1]"/>
    </xsl:template>

    <xsl:template match=".[. = '=']" mode="uuid-char">
        <xsl:param name="PRNG" as="map(xs:string, item())"/>
        <xsl:sequence select="$PRNG?permute(('8', '9', 'a', 'b'))[1]"/>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/resolve-oscal-profile-debug.xpl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<p:declare-step xmlns:p="http://www.w3.org/ns/xproc"
  xmlns:c="http://www.w3.org/ns/xproc-step" version="1.0"
  xmlns:oscal="http://csrc.nist.gov/ns/oscal/1.0"
  type="oscal:resolve-profile" name="oscal-resolve-profile">

  <!-- &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& -->
  <!-- Ports -->

  <p:input port="source" primary="true"/>
  <p:input port="parameters" kind="parameter"/>

  <p:serialization port="a.echo-input" indent="true"/>
  <p:output        port="a.echo-input" primary="false">
    <p:pipe        port="result"       step="input"/>
  </p:output>

  <p:serialization port="b.select" indent="true"/>
  <p:output        port="b.select" primary="false">
    <p:pipe        port="result"   step="select"/>
  </p:output>

  <p:serialization port="c.metadata" indent="true"/>
  <p:output        port="c.metadata" primary="false">
    <p:pipe        port="result"   step="metadata"/>
  </p:output>

  <p:serialization port="d.merge" indent="true"/>
  <p:output        port="d.merge" primary="false">
    <p:pipe        port="result"  step="merge"/>
  </p:output>

  <p:serialization port="e.modify" indent="true"/>
  <p:output        port="e.modify" primary="false">
    <p:pipe        port="result"   step="modify"/>
  </p:output>

  <p:serialization port="f.finish" indent="true"/>
  <p:output        port="f.finish" primary="false">
    <p:pipe        port="result"   step="finish"/>
  </p:output>

  <!--
  <opr:transform version="2.0">oscal-profile-resolve-select.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-metadata.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-merge.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-modify.xsl</opr:transform>
  <opr:transform version="2.0">oscal-profile-resolve-finish.xsl</opr:transform>-->


  <p:serialization port="z.final" indent="true" method="xml" omit-xml-declaration="false"/>
  <p:output        port="z.final" primary="true">
    <p:pipe        port="result" step="final"/>
  </p:output>

  <!-- &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& &&& -->
  <!-- Pipeline -->

  <p:identity name="input"/>

  <p:xslt name="select">
    <p:input port="stylesheet">
      <p:document href="oscal-profile-resolve-select.xsl"/>
    </p:input>
  </p:xslt>

  <p:xslt name="metadata">
    <p:input port="stylesheet">
      <p:document href="oscal-profile-resolve-metadata.xsl"/>
    </p:input>
  </p:xslt>

  <p:xslt name="merge">
    <p:input port="stylesheet">
      <p:document href="oscal-profile-resolve-merge.xsl"/>
    </p:input>
  </p:xslt>

  <p:xslt name="modify">
    <p:input port="stylesheet">
      <p:document href="oscal-profile-resolve-modify.xsl"/>
    </p:input>
  </p:xslt>

  <p:xslt name="finish">
    <p:input port="stylesheet">
      <p:document href="oscal-profile-resolve-finish.xsl"/>
    </p:input>
  </p:xslt>

  <p:identity name="final"/>

</p:declare-step>



================================================
FILE: src/utils/resolver-pipeline/select-or-custom-merge.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="3.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    exclude-result-prefixes="xs math o"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0">

    <xsl:include href="oscal-profile-resolve-functions.xsl"/>

    <!-- A control is included if it is selected by the provided import instruction. -->
    <!-- Also, for a nonselected control, this template can return selected children. -->
    <xsl:template match="control" mode="o:select" as="element(o:control)*">
        <xsl:param name="import-instruction" tunnel="yes" required="yes"/>
        <xsl:choose>
            <xsl:when test="o:selects($import-instruction,.)">
                <xsl:copy copy-namespaces="no">
                    <xsl:call-template name="add-process-id"/>
                    <xsl:apply-templates mode="#current" select="node() | @*"/>
                </xsl:copy>
            </xsl:when>
            <xsl:otherwise>
                <!-- Visit child controls in case they are selected using
                   with-parent-controls="no". -->
                <xsl:apply-templates mode="#current" select="control"/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>

    <xsl:template name="add-process-id" as="attribute(opr:id)">
        <xsl:param name="context" select="." as="element()"/>
        <xsl:attribute name="opr:id" namespace="http://csrc.nist.gov/ns/oscal/profile-resolution">
            <xsl:value-of
                select="concat(opr:catalog-identifier($context/root()/o:catalog), '#', $context/(@id, generate-id())[1])"/>
        </xsl:attribute>
    </xsl:template>

    <!-- Function o:selects($importing,$candidate) returns a true or false
         depending on whether the import calls the candidate control  -->
    
    <!-- @with-child-controls='yes' is recursive - given on a control it brings all control descendants, not only children   -->
    <xsl:function name="o:selects" as="xs:boolean">
        <xsl:param name="importing" as="element()"/><!-- o:import in selection phase, o:insert-controls in merge phase -->
        <xsl:param name="candidate" as="element(o:control)"/>
        <xsl:variable name="include-reasons" as="xs:boolean+">
            <!-- we are not optimizing for performance here; nothing is done to prevent all checks even if the first passes -->
            <!--<xsl:sequence select="empty($importing/include)"/>-->
            <xsl:sequence select="exists($importing/include-all)"/>
            <xsl:sequence select="some $c in ($importing/include-controls/with-id)
                satisfies ($c = $candidate/@id)"/>
            <xsl:sequence select="some $c in ($importing/include-controls[o:calls-children(.)]/with-id)
                satisfies ($c = $candidate/ancestor::control/@id)"/>
            <xsl:sequence select="some $m in ($importing/include-controls/matching[@pattern != ''])
                satisfies (matches($candidate/@id,$m/@pattern/o:glob-as-regex(string(.)) ))"/>
            <xsl:sequence select="some $m in ($importing/include-controls[o:calls-children(.)]/matching[@pattern != '']), $a in $candidate/ancestor::control 
                satisfies (matches($a/@id,$m/@pattern/o:glob-as-regex(string(.))))"/>
        </xsl:variable>
        <xsl:variable name="exclude-reasons" as="xs:boolean+">
            <xsl:sequence select="exists($candidate/parent::control) and $importing/include-all/@with-child-controls='no'"/>
            <xsl:sequence select="some $c in ($importing/exclude-controls/with-id) satisfies ($c = $candidate/@id)"/>
            <xsl:sequence select="some $c in ($importing/exclude-controls[o:calls-children(.)]/with-id)
                satisfies ($c = $candidate/ancestor::control/@id)"/>
            <xsl:sequence select="some $m in ($importing/exclude-controls/matching[@pattern != ''])
                satisfies (matches($candidate/@id,$m/@pattern/o:glob-as-regex(string(.))))"/>
            <xsl:sequence select="some $m in ($importing/exclude-controls[o:calls-children(.)]/matching[@pattern != '']), $a in $candidate/ancestor::control
                satisfies (matches($a/@id,$m/@pattern/o:glob-as-regex(string(.))))"/>
        </xsl:variable>
        <!-- predicate [.] filters reasons as booleans -->
        <xsl:sequence select="exists($include-reasons[.]) and empty($exclude-reasons[.])"/>
    </xsl:function>
    
    <xsl:function name="o:calls-children" as="xs:boolean">
        <xsl:param name="caller" as="element()"/>
        <xsl:sequence select="$caller/@with-child-controls='yes'"/>
    </xsl:function>

    <xsl:function name="opr:catalog-identifier" as="xs:string">
        <xsl:param name="catalog" as="element(o:catalog)"/>
        <xsl:sequence select="$catalog/(@uuid,base-uri(root(.)))[1]"/>
    </xsl:function>

</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/test-tweak.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:math="http://www.w3.org/2005/xpath-functions/math"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    exclude-result-prefixes="xs math"
    version="3.0"
    xmlns="http://csrc.nist.gov/ns/oscal/1.0" xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xpath-default-namespace="http://csrc.nist.gov/ns/oscal/1.0">

    <xsl:template match="node() | @*">
        <xsl:copy>
            <xsl:namespace name="opr">http://csrc.nist.gov/ns/oscal/profile-resolution</xsl:namespace>
            <xsl:apply-templates select="node() | @*"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="x:expect//control | x:expect//param">
        <xsl:copy>
            <xsl:copy-of select="@*"/>
            <xsl:attribute name="opr:id" expand-text="true">{ancestor::selection/@id}#{@id}</xsl:attribute>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:template>

</xsl:stylesheet>



================================================
FILE: src/utils/resolver-pipeline/TESTING.md
================================================
# Profile Resolver Pipeline Tests

The `testing/*` folders contain XSpec tests that indicate expected interim results of each XSLT transformation in the sequence.

Note that these interim results are _not necessarily valid to any OSCAL schema_, although they are quite close to OSCAL profile and catalog syntax.

The files in `testing/*` are only for this implementation. Implementation-independent tests and sample files for profile resolution are [with the specification](../../specifications/profile-resolution).



================================================
FILE: src/utils/resolver-pipeline/uuid-method-choice.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet
    xmlns:javaUUID="java.util.UUID"
    xmlns:mh="http://csrc.nist.gov/ns/message"
    xmlns:r="http://csrc.nist.gov/ns/random"
    xmlns:u="http://csrc.nist.gov/ns/uuid"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    exclude-result-prefixes="#all"
    version="3.0">

    <xsl:import href="random-util.xsl"/>
    <xsl:import href="message-handler.xsl"/>

    <!-- Select an approach for assigning the top-level UUID for the 
        result catalog. Supported values:
        - 'random-xslt'    No parameters.
        - 'random-java'    No parameters.
        - 'user-provided'  Parameter $top-uuid is required in this case.
        - 'web-service'    Parameter $uuid-service is optional.
        - 'fixed'          No parameters.
        -->
    <xsl:param name="uuid-method" as="xs:string" select="'fixed'"/>
    
    <!-- Explicit top-level UUID for the result catalog. -->
    <xsl:param name="top-uuid" as="xs:string?"/>
    
    <!-- Alternatively, call a web service if the processor supports it -->
    <xsl:param name="uuid-service" select="'https://www.uuidgenerator.net/api/version4'"/>

    <xsl:template name="u:determine-uuid" as="xs:string">
        <xsl:param name="uuid-method" select="$uuid-method" as="xs:string"/>
        <xsl:param name="uuid-service" select="$uuid-service" as="xs:string"/>
        <xsl:param name="top-uuid" select="$top-uuid" as="xs:string?"/>
        
        <xsl:variable name="uuid-v4-regex" as="xs:string">^[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-4[0-9A-Fa-f]{3}-[89ABab][0-9A-Fa-f]{3}-[0-9A-Fa-f]{12}$</xsl:variable>
        <xsl:variable name="fixed-uuid" as="xs:string">00000000-0000-4000-B000-000000000000</xsl:variable>
        <xsl:choose>
            <xsl:when test="$uuid-method eq 'user-provided' and
                matches($top-uuid,$uuid-v4-regex)">
                <xsl:sequence select="$top-uuid"/>
            </xsl:when>
            <xsl:when test="$uuid-method eq 'user-provided'">
                <!-- If we reach this block, the provided value does not match the regex. -->
                <xsl:call-template name="mh:message-handler">
                    <xsl:with-param name="message-type">Warning</xsl:with-param>
                    <xsl:with-param name="text" expand-text="yes">top-uuid value, '{$top-uuid}', does not meet UUID requirements. Using default UUID instead.</xsl:with-param>
                </xsl:call-template>
                <xsl:sequence select="$fixed-uuid"/>
            </xsl:when>
            <xsl:when test="$uuid-method eq 'random-xslt'" use-when="function-available('random-number-generator')">
                <!-- seed splices a timestamp with a given @uuid -->
                <xsl:sequence select="r:make-uuid( /*/@uuid || '-' || replace( string(current-dateTime()),'\D','') )"/>
            </xsl:when>
            <xsl:when test="$uuid-method eq 'random-java'" use-when="function-available('javaUUID:randomUUID')">
                <xsl:sequence select="javaUUID:randomUUID()"/>
            </xsl:when>
            <xsl:when test="$uuid-method = ('random-xslt','random-java')">
                <!-- If we reach this block, the requested random method is not available. -->
                <xsl:call-template name="mh:message-handler">
                    <xsl:with-param name="message-type">Warning</xsl:with-param>
                    <xsl:with-param name="text" expand-text="yes">uuid-method, '{$uuid-method}', is not available. Using default UUID instead.</xsl:with-param>
                </xsl:call-template>
                <xsl:sequence select="$fixed-uuid"/>
            </xsl:when>
            <xsl:when test="$uuid-method eq 'web-service' and unparsed-text-available($uuid-service)">
                <xsl:sequence select="unparsed-text($uuid-service)"/>
            </xsl:when>
            <xsl:when test="$uuid-method eq 'web-service'">
                <xsl:call-template name="mh:message-handler">
                    <xsl:with-param name="message-type">Warning</xsl:with-param>
                    <xsl:with-param name="text" expand-text="yes">uuid-service, '{$uuid-service}', is not available. Using default UUID instead.</xsl:with-param>
                </xsl:call-template>
                <xsl:sequence select="$fixed-uuid"/>
            </xsl:when>
            <xsl:when test="$uuid-method eq 'fixed'">
                <xsl:sequence select="$fixed-uuid"/>
            </xsl:when>
            <xsl:otherwise>
                <xsl:call-template name="mh:message-handler">
                    <xsl:with-param name="message-type">Warning</xsl:with-param>
                    <xsl:with-param name="text" expand-text="yes">uuid-method, '{$uuid-method}', is not recognized. Using default UUID instead.</xsl:with-param>
                </xsl:call-template>
                <xsl:sequence select="$fixed-uuid"/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>

</xsl:stylesheet>


================================================
FILE: src/utils/resolver-pipeline/version-util.xsl
================================================
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:v="http://csrc.nist.gov/ns/version"
    exclude-result-prefixes="xs v" version="3.0">

    <!-- Reference for Semantic Versioning 2.0.0: semver.org -->

    <!-- Regular expression to check that a string is a valid semantic version, from semver.org.
         Capture groups: cg1 = major, cg2 = minor, cg3 = patch, cg4 = pre-release and cg5 = buildmetadata-->
    <xsl:variable name="semver-regexp" as="xs:string"
        select="'^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$'"/>

    <!-- Compare two semantic version strings for precedence.
        
        Parameters:
        * $A: Version string, assumed valid according to Semantic Versioning 2.0.0.
        * $B: Version string, assumed valid according to Semantic Versioning 2.0.0.

        Return values, imitating the XPath compare() function for strings:
        * -1 if $A is older than $B
        *  0 if $A and $B indicate the same version, not counting build metadata
        *  1 if $A is newer than $B
    -->
    <xsl:function name="v:compare" as="xs:integer">
        <xsl:param name="A" as="xs:string"/>
        <xsl:param name="B" as="xs:string"/>

        <!-- This two-parameter function assumes both strings are valid. -->
        <xsl:if test="not(matches($A, $semver-regexp))">
            <xsl:message terminate="yes" expand-text="yes">{$A} is not a valid semantic version.</xsl:message>
        </xsl:if>
        <xsl:if test="not(matches($B, $semver-regexp))">
            <xsl:message terminate="yes" expand-text="yes">{$B} is not a valid semantic version.</xsl:message>
        </xsl:if>

        <!-- Remove build metadata, which is irrelevant for precedence. -->
        <xsl:variable name="remove-build-metadata" as="function(*)" select="
            function ($str as xs:string) as xs:string {
            replace($str, '\+.*$', '')
            }"/>
        <xsl:variable name="A-trunc" as="xs:string" select="$remove-build-metadata($A)"/>
        <xsl:variable name="B-trunc" as="xs:string" select="$remove-build-metadata($B)"/>
        <xsl:variable name="A-numeric-parts" as="xs:integer+"
            select="v:version-to-xyz(normalize-space($A-trunc), false()) ! xs:integer(.)"/>
        <xsl:variable name="B-numeric-parts" as="xs:integer+"
            select="v:version-to-xyz(normalize-space($B-trunc), false()) ! xs:integer(.)"/>

        <!-- Check if the x.y.z parts of $A and $B differ. After finding a difference,
            break out of the loop because the remainder of the string is irrelevant. -->
        <xsl:variable name="comparison-of-xyz" as="xs:integer?">
            <xsl:iterate select="(1, 2, 3)">
                <xsl:variable name="index" select="."/>
                <xsl:variable name="A-this-part" as="xs:integer" select="$A-numeric-parts[$index]"/>
                <xsl:variable name="B-this-part" as="xs:integer" select="$B-numeric-parts[$index]"/>
                <xsl:choose>
                    <xsl:when test="$A-this-part lt $B-this-part">
                        <!-- $A is older -->
                        <xsl:sequence select="xs:integer(-1)"/>
                        <xsl:break/>
                    </xsl:when>
                    <xsl:when test="$A-this-part gt $B-this-part">
                        <!-- $A is newer -->
                        <xsl:sequence select="xs:integer(1)"/>
                        <xsl:break/>
                    </xsl:when>
                </xsl:choose>
            </xsl:iterate>
        </xsl:variable>
        <xsl:choose>
            <xsl:when test="$A-trunc eq $B-trunc">
                <xsl:sequence select="xs:integer(0)"/>
            </xsl:when>
            <xsl:when test="exists($comparison-of-xyz)">
                <!-- $A and $B differ in their x.y.z pattern. No need to consider pre-release descriptors. -->
                <xsl:sequence select="$comparison-of-xyz"/>
            </xsl:when>
            <xsl:when test="(contains($A-trunc, '-')) and not(contains($B-trunc, '-'))">
                <!-- $A and $B have the same x.y.z pattern, and only $A has a pre-release descriptor. $A is older. -->
                <xsl:sequence select="xs:integer(-1)"/>
            </xsl:when>
            <xsl:when test="not(contains($A-trunc, '-')) and (contains($B-trunc, '-'))">
                <!-- $A and $B have the same x.y.z pattern, and only $B has a pre-release descriptor. $B is older. -->
                <xsl:sequence select="xs:integer(1)"/>
            </xsl:when>
            <xsl:otherwise>
                <!-- $A and $B differ only in their pre-release descriptors, which both exist and which we compare here. -->
                <xsl:variable name="A-pre-release-parts" as="xs:string+"
                    select="$A-trunc => substring-after('-') => tokenize('\.')"/>
                <xsl:variable name="B-pre-release-parts" as="xs:string+"
                    select="$B-trunc => substring-after('-') => tokenize('\.')"/>
                <xsl:variable name="comparison-of-pre-release" as="xs:integer?">
                    <xsl:iterate select="1 to max( (count($A-pre-release-parts), count($B-pre-release-parts)) )">
                        <xsl:variable name="index" select="."/>
                        <xsl:variable name="A-this-part" as="xs:string?" select="$A-pre-release-parts[$index]"/>
                        <xsl:variable name="B-this-part" as="xs:string?" select="$B-pre-release-parts[$index]"/>
                        <xsl:variable name="has-non-numeric" as="function(*)" select="
                            function ($str as xs:string) as xs:boolean {
                            matches($str, '[a-zA-Z-]')
                            }"/>
                        <xsl:choose>
                            <xsl:when test="empty($A-this-part)">
                                <!-- $A doesn't have this part (and $B does, or else $index would exceed max(...) in xsl:iterate). $B is newer. -->
                                <xsl:sequence select="xs:integer(-1)"/>
                                <xsl:break/>
                            </xsl:when>
                            <xsl:when test="empty($B-this-part)">
                                <!-- $B doesn't have this part (and $A does). $A is newer. -->
                                <xsl:sequence select="xs:integer(1)"/>
                                <xsl:break/>
                            </xsl:when>
                            <!-- Beyond this point, $A and $B have nonempty items to compare. -->
                            <xsl:when test="$A-this-part eq $B-this-part">
                                <!-- Skip to next iteration. -->
                            </xsl:when>
                            <xsl:when test="($has-non-numeric($A-this-part)) and not($has-non-numeric($B-this-part))">
                                <!-- $A is newer because numeric identifiers have lower precedence than non-numeric identifiers. -->
                                <xsl:sequence select="xs:integer(1)"/>
                                <xsl:break/>
                            </xsl:when>
                            <xsl:when test="not($has-non-numeric($A-this-part)) and ($has-non-numeric($B-this-part))">
                                <!-- $B is newer because numeric identifiers have lower precedence than non-numeric identifiers. -->
                                <xsl:sequence select="xs:integer(-1)"/>
                                <xsl:break/>
                            </xsl:when>
                            <!-- Beyond this point, both identifiers are all-numeric or neither is all-numeric. -->
                            <xsl:when test="$has-non-numeric($A-this-part)">
                                <xsl:sequence select="compare($A-this-part, $B-this-part)"/>
                                <xsl:break/>
                            </xsl:when>
                            <xsl:when test="number($A-this-part) lt number($B-this-part)">
                                <xsl:sequence select="xs:integer(-1)"/>
                                <xsl:break/>
                            </xsl:when>
                            <xsl:when test="number($A-this-part) gt number($B-this-part)">
                                <xsl:sequence select="xs:integer(1)"/>
                                <xsl:break/>
                            </xsl:when>
                        </xsl:choose>
                    </xsl:iterate>
                </xsl:variable>
                <xsl:sequence select="$comparison-of-pre-release"/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:function>
    
    <!-- Compare two strings for precedence according to Semantic Versioning 2.0.0.
        If the strings are not valid version strings, then they must be modifiable
        in specific ways to produce valid version strings. 

        Parameters:
        * $A: Version string.
        * $B: Version string.
        * $options: Map that determines ways in which the function can handle
          $A and $B if they are not valid version strings. The default behavior
          if any option is omitted or false is not to allow the handling described.

          Keys in $options map:
          * 'normalize-space': If true, normalize space in each string.
          * 'supply-missing-zeros': If true, supply missing y or z as zero.
          * 'remove-leading-zeros': If true, remove leading zeros from x, y, or z.
          * 'allow-empty-string': If true, empty string is allowed and considered the
            oldest possible version.

        Return values, imitating the XPath compare() function for strings:
        * -1 if $A is older than $B
        *  0 if $A and $B indicate the same version, not counting build metadata
        *  1 if $A is newer than $B
    -->
    <xsl:function name="v:compare" as="xs:integer">
        <xsl:param name="A" as="xs:string"/>
        <xsl:param name="B" as="xs:string"/>
        <xsl:param name="options" as="map(*)?"/>
        <xsl:choose>
            <xsl:when test="($A = '' or $B = '') and $options('allow-empty-string')">
                <xsl:sequence select="compare($A, $B)"/>
            </xsl:when>
            <xsl:otherwise>
                <!-- Modify $A and $B as $options indicates, and call the v:compare
                    function implementation that assumes valid inputs. At that point,
                    if either input is still not a valid Semantic Version 2.0.0
                    string, that function will issue a fatal error. -->
                <xsl:sequence select="v:compare(
                    v:normalize-version($A, $options),
                    v:normalize-version($B, $options)
                    )"/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:function>

    <!-- Modify $str as the $options map indicates, in an effort to make $str
        a valid Semantic Versioning 2.0.0 string.

        Parameters:
        * $str: String.
        * $options: Map that determines modifications the function applies to
          $str. The default behavior if any option is omitted or false is not
          to perform the modification described.

          Keys in $options map:
          * 'normalize-space': If true, normalize space in $str.
          * 'supply-missing-zeros': If true, supply missing y or z as zero.
          * 'remove-leading-zeros': If true, remove leading zeros from x, y, or z.        
    -->
    <xsl:function name="v:normalize-version" as="xs:string">
        <xsl:param name="str" as="xs:string"/>
        <xsl:param name="options" as="map(*)"/>
        <xsl:sequence select="$str
            => v:normalize-space-option($options('normalize-space'))
            => v:supply-missing-zeros($options('supply-missing-zeros'))
            => v:remove-leading-zeros($options('remove-leading-zeros'))
            "/>
    </xsl:function>

    <!-- ======================================= -->
    <!-- Helper functions -->

    <!-- Normalize space in $str, if $option is true. If $option
        is false or empty, return $str unchanged.
    
        Assumptions about content of $str: None
    -->
    <xsl:function name="v:normalize-space-option" as="xs:string">
        <xsl:param name="str" as="xs:string"/>
        <xsl:param name="option" as="xs:boolean?"/>
        <xsl:sequence select="if ($option) then normalize-space($str) else $str"/>
    </xsl:function>

    <!-- Supply missing zeros in y or z spots of $str if $option is true,
        e.g., convert 1.2 to 1.2.0 and 1 to 1.0.0. If $option is false
        or empty, return $str unchanged.
    
        Assumptions about content of $str: Series of one to three nonnegative numeric
        identifiers separated by dots, optionally followed by a hyphen and
        more string content.
    -->
    <xsl:function name="v:supply-missing-zeros" as="xs:string">
        <xsl:param name="str" as="xs:string"/>
        <xsl:param name="option" as="xs:boolean?"/>
        <xsl:choose>
            <xsl:when test="$option">
                <xsl:variable name="prerelease-part" as="xs:string"
                    select="substring-after($str,'-')"/>
                <xsl:variable name="modified-xyz-part" as="xs:string"
                    select="$str
                    => v:version-to-xyz(true())
                    => string-join('.')
                    "/>
                <xsl:sequence select="
                    if ($prerelease-part != '')
                    then concat($modified-xyz-part, '-', $prerelease-part)
                    else $modified-xyz-part
                    "/>
            </xsl:when>
            <xsl:otherwise>
                <xsl:sequence select="$str"/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:function>

    <!-- Remove leading zeros from numeric identifiers in $str if
        $option is true. If $option is false or empty, return
        $str unchanged.
        
        Assumptions about content of $str: Series of dot-separated
        identifiers, optionally followed by a hyphen and another
        series of dot-separated identifiers.
    -->
    <xsl:function name="v:remove-leading-zeros" as="xs:string">
        <xsl:param name="str" as="xs:string"/>
        <xsl:param name="option" as="xs:boolean?"/>
        <xsl:choose>
            <xsl:when test="$option">
                <xsl:variable name="xyz-part" as="xs:string" select="replace($str, '\-.*$', '')"/>
                <xsl:variable name="prerelease-part" as="xs:string" select="substring-after($str, '-')"/>
                <!-- If $str contains no hyphens, $xyz-part equals $str and $prerelease part equals ''. -->

                <!-- Tokenize string by dots, and remove leading zeros from each identifier
                    that is a nonnegative number with at least one leading zero. -->
                <xsl:variable name="identifier-seq-without-leading-zeros" as="function(*)"
                    select="function($s as xs:string) as xs:string* {
                    for $part in tokenize($s, '\.')
                    return
                        if (matches($part,'^0[0-9]+$'))
                        then xs:string(xs:integer($part))
                        else $part
                    }"/>
                <xsl:variable name="modified-xyz-parts" as="xs:string+"
                    select="$identifier-seq-without-leading-zeros($xyz-part)"/>
                <xsl:variable name="modified-prerelease-parts" as="xs:string*"
                    select="$identifier-seq-without-leading-zeros($prerelease-part)"/>

                <!-- Join the individual identifiers with dots, and then join the xyz string to the 
                    prerelease string with a hyphen. The purpose of the [.] predicate is to
                    make $modified-prerelease-part-or-empty-seq an empty sequence rather than
                    an empty string, in case there is no prerelease part. That way, the return
                    value of this function does not have a trailing hyphen (e.g., 1.2.3-) in that case. -->
                <xsl:variable name="modified-prerelease-part-or-empty-seq" as="xs:string?"
                    select="string-join($modified-prerelease-parts, '.')[.]"/>
                <xsl:sequence select="string-join(
                    (string-join($modified-xyz-parts, '.'), $modified-prerelease-part-or-empty-seq),
                    '-')"/>
            </xsl:when>
            <xsl:otherwise>
                <xsl:sequence select="$str"/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:function>

    <!-- Parse a version string, $ver, and return 3 numbers as strings.
        Choice of error handling:
        * If $supply-missing-zeros is true, use zero for 2nd or 3rd number
          if it is missing from $ver.
        * If $supply-missing-zeros is false, error if 2nd or 3rd number is missing.

        Example: $ver='1.2.3'. Returns ('1', '2', '3').
        Example: $ver='1.2', $supply-missing-zeros=true. Returns ('1', '2', '0').
        Example: $ver='1.2', $supply-missing-zeros=false. Returns error.
        
        Assumptions about content of $ver: Series of one to three nonnegative
        numeric identifiers separated by dots, optionally followed by more
        string content that the function ignores.
    -->
    <xsl:function name="v:version-to-xyz" as="xs:string+">
        <xsl:param name="ver" as="xs:string"/>
        <xsl:param name="supply-missing-zeros" as="xs:boolean"/>
        <xsl:analyze-string select="$ver" regex="^([0-9]+)(\.([0-9]+))?(\.([0-9]+))?">
            <xsl:matching-substring>
                <xsl:sequence select="regex-group(1)"/>
                <xsl:choose>
                    <xsl:when test="$supply-missing-zeros">
                        <!-- Second and third numbers if present, or zero as default-->
                        <xsl:sequence select="(regex-group(3), '0')[.][1]"/>
                        <xsl:sequence select="(regex-group(5), '0')[.][1]"/>
                    </xsl:when>
                    <xsl:otherwise>
                        <!-- Second and third numbers. If either one is not present,
                        these instructions will return an empty string. Note that an
                        empty string cannot be converted to xs:integer. -->
                        <xsl:sequence select="regex-group(3)"/>
                        <xsl:sequence select="regex-group(5)"/>
                    </xsl:otherwise>
                </xsl:choose>
            </xsl:matching-substring>
        </xsl:analyze-string>
    </xsl:function>
</xsl:stylesheet>


================================================
FILE: src/utils/resolver-pipeline/testing/pathological-profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/css" href="../../author/CSS/oscal-author.css" title="Authoring" alternate="no"?>
<?xml-model href="../../schematron/oscal-profile.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-model href="../../../specifications/profile-resolution/example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0" id="pathological-profile">
    <metadata>
        <title>Pathological Profile</title>
        <last-modified>2019-11-13T12:41:07.061-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0-MR2</oscal-version>
    </metadata>
    <!-- random comment -->
    <import href="../../../../specifications/profile-resolution/profile-resolution-examples/catalogs/abc-full_catalog.xml">
        <include >
            <call control-id="a1"/>
        </include>

    </import>
    <import href="../../../../specifications/profile-resolution/profile-resolution-examples/catalogs/abc-full_catalog.xml">
        <include>
            <match pattern="^a"/>
        </include>

    </import>
    <merge>
      <as-is>true</as-is>
    </merge>
</profile>



================================================
FILE: src/utils/resolver-pipeline/testing/test.sh
================================================
Error reading file with 'cp1252': 'charmap' codec can't decode byte 0x9d in position 2822: character maps to <undefined>


================================================
FILE: src/utils/resolver-pipeline/testing/working-catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    id="worksheet">
    <metadata>
        <title>Worksheet Catalog</title>
        <last-modified>2019-12-06T15:00:35.313-05:00</last-modified>
        <version>1.0</version>
        <oscal-version>1.0-MR2</oscal-version>
    </metadata>
    <group>
        <title>Only Group</title>
        <param id="loose">
            <label>Loose parameter</label>
        </param>
        <control id="control_A">
            <title>Control A</title>
            <prop name="somewhat">property</prop>
            <link href="file.xml"><text>A link</text></link>
        </control>
    </group>
</catalog>



================================================
FILE: src/utils/resolver-pipeline/testing/1_selected/catalog-no-uuid.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"/>



================================================
FILE: src/utils/resolver-pipeline/testing/1_selected/catalog-nonstandard-file-name-ext.xmlcat
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0" uuid="xmlcat"/>



================================================
FILE: src/utils/resolver-pipeline/testing/1_selected/glob-rewrite.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    stylesheet="../../oscal-profile-resolve-select.xsl">
    <x:scenario label="Tests for o:glob-as-regex function">
    <x:scenario label="Simple string">
        <x:call function="o:glob-as-regex">
            <x:param>ac</x:param>
        </x:call>
        <x:expect label="Anchored, otherwise the same" select="'^ac$'"/>
    </x:scenario>
    <x:scenario label="More complex string">
        <x:call function="o:glob-as-regex">
            <x:param>ac-1(1)</x:param>
        </x:call>
        <x:expect label="Anchored and escaped" select="'^ac-1\(1\)$'"/>
    </x:scenario>
    <x:scenario label="More complex string, with ?">
        <x:call function="o:glob-as-regex">
            <x:param>ac-1(?)</x:param>
        </x:call>
        <x:expect label="Anchored and escaped with substitution" select="'^ac-1\(.\)$'"/>
    </x:scenario>
    <x:scenario label="This time with *">
        <x:call function="o:glob-as-regex">
            <x:param>ac-1(*)</x:param>
        </x:call>
        <x:expect label="Anchored and escaped with substitution" select="'^ac-1\(.*\)$'"/>
        </x:scenario>
        <x:scenario label="Empty string (degenerate case)">
            <x:call function="o:glob-as-regex">
                <x:param select="''"/>
            </x:call>
            <x:expect label="Anchored empty string" select="'^$'"/>
        </x:scenario>
    </x:scenario>
</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/1_selected/resource-media-type.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../../../specifications/profile-resolution/example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:08.131-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="427f8c54-c3af-4ca3-a92c-f6abaa015ba5">
   <metadata>
      <title>Test Profile with Nonstandard File Name Extension in resource/rlink</title>
      <last-modified>2020-05-30T14:39:37.3-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0-rc2</oscal-version>
   </metadata>
   <import href="#0050231f-4fd0-43d6-8fa0-431367cd83e1">
      <include-all/>
   </import>
   <back-matter>
      <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e1">
         <rlink href="https://some-non-xml-url"/>
         <rlink href="catalog-nonstandard-file-name-ext.xmlcat" media-type="xml"/>
      </resource>
      <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e1">
         <!-- Duplicate uuid is intentional, for testing template with
            mode="o:select" match="import[starts-with(@href,'#')]" -->
         <rlink href="catalog-nonstandard-file-name-ext.xmlcat" media-type="xml"/>
      </resource>
   </back-matter>
</profile>



================================================
FILE: src/utils/resolver-pipeline/testing/1_selected/resource-multiple-rlinks.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../../../specifications/profile-resolution/example-checkup.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- Modified by conversion XSLT 2021-04-05T11:22:08.131-04:00 - RC2 OSCAL becomes RC3 OSCAL -->
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="427f8c54-c3af-4ca3-a92c-f6abaa015ba5">
   <metadata>
      <title>Test Profile with Nonstandard File Name Extension in resource/rlink</title>
      <last-modified>2020-05-30T14:39:37.3-04:00</last-modified>
      <version>1.0</version>
      <oscal-version>1.0.0-rc2</oscal-version>
   </metadata>
   <import href="#0050231f-4fd0-43d6-8fa0-431367cd83e1">
      <include-all/>
   </import>
   <back-matter>
      <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e1">
         <rlink href="catalog-nonstandard-file-name-ext.xmlcat" media-type="xml"/>
         <rlink href="catalog-no-uuid.xml"/>
      </resource>
   </back-matter>
</profile>



================================================
FILE: src/utils/resolver-pipeline/testing/1_selected/select-mapping-controls.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
  xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
  xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
  xmlns:ov="http://csrc.nist.gov/ns/oscal/test/variable"
  xmlns:x="http://www.jenitennison.com/xslt/xspec"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  stylesheet="../../oscal-profile-resolve-select.xsl"
  xslt-version="3.0">

    <!-- This file contains preliminary tests for behavior described in the
        "Mapping Controls" section of the spec. The tests are at an
        "integration" level rather than per-template or per-function level
        because the feature is not implemented yet (i.e., the breakdown
        into templates and functions is not determined).

        Future integration-level or system-level tests should also cover
        updating "all known references to the old ID in other included content,
        allowing the new ID to be used in subsequent profile sections." -->

    <!-- SPEC QUESTION: What are the optional sections of <mapping>
        other than <controls>? Are groups, params, and parts among them?
        https://github.com/usnistgov/OSCAL/discussions/1114
        When this is determined, tests can be added for those sections. -->

    <!-- Location of sample files, relative to this test file -->
    <x:variable name="ov:filedir" as="xs:string" select="resolve-uri('../../../../specifications/profile-resolution/profile-resolution-examples',$x:xspec-uri)"/>

    <x:scenario label="Import controls using ID mapping">
        <x:scenario label="Basic case" pending="Mapping is not implemented yet">
            <x:context mode="o:select">
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls>
                        <with-id>x1</with-id>
                    </include-controls>
                    <mapping>
                        <controls>
                            <map from="x1" to="map-x1"/>
                        </controls>
                    </mapping>
                </import>
            </x:context>
            <x:expect label="Control X1 with id=map-x1">
                <selection uuid="..." opr:src="...">
                    <metadata>...</metadata>
                    <group opr:id="...">
                        <title>Group X of XYZ</title>
                        <control id="map-x1" opr:id="...">
                            <title>Control X1</title>
                        </control>
                    </group>
                    <group opr:id="...">...</group>
                    <group opr:id="...">...</group>
                </selection>
            </x:expect>
            <x:expect label="opr:id of Control X1 has mapped ID after #"
                test="$x:result//o:title[.='Control X1']/parent::o:control/@opr:id ! substring-after(.,'#')"
                select="'map-x1'"/>
        </x:scenario>
        <x:scenario label="Catalog imported twice with different mappings" pending="Mapping is not implemented yet">
            <x:context mode="o:select">
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls>
                        <with-id>x1</with-id>
                    </include-controls>
                    <mapping>
                        <controls>
                            <map from="x1" to="map1-x1"/>
                        </controls>
                    </mapping>
                </import>
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls>
                        <with-id>x1</with-id>
                    </include-controls>
                    <mapping>
                        <controls>
                            <map from="x1" to="map2-x1"/>
                        </controls>
                    </mapping>
                </import>
            </x:context>
            <x:expect label="Control X1 twice with IDs map1-x1 and map2-x1">
                <selection uuid="..." opr:src="...">
                    <metadata>...</metadata>
                    <group opr:id="...">
                        <title>Group X of XYZ</title>
                        <control id="map1-x1" opr:id="...">
                            <title>Control X1</title>
                        </control>
                    </group>
                    <group opr:id="...">...</group>
                    <group opr:id="...">...</group>
                </selection>
                <selection uuid="..." opr:src="...">
                    <metadata>...</metadata>
                    <group opr:id="...">
                        <title>Group X of XYZ</title>
                        <control id="map2-x1" opr:id="...">
                            <title>Control X1</title>
                        </control>
                    </group>
                    <group opr:id="...">...</group>
                    <group opr:id="...">...</group>
                </selection>
            </x:expect>
        </x:scenario>
        <x:scenario label="Partial matching of text" pending="Mapping is not implemented yet">
            <x:context mode="o:select">
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls with-child-controls="yes">
                        <with-id>z3</with-id>
                    </include-controls>
                    <mapping>
                        <controls>
                            <map from="z3.a" to="map-z3.a"/>
                        </controls>
                    </mapping>
                </import>
            </x:context>
            <x:expect label="Control Z3-A has mapped ID, while Z3-A-1 has unchanged ID"
                test="$x:result//o:title[.='Control Z3']/parent::o:control">
                <control id="z3" opr:id="..."><title>Control Z3</title>
                    <control id="map-z3.a" opr:id="..."><title>Control Z3-A</title>
                        <control id="z3.a-1" opr:id="..."><title>Control Z3-A-1</title></control>
                    </control>
                </control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Attempt to use pattern in 'from'">
            <x:context mode="o:select">
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls with-child-controls="yes">
                        <with-id>z3</with-id>
                    </include-controls>
                    <mapping>
                        <controls>
                            <map from="z3*" to="map-z3"/>
                        </controls>
                    </mapping>
                </import>
            </x:context>
            <x:expect label="IDs are unchanged because 'from' must be exact match"
                test="$x:result//o:title[.='Control Z3']/parent::o:control">
                <control id="z3" opr:id="..."><title>Control Z3</title>
                    <control id="z3.a" opr:id="..."><title>Control Z3-A</title>
                        <control id="z3.a-1" opr:id="..."><title>Control Z3-A-1</title></control>
                    </control>
                </control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Multiple mappings from the same ID" pending="Mapping is not implemented yet">
            <x:context mode="o:select">
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls>
                        <with-id>x1</with-id>
                    </include-controls>
                    <mapping>
                        <controls>
                            <map from="x1" to="map-x1"/>
                            <map from="x1" to="map-again-x1"/>
                        </controls>
                    </mapping>
                </import>
            </x:context>
            <x:expect label="ID of Control X1 uses first value (SPEC QUESTION: is that the expected behavior? https://github.com/usnistgov/OSCAL/discussions/1115)"
                test="$x:result//o:title[.='Control X1']/parent::o:control/@id/string()"
                select="'map-x1'"/>
        </x:scenario>
        <x:scenario label="'to' of one mapping matches 'from' of another mapping" pending="Mapping is not implemented yet">
            <x:context mode="o:select">
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls>
                        <with-id>x1</with-id>
                    </include-controls>
                    <mapping>
                        <controls>
                            <map from="x1" to="map-x1"/>
                            <map from="map-x1" to="map-again-x1"/>
                        </controls>
                    </mapping>
                </import>
            </x:context>
            <x:expect label="ID of Control X1 uses 'to' value, ignoring subsequent mapping (SPEC QUESTION: is that the expected behavior? https://github.com/usnistgov/OSCAL/discussions/1115)"
                test="$x:result//o:title[.='Control X1']/parent::o:control/@id/string()"
                select="'map-x1'"/>
        </x:scenario>
        <x:scenario label="'to' ID appears in exclusion directive">
            <x:context mode="o:select">
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls>
                        <with-id>x1</with-id>
                    </include-controls>
                    <exclude-controls>
                        <with-id>map-x1</with-id>
                    </exclude-controls>
                    <mapping>
                        <controls>
                            <map from="x1" to="map-x1"/>
                        </controls>
                    </mapping>
                </import>
            </x:context>
            <x:expect label="Control X1 is included (mapping occurs after exclusion logic) (SPEC QUESTION: is that the expected behavior? https://github.com/usnistgov/OSCAL/discussions/1116)"
                test="exists($x:result//o:title[.='Control X1'])"/>
        </x:scenario>
        <x:scenario label="ID matches but mapping is not for controls">
            <x:context mode="o:select">
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls>
                        <with-id>x1</with-id>
                    </include-controls>
                    <mapping>
                        <params>
                            <map from="x1" to="map-x1"/>
                        </params>
                    </mapping>
                </import>
            </x:context>
            <x:expect label="ID of Control X1 is unchanged"
                test="$x:result//o:title[.='Control X1']/parent::o:control/@id/string()"
                select="'x1'"/>
        </x:scenario>
        <x:scenario label="No applicable mapping">
            <x:context mode="o:select">
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls>
                        <with-id>x1</with-id>
                    </include-controls>
                    <mapping>
                        <controls>
                            <map from="nonexistent" to="map-x1"/>
                        </controls>
                    </mapping>
                </import>
            </x:context>
            <x:expect label="ID of Control X1 is unchanged"
                test="$x:result//o:title[.='Control X1']/parent::o:control/@id/string()"
                select="'x1'"/>
        </x:scenario>
    </x:scenario>

</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/1_selected/select-rlink.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/test/variable"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    stylesheet="../../oscal-profile-resolve-select.xsl">
    
    <!-- Location of sample files, relative to this test file -->
    <x:variable name="ov:filedir" as="xs:string" select="resolve-uri('../../../../specifications/profile-resolution/profile-resolution-examples',$x:xspec-uri)"/>

    <x:scenario label="Direct import by file href">
        <x:context>
            <profile>
                <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                    <include-controls>
                        <with-id>z3</with-id>
                    </include-controls>
                </import>
            </profile>
        </x:context>
        <x:expect label="Control selected from catalog source">
            <profile>
                <selection uuid="..." opr:src="...">
                    <metadata>
                        <title>XYZ Tiny Catalog</title>
                        <last-modified>2020-05-30T14:51:42.355-04:00</last-modified>
                        <version>1.0</version>
                        <oscal-version>1.0.0-rc2</oscal-version>
                    </metadata>
                    <group opr:id="...">
                        <title>Group X of XYZ</title>
                    </group>
                    <group opr:id="...">
                        <title>Group Y of XYZ</title>
                    </group>
                    <group opr:id="...">
                        <title>Group Z of XYZ</title>
                        <control id="z3" opr:id="..."><title>Control Z3</title></control>
                    </group>
                </selection>
            </profile>
        </x:expect>
    </x:scenario>
    <x:scenario label="Indirect import via resource/rlink">
        <x:context>
            <profile>
                <import href="#6e57d296-39c1-4e83-8107-4dcc2ede751b">
                    <include-controls>
                        <with-id>z3</with-id>
                    </include-controls>
                </import>
                <back-matter>
                    <resource uuid="6e57d296-39c1-4e83-8107-4dcc2ede751b">
                        <title>Tiny Catalog</title>
                        <rlink href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml"/>
                    </resource>
                </back-matter>
            </profile>
        </x:context>
        <x:expect label="Control selected from remote resource">
            <profile>
                <selection uuid="..." opr:src="...">
                    <metadata>
                        <title>XYZ Tiny Catalog</title>
                        <last-modified>2020-05-30T14:51:42.355-04:00</last-modified>
                        <version>1.0</version>
                        <oscal-version>1.0.0-rc2</oscal-version>
                    </metadata>
                    <group opr:id="...">
                        <title>Group X of XYZ</title>
                    </group>
                    <group opr:id="...">
                        <title>Group Y of XYZ</title>
                    </group>
                    <group opr:id="...">
                        <title>Group Z of XYZ</title>
                        <control id="z3" opr:id="..."><title>Control Z3</title></control>
                    </group>
                </selection>
                <back-matter>
                    <resource uuid="6e57d296-39c1-4e83-8107-4dcc2ede751b">
                        <title>Tiny Catalog</title>
                        <rlink href="..."/>
                    </resource>
                </back-matter>
            </profile>
        </x:expect>
    </x:scenario>
    <x:scenario label="Indirect import via resource/rlink selecting XML">
        <x:context>
            <profile>
                <import href="#6e57d296-39c1-4e83-8107-4dcc2ede751b">
                    <include-controls>
                        <with-id>z3</with-id>
                    </include-controls>
                </import>
                <back-matter>
                    <resource uuid="6e57d296-39c1-4e83-8107-4dcc2ede751b">
                        <title>Tiny Catalog</title>
                        <rlink href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml"/>
                        <rlink href="{$ov:filedir}/catalogs/xyz-tiny_catalog.json"/>
                    </resource>
                </back-matter>
            </profile>
        </x:context>
        <x:expect label="Control selected from XML remote resource, ignoring JSON resource">
            <profile>
                <selection uuid="..." opr:src="...">
                    <metadata>
                        <title>XYZ Tiny Catalog</title>
                        <last-modified>2020-05-30T14:51:42.355-04:00</last-modified>
                        <version>1.0</version>
                        <oscal-version>1.0.0-rc2</oscal-version>
                    </metadata>
                    <group opr:id="...">
                        <title>Group X of XYZ</title>
                    </group>
                    <group opr:id="...">
                        <title>Group Y of XYZ</title>
                    </group>
                    <group opr:id="...">
                        <title>Group Z of XYZ</title>
                        <control id="z3" opr:id="..."><title>Control Z3</title></control>
                    </group>
                </selection>
                <back-matter>
                    <resource uuid="6e57d296-39c1-4e83-8107-4dcc2ede751b">
                        <title>Tiny Catalog</title>
                        <rlink href="..."/>
                        <rlink href="..."/>
                    </resource>
                </back-matter>
            </profile>
        </x:expect>
    </x:scenario>

</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/1_selected/select.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/test/variable"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    stylesheet="../../oscal-profile-resolve-select.xsl"
    xslt-version="3.0">

    <!-- Location of sample files, relative to this test file -->
    <x:variable name="ov:filedir" as="xs:string" select="resolve-uri('../../../../specifications/profile-resolution/profile-resolution-examples',$x:xspec-uri)"/>

    <x:variable name="ov:unique" as="function(*)"
        select="function($seq as xs:string*) as xs:boolean {
        count($seq) = count(distinct-values($seq))
        }"/>

    <x:variable name="ov:catalog-selection-structure" as="element(o:selection)">
        <selection opr:src="..." uuid="...">
            <metadata>...</metadata>
            <group opr:id="...">...</group>
            <group opr:id="...">...</group>
            <group opr:id="...">...</group>
        </selection>
    </x:variable>

    <x:scenario label="Tests for match='* | @*' template for all modes">
        <x:variable name="ov:arbitrary-element" as="element(arbitrary-element)">
            <arbitrary-element xmlns="" arbitrary-attribute="val">text<child/></arbitrary-element>
        </x:variable>
        <x:scenario label="Element">
            <x:context select="$ov:arbitrary-element"/>
            <x:expect label="Copy" select="$ov:arbitrary-element"/>
        </x:scenario>
        <x:scenario label="Attribute">
            <x:context select="$ov:arbitrary-element/@arbitrary-attribute"/>
            <x:expect label="Copy"
                test="$x:result instance of attribute(arbitrary-attribute) and $x:result/string()='val'"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='comment() | processing-instruction()' template for all modes">
        <x:scenario label="Comment">
            <x:context><!--comment--></x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
        <x:scenario label="Processing instruction">
            <x:context><?pi type="sample" href="file.css"?></x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='profile' template">
        <x:scenario label="Profile root">
            <x:context>
                <profile/>
            </x:context>
    
            <x:expect label="root becomes root">
                <profile/>
            </x:expect>
        </x:scenario>
        <x:scenario label="Profile select empty import">
            <x:context>
                <profile>
                    <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml"/>
                </profile>
            </x:context>
    
            <x:expect label="Include group structure but select no controls">
                <profile>
                    <selection uuid="..." opr:src="...">
                        <metadata>
                            <title>XYZ Tiny Catalog</title>
                            <last-modified>2020-05-30T14:51:42.355-04:00</last-modified>
                            <version>1.0</version>
                            <oscal-version>1.0.0-rc2</oscal-version>
                        </metadata>
                        <group opr:id="...">
                            <title>Group X of XYZ</title>
                        </group>
                        <group opr:id="...">
                            <title>Group Y of XYZ</title>
                        </group>
                        <group opr:id="...">
                            <title>Group Z of XYZ</title>
                        </group>
                    </selection>
                </profile>
            </x:expect>
            <x:expect label="opr:id values are unique"
                test="$x:result//*/@opr:id => $ov:unique()"/>
            <!-- If the pattern of opr:id values isn't worth testing, then delete the next
                variables and assertions. Similar in "Profile select include all" scenario.--> 
            <x:variable name="ov:group_id" as="attribute()+" select="$x:result//o:group/@opr:id"/>
            <x:variable name="ov:catalog_uuid" as="xs:string" select="doc($ov:filedir || '/catalogs/xyz-tiny_catalog.xml')/o:catalog/@uuid"/>
            <x:expect label="Each group has opr:id whose substring before # matches the selection uuid,"
                test="every $id in $ov:group_id satisfies starts-with($id, $id/ancestor::o:selection/@uuid || '#')"/>
            <x:expect label="which matches the original catalog's top-level uuid."
                test="$x:result/o:selection/@uuid = $ov:catalog_uuid"/>
        </x:scenario>
        <x:scenario label="Error case: Profile cannot find catalog" catch="yes">
            <x:context>
                <profile>
                    <import href="nonexistent_catalog.xml"/>
                </profile>
            </x:context>
            <x:expect label="Fatal XSLT error"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
        </x:scenario>
        <x:scenario label="Profile select include all">
            <x:context>
                <profile>
                    <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                        <include-all/>
                    </import>
                </profile>
            </x:context>
            <x:expect label="Select all controls, grouped">
                <profile>
                    <selection uuid="..." opr:src="...">
                        <metadata>...</metadata>
                        <group opr:id="...">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="..."><title>Control X1</title></control>
                            <control id="x2" opr:id="..."><title>Control X2</title></control>
                            <control id="x3" opr:id="..."><title>Control X3</title></control>
                        </group>
                        <group opr:id="...">
                            <title>Group Y of XYZ</title>
                            <control id="y1" opr:id="..."><title>Control Y1</title></control>
                            <control id="y2" opr:id="..."><title>Control Y2</title></control>
                            <control id="y3" opr:id="..."><title>Control Y3</title></control>
                        </group>
                        <group opr:id="...">
                            <title>Group Z of XYZ</title>
                            <control id="z1" opr:id="..."><title>Control Z1</title></control>
                            <control id="z2" opr:id="..."><title>Control Z2</title></control>
                            <control id="z3" opr:id="..."><title>Control Z3</title>
                                <control id="z3.a" opr:id="..."><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="..."><title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                </profile>
            </x:expect>
            <x:expect label="opr:id values are unique"
                test="$x:result//*/@opr:id => $ov:unique()"/>
            <x:variable name="ov:control_id" as="attribute()+" select="$x:result//o:control/@opr:id"/>
            <x:variable name="ov:catalog_uuid" as="xs:string" select="doc($ov:filedir || '/catalogs/xyz-tiny_catalog.xml')/o:catalog/@uuid"/>
            <x:expect label="Each control has opr:id whose substring before # matches the selection uuid,"
                test="every $id in $ov:control_id satisfies starts-with($id, $id/ancestor::o:selection/@uuid || '#')"/>
            <x:expect label="which matches the original catalog's top-level uuid."
                test="$x:result/o:selection/@uuid = $ov:catalog_uuid"/>
        </x:scenario>
        <x:scenario label="Profile select include call control-id">
            <x:variable name="ov:profile-using-with-id" as="element(o:profile)">
                <profile>
                    <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                        <include-controls>
                            <with-id>x2</with-id>
                            <with-id>x1</with-id>
                        </include-controls>
                    </import>
                </profile>
            </x:variable>
            <x:context select="$ov:profile-using-with-id"/>
            <x:expect label="Control x1 and x2, in their group, with other groups empty">
                <profile>
                    <selection uuid="..." opr:src="...">
                        <metadata>...</metadata>
                        <group opr:id="...">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="..."><title>Control X1</title></control>
                            <control id="x2" opr:id="..."><title>Control X2</title></control>
                        </group>
                       <group opr:id="..."><title>Group Y of XYZ</title></group>
                       <group opr:id="..."><title>Group Z of XYZ</title></group>
                   </selection>
                </profile>
            </x:expect>
            <!-- Assertions about the order of controls in output catalog are relevant for merge phase. -->
            <x:expect label="Order of controls in output is x1, x2 as in the input catalog."
                test="$x:result//o:control/@id/string()" select="('x1','x2')"/>
            <x:expect label="In this case, order of controls in output does not match order of with-id elements in profile."
                test="not(deep-equal($x:result//o:control/@id/string(), $ov:profile-using-with-id//o:control/@id/string()))"/>
        </x:scenario>
    
        <x:scenario label="Profile select include call match">
            <x:context>
                <profile>
                    <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                        <include-controls>
                            <!-- any x control -->
                            <matching pattern="x*"/>
                        </include-controls>
                    </import>
                </profile>
            </x:context>
    
            <x:expect label="The x controls, matched as such">
                <profile>
                    <selection uuid="..." opr:src="...">
                        <metadata>...</metadata>
                        <group opr:id="...">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="..."><title>Control X1</title></control>
                            <control id="x2" opr:id="..."><title>Control X2</title></control>
                            <control id="x3" opr:id="..."><title>Control X3</title></control>
                        </group>
                        <group opr:id="..."><title>Group Y of XYZ</title></group>
                        <group opr:id="..."><title>Group Z of XYZ</title></group>
                    </selection>
                </profile>
            </x:expect>
        </x:scenario>
    
        <x:scenario label="Profile implicit select all, excluding x1 y1 z1">
            <x:context>
                <profile>
                    <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                        <include-all/>
                        <exclude-controls>
                            <with-id>x1</with-id>
                            <with-id>y1</with-id>
                            <with-id>z1</with-id>
                        </exclude-controls>
                    </import>
                </profile>
            </x:context>
    
            <x:expect label="All controls but x1,y1,z1, grouped">
                <profile>
                    <selection uuid="..." opr:src="...">
                        <metadata>...</metadata>
                        <group opr:id="...">
                            <title>Group X of XYZ</title>
                            <control id="x2" opr:id="..."><title>Control X2</title></control>
                            <control id="x3" opr:id="..."><title>Control X3</title></control>
                        </group>
                        <group opr:id="...">
                            <title>Group Y of XYZ</title>
                            <control id="y2" opr:id="..."><title>Control Y2</title></control>
                            <control id="y3" opr:id="..."><title>Control Y3</title></control>
                        </group>
                        <group opr:id="...">
                            <title>Group Z of XYZ</title>
                            <control id="z2" opr:id="..."><title>Control Z2</title></control>
                            <control id="z3" opr:id="..."><title>Control Z3</title>
                                <control id="z3.a" opr:id="..."><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="..."><title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                </profile>
            </x:expect>
        </x:scenario>
    
        <x:scenario label="Recursive 'with-child-controls'">
            <x:context>
                <profile>
                    <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                        <include-controls with-child-controls="yes">
                            <with-id>z3</with-id>
                        </include-controls>
                    </import>
                </profile>
            </x:context>
    
            <x:expect label="Only the Z3 control, with all control descendants">
                <profile>
                    <selection uuid="..." opr:src="...">
                        <metadata>...</metadata>
                        <group opr:id="...">
                            <title>Group X of XYZ</title>
                        </group>
                        <group opr:id="...">
                            <title>Group Y of XYZ</title>
                        </group>
                        <group opr:id="...">
                            <title>Group Z of XYZ</title>
                            <control id="z3" opr:id="..."><title>Control Z3</title>
                                <control id="z3.a" opr:id="..."><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="..."><title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                </profile>
            </x:expect>
        </x:scenario>

        <x:scenario label="Nondefault value of 'with-parent-controls' (no)">
            <x:context>
                <profile>
                    <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                        <include-controls with-parent-controls="no">
                            <with-id>z3.a-1</with-id>
                        </include-controls>
                    </import>
                </profile>
            </x:context>
            
            <x:expect label="Control Z3-A-1 without its ancestor controls">
                <profile>
                    <selection uuid="..." opr:src="...">
                        <metadata>...</metadata>
                        <group opr:id="...">
                            <title>Group X of XYZ</title>
                        </group>
                        <group opr:id="...">
                            <title>Group Y of XYZ</title>
                        </group>
                        <group opr:id="...">
                            <title>Group Z of XYZ</title>
                            <control id="z3.a-1" opr:id="..."><title>Control Z3-A-1</title></control>
                        </group>
                    </selection>
                </profile>
            </x:expect>
        </x:scenario>

        <x:scenario label="Doubled import, exclusive call">
            <x:context>
                <profile>
                    <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                        <include-controls>
                            <with-id>x1</with-id>
                        </include-controls>
                    </import>
                    <import href="{$ov:filedir}/catalogs/xyz-tiny_catalog.xml">
                        <include-controls>
                            <with-id>y1</with-id>
                        </include-controls>
                    </import>
                </profile>
            </x:context>
    
            <x:expect label="Showing two control selections">
                <profile>
                    <selection uuid="..." opr:src="...">
                        <metadata>...</metadata>
                        <group opr:id="...">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="..."><title>Control X1</title></control>
                        </group>
                        <group opr:id="..."><title>Group Y of XYZ</title></group>
                        <group opr:id="..."><title>Group Z of XYZ</title></group>
                    </selection>
                    <selection uuid="..." opr:src="...">
                        <metadata>...</metadata>
                        <group opr:id="...">
                            <title>Group X of XYZ</title>
                        </group>
                        <group opr:id="...">
                            <title>Group Y of XYZ</title>
                            <control id="y1" opr:id="..."><title>Control Y1</title></control>
                        </group>
                        <group opr:id="..."><title>Group Z of XYZ</title></group>
                    </selection>
                </profile>
            </x:expect>
            <x:expect label="In this implementation, the doubled import makes the group IDs non-unique"
                test="$x:result//o:group/@opr:id => $ov:unique() => not()"/>
            <x:expect label="In this implementation, the doubled import makes the selection UUIDs non-unique"
                test="$x:result//o:selection/@uuid => $ov:unique() => not()"/>
            <x:expect label="Within each selection, opr:id values are unique"
                test="every $sel in $x:result//o:selection satisfies $sel//*/@opr:id => $ov:unique()"/>
        </x:scenario>
    
        <x:scenario label="Loose parameters">
            <x:context>
                <profile>
                    <import href="{$ov:filedir}/catalogs/abc-full_catalog.xml">
                        <include-controls>
                            <with-id>a1</with-id>
                            <with-id>b1</with-id>
                        </include-controls>
                    </import>
                </profile>
            </x:context>
    
            <x:expect label="Two controls in three groups with back matter and loose parameters">
                <profile>
                    <selection uuid="..." opr:src="...">
                        <metadata>...</metadata>
                        <group opr:id="...">
                            <title>Group A of C</title>
                            <param id="param-A.a" opr:id="...">
                                <label>A.a parameter</label>
                                <value>A.a value</value>
                            </param>
                            <param id="param-A.b" opr:id="...">
                                <select>
                                    <choice>A.b parameter selection choice 1</choice>
                                    <choice>A.b parameter selection choice 2</choice>
                                    <choice>A.b parameter selection choice 3</choice>
                                </select>
                            </param>
                            <control id="a1" opr:id="...">
                                <title>Control A1</title>
                                <param id="param-a1.a" opr:id="...">
                                    <label>a1.a parameter</label>
                                    <value>a1.a value</value>
                                </param>
                                <prop name="label" value="1st"/>
                                <part name="statement" id="a1-stmt">
                                    <p>A1 aaaaa aaaaaaaaaa</p>
                                    <p>Parameter A.a is set: <insert type="param" id-ref="param-A.a"/></p>
                                    <p>Parameter a1.a is set: <insert type="param" id-ref="param-a1.a"/></p>
                                </part>
                            </control>
                        </group>
                        <group opr:id="...">
                            <title>Group B of C</title>
                            <control id="b1" opr:id="...">
                                <title>Control B1</title>
                                <prop name="label" value="4th"/>
                                <part name="statement" id="b1-stmt">
                                    <p>B1 bbbb bbbbbbb.</p>
                                </part>
                            </control>
                        </group>
                        <group opr:id="...">
                            <title>Group C of C</title>
                        </group>
                        <back-matter>
                            <resource uuid="...">
                                <citation>
                                    <text>A citation to an out of line document.</text>
                                </citation>
                            </resource>
                            <resource uuid="...">
                                <citation>
                                    <text>A citation to an out of line document.</text>
                                </citation>
                            </resource>
                            <resource uuid="...">
                                <prop name="keep" value="always"/>
                                <citation>
                                    <text>A citation to an out of line document.</text>
                                </citation>
                            </resource>
                        </back-matter>
                    </selection>
                </profile>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='profile' mode='o:select' template">
        <!-- Tests for this template are incomplete. When it is decided whether to keep this
            approach, we can add more test scenarios.-->
        <x:scenario label="Profile that calls itself" catch="yes" pending="Returns nothing now">
            <x:context mode="o:select" select="doc($ov:filedir || '/base-test_profile.xml')/o:profile">
                <x:param name="uri-stack" tunnel="yes"
                    select="xs:anyURI($ov:filedir || '/base-test_profile.xml')"/>
            </x:context>
            <x:expect label="Fatal XSLT error due to circular reference"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
        </x:scenario>
        <x:scenario label="Profile that calls a distinct profile"
            pending="Not implemented yet; revisit later">
            <x:context mode="o:select" select="doc($ov:filedir || '/base2-test_profile.xml')/o:profile">
                <x:param name="uri-stack" tunnel="yes"
                    select="xs:anyURI($ov:filedir || '/base-test_profile.xml')"/>
            </x:context>
            <x:expect label="Catalog">
                <catalog uuid="...">...</catalog>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='catalog' mode='o:select' template">
        <x:scenario label="Catalog document">
            <x:context mode="o:select" select="doc($ov:filedir || '/catalogs/xyz-tiny_catalog.xml')//o:catalog">
                <x:param name="import-instruction" tunnel="yes">
                    <import/>
                </x:param>
            </x:context>
            <x:expect label="Selection from catalog"
                select="$ov:catalog-selection-structure"/>
        </x:scenario>
        <x:scenario label="Catalog with attributes from various namespaces">
            <x:context mode="o:select">
                <o:catalog uuid="val" y:attr1="val1" z:attr2="val2" xmlns:y="some-ns" xmlns:z="http://www.w3.org/2001/XMLSchema-instance"/>
            </x:context>
            <x:expect label="Attributes other than from XMLSchema-instance namespace get copied">
                <selection opr:src="..." uuid="val" y:attr1="val1" xmlns:y="some-ns"/>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='import[starts-with(@href,'#')]' mode='o:select' template">
        <x:scenario label="import element matches resource element">
            <x:context mode="o:select" select="(doc($ov:filedir || '/base2-test_profile.xml')//o:import)[1]"/>
            <x:expect label="Selection from linked catalog"
                select="$ov:catalog-selection-structure"/>
        </x:scenario>
        <x:scenario label="import element matches multiple resource elements">
            <x:context mode="o:select" href="resource-media-type.xml"
                select="(//o:import)[1]"/>
            <x:expect label="One selection from linked catalog, per matching resource element">
                <selection opr:src="..." uuid="xmlcat">...</selection>
                <selection opr:src="..." uuid="xmlcat">...</selection>
            </x:expect>
        </x:scenario>
        <x:scenario label="import element does not match resource element">
            <!-- QUESTION: Is the behavior correct? https://github.com/usnistgov/OSCAL/issues/1079 -->
            <x:context mode="o:select">
                <import href="#nonexistent"/>
            </x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='resource' mode='o:import' template">
        <x:scenario label="Select rlink by href alone">
            <x:context mode="o:import" select="(doc($ov:filedir || '/base2-test_profile.xml')//o:resource)[1]">
                <x:param name="import-instruction" tunnel="yes">
                    <import/>
                </x:param>
            </x:context>
            <!-- Above, $import-instruction tunnel param is required by dowstream template. -->
            <x:expect label="Selection from linked catalog"
                select="$ov:catalog-selection-structure"/>
        </x:scenario>
        <x:scenario label="Select rlink by media-type attribute">
            <x:context mode="o:import" href="resource-media-type.xml"
                select="(//o:resource)[1]"/>
            <x:expect label="Selection from linked catalog">
                <selection opr:src="..." uuid="...">...</selection>
            </x:expect>
        </x:scenario>
        <x:scenario label="Multiple viable rlink children">
            <x:context mode="o:import" href="resource-multiple-rlinks.xml"
                select="(//o:resource)[1]"/>
            <x:expect label="Selection based on first viable rlink">
                <selection opr:src="..." uuid="xmlcat">...</selection>
            </x:expect>
        </x:scenario>
        <x:scenario label="Error case: No rlink child with suitable href or media-type" catch="yes">
            <x:context mode="o:import">
                <resource uuid="foo">
                    <rlink href="foo.json"/>
                </resource>
            </x:context>
            <x:variable name="ov:expected_error" as="xs:string">Document not acquired for resource with uuid foo: No rlink with media-type='xml' or href ending with '.xml'</x:variable>
            <x:expect label="Fatal XSLT error"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            <!-- The next assertion requires a newer XSpec version; passes in Oxygen v24, fails in Oxygen v22.1 -->
            <x:expect label="with message specific to situation"
                test="$x:result('err')('value')/string()"
                select="$ov:expected_error"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='import' mode='o:select' template">
        <x:scenario label="Resource is available">
            <x:context mode="o:select"
                select="(doc($ov:filedir || '/base-test_profile.xml')//o:import)[1]"/>
            <x:expect label="Selection from imported catalog"
                select="$ov:catalog-selection-structure"/>
        </x:scenario>
        <x:scenario label="Error case: Resource is not available" catch="yes">
            <x:context mode="o:select"
                select="(doc($ov:filedir || '/broken_profile.xml')//o:import)[1]"/>
            <x:expect label="Fatal XSLT error"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
        </x:scenario>
        <x:scenario label="Error case: Resource reference is circular" catch="yes" pending="XSLT needs to catch up to spec">
            <x:context mode="o:select"
                select="(doc($ov:filedir || '/circular_profile.xml')//o:import)[1]"/>
            <x:expect label="Fatal XSLT error"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
        </x:scenario>
        <x:scenario label="Error case: href is not castable as xs:anyURI" catch="yes">
            <x:context mode="o:select"><import/></x:context>
            <x:expect label="Fatal XSLT error"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='group' mode='o:select' template">
        <x:context mode="o:select" select="//o:group">
            <catalog uuid="catalog-uuid">
               <group attr="val">
                   <title>Group X of XYZ</title>
               </group>
            </catalog>
        </x:context>
        <x:expect label="Copy of element with opr:id inserted">
            <group attr="val" opr:id="...">
                <title>Group X of XYZ</title>
            </group>
        </x:expect>
    </x:scenario>

    <x:scenario label="Tests for add-process-id template">
        <x:scenario label="Context element has id">
            <x:context select="//o:control">
                <catalog uuid="catalog-uuid">
                    <control id="control-id"/>
                </catalog>
            </x:context>
            <x:call template="add-process-id"/>
            <x:expect label="opr:id attribute"
                test="$x:result instance of attribute(opr:id)"/>
            <x:expect label="whose value is hash-separated join of catalog uuid and context id"
                test="$x:result/string()" select="'catalog-uuid#control-id'"/>
        </x:scenario>
        <x:scenario label="Context element lacks id">
            <x:context select="//o:control">
                <catalog uuid="catalog-uuid">
                    <control/>
                </catalog>
            </x:context>
            <x:call template="add-process-id"/>
            <x:expect label="opr:id attribute"
                test="$x:result instance of attribute(opr:id)"/>
            <x:expect label="whose value is hash-separated join of catalog uuid and a generated id"
                test="matches($x:result/string(), 'catalog-uuid#.+')"/>
        </x:scenario>
    </x:scenario>
    
    <x:scenario label="Tests for opr:catalog-identifier function">
        <x:scenario label="Catalog has uuid">
            <x:call function="opr:catalog-identifier">
                <x:param>
                    <catalog uuid="abc"/>
                </x:param>
            </x:call>
            <x:expect label="Returns uuid" select="'abc'"/>
        </x:scenario>
        <x:scenario label="Catalog lacks uuid">
            <x:call function="opr:catalog-identifier">
                <x:param href="catalog-no-uuid.xml" select="/o:catalog"/>
            </x:call>
            <x:expect label="Returns base URI of catalog" test="ends-with($x:result,'/catalog-no-uuid.xml')"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='control' mode='o:select' template">
        <x:scenario label="Control is selected">
            <!--Below, $import-instruction is an <import> element that
                selects the control with id="a1" and the context node
                has id="a1". -->
            <x:context mode="o:select"
                select="doc($ov:filedir || '/catalogs/abc-simple_catalog.xml')//o:control[@id='a1']">
                <x:param name="import-instruction" tunnel="yes"
                    select="(doc($ov:filedir || '/base2-test_profile.xml')//o:import)[1]"/>
            </x:context>
            <x:expect label="Copy of control element with opr:id inserted">
                <control id="a1" opr:id="...">...</control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Control is not selected">
            <x:context mode="o:select">
                <x:param name="import-instruction" tunnel="yes">
                    <import/>
                </x:param>
                <control id="x1"/>
            </x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
        <x:scenario label="Control is not selected but its child controls are selected">
            <!--Below, $import-instruction is an <import> element that
                selects children a1.a and a1.c of the control with id="a1",
                and the context node has id="a1". -->
            <x:context mode="o:select"
                select="doc($ov:filedir || '/catalogs/abc-multiple-children_catalog.xml')//o:control[@id='a1']">
                <x:param name="import-instruction" tunnel="yes"
                    select="(doc($ov:filedir || '/without-parent_profile.xml')//o:import)[1]"/>
            </x:context>
            <x:expect label="Copy of selected child control elements with opr:id inserted">
                <control id="a1.a" opr:id="...">...</control>
                <control id="a1.c" opr:id="...">...</control>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match='param' mode='o:select' template">
        <x:context mode="o:select" select="//o:param">
            <catalog uuid="catalog-uuid">
                <!--Skip metadata because not relevant for this scenario.-->
                <control id="a1">
                    <title>Control A1</title>
                    <param id="a1_prm1">
                        <label>A1 Parameter 1</label>
                    </param>
                </control>
            </catalog>
        </x:context>
        <x:expect label="Copy of param element with opr:id inserted">
            <param id="a1_prm1" opr:id="...">
                <label>A1 Parameter 1</label>
            </param>
        </x:expect>
    </x:scenario>

    <x:scenario label="Tests for o:selects function">
        <x:variable name="ov:control-hierarchy" as="element(o:control)">
            <control id="level-one">
                <control id="level-two">
                    <control id="level-three">
                        <control id="level-four"/>
                    </control>
                </control>
            </control>
        </x:variable>
        <x:scenario label="Test each include reason, with no exclude reasons. ">
            <x:scenario label="Include all.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control/>
                    </x:param>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Include all, omit with-child-controls, and candidate is descendant.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-two']"/>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Select by ID.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls>
                                <with-id>abc</with-id>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="abc"/>
                    </x:param>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Select by ID, but candidate does not match.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls>
                                <with-id>abc</with-id>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="nonmatch"/>
                    </x:param>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Select descendant ID and do not include parent controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls with-parent-controls="no">
                                <with-id>level-four</with-id>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-two']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Select ancestor ID and include child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls with-child-controls="yes">
                                <with-id>level-two</with-id>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Select ancestor ID, omitting with-child-controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls>
                                <with-id>level-two</with-id>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="false (with-child-controls defaults to no)" select="false()"/>
            </x:scenario>
            <x:scenario label="Select ancestor ID and do not include child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls with-child-controls="no">
                                <with-id>level-two</with-id>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Match ID.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls>
                                <matching pattern="ab*"/>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="abc"/>
                    </x:param>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Try to match ID, but candidate is not a match.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls>
                                <matching pattern="ab*"/>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="nonmatch"/>
                    </x:param>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="matching object with no pattern.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls>
                                <matching/>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="abc"/>
                    </x:param>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="matching object with empty string as pattern.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls>
                                <matching pattern=""/>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id=""/>
                    </x:param>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Match descendant ID, without parent controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls with-parent-controls="no">
                                <matching pattern="*-four"/>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-two']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Match ancestor ID, omitting with-child-controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls>
                                <matching pattern="*-two"/>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="false (with-child-controls defaults to no)" select="false()"/>
            </x:scenario>
            <x:scenario label="Match ancestor ID, with child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls with-child-controls="yes">
                                <matching pattern="*-two"/>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Match ancestor ID, without child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls with-child-controls="no">
                                <matching pattern="*-two"/>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Include grandparent with child controls, and include parent without child controls">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls with-child-controls="yes">
                                <with-id>level-two</with-id>
                            </include-controls>
                            <include-controls with-child-controls="no">
                                <with-id>level-three</with-id>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate"
                        select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Provide an include reason, and test each exclude reason. ">
            <x:scenario label="Include all, but explicitly not with child controls, and candidate is descendant.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all with-child-controls="no"/>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-two']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Exclude by ID.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls>
                                <with-id>abc</with-id>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="abc"/>
                    </x:param>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Exclude by ID but candidate does not match.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls>
                                <with-id>abc</with-id>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="nonmatch"/>
                    </x:param>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Exclude ancestor ID, omitting with-child-controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls>
                                <with-id>level-two</with-id>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="true (with-child-controls defaults to no)" select="true()"/>
            </x:scenario>
            <x:scenario label="Exclude ancestor ID and child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls with-child-controls="yes">
                                <with-id>level-two</with-id>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Exclude ancestor ID without child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls with-child-controls="no">
                                <with-id>level-two</with-id>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Include grandparent with child controls, and exclude parent with child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls with-child-controls="yes">
                                <with-id>level-two</with-id>
                            </include-controls>
                            <exclude-controls with-child-controls="yes">
                                <with-id>level-three</with-id>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate"
                        select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Include grandparent with child controls, and exclude parent without excluding child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls with-child-controls="yes">
                                <with-id>level-two</with-id>
                            </include-controls>
                            <exclude-controls with-child-controls="no">
                                <with-id>level-three</with-id>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate"
                        select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Match ID.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls>
                                <matching pattern="ab*"/>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="abc"/>
                    </x:param>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Try to match ID, but candidate is not a match.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls>
                                <matching pattern="ab*"/>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="nonmatch"/>
                    </x:param>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="matching object with no pattern.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls>
                                <matching pattern=""/>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id="abc"/>
                    </x:param>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="matching object with empty string as pattern.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls>
                                <matching pattern=""/>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate">
                        <control id=""/>
                    </x:param>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Match descendant ID, without parent controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls with-parent-controls="no">
                                <matching pattern="*-four"/>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-two']"/>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
            <x:scenario label="Match ancestor ID, omitting with-child-controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls>
                                <matching pattern="*-two"/>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="true (with-child-controls defaults to no)" select="true()"/>
            </x:scenario>
            <x:scenario label="Match ancestor ID, with child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls with-child-controls="yes">
                                <matching pattern="*-two"/>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="Match ancestor ID, without child controls.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-all/>
                            <exclude-controls with-child-controls="no">
                                <matching pattern="*-two"/>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="true" select="true()"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Spot-check that having multiple include reasons is fine.">
            <x:call function="o:selects">
                <x:param name="importing">
                    <import>
                        <include-controls with-child-controls="yes">
                            <matching pattern="*-two"/>
                        </include-controls>
                        <include-controls>
                            <with-id>level-four</with-id>
                        </include-controls>
                    </import>
                </x:param>
                <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
            </x:call>
            <x:expect label="true" select="true()"/>
        </x:scenario>
        <x:scenario label="Spot-check that having multiple exclude reasons is fine.">
            <x:call function="o:selects">
                <x:param name="importing">
                    <import>
                        <exclude-controls with-child-controls="yes">
                            <matching pattern="*-two"/>
                        </exclude-controls>
                        <exclude-controls>
                            <with-id>level-four</with-id>
                        </exclude-controls>
                    </import>
                </x:param>
                <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
            </x:call>
            <x:expect label="false" select="false()"/>
        </x:scenario>
        <x:scenario label="Spot-check that exclude reasons override include reasons, ">
            <x:scenario label="if exclude reason appears first.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <exclude-controls>
                                <with-id>level-four</with-id>
                            </exclude-controls>
                            <include-controls>
                                <with-id>level-four</with-id>
                            </include-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
            <x:scenario label="if exclude reason appears second.">
                <x:call function="o:selects">
                    <x:param name="importing">
                        <import>
                            <include-controls>
                                <with-id>level-four</with-id>
                            </include-controls>
                            <exclude-controls>
                                <with-id>level-four</with-id>
                            </exclude-controls>
                        </import>
                    </x:param>
                    <x:param name="candidate" select="$ov:control-hierarchy//o:control[@id='level-four']"/>
                </x:call>
                <x:expect label="false" select="false()"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Edge case of no import instructions">
            <x:call function="o:selects">
                <x:param name="importing">
                    <import/>
                </x:param>
                <x:param name="candidate">
                    <control/>
                </x:param>
            </x:call>
            <x:expect label="false" select="false()"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for o:calls-children function">
        <x:scenario label="with-child-controls attribute is 'yes'">
            <x:call function="o:calls-children">
                <x:param>
                    <elem with-child-controls="yes"/>
                </x:param>
            </x:call>
            <x:expect label="true" select="true()"/>
        </x:scenario>
        <x:scenario label="with-child-controls attribute is 'no'">
            <x:call function="o:calls-children">
                <x:param>
                    <elem with-child-controls="no"/>
                </x:param>
            </x:call>
            <x:expect label="false" select="false()"/>
        </x:scenario>
        <x:scenario label="with-child-controls attribute is omitted">
            <x:call function="o:calls-children">
                <x:param>
                    <elem/>
                </x:param>
            </x:call>
            <x:expect label="false" select="false()"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for o:resource-or-error function">
        <x:scenario label="Document is available">
            <x:call function="o:resource-or-error">
                <x:param select="(doc($ov:filedir || '/base-test_profile.xml')//o:import)[1]/@href"/>
            </x:call>
            <x:expect label="Resolved document" test="exists($x:result/self::document-node()/o:catalog)"/>
        </x:scenario>
        <x:scenario label="Error case: Document is not available" catch="yes">
            <x:call function="o:resource-or-error">
                <x:param select="(doc($ov:filedir || '/broken_profile.xml')//o:import)[1]/@href"/>
            </x:call>
            <x:expect label="Fatal XSLT error"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
        </x:scenario>
    </x:scenario>
    
    <x:scenario label="Tests for o:resolve-profile function" pending="incomplete">
        <!-- Intended for the case where an profile imports another profile,
            this function is not in use yet. For now, just test that the
            function can run. When it is decided whether to keep this
            approach, we can add more test scenarios. -->
        <x:scenario label="Sanity check">
            <x:call function="o:resolve-profile">
                <x:param name="profile">
                    <o:profile href="{$ov:filedir}/base-test_profile.xml"/>
                </x:param>
                <x:param name="uri-stack" select="xs:anyURI($ov:filedir || '/base-test_profile.xml')"/>
            </x:call>
            <x:expect label="Catalog">
                <catalog uuid="...">...</catalog>
            </x:expect>
        </x:scenario>
    </x:scenario>
</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/2_metadata/metadata.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description
    xmlns="http://csrc.nist.gov/ns/oscal/1.0"    
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/xspec/variable"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    run-as="external"
    stylesheet="../../oscal-profile-resolve-metadata.xsl">
    
    <!-- In this file, the purpose of run-as="external" is to enable
        individual scenarios to specify values of global XSLT
        parameters. -->

    <x:variable name="ov:sample-output-from-pipeline-step-1" as="element(o:profile)">
        <profile uuid="cb1ec926-3441-458f-8cce-ea11308c9d37">
            <metadata>
                <title>Test Profile</title>
                <last-modified>2021-05-30T14:39:35.84-04:00</last-modified>
                <version>1.3</version>
                <oscal-version>1.0.1</oscal-version>
            </metadata>
            <selection uuid="6498eb6e-8653-4470-8b97-54054d3ba886" opr:src="some-value">
                <metadata>
                    <title>XYZ Tiny Catalog</title>
                    <last-modified>2020-05-30T14:51:42.355-04:00</last-modified>
                    <version>1.0</version>
                    <oscal-version>1.0.0</oscal-version>
                    <prop name="catalog-required" value="some value"/>
                    <link href="#catalog-internal"><text>Internal link within catalog</text></link>
                </metadata>
                <group opr:id="some-id">
                    <title>Group X of XYZ</title>
                </group>
            </selection>
        </profile>
    </x:variable>

    <x:scenario label="Tests for match='/ | * | @*' template for all modes">
        <x:variable name="ov:arbitrary-element" as="element(arbitrary-element)">
            <arbitrary-element xmlns="" arbitrary-attribute="val">text<child/></arbitrary-element>
        </x:variable>
        <x:scenario label="Element">
            <x:context select="$ov:arbitrary-element"/>
            <x:expect label="Copy" select="$ov:arbitrary-element"/>
        </x:scenario>
        <x:scenario label="Attribute">
            <x:context select="$ov:arbitrary-element/@arbitrary-attribute"/>
            <x:expect label="Copy"
                test="$x:result instance of attribute(arbitrary-attribute) and $x:result/string()='val'"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=profile template">
        <x:variable name="ov:top-uuid" as="xs:string"
            select="'12345678-90AB-4CDE-a012-bcdef0123456'"/>
        <x:param name="profile-origin-uri" select="'urn:UNKNOWN/some-profile-filename.xml'"/>
        <x:context>
            <profile uuid="test"/>
        </x:context>
        <x:scenario label="Basic case">
            <x:param name="top-uuid" select="$ov:top-uuid"/>
            <x:param name="uuid-method" select="'user-provided'"/>
            <x:expect label="Catalog uses specified uuid"
                test="/o:catalog/@uuid/string()" select="$ov:top-uuid"/>
        </x:scenario>
        <x:scenario label="selection/metadata has prop and link children">
            <x:context select="$ov:sample-output-from-pipeline-step-1"/>            
            <x:expect label="Source catalog prop does not leak into output catalog metadata"
                test="exists(/o:catalog/o:metadata) and
                empty(/o:catalog/o:metadata/o:prop[@name='catalog-required'])"/>
            <x:expect label="Source catalog link does not leak into output catalog metadata"
                test="exists(/o:catalog/o:metadata) and
                empty(/o:catalog/o:metadata/o:link[@href='#catalog-internal'])"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=profile/metadata template">
        <x:scenario label="Simple case">
            <x:context select="$ov:sample-output-from-pipeline-step-1/o:metadata"/>
            <x:expect label="Metadata includes profile version, resolution-tool prop, and source-profile link">
                <metadata>
                    <title>Test Profile</title>
                    <last-modified>...</last-modified>
                    <version>1.3</version>
                    <oscal-version>...</oscal-version>
                    <prop name="resolution-tool" value="OSCAL Profile Resolver XSLT Pipeline OPRXP" />
                    <link href="urn:UNKNOWN" rel="source-profile" />
                </metadata>
            </x:expect>
            <x:expect label="version value matches version of source profile"
                test="/o:metadata/o:version/string()" select="'1.3'"/>
        </x:scenario>
        <x:scenario label="profile/metadata has additional children, 'leader' and others">
            <x:context select="/o:profile/o:metadata">
                <profile uuid="pathological-profile">
                    <metadata>
                        <title>Pathological Profile</title>
                        <published>2019-11-13T12:41:07.061-05:00</published>
                        <last-modified>2019-11-13T12:41:07.061-05:00</last-modified>
                        <version>1.0</version>
                        <oscal-version>1.0-rc2</oscal-version>
                        <document-id scheme="https://www.doi.org/">...doi...</document-id>
                        <party>
                            <org>
                                <org-name>Standing Committee</org-name>
                            </org>
                        </party>
                    </metadata>
                </profile>
            </x:context>            
            <x:expect label="resolution-tool and source-profile are between last 'leader' (document-id) and 'everything else' (party)">
                <metadata>
                    <title>...</title>
                    <published>2019-11-13T12:41:07.061-05:00</published>
                    <last-modified>...</last-modified>
                    <version>...</version>
                    <oscal-version>...</oscal-version>
                    <document-id scheme="https://www.doi.org/">...doi...</document-id>
                    <prop name="resolution-tool" value="..."/>
                    <link href="urn:UNKNOWN" rel="source-profile"/>
                    <party>
                        <org>
                            <org-name>Standing Committee</org-name>
                        </org>
                    </party>
                </metadata>
            </x:expect>
        </x:scenario>
        <x:scenario label="profile/metadata has prop child">
            <x:context select="/o:profile/o:metadata">
                <profile uuid="pathological-profile">
                    <metadata>
                        <title>Pathological Profile</title>
                        <last-modified>2019-11-13T12:41:07.061-05:00</last-modified>
                        <version>1.0</version>
                        <oscal-version>1.0-rc2</oscal-version>
                        <prop name="required" value="some value"/>
                        <prop name="optional" value="some other value"/>
                    </metadata>
                </profile>
            </x:context>            
            <x:expect label="resolution-tool prop is after last prop from input">
                <metadata>
                    <title>...</title>
                    <last-modified>...</last-modified>
                    <version>...</version>
                    <oscal-version>...</oscal-version>
                    <prop name="required" value="some value"/>
                    <prop name="optional" value="some other value"/>
                    <prop name="resolution-tool" value="..."/>
                    <link href="..." rel="source-profile"/>
                </metadata>
            </x:expect>
        </x:scenario>
        <x:scenario label="profile/metadata has link">
            <x:context select="/o:profile/o:metadata">
                <profile uuid="pathological-profile">
                    <metadata>
                        <title>Pathological Profile</title>
                        <last-modified>2019-11-13T12:41:07.061-05:00</last-modified>
                        <version>1.0</version>
                        <oscal-version>1.0-rc2</oscal-version>
                        <link href="#internal"><text>Internal link</text></link>
                    </metadata>
                </profile>
            </x:context>
            <x:expect label="source-profile link is inserted before copied link">
                <metadata>
                    <title>...</title>
                    <last-modified>...</last-modified>
                    <version>...</version>
                    <oscal-version>...</oscal-version>
                    <prop name="resolution-tool" value="..."/>
                    <link href="..." rel="source-profile"/>
                    <link href="#internal"><text>Internal link</text></link>
                </metadata>
            </x:expect>
        </x:scenario>
        <x:scenario label="Option to hide source profile URI">
            <x:param name="hide-source-profile-uri" select="true()"/>
            <x:context select="$ov:sample-output-from-pipeline-step-1/o:metadata"/>
            <x:expect label="link rel=source-profile has generic href value"
                test="//o:link[@rel='source-profile']">
                <link href="profile" rel="source-profile"/>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=last-modified template">
        <x:scenario label="Typical case">
            <x:context select="$ov:sample-output-from-pipeline-step-1/o:metadata/o:last-modified"/>
            <x:expect label="last-modified element without attributes">
                <last-modified>...</last-modified>
            </x:expect>
            <x:expect label="Element content is a time stamp"
                test="$x:result/node() castable as xs:dateTime"/>
            <!-- last-modified content must represent the time the profile resolution
                completed. Sanity-check that last-modified is not a copy of the
                last-modified timestamps from the input document. -->
            <x:variable name="ov:inputs-last-modified" as="xs:string+"
                select="$ov:sample-output-from-pipeline-step-1//o:last-modified/string()"/>
            <x:expect label="last-modified content is not from input document"
                test="not(o:metadata/o:last-modified/string() = $ov:inputs-last-modified)"/>
        </x:scenario>
        <x:scenario label="Empty last-modified in source document">
            <x:context>
                <last-modified/>
            </x:context>
            <x:expect label="Output still has a time stamp"
                test="$x:result/self::o:last-modified/node() castable as xs:dateTime"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=profile/metadata/oscal-version template">
        <x:scenario label="Simple case">
            <x:context select="/o:profile/o:metadata/o:oscal-version">
                <profile>
                    <metadata>
                        <oscal-version>1.3</oscal-version>
                    </metadata>
                </profile>
            </x:context>
            <x:expect label="oscal-version">
                <oscal-version>...</oscal-version>
            </x:expect>
        </x:scenario>
        <x:scenario label="Sanity checks for calling opr:oscal-version with correct inputs: ">
            <x:scenario label="Most recent version is in selection metadata" catch="yes">
                <x:context select="/o:profile/o:metadata/o:oscal-version">
                    <profile>
                        <metadata>
                            <oscal-version>1.0.3</oscal-version>
                        </metadata>
                        <!-- All selections from pipeline's step 1 output
                            are under consideration, not just first or last. -->
                        <selection>
                            <metadata>
                                <oscal-version>1.0.1</oscal-version>
                            </metadata>
                        </selection>
                        <selection>
                            <metadata>
                                <oscal-version>1.0.4</oscal-version>
                            </metadata>
                        </selection>
                        <selection>
                            <metadata>
                                <oscal-version>1.0.2</oscal-version>
                            </metadata>
                        </selection>
                    </profile>
                </x:context>
                <x:expect label="Error"
                    test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
            <x:scenario label="Most recent version is in profile metadata">
                <x:context select="/o:profile/o:metadata/o:oscal-version">
                    <profile>
                        <metadata>
                            <oscal-version>1.0.4</oscal-version>
                        </metadata>
                        <selection>
                            <metadata>
                                <oscal-version>1.0.1</oscal-version>
                            </metadata>
                        </selection>
                    </profile>
                </x:context>
                <x:expect label="Version from profile">
                    <oscal-version>1.0.4</oscal-version>
                </x:expect>
            </x:scenario>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for opr:oscal-version function">
        <x:scenario label="Same major version">
            <x:scenario label="Source profile version at least as new as all imported documents">
                <x:call function="opr:oscal-version">
                    <x:param name="source" select="'1.0.1'"/>
                    <x:param name="imported" select="('1.0.0','1.0.1')"/>
                </x:call>
                <x:expect label="Source version and no error" select="'1.0.1'"/>
            </x:scenario>
            <x:scenario label="Source profile version older than at least one imported document" catch="yes">
                <x:call function="opr:oscal-version">
                    <x:param name="source" select="'1.0.0'"/>
                    <x:param name="imported" select="('1.0.0','1.0.1')"/>
                </x:call>
                <x:expect label="Error"
                    test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
            <x:scenario label="Imported document has a newer pre-release identifier" catch="yes">
                <x:call function="opr:oscal-version">
                    <x:param name="source" select="'1.0.1-rc1'"/>
                    <x:param name="imported" select="('1.0.0','1.0.1-rc2')"/>
                </x:call>
                <x:expect label="Error"
                    test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Different major version">
            <x:scenario label="Source profile version at least as new as all imported documents">
                <x:call function="opr:oscal-version">
                    <x:param name="source" select="'2.0.1'"/>
                    <x:param name="imported" select="('1.37.40','1.37')"/>
                </x:call>
                <x:expect label="Source version and no error" select="'2.0.1'"/>
            </x:scenario>
            <x:scenario label="Source profile version older than at least one imported document" catch="yes">
                <x:call function="opr:oscal-version">
                    <x:param name="source" select="'1.37.40'"/>
                    <x:param name="imported" select="('2.0','1.0.1')"/>
                </x:call>
                <x:expect label="Error"
                    test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
        </x:scenario>
    </x:scenario>
    
    <x:scenario label="Tests for match=selection/metadata template">
        <x:context select="$ov:sample-output-from-pipeline-step-1//o:selection/o:metadata"/>
        <x:expect label="Nothing" select="()"/>
    </x:scenario>

</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/2_metadata/random-util.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/xspec/variable"
    xmlns:r="http://csrc.nist.gov/ns/random"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    stylesheet="../../random-util.xsl"
    xslt-version="3.0">

    <!-- For repeatable testing, use a fixed germ. Also, XSpec
        cannot evaluate base-uri(/) in the default parameter
        value from the XSLT. -->
    <x:param name="germ">x</x:param>

    <x:variable name="ov:uuid-v4-regex" as="xs:string">^[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-4[0-9A-Fa-f]{3}-[89ABab][0-9A-Fa-f]{3}-[0-9A-Fa-f]{12}$</x:variable>
    <x:variable name="ov:seed" as="item()" select="'x'"/>
    <x:variable name="ov:PRNG" as="map(xs:string, item())" select="random-number-generator($ov:seed)"/>

    <x:scenario label="Tests for top-level template">
        <x:call template="xsl:initial-template"/>
        <!-- Assertions here are minimal because r:make-uuid
            has function-level tests below. -->
        <x:expect label="Repeatable result for the seed, 'a'"
            test="$x:result/a[1]/string()" select="$x:result/a[2]/string()"/>
        <x:expect label="The 'b' uuid is different from the 'a' uuid"
            test="not($x:result/a[1]/string() = $x:result/b/string())"/>
    </x:scenario>

    <x:scenario label="Tests for r:make-uuid function">
        <x:call function="r:make-uuid">
            <x:param name="seed" select="$ov:seed"/>
        </x:call>
        <x:expect label="Same as calling r:make-uuid-sequence with seq-length=1"
            select="r:make-uuid-sequence($ov:seed, 1)"/>      
    </x:scenario>
    <x:scenario label="Tests for r:make-uuid-sequence function">
        <x:scenario label="seq-length=1">
            <x:variable name="ov:seq-length" as="xs:integer" select="1"/>
            <x:call function="r:make-uuid-sequence">
                <x:param name="seed" select="$ov:seed"/>
                <x:param name="seq-length" select="$ov:seq-length"/>
            </x:call>
            <x:like label="SHARED: Check sequence of uuids"/>
        </x:scenario>
        <x:scenario label="seq-length=10000">
            <x:variable name="ov:seq-length" as="xs:integer" select="10000"/>
            <x:call function="r:make-uuid-sequence">
                <x:param name="seed" select="$ov:seed"/>
                <x:param name="seq-length" select="$ov:seq-length"/>
            </x:call>
            <x:like label="SHARED: Check sequence of uuids"/>
            <x:expect label="Check uniqueness of strings in the sequence"
                test="$x:result => distinct-values() => count() = $ov:seq-length"/>
            <x:expect label="Check that 2nd uuid is not a shift of 1st uuid"
                test="not(starts-with($x:result[2],substring($x:result[1],2,7)))"/>
        </x:scenario>
        <x:scenario label="seq-length=500,000" pending="To save time, run only when needed">
            <x:variable name="ov:seq-length" as="xs:integer" select="500000"/>
            <x:call function="r:make-uuid-sequence">
                <x:param name="seed" select="$ov:seed"/>
                <x:param name="seq-length" select="$ov:seq-length"/>
            </x:call>
            <x:like label="SHARED: Check sequence of uuids"/>
            <x:expect label="Check uniqueness of strings in the sequence"
                test="$x:result => distinct-values() => count() = $ov:seq-length"/>
        </x:scenario>
        <x:scenario label="Edge case: seq-length=0">
            <x:call function="r:make-uuid-sequence">
                <x:param name="seed" select="$ov:seed"/>
                <x:param name="seq-length" as="xs:integer" select="0"/>
            </x:call>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
    </x:scenario>
    <x:scenario label="Tests for r:make-random-string-sequence function">
        <x:scenario label="Template starts with _">
            <x:variable name="ov:template" select="'_xyz'"/>
            <x:call function="r:make-random-string-sequence">
                <x:param name="seed" select="$ov:seed"/>
                <x:param name="seq-length" select="1"/>
                <x:param name="template" select="$ov:template"/>
            </x:call>
            <x:expect label="Starts with hex digit"
                test="matches($x:result,'^[0-9a-f]')"/>
            <x:expect label="Same length as template"
                test="string-length($x:result)=string-length($ov:template)"/>
            <x:expect label="For this template, characters after the first are not hex digits"
                test="not(matches(substring($x:result,2),'[0-9a-f]'))"/>
        </x:scenario>
        <x:scenario label="Template starts with =">
            <x:variable name="ov:template" select="'=xyz'"/>
            <x:call function="r:make-random-string-sequence">
                <x:param name="seed" select="$ov:seed"/>
                <x:param name="seq-length" select="1"/>
                <x:param name="template" select="$ov:template"/>
            </x:call>
            <x:expect label="Starts with 8, 9, a, or b"
                test="matches($x:result,'^[89ab]')"/>
            <x:expect label="Same length as template"
                test="string-length($x:result)=string-length($ov:template)"/>
            <x:expect label="For this template, characters after the first are not 8, 9, a, or b"
                test="not(matches(substring($x:result,2),'[89ab]'))"/>
        </x:scenario>
        <x:scenario label="Template is empty string">
            <x:call function="r:make-random-string-sequence">
                <x:param name="seed" select="$ov:seed"/>
                <x:param name="seq-length" select="1"/>
                <x:param name="template" select="''"/>
            </x:call>
            <x:expect label="Empty string" select="''"/>
        </x:scenario>
        <x:scenario label="Long template of repeated '_' characters">
            <x:variable name="ov:template" select="string-join(for $j in (1 to 10000) return '_','')"/>
            <x:variable name="ov:expected-digits" as="xs:string" select="'^[0-9a-f]+$'"/>
            <x:call function="r:make-random-string-sequence">
                <x:param name="seed" select="$ov:seed"/>
                <x:param name="seq-length" select="1"/>
                <x:param name="template" select="$ov:template"/>
            </x:call>
            <x:like label="SHARED: Check long output"/>
        </x:scenario>
        <x:scenario label="Long template of repeated '=' characters">
            <x:variable name="ov:template" select="string-join(for $j in (1 to 10000) return '=','')"/>
            <x:variable name="ov:expected-digits" as="xs:string" select="'^[89ab]+$'"/>
            <x:call function="r:make-random-string-sequence">
                <x:param name="seed" select="$ov:seed"/>
                <x:param name="seq-length" select="1"/>
                <x:param name="template" select="$ov:template"/>
            </x:call>
            <x:like label="SHARED: Check long output"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Test for '_' character with mode=uuid-char">
        <x:context select="'_'" mode="uuid-char">
            <x:param name="PRNG" select="$ov:PRNG"/>
        </x:context>
        <x:expect label="One hex digit"
            test="matches($x:result,'^[0-9a-f]$')"/>
        <!-- The "Long template of repeated '_' characters" scenario
            checks that it is not the same hex digit for all PRNG inputs. -->
    </x:scenario>
    <x:scenario label="Test for '=' character with mode=uuid-char">
        <x:context select="'='" mode="uuid-char">
            <x:param name="PRNG" select="$ov:PRNG"/>
        </x:context>
        <x:expect label="One character 8, 9, a, or b"
            test="matches($x:result,'^[89ab]$')"/>
        <!-- The "Long template of repeated '=' characters" scenario
            checks that it is not the same hex digit for all PRNG inputs. -->
    </x:scenario>
    <x:scenario label="Tests for characters other than '_' or '=', with mode=uuid-char">
        <!-- These tests exercise the default template behavior for mode="uuid-char". -->
        <x:scenario label="Empty string">
            <x:context select="''" mode="uuid-char">
                <x:param name="PRNG" select="$ov:PRNG"/>
            </x:context>
            <x:expect label="Text node with no content"
                test="$x:result instance of text() and string-length($x:result) eq 0"/>
        </x:scenario>
        <x:scenario label="Hyphen">
            <x:context select="'-'" mode="uuid-char">
                <x:param name="PRNG" select="$ov:PRNG"/>
            </x:context>
            <x:expect label="Text node with hyphen">-</x:expect>
        </x:scenario>
        <x:scenario label="A non-ASCII character">
            <x:variable name="ov:charnum" as="xs:integer" select="500"/>
            <x:context select="codepoints-to-string($ov:charnum)" mode="uuid-char">
                <x:param name="PRNG" select="random-number-generator('123')"/>
            </x:context>
            <x:expect label="Text node with same character"
                expand-text="yes">{codepoints-to-string($ov:charnum)}</x:expect>
        </x:scenario>
    </x:scenario>

    <!-- SHARED scenarios -->

    <x:scenario shared="yes" label="SHARED: Check long output">
        <!-- This set of shared assertions expects the referencing
            scenario to have defined <x:variable name="ov:expected-digits" .../> -->
        <x:expect label="String of digits in expected set"
            test="matches($x:result,$ov:expected-digits)"/>
        <x:expect label="Same length as template"
            test="string-length($x:result) = string-length($ov:template)"/>
        <x:variable name="ov:distinct-codepoints" as="xs:integer+"
            select="$x:result => string-to-codepoints() => distinct-values()"/>
        <x:expect label="String is not the same digit repeated"
            test="count($ov:distinct-codepoints) gt 1"/>
    </x:scenario>
    
    <x:scenario shared="yes" label="SHARED: Check sequence of uuids">
        <!-- This set of shared assertions expects the referencing
            scenario or its ancestor to have defined
            <x:variable name="ov:seq-length" .../> and
            <x:variable name="ov:seed" .../> -->
        <x:expect label="Correct number of strings"
            test="$x:result instance of xs:string+ and count($x:result) eq $ov:seq-length"/>
        <x:expect label="Each string matches uuid regular expression"
            test="every $uuid in $x:result satisfies matches($uuid, $ov:uuid-v4-regex)"/>
        <x:expect label="Check repeatability for same seed"
            test="deep-equal($x:result, r:make-uuid-sequence($ov:seed, $ov:seq-length))"/>
        <x:expect label="Not typically equal to function output for a different seed"
            test="not(deep-equal($x:result, r:make-uuid-sequence($ov:seed || '1', $ov:seq-length)))"/>
    </x:scenario>

</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/2_metadata/uuid-method-choice.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:javaUUID="java.util.UUID"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/xspec/variable"
    xmlns:u="http://csrc.nist.gov/ns/uuid"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    stylesheet="../../uuid-method-choice.xsl">
    
    <x:scenario label="Tests for u:determine-uuid template">
        <x:variable name="ov:fixed" as="xs:string" select="'00000000-0000-4000-B000-000000000000'"/>
        <x:variable name="ov:specified" as="xs:string" select="'f0ad1e6c-5de5-44cd-b92e-a4c507805f0f'"/>
        <x:variable name="ov:service" as="xs:string" select="resolve-uri('uuid-value.txt',$x:xspec-uri)"/>
        <x:scenario label="Valid user-provided UUID">
            <x:call template="u:determine-uuid">
                <x:param name="top-uuid" select="$ov:specified"/>
                <x:param name="uuid-method" select="'user-provided'"/>
            </x:call>
            <x:expect label="Specified UUID" select="$ov:specified"/>
        </x:scenario>
        <x:scenario label="Invalid user-provided UUID">
            <x:call template="u:determine-uuid">
                <x:param name="top-uuid" select="'123'"/>
                <x:param name="uuid-method" select="'user-provided'"/>
            </x:call>
            <x:expect label="Fixed UUID" select="$ov:fixed"/>
        </x:scenario>
        <x:scenario label="Random UUID using XSLT">
            <!-- Random XSLT method requires a global context item.
                For this test's purpose, the context item does not
                matter, so just use this file itself. -->
            <x:context href="uuid-method-choice.xspec"/>
            <x:call template="u:determine-uuid">
                <x:param name="top-uuid" select="$ov:specified"/>
                <x:param name="uuid-method" select="'random-xslt'"/>
            </x:call>
            <x:expect label="Nonempty string"
                test="$x:result instance of xs:string and $x:result != ''"/>
            <x:expect label="UUID is neither fixed one nor specified one"
                test="$x:result ne $ov:specified and $x:result ne $ov:fixed"/>
        </x:scenario>
        <x:scenario label="Random UUID using Java (Note: Not available in CI/CD)">
            <x:call template="u:determine-uuid">
                <x:param name="top-uuid" select="$ov:specified"/>
                <x:param name="uuid-method" select="'random-java'"/>
            </x:call>
            <x:variable name="ov:java-fcn-available" as="xs:boolean"
                select="function-available('javaUUID:randomUUID')"/>
            <x:expect label="Nonempty"
                test="if ($ov:java-fcn-available)
                then (string($x:result) != '')
                else true()"/>
            <x:expect label="UUID is neither fixed one nor specified one"
                test="if ($ov:java-fcn-available)
                then (string($x:result) ne $ov:specified and string($x:result) ne $ov:fixed)
                else true()"/>
            </x:scenario>
        <!-- FYI: Because the transform relies on use-when, which is evaluated at
            compile time, the same test invocation cannot check both
            when the XSLT and Java random number generators are available
            and when they are unavailable. This XSpec test does not cover
            the fallback behavior that produces the fixed UUID value. -->
        <x:scenario label="web-service method, available">
            <!-- To avoid having the test require access to the Internet,
                mock the web service as a text file that XSLT reads using
                unparsed-text(). -->
            <x:call template="u:determine-uuid">
                <x:param name="uuid-service" select="$ov:service"/>
                <x:param name="uuid-method" select="'web-service'"/>
            </x:call>
            <x:expect label="Value from the 'web service' (in this case, a text file)"
                select="'309deb03-491b-4677-9148-bc1b79a21c9c'"/>
        </x:scenario>
        <x:scenario label="web-service method, unavailable">
            <x:call template="u:determine-uuid">
                <x:param name="uuid-service" select="'nonexistent.txt'"/>
                <x:param name="uuid-method" select="'web-service'"/>
            </x:call>
            <x:expect label="Fixed UUID" select="$ov:fixed"/>
        </x:scenario>
        <x:scenario label="Fixed UUID">
            <x:call template="u:determine-uuid">
                <x:param name="uuid-method" select="'fixed'"/>
            </x:call>
            <x:expect label="Fixed UUID" select="$ov:fixed"/>
        </x:scenario>
        <x:scenario label="Unrecognized method">
            <x:call template="u:determine-uuid">
                <x:param name="uuid-method" select="'junk'"/>
            </x:call>
            <x:expect label="Fixed UUID" select="$ov:fixed"/>
        </x:scenario>
    </x:scenario>
</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/2_metadata/uuid-value.txt
================================================
309deb03-491b-4677-9148-bc1b79a21c9c


================================================
FILE: src/utils/resolver-pipeline/testing/2_metadata/version-util.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:v="http://csrc.nist.gov/ns/version"
    stylesheet="../../version-util.xsl"
    xslt-version="3.0">

    <x:scenario label="Tests for v:compare function with two parameters">
        <x:scenario label="Difference in 1st number">
            <x:call function="v:compare">
                <x:param select="'2.10.20'"/>
                <x:param select="'1.20.30'"/>
            </x:call>
            <x:expect label="A is newer" select="xs:integer(1)"/>
        </x:scenario>
        <x:scenario label="Difference in 2nd number">
            <x:call function="v:compare">
                <x:param select="'5.2.10'"/>
                <x:param select="'5.1.20'"/>
            </x:call>
            <x:expect label="A is newer" select="xs:integer(1)"/>
        </x:scenario>
        <x:scenario label="Difference in 3rd number">
            <x:call function="v:compare">
                <x:param select="'5.2.20'"/>
                <x:param select="'5.2.10'"/>
            </x:call>
            <x:expect label="A is newer" select="xs:integer(1)"/>
        </x:scenario>
        <x:scenario label="Difference in pre-release, where ">
            <!-- Examples of precedence from semver.org
                1.0.0-alpha < 1.0.0-alpha.1 < 1.0.0-alpha.beta < 1.0.0-beta < 1.0.0-beta.2 < 1.0.0-beta.11 < 1.0.0-rc.1 < 1.0.0
            -->
            <x:scenario label="B equals A plus an extra part">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-alpha'"/>
                    <x:param select="'1.0.0-alpha.1'"/>
                </x:call>
                <x:expect label="A is older" select="xs:integer(-1)"/>
            </x:scenario>
            <x:scenario label="B equals A plus an extra part (another example)">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-beta'"/>
                    <x:param select="'1.0.0-beta.2'"/>
                </x:call>
                <x:expect label="A is older" select="xs:integer(-1)"/>
            </x:scenario>
            <x:scenario label="the A part is all-numeric, while B part has non-numeric character">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-alpha.1'"/>
                    <x:param select="'1.0.0-alpha.beta'"/>
                </x:call>
                <x:expect label="A is older" select="xs:integer(-1)"/>
            </x:scenario>
            <x:scenario label="both parts have non-numeric characters">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-alpha.beta'"/>
                    <x:param select="'1.0.0-beta'"/>
                </x:call>
                <x:expect label="A is older because alpha is before beta in ASCII sequence" select="xs:integer(-1)"/>
            </x:scenario>
            <x:scenario label="both parts have non-numeric characters (another example)">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-beta.11'"/>
                    <x:param select="'1.0.0-rc.1'"/>
                </x:call>
                <x:expect label="A is older because beta is before rc in ASCII sequence" select="xs:integer(-1)"/>
            </x:scenario>
            <x:scenario label="both parts are all-numeric">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-beta.2'"/>
                    <x:param select="'1.0.0-beta.11'"/>
                </x:call>
                <x:expect label="A is older because 2 is before 11 as numbers" select="xs:integer(-1)"/>
            </x:scenario>
            <x:scenario label="both parts are all-numeric, swapping order of input parameters">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-beta.11'"/>
                    <x:param select="'1.0.0-beta.2'"/>
                </x:call>
                <x:expect label="A is newer because 11 is after 2 as numbers" select="xs:integer(1)"/>
            </x:scenario>
            <x:scenario label="A has a pre-release part and B does not">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-rc.1'"/>
                    <x:param select="'1.0.0'"/>
                </x:call>
                <x:expect label="A is older" select="xs:integer(-1)"/>
            </x:scenario>            
        </x:scenario>
        <x:scenario label="A and B differ only in build metadata, ">
            <x:scenario label="with pre-release string">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-alpha+001'"/>
                    <x:param select="'1.0.0-alpha+002'"/>
                </x:call>
                <x:expect label="A and B have the same precedence, because build metadata does not affect precedence" select="xs:integer(0)"/>
            </x:scenario>
            <x:scenario label="without pre-release string">
                <x:call function="v:compare">
                    <x:param select="'1.0.0+exp.sha.5114f85'"/>
                    <x:param select="'1.0.0+20130313144700'"/>
                </x:call>
                <x:expect label="A and B have the same precedence, because build metadata does not affect precedence" select="xs:integer(0)"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Improper form (two-parameter function does not make corrections)">
            <x:scenario label="First string has improper form" catch="yes">
                <x:call function="v:compare">
                    <x:param select="'1.0'"/>
                    <x:param select="'1.0.0'"/>
                </x:call>
                <x:expect label="Error" test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
            <x:scenario label="Second string has improper form" catch="yes">
                <x:call function="v:compare">
                    <x:param select="'1.0.0'"/>
                    <x:param select="'1.0'"/>
                </x:call>
                <x:expect label="Error" test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
            <x:scenario label="Both strings have identical improper form" catch="yes">
                <x:call function="v:compare">
                    <x:param select="'1.0'"/>
                    <x:param select="'1.0'"/>
                </x:call>
                <x:expect label="Error" test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
        </x:scenario>        
    </x:scenario>

    <x:scenario label="Tests for v:compare function with three parameters">
        <x:scenario label="Normalize space ">
            <x:scenario label="in A">
                <x:call function="v:compare">
                    <x:param select="' 1.0.0-draft '"/>
                    <x:param select="'1.0.0-draft'"/>
                    <x:param select="map{'normalize-space': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
            <x:scenario label="in B">
                <x:call function="v:compare">
                    <x:param select="'1.0.0-draft'"/>
                    <x:param select="' 1.0.0-draft '"/>
                    <x:param select="map{'normalize-space': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Supply missing zeros ">
            <x:scenario label="in 'z' spot of A">
                <x:call function="v:compare">
                    <x:param select="'2.10-draft'"/>
                    <x:param select="'2.10.0-draft'"/>
                    <x:param select="map{'supply-missing-zeros': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
            <x:scenario label="in 'z' spot of B">
                <x:call function="v:compare">
                    <x:param select="'2.10.0'"/>
                    <x:param select="'2.10'"/>
                    <x:param select="map{'supply-missing-zeros': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
            <x:scenario label="in 'y' and 'z' spots of A">
                <x:call function="v:compare">
                    <x:param select="'5-draft'"/>
                    <x:param select="'5.0.0-draft'"/>
                    <x:param select="map{'supply-missing-zeros': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
            <x:scenario label="in 'y' and 'z' spots of B">
                <x:call function="v:compare">
                    <x:param select="'5.0.0'"/>
                    <x:param select="'5'"/>
                    <x:param select="map{'supply-missing-zeros': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Remove leading zeros ">
            <x:scenario label="in A">
                <x:call function="v:compare">
                    <x:param select="'010.020.030-rc010.00'"/>
                    <x:param select="'10.20.30-rc010.0'"/>
                    <x:param select="map{'remove-leading-zeros': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
            <x:scenario label="in B">
                <x:call function="v:compare">
                    <x:param select="'10.20.30-rc010.0'"/>
                    <x:param select="'010.020.030-rc010.00'"/>
                    <x:param select="map{'remove-leading-zeros': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
            <x:scenario label="in A and B">
                <x:call function="v:compare">
                    <x:param select="'010.020.030-rc010.00'"/>
                    <x:param select="'0010.0020.0030-rc010.000'"/>
                    <x:param select="map{'remove-leading-zeros': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
            <x:scenario label="at beginning and end">
                <x:call function="v:compare">
                    <x:param select="'0.020.030-rc010.00'"/>
                    <x:param select="'00.0020.0030-rc010.0'"/>
                    <x:param select="map{'remove-leading-zeros': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Allow empty string ">
            <x:scenario label="as first input">
                <x:call function="v:compare">
                    <x:param select="''"/>
                    <x:param select="'1.0.0'"/>
                    <x:param select="map{'allow-empty-string': true()}"/>
                </x:call>
                <x:expect label="B is newer" select="xs:integer(-1)"/>
            </x:scenario>
            <x:scenario label="as second input">
                <x:call function="v:compare">
                    <x:param select="'1.0.0'"/>
                    <x:param select="''"/>
                    <x:param select="map{'allow-empty-string': true()}"/>
                </x:call>
                <x:expect label="A is newer" select="xs:integer(1)"/>
            </x:scenario>
            <x:scenario label="for both inputs">
                <x:call function="v:compare">
                    <x:param select="''"/>
                    <x:param select="''"/>
                    <x:param select="map{'allow-empty-string': true()}"/>
                </x:call>
                <x:expect label="A and B are the same" select="xs:integer(0)"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Improper form even after modifications">
            <x:scenario label="First string has improper form" catch="yes">
                <x:call function="v:compare">
                    <x:param select="'!2.0.0'"/>
                    <x:param select="'1.0.0'"/>
                    <x:param select="map{}"/>
                </x:call>
                <x:expect label="Error" test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
            <x:scenario label="Second string has improper form" catch="yes">
                <x:call function="v:compare">
                    <x:param select="'1.0.0'"/>
                    <x:param select="'!0'"/>
                    <x:param select="map{}"/>
                </x:call>
                <x:expect label="Error" test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
            <x:scenario label="Both strings have identical improper form" catch="yes">
                <x:call function="v:compare">
                    <x:param select="'!1.0.0'"/>
                    <x:param select="'!1.0.0'"/>
                    <x:param select="map{}"/>
                </x:call>
                <x:expect label="Error" test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Multiple modifications">
            <x:call function="v:compare">
                <x:param select="' 01.00-draft '"/>
                <x:param select="'1.0.0-draft'"/>
                <x:param select="map{
                    'normalize-space': true(),
                    'supply-missing-zeros': true(),
                    'remove-leading-zeros': true(),
                    'allow-empty-string': true()
                    }"/>
            </x:call>
            <x:expect label="A and B are the same" select="xs:integer(0)"/>
        </x:scenario>
    </x:scenario>
    
    <x:scenario label="Tests for v:normalize-version function">
        <x:scenario label="Multiple modifications requested">
            <x:scenario label="Spot check 1">
                <x:call function="v:normalize-version">
                    <x:param select="' 01.00-draft '"/>
                    <x:param select="map{
                        'normalize-space': true(),
                        'supply-missing-zeros': true(),
                        'remove-leading-zeros': true()
                        }"/>
                </x:call>
                <x:expect label="Removed space; inserted 0 for z; removed leading zeros" select="'1.0.0-draft'"/>
            </x:scenario>
            <x:scenario label="Spot check 2">
                <x:call function="v:normalize-version">
                    <x:param select="' 01.00-draft '"/>
                    <x:param select="map{
                        'normalize-space': true(),
                        'supply-missing-zeros': true()
                        }"/>
                </x:call>
                <x:expect label="Removed space; inserted 0 for z; leading zeros unchanged" select="'01.00.0-draft'"/>
            </x:scenario>
            <x:scenario label="Spot check 3">
                <x:call function="v:normalize-version">
                    <x:param select="' 01.00-draft '"/>
                    <x:param select="map{
                        'normalize-space': true(),
                        'remove-leading-zeros': true()
                        }"/>
                </x:call>
                <x:expect label="Removed space; did not insert 0 for z; removed leading zeros" select="'1.0-draft'"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="No modifications requested">
            <x:scenario label="Explicit values of false">
                <x:call function="v:normalize-version">
                    <x:param select="' 01.00-draft '"/>
                    <x:param select="map{
                        'normalize-space': false(),
                        'supply-missing-zeros': false(),
                        'remove-leading-zeros': false()
                        }"/>
                </x:call>
                <x:expect label="Input string is unchanged" select="' 01.00-draft '"/>
            </x:scenario>
            <x:scenario label="Relevant options omitted, and unknown options supplied">
                <x:call function="v:normalize-version">
                    <x:param select="' 01.00-draft '"/>
                    <x:param select="map{
                        'unknown1': false(),
                        'unknown2': true()
                        }"/>
                </x:call>
                <x:expect label="Input string is unchanged" select="' 01.00-draft '"/>
            </x:scenario>
            <x:scenario label="Empty map">
                <x:call function="v:normalize-version">
                    <x:param select="' 01.00-draft '"/>
                    <x:param select="map{}"/>
                </x:call>
                <x:expect label="Input string is unchanged" select="' 01.00-draft '"/>
            </x:scenario>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for v:normalize-space-option function">
        <x:scenario label="option = true">
            <x:call function="v:normalize-space-option">
                <x:param select="' a b '"/>
                <x:param select="true()"/>
            </x:call>
            <x:expect label="Input string without leading or trailing space" select="'a b'"/>
        </x:scenario>
        <x:scenario label="option = false">
            <x:call function="v:normalize-space-option">
                <x:param select="' a b '"/>
                <x:param select="false()"/>
            </x:call>
            <x:expect label="Input string unchanged" select="' a b '"/>
        </x:scenario>
        <x:scenario label="option = empty sequence">
            <x:call function="v:normalize-space-option">
                <x:param select="' a b '"/>
                <x:param select="()"/>
            </x:call>
            <x:expect label="Input string unchanged" select="' a b '"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for v:supply-missing-zeros function">
        <x:scenario label="Missing z, prerelease string, option = true">
            <x:call function="v:supply-missing-zeros">
                <x:param select="'2.10-draft.3'"/>
                <x:param select="true()"/>
            </x:call>
            <x:expect label="z inserted" select="'2.10.0-draft.3'"/>
        </x:scenario>
        <x:scenario label="Missing y and z, prerelease string, option = true">
            <x:call function="v:supply-missing-zeros">
                <x:param select="'2-draft.3'"/>
                <x:param select="true()"/>
            </x:call>
            <x:expect label="y and z inserted" select="'2.0.0-draft.3'"/>
        </x:scenario>
        <x:scenario label="Missing z, no prerelease string, option = true">
            <x:call function="v:supply-missing-zeros">
                <x:param select="'2.10'"/>
                <x:param select="true()"/>
            </x:call>
            <x:expect label="z inserted" select="'2.10.0'"/>
        </x:scenario>
        <x:scenario label="Missing y and z, no prerelease string, option = true">
            <x:call function="v:supply-missing-zeros">
                <x:param select="'2'"/>
                <x:param select="true()"/>
            </x:call>
            <x:expect label="y and z inserted" select="'2.0.0'"/>
        </x:scenario>
        <x:scenario label="option = false">
            <x:call function="v:supply-missing-zeros">
                <x:param select="'1.2-draft.3'"/>
                <x:param select="false()"/>
            </x:call>
            <x:expect label="Input string unchanged" select="'1.2-draft.3'"/>
        </x:scenario>
        <x:scenario label="option = empty sequence">
            <x:call function="v:supply-missing-zeros">
                <x:param select="'1.2-draft.3'"/>
                <x:param select="()"/>
            </x:call>
            <x:expect label="Input string unchanged" select="'1.2-draft.3'"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for v:remove-leading-zeros">
        <x:scenario label="option = true">
            <x:call function="v:remove-leading-zeros">
                <x:param select="'010.020.030-rc010.-010.020'"/>
                <x:param select="true()"/>
            </x:call>
            <x:expect label="Leading zeros removed from the all-numeric identifiers"
                select="'10.20.30-rc010.-010.20'"/>
        </x:scenario>
        <x:scenario label="option = true, no prerelease part">
            <x:call function="v:remove-leading-zeros">
                <x:param select="'010.020.030'"/>
                <x:param select="true()"/>
            </x:call>
            <x:expect label="Leading zeros removed from the all-numeric identifiers"
                select="'10.20.30'"/>
        </x:scenario>
        <x:scenario label="option = false">
            <x:call function="v:remove-leading-zeros">
                <x:param select="'010.020.030-rc010.-010.020'"/>
                <x:param select="false()"/>
            </x:call>
            <x:expect label="Input string unchanged" select="'010.020.030-rc010.-010.020'"/>
        </x:scenario>
        <x:scenario label="option = empty sequence">
            <x:call function="v:remove-leading-zeros">
                <x:param select="'010.020.030-rc010.-010.020'"/>
                <x:param select="()"/>
            </x:call>
            <x:expect label="Input string unchanged" select="'010.020.030-rc010.-010.020'"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for v:version-to-xyz function">
        <x:scenario label="String with three dot-separated numeric parts">
            <x:call function="v:version-to-xyz">
                <x:param select="'1.22.333'"/>
                <x:param select="false()"/>
            </x:call>
            <x:expect label="Sequence of three numbers as strings" select="('1', '22', '333')"/>
        </x:scenario>
        <x:scenario label="String with two dot-separated numeric parts">
            <x:call function="v:version-to-xyz">
                <x:param select="'1.22'"/>
                <x:param select="true()"/>
            </x:call>
            <x:expect label="Sequence of three numbers as strings with zero in 3rd spot" select="('1', '22', '0')"/>
        </x:scenario>
        <x:scenario label="String with one number">
            <x:call function="v:version-to-xyz">
                <x:param select="'1'"/>
                <x:param select="true()"/>
            </x:call>
            <x:expect label="Sequence of three numbers as strings with zero in 2nd and 3rd spot" select="('1', '0', '0')"/>
        </x:scenario>
        <x:scenario label="String with hyphen between the numbers">
            <x:call function="v:version-to-xyz">
                <x:param select="'1-22-333'"/>
                <x:param select="true()"/>
            </x:call>
            <!-- The "-22-333" substring would be interpreted as a pre-release descriptor, not the y.z in an x.y.z pattern -->
            <x:expect label="Sequence of three numbers as strings with zero in 2nd and 3rd spot" select="('1', '0', '0')"/>
        </x:scenario>
        <x:scenario label="Fewer than 3 dot-separated numbers, and 2nd input is false">
            <x:call function="v:version-to-xyz">
                <x:param select="'1:22:333'"/>
                <x:param select="false()"/>
            </x:call>
            <x:expect label="Sequence of three numbers as strings with empty string in 2nd and 3rd spot" select="('1', '', '')"/>
        </x:scenario>
        <x:scenario label="Error cases">
            <x:scenario label="Empty string" catch="yes">
                <x:call function="v:version-to-xyz">
                    <x:param select="''"/>
                    <x:param select="false()"/>
                </x:call>
                <x:expect label="Error" test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
            <x:scenario label="String with non-numeric first character" catch="yes">
                <x:call function="v:version-to-xyz">
                    <x:param select="'v1.22.333'"/>
                    <x:param select="false()"/>
                </x:call>
                <x:expect label="Error" test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
            </x:scenario>
        </x:scenario>
    </x:scenario>
</x:description>


================================================
FILE: src/utils/resolver-pipeline/testing/3_merged/merge-as-is.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    stylesheet="../../oscal-profile-resolve-merge.xsl"
    xslt-version="3.0">

    <x:scenario label="Tests for match=catalog[merge/as-is=$true-content] priority=12 template">
        <x:scenario label="Single import, as-is merge">
            <x:context>
                <catalog>
                    <selection uuid="xyz-tiny_catalog" opr:id="...">
                        <group id="x" opr:id="xyz-tiny_catalog#x">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                            <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                        </group>
                        <group id="y" opr:id="xyz-tiny_catalog#y">
                            <title>Group Y of XYZ</title>
                            <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                            <control id="y2" opr:id="xyz-tiny_catalog#y2"><title>Control Y2</title></control>
                            <control id="y3" opr:id="xyz-tiny_catalog#y3"><title>Control Y3</title></control>
                        </group>
                        <group id="z" opr:id="xyz-tiny_catalog#z">
                            <title>Group Z of XYZ</title>
                            <control id="z1" opr:id="xyz-tiny_catalog#z1"><title>Control Z1</title></control>
                            <control id="z2" opr:id="xyz-tiny_catalog#z2"><title>Control Z2</title></control>
                            <control id="z3" opr:id="xyz-tiny_catalog#z3"><title>Control Z3</title>
                                <control id="z3.a" opr:id="xyz-tiny_catalog#z3.a"><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="xyz-tiny_catalog#z3.a-1"><title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                    <merge>
                        <as-is>true</as-is>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="XYZ catalog with original grouping">
                <catalog>
                    <group id="x">
                        <title>Group X of XYZ</title>
                        <control id="x1"><title>Control X1</title></control>
                        <control id="x2"><title>Control X2</title></control>
                        <control id="x3"><title>Control X3</title></control>
                    </group>
                    <group id="y">
                        <title>Group Y of XYZ</title>
                        <control id="y1"><title>Control Y1</title></control>
                        <control id="y2"><title>Control Y2</title></control>
                        <control id="y3"><title>Control Y3</title></control>
                    </group>
                    <group id="z">
                        <title>Group Z of XYZ</title>
                        <control id="z1"><title>Control Z1</title></control>
                        <control id="z2"><title>Control Z2</title></control>
                        <control id="z3"><title>Control Z3</title>
                            <control id="z3.a"><title>Control Z3-A</title>
                                <control id="z3.a-1"><title>Control Z3-A-1</title></control>
                            </control>
                        </control>
                    </group>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Parallel imports, as-is merge">
            <x:context>
                <catalog>
                    <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                        <group id="x" opr:id="xyz-tiny_catalog#x">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                        </group>
                        <group id="z" opr:id="xyz-tiny_catalog#z">
                            <title>Group Z of XYZ</title>
                            <control id="z1" opr:id="xyz-tiny_catalog#z1"><title>Control Z1</title></control>
                            <control id="z3" opr:id="xyz-tiny_catalog#z3"><title>Control Z3</title>
                                <control id="z3.a" opr:id="xyz-tiny_catalog#z3.a"><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="xyz-tiny_catalog#z3.a-1"><title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                    <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                        <group id="x" opr:id="xyz-tiny_catalog#x">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                        </group>
                        <group id="y" opr:id="xyz-tiny_catalog#y">
                            <title>Group Y of XYZ</title>
                            <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                            <control id="y2" opr:id="xyz-tiny_catalog#y2"><title>Control Y2</title></control>
                            <control id="y3" opr:id="xyz-tiny_catalog#y3"><title>Control Y3</title></control>
                        </group>
                        <group id="z" opr:id="xyz-tiny_catalog#z">
                            <title>Group Z of XYZ</title>
                            <control id="z3" opr:id="xyz-tiny_catalog#z3"><title>Control Z3</title>
                                <control id="z3.a" opr:id="xyz-tiny_catalog#z3.a"><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="xyz-tiny_catalog#z3.a-1"><title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                    <merge>
                        <as-is>true</as-is>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="XYZ catalog merged, with some redundancy">
                <catalog>
                    <group id="x">
                        <title>Group X of XYZ</title>
                        <control id="x1"><title>Control X1</title></control>
                        <control id="x1"><title>Control X1</title></control>
                        <control id="x2"><title>Control X2</title></control>
                    </group>
                    <group id="z">
                        <title>Group Z of XYZ</title>
                        <control id="z1"><title>Control Z1</title></control>
                        <control id="z3"><title>Control Z3</title>
                            <control id="z3.a"><title>Control Z3-A</title>
                                <control id="z3.a-1"><title>Control Z3-A-1</title></control>
                            </control>
                        </control>
                        <control id="z3"><title>Control Z3</title>
                            <control id="z3.a"><title>Control Z3-A</title>
                                <control id="z3.a-1"><title>Control Z3-A-1</title></control>
                            </control>
                        </control>
                    </group>
                    <group id="y">
                        <title>Group Y of XYZ</title>
                        <control id="y1"><title>Control Y1</title></control>
                        <control id="y2"><title>Control Y2</title></control>
                        <control id="y3"><title>Control Y3</title></control>
                    </group>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Merge with loose parameters">
            <x:context>
                <catalog>
                    <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                        <group id="x" opr:id="xyz-tiny_catalog#x">
                            <title>Group X of XYZ</title>
                            <prop value="special" name="status"/>
                            <param id="param-x">
                                <label>Param X</label>
                                <constraint>no control</constraint>
                            </param>
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                        </group>
                    </selection>
                    <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                        <group id="x" opr:id="xyz-tiny_catalog#x">
                            <title>Group X of XYZ</title>
                            <prop value="special" name="status"/>
                            <param id="param-x">
                                <select>
                                    <choice>some choice</choice>
                                    <choice>some other choice</choice>
                                </select>
                            </param>
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                        </group>
                    </selection>
                    <merge>
                        <as-is>true</as-is>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Output has loose parameters with redundancy">
                <catalog>
                    <group id="x">
                        <title>Group X of XYZ</title>
                        <prop value="special" name="status"/>
                        <prop value="special" name="status"/>
                        <param id="param-x">
                            <label>Param X</label>
                            <constraint>no control</constraint>
                        </param>
                        <param id="param-x">
                            <select>
                                <choice>some choice</choice>
                                <choice>some other choice</choice>
                            </select>
                        </param>
                        <control id="x1"><title>Control X1</title></control>
                        <control id="x1"><title>Control X1</title></control>
                        <control id="x2"><title>Control X2</title></control>
                    </group>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Catalog with attribute, metadata, and modify child">
            <x:context>
                <catalog uuid="zzz">
                    <metadata>
                        <title>Test Profile</title>
                        <last-modified>2019-11-13T12:41:07.061-05:00</last-modified>
                        <version>1.3</version>
                        <oscal-version>1.0.2</oscal-version>
                        <prop name="resolution-tool" value="OSCAL Profile Resolver XSLT Pipeline OPRXP" />
                        <link href="urn:UNKNOWN" rel="source-profile" />
                    </metadata>
                    <selection uuid="xyz-tiny_catalog">
                        <control id="x1"><title>Control X1</title></control>
                    </selection>
                    <merge>
                        <as-is>true</as-is>
                    </merge>
                    <modify>
                        <set-parameter param-id="a1_prm1">
                            <constraint>
                                <description>
                                    <p>at least every 3 years</p>
                                </description>
                            </constraint>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="Output includes catalog attribute, metadata, and modify child">
                <catalog uuid="zzz">
                    <metadata>
                        <title>Test Profile</title>
                        <last-modified>2019-11-13T12:41:07.061-05:00</last-modified>
                        <version>1.3</version>
                        <oscal-version>1.0.2</oscal-version>
                        <prop name="resolution-tool" value="OSCAL Profile Resolver XSLT Pipeline OPRXP" />
                        <link href="urn:UNKNOWN" rel="source-profile" />
                    </metadata>
                    <control id="x1"><title>Control X1</title></control>
                    <modify>
                        <set-parameter param-id="a1_prm1">
                            <constraint>
                                <description>
                                    <p>at least every 3 years</p>
                                </description>
                            </constraint>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Catalog with back matter inside and outside selection">
            <x:context>
                <catalog uuid="zzz">
                    <selection uuid="xyz-tiny_catalog">
                        <control id="x1"><title>Control X1</title></control>
                        <back-matter>
                            <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                <title>Ref BBB</title>
                                <citation>
                                    <text>Bbb bbbbb Bbb b.</text>
                                </citation>
                                <rlink href="bbb.html"/>
                            </resource>
                        </back-matter>
                    </selection>
                    <merge>
                        <as-is>true</as-is>
                    </merge>
                    <back-matter>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e1">
                            <title>Ref AAA</title>
                            <citation>
                                <text>Aaaa aaaa aaaa</text>
                            </citation>
                            <rlink href="aaa.html"/>
                        </resource>
                    </back-matter>
                </catalog>
            </x:context>
            <x:expect label="Output includes consolidated back matter">
                <catalog uuid="zzz">
                    <control id="x1"><title>Control X1</title></control>
                    <back-matter>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                            <title>Ref BBB</title>
                            <citation>
                                <text>Bbb bbbbb Bbb b.</text>
                            </citation>
                            <rlink href="bbb.html"/>
                        </resource>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e1">
                            <title>Ref AAA</title>
                            <citation>
                                <text>Aaaa aaaa aaaa</text>
                            </citation>
                            <rlink href="aaa.html"/>
                        </resource>
                    </back-matter>
                </catalog>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for o:merge-groups-as-is template">
        <x:scenario label="$merging is sequence of selection elements ">
            <x:scenario label="with duplicate identifiers">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:selection)+">
                        <selection uuid="a"><title>uuid a</title></selection>
                        <selection uuid="a"><title>uuid a again</title></selection>
                        <selection opr:id="b"><title>opr:id b</title></selection>
                        <selection opr:id="b"><title>opr:id b again</title></selection>
                        <selection uuid="c"><title>uuid c</title></selection>
                        <selection opr:id="c"><title>opr:id c</title></selection>
                    </x:param>
                </x:call>
                <x:expect label="One output per unique identifier name/value pair, but opr:id is omitted">
                    <selection uuid="a"><title>uuid a</title></selection>
                    <selection><title>opr:id b</title></selection>
                    <selection uuid="c"><title>uuid c</title></selection>
                </x:expect>
            </x:scenario>
            <x:scenario label="ungrouped with children other than title, param, control">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:selection)+" select="//o:selection">
                        <catalog>
                          <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                              <prop value="special" name="status"/>
                              <param id="param-x">
                                  <label>Param X</label>
                                  <constraint>no control</constraint>
                              </param>
                              <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                              <back-matter>
                                  <resource opr:id="ref001">
                                      <title>Ref AAA</title>
                                  </resource>
                              </back-matter>
                          </selection>
                          <merge>
                              <as-is>true</as-is>
                          </merge>
                      </catalog>
                    </x:param>
                </x:call>
                <!-- This template's output has back-matter in the "wrong" place,
                    but that is OK because the caller ignores back-matter. -->
                <x:expect label="'other' children followed by params and controls">
                    <selection id="xyz-tiny_catalog">
                        <prop value="special" name="status"/>
                        <back-matter>
                            <resource>
                                <title>Ref AAA</title>
                            </resource>
                        </back-matter>
                        <param id="param-x">
                            <label>Param X</label>
                            <constraint>no control</constraint>
                        </param>
                        <control id="x1"><title>Control X1</title></control>
                    </selection>
                </x:expect>
            </x:scenario>
            <x:scenario label="grouped with children other than title, param, control">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:selection)+" select="//o:selection">
                        <catalog>
                            <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                                <group>
                                    <title>Group X of XYZ</title>
                                    <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                                </group>
                                <back-matter>
                                    <resource opr:id="ref001">
                                        <title>Ref AAA</title>
                                    </resource>
                                </back-matter>
                            </selection>
                            <merge>
                                <as-is>true</as-is>
                            </merge>
                        </catalog>
                    </x:param>
                </x:call>
                <!-- This template's output has back-matter in the "wrong" place,
                    but that is OK because the caller ignores back-matter. -->
                <x:expect label="'other' children followed by group">
                    <selection id="xyz-tiny_catalog">
                        <back-matter>
                            <resource>
                                <title>Ref AAA</title>
                            </resource>
                        </back-matter>
                        <group>
                            <title>Group X of XYZ</title>
                            <control id="x1"><title>Control X1</title></control>
                        </group>
                    </selection>
                </x:expect>
            </x:scenario>
            <x:scenario label="grouped but no controls in groups">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:selection)+" select="//o:selection">
                        <catalog>
                            <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                                <group>
                                    <title>Group X of XYZ</title>
                                </group>
                            </selection>
                            <merge>
                                <as-is>true</as-is>
                            </merge>
                        </catalog>
                    </x:param>
                </x:call>
                <x:expect label="selection but no groups">
                    <selection id="xyz-tiny_catalog"/>
                </x:expect>
            </x:scenario>
            <x:scenario label="grouped with controls not as children but only deeper descendants">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:selection)+" select="//o:selection">
                        <catalog>
                            <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                                <group>
                                    <title>Group X of XYZ</title>
                                    <group>
                                        <title>Group XX</title>
                                        <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                                    </group>
                                </group>
                            </selection>
                            <merge>
                                <as-is>true</as-is>
                            </merge>
                        </catalog>
                    </x:param>
                </x:call>
                <x:expect label="Groups are retained in output">
                    <selection id="xyz-tiny_catalog">
                        <group>
                            <title>Group X of XYZ</title>
                            <group>
                                <title>Group XX</title>
                                <control id="x1"><title>Control X1</title></control>
                            </group>
                        </group>
                    </selection>
                </x:expect> 
            </x:scenario>
            <x:scenario label="with params and controls that need merging">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:selection)+" select="//o:selection">
                        <catalog>
                            <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                                <param id="param-x">
                                    <label>Param X</label>
                                    <constraint>no control</constraint>
                                </param>
                                <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            </selection>
                            <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                                <param id="param-x">
                                    <label>Param X</label>
                                    <constraint>no control</constraint>
                                </param>
                                <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            </selection>
                            <merge>
                                <as-is>true</as-is>
                                <combine method="use-first"/>
                            </merge>
                        </catalog>
                    </x:param>
                </x:call>
                <x:expect label="merged params and controls, following use-first directive">
                    <selection id="xyz-tiny_catalog">
                        <param id="param-x">
                            <label>Param X</label>
                            <constraint>no control</constraint>
                        </param>
                        <control id="x1"><title>Control X1</title></control>
                    </selection>
                </x:expect>
            </x:scenario>
        </x:scenario>
        <x:scenario label="$merging is sequence of group elements ">
            <x:scenario label="with duplicate identifiers">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:group)+">
                        <group id="a"><title>id a</title></group>
                        <group id="a"><title>id a again</title></group>
                        <group opr:id="b"><title>opr:id b</title></group>
                        <group opr:id="b"><title>opr:id b again</title></group>
                        <group id="c"><title>id c</title></group>
                        <group opr:id="c"><title>opr:id c</title></group>
                    </x:param>
                </x:call>
                <x:expect label="One output per unique identifier name/value pair, but opr:id is omitted">
                    <group id="a"><title>id a</title></group>
                    <group><title>opr:id b</title></group>
                    <group id="c"><title>id c</title></group>
                </x:expect>
            </x:scenario>
            <x:scenario label="with children other than title, param, control">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:group)+" select="//o:group">
                        <catalog>
                            <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                                <group>
                                    <title>Group X of XYZ</title>
                                    <prop value="special" name="status"/>
                                    <param id="param-x">
                                        <label>Param X</label>
                                        <constraint>no control</constraint>
                                    </param>
                                    <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                                </group>
                                <group id="group-y">
                                    <title>Group Y of XYZ</title>
                                    <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                                </group>
                            </selection>
                            <merge>
                                <as-is>true</as-is>
                            </merge>
                        </catalog>
                    </x:param>
                </x:call>
                <x:expect label="groups with title followed by 'other' children, params, and controls">
                    <group>
                        <title>Group X of XYZ</title>
                        <prop value="special" name="status"/>
                        <param id="param-x">
                            <label>Param X</label>
                            <constraint>no control</constraint>
                        </param>
                        <control id="x1"><title>Control X1</title></control>
                    </group>
                    <group id="group-y">
                        <title>Group Y of XYZ</title>
                        <control id="y1"><title>Control Y1</title></control>
                    </group>
                </x:expect>
            </x:scenario>
            <x:scenario label="with nested groups">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:group)+" select="//o:selection/o:group">
                        <catalog>
                            <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                                <group>
                                    <title>Group X of XYZ</title>
                                    <prop value="special" name="status"/>
                                    <param id="param-x">
                                        <label>Param X</label>
                                        <constraint>no control</constraint>
                                    </param>
                                    <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                                </group>
                                <group id="group-y">
                                    <title>Group Y of XYZ</title>
                                    <group id="group-yy">
                                        <title>Group YY</title>
                                        <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                                    </group>
                                </group>
                            </selection>
                            <merge>
                                <as-is>true</as-is>
                            </merge>
                        </catalog>
                    </x:param>
                </x:call>
                <x:expect label="groups including nested group">
                    <group>
                        <title>Group X of XYZ</title>
                        <prop value="special" name="status"/>
                        <param id="param-x">
                            <label>Param X</label>
                            <constraint>no control</constraint>
                        </param>
                        <control id="x1"><title>Control X1</title></control>
                    </group>
                    <group id="group-y">
                        <title>Group Y of XYZ</title>
                        <group id="group-yy">
                            <title>Group YY</title>
                            <control id="y1"><title>Control Y1</title></control>
                        </group>
                    </group>
                </x:expect>
            </x:scenario>
            <x:scenario label="with controls not as children but only deeper descendants">
                <x:call template="o:merge-groups-as-is">
                    <x:param name="merging" as="element(o:group)+" select="//o:selection/o:group">
                        <catalog>
                            <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                                <group>
                                    <title>Group X of XYZ</title>
                                    <group>
                                        <title>Group XX</title>
                                        <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                                    </group>
                                </group>
                            </selection>
                            <merge>
                                <as-is>true</as-is>
                            </merge>
                        </catalog>
                    </x:param>
                </x:call>
                <x:expect label="Groups are retained in output">
                    <group>
                        <title>Group X of XYZ</title>
                        <group>
                            <title>Group XX</title>
                            <control id="x1"><title>Control X1</title></control>
                        </group>
                    </group>
                </x:expect> 
            </x:scenario>
        </x:scenario>
        <x:scenario label="$merging is empty sequence">
            <x:call template="o:merge-groups-as-is">
                <x:param name="merging" select="()"/>
            </x:call>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
    </x:scenario>
</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/3_merged/merge-combine.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/xspec/variable"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    stylesheet="../../oscal-profile-resolve-merge.xsl">

    <!-- Override value of $in_xspec global XSLT variable so that error behavior
        in "Error case: Elements of different kinds" scenario can differ for
        testing vs. production usage. -->
    <x:param name="in_xspec" select="true()"/>

    <!-- These variables provide contexts that indicate how to combine elements. -->
    <x:variable name="ov:combine-merge">
        <catalog>
            <merge>
                <combine method="merge"/>
            </merge>
        </catalog>
    </x:variable>
    <x:variable name="ov:combine-use-first">
        <catalog>
            <merge>
                <combine method="use-first"/>
            </merge>
        </catalog>
    </x:variable>
    <x:variable name="ov:combine-keep">
        <catalog/>
    </x:variable>

    <x:scenario label="Tests for combine-elements template">
        <x:variable name="ov:who" as="element(o:control)+" select="//o:control">
            <selection>
                <control id="a" attr="val"><title>Control A</title></control>
                <control id="b"><title>Control B</title></control>
                <control id="a" attr1="val1"><title>Control A1</title></control>
            </selection>
        </x:variable>
        <x:scenario label="Typical case: $who is nonempty and context has ancestor catalog ">
            <x:scenario label="with 'merge' method">
                <x:context select="$ov:combine-merge"/>
                <x:call template="combine-elements">
                    <x:param name="who" select="$ov:who"/>
                </x:call>
                <x:expect label="Dispatches to handler for 'merge' method">
                    <control id="a" attr="val" attr1="val1">
                        <title>Control A</title>
                        <title>Control A1</title>
                    </control>
                    <control id="b"><title>Control B</title></control>
                </x:expect>
            </x:scenario>
            <x:scenario label="with 'use-first' method">
                <x:context select="$ov:combine-use-first"/>
                <x:call template="combine-elements">
                    <x:param name="who" select="$ov:who"/>
                </x:call>
                <x:expect label="Dispatches to handler for 'use-first' method">
                    <control id="a" attr="val"><title>Control A</title></control>
                </x:expect>
            </x:scenario>
            <x:scenario label="with no method">
                <x:context select="$ov:combine-keep"/>
                <x:call template="combine-elements">
                    <x:param name="who" select="$ov:who"/>
                </x:call>
                <x:expect label="Dispatches to handler for 'keep' method">
                    <control id="a" attr="val"><title>Control A</title></control>
                    <control id="b"><title>Control B</title></control>
                    <control id="a" attr1="val1"><title>Control A1</title></control>
                </x:expect>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Edge case: No elements">
            <x:context select="$ov:combine-keep"/>
            <x:call template="combine-elements">
                <x:param name="who" as="empty-sequence()"/>
            </x:call>
            <x:expect label="Nothing"/>
        </x:scenario>
        <x:scenario label="Edge case that shouldn't happen: No catalog ancestor">
            <x:context>
                <not-catalog/>
            </x:context>
            <x:call template="combine-elements">
                <x:param name="who" select="$ov:who"/>
            </x:call>
            <x:expect label="Nothing"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=catalog[merge/combine/@method='merge'] priority=10 mode=o:combine-elements template">
        <x:scenario label="Elements of same kind with duplicate id but distinct opr:id">
            <x:context mode="o:combine-elements" select="$ov:combine-merge">
                <x:param name="elements" as="element()+">
                    <control id="a" opr:id="a"><title>Control A</title></control>
                    <control id="a" opr:id="a1"><title>Control A1</title></control>
                </x:param>
            </x:context>
            <x:expect label="Distinct elements">
                <control id="a"><title>Control A</title></control>
                <control id="a"><title>Control A1</title></control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Elements of same kind with duplicate identifier">
            <x:context mode="o:combine-elements" select="$ov:combine-merge">
                <x:param name="elements" as="element()+" select="//o:control">
                    <catalog>
                        <control id="a" attr="val"><title>Control A</title></control>
                        <control id="b"><title>Control B</title></control>
                        <control id="a" attr1="val1"><title>Control A1</title></control>
                    </catalog>
                </x:param>
            </x:context>
            <x:expect label="For each distinct identifier, one wrapper element and merged attributes and child elements">
                <control id="a" attr="val" attr1="val1">
                    <title>Control A</title>
                    <title>Control A1</title>
                </control>
                <control id="b">
                    <title>Control B</title>
                </control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Edge case: Elements of same kind despite different notation">
            <x:context mode="o:combine-elements" select="$ov:combine-merge">
                <x:param name="elements" as="element()+" xmlns="foo" select="//*:control">
                    <some-wrapper>
                        <o:control id="a" attr="val"><o:title>Control A</o:title></o:control>
                        <ccc:control xmlns:ccc="http://csrc.nist.gov/ns/oscal/1.0" id="b"><ccc:title>Control B</ccc:title></ccc:control>
                        <control xmlns="http://csrc.nist.gov/ns/oscal/1.0" id="a" attr1="val1"><title>Control A1</title></control>
                    </some-wrapper>
                </x:param>
            </x:context>
            <x:expect label="Same result as in case of consistent notation, and no error">
                <control id="a" attr="val" attr1="val1">
                    <title>Control A</title>
                    <title>Control A1</title>
                </control>
                <control id="b">
                    <title>Control B</title>
                </control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Error case: Elements of different kinds" catch="yes">
            <x:context mode="o:combine-elements" select="$ov:combine-merge">
                <x:param name="elements" as="element()+" select="//*:control">
                    <selection>
                        <control/>
                        <control xmlns="foo"/>
                    </selection>
                </x:param>
            </x:context>
            <x:expect label="XSLT error, fatal when $in_xspec is true"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>            
        </x:scenario>
        <x:scenario label="Empty sequence">
            <x:context mode="o:combine-elements" select="$ov:combine-merge">
                <x:param name="elements" select="()"/>
            </x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
    </x:scenario>
    
    <x:scenario label="Tests for match=catalog[merge/combine/@method='use-first'] priority=10 mode=o:combine-elements template">
        <x:scenario label="Elements of same kind with duplicate id but distinct opr:id">
            <x:context mode="o:combine-elements" select="$ov:combine-use-first">
                <x:param name="elements" as="element()+" select="//o:control">
                    <selection>
                        <control id="a" opr:id="a"><title>Control A</title></control>
                        <control id="a" opr:id="a1"><title>Control A1</title></control>
                    </selection>
                </x:param>
            </x:context>
            <x:expect label="First element">
                <control id="a">
                    <title>Control A</title>
                </control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Elements of same kind with duplicate identifier">
            <x:context mode="o:combine-elements" select="$ov:combine-use-first">
                <x:param name="elements" as="element()+" select="//o:control">
                    <selection>
                        <control id="a" attr="val"><title>Control A</title></control>
                        <control id="b"><title>Control B</title></control>
                        <control id="a" attr1="val1"><title>Control A1</title></control>
                    </selection>
                </x:param>
            </x:context>
            <x:expect label="First element">
                <control id="a" attr="val">
                    <title>Control A</title>
                </control>
            </x:expect>
            <x:expect label="No title from 2nd id=a control" test="empty(//title[.='Control  A1'])"/>
            <x:expect label="No attr1 from 2nd id=a control" test="empty(//*[@attr1])"/>
        </x:scenario>
        <x:scenario label="Elements of different kinds">
            <x:context mode="o:combine-elements" select="$ov:combine-use-first">
                <x:param name="elements" as="element()+" select="//*:control">
                    <selection>
                        <control/>
                        <control xmlns="foo"/>
                    </selection>
                </x:param>
            </x:context>
            <x:expect label="First element">
                <control/>
            </x:expect>
        </x:scenario>
        <x:scenario label="Empty sequence">
            <x:context mode="o:combine-elements" select="$ov:combine-use-first">
                <x:param name="elements" select="()"/>
            </x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=catalog priority=5 mode=o:combine-elements template">
        <x:scenario label="Elements of same kind with duplicate id but distinct opr:id">
            <x:context mode="o:combine-elements" select="$ov:combine-keep">
                <x:param name="elements" as="element()+" select="//o:control">
                    <selection>
                        <control id="a" opr:id="a"><title>Control A</title></control>
                        <control id="a" opr:id="a1"><title>Control A1</title></control>
                    </selection>
                </x:param>
            </x:context>
            <x:expect label="All elements">
                <control id="a"><title>Control A</title></control>
                <control id="a"><title>Control A1</title></control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Elements of same kind with duplicate identifier">
            <x:context mode="o:combine-elements" select="$ov:combine-keep">
                <x:param name="elements" as="element()+" select="//o:control">
                    <selection>
                        <control id="a" attr="val"><title>Control A</title></control>
                        <control id="b"><title>Control B</title></control>
                        <control id="a" attr1="val1"><title>Control A1</title></control>
                    </selection>
                </x:param>
            </x:context>
            <x:expect label="All elements">
                <control id="a" attr="val"><title>Control A</title></control>
                <control id="b"><title>Control B</title></control>
                <control id="a" attr1="val1"><title>Control A1</title></control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Elements of different kinds">
            <x:context mode="o:combine-elements" select="$ov:combine-keep">
                <x:param name="elements" as="element()+" select="//*:control">
                    <selection>
                        <control/>
                        <control xmlns="foo"/>
                    </selection>
                </x:param>
            </x:context>
            <x:expect label="All elements">
                <control/>
                <control xmlns="foo"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="Empty sequence">
            <x:context mode="o:combine-elements" select="$ov:combine-keep">
                <x:param name="elements" select="()"/>
            </x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
    </x:scenario>

</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/3_merged/merge-custom.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/test/variable"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    stylesheet="../../oscal-profile-resolve-merge.xsl">

    <x:scenario label="Tests for match=catalog[exists(merge/custom)] priority=13 template">
        <x:scenario label="Single import, custom structure">
            <x:context>
                <catalog uuid="xyz-tiny_catalog">
                    <selection uuid="xyz-tiny_catalog_selection">
                        <group id="x">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                            <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                        </group>
                        <group id="y">
                            <title>Group Y of XYZ</title>
                            <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                            <control id="y2" opr:id="xyz-tiny_catalog#y2"><title>Control Y2</title></control>
                            <control id="y3" opr:id="xyz-tiny_catalog#y3"><title>Control Y3</title></control>
                        </group>
                        <group id="z">
                            <title>Group Z of XYZ</title>
                            <control id="z1" opr:id="xyz-tiny_catalog#z1"><title>Control Z1</title></control>
                            <control id="z2" opr:id="xyz-tiny_catalog#z2"><title>Control Z2</title></control>
                            <control id="z3" opr:id="xyz-tiny_catalog#z3"><title>Control Z3</title>
                                <control id="z3.a" opr:id="xyz-tiny_catalog#z3.a"><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="xyz-tiny_catalog#z3.a-1">
                                        <title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                    <merge>
                        <custom>
                            <group id="g1">
                                <title>New Group 1</title>
                                <insert-controls>
                                    <include-controls>
                                        <with-id>x1</with-id>
                                        <with-id>y1</with-id>
                                        <with-id>z1</with-id>
                                    </include-controls>
                                </insert-controls>
                            </group>
                            <group id="g2">
                                <title>New Group 2</title>
                                <insert-controls>
                                    <include-controls>
                                        <with-id>x2</with-id>
                                        <with-id>y2</with-id>
                                        <with-id>z2</with-id>
                                    </include-controls>
                                </insert-controls>
                            </group>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Catalog with its attributes, and result of processing merge/custom">
                <catalog uuid="xyz-tiny_catalog">
                    <group id="g1">...</group>
                    <group id="g2">...</group>
                </catalog>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=custom mode=o:custom-merge template">
        <x:scenario label="Basic structure">
            <x:context mode="o:custom-merge">
                <custom>
                    <foo/>
                </custom>
            </x:context>
            <x:expect label="Processed child without custom wrapper tags">
                <foo/>
            </x:expect>
        </x:scenario>
        <x:scenario label="Test behavior of custom groups">
            <x:scenario label="Single import with groups, merged into custom groups">
                <x:context mode="o:custom-merge" select="//o:custom">
                    <catalog uuid="xyz-tiny_catalog">
                        <selection uuid="xyz-tiny_catalog_selection">
                            <group id="x">
                                <title>Group X of XYZ</title>
                                <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                                <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                                <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                            </group>
                            <group id="y">
                                <title>Group Y of XYZ</title>
                                <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                                <control id="y2" opr:id="xyz-tiny_catalog#y2"><title>Control Y2</title></control>
                                <control id="y3" opr:id="xyz-tiny_catalog#y3"><title>Control Y3</title></control>
                            </group>
                            <group id="z">
                                <title>Group Z of XYZ</title>
                                <control id="z1" opr:id="xyz-tiny_catalog#z1"><title>Control Z1</title></control>
                                <control id="z2" opr:id="xyz-tiny_catalog#z2"><title>Control Z2</title></control>
                                <control id="z3" opr:id="xyz-tiny_catalog#z3"><title>Control Z3</title>
                                    <control id="z3.a" opr:id="xyz-tiny_catalog#z3.a"><title>Control Z3-A</title>
                                        <control id="z3.a-1" opr:id="xyz-tiny_catalog#z3.a-1">
                                            <title>Control Z3-A-1</title></control>
                                    </control>
                                </control>
                            </group>
                        </selection>
                        <merge>
                            <custom>
                                <group id="g1">
                                    <title>New Group 1</title>
                                    <insert-controls>
                                        <include-controls>
                                            <with-id>x1</with-id>
                                            <with-id>y1</with-id>
                                            <with-id>z1</with-id>
                                        </include-controls>
                                    </insert-controls>
                                </group>
                                <group id="g2">
                                    <title>New Group 2</title>
                                    <insert-controls>
                                        <include-controls>
                                            <with-id>x2</with-id>
                                            <with-id>y2</with-id>
                                            <with-id>z2</with-id>
                                        </include-controls>
                                    </insert-controls>
                                </group>
                            </custom>
                        </merge>
                    </catalog>
                </x:context>
                <x:expect label="New groups for XYZ 1 and 2">
                    <group id="g1">
                        <title>New Group 1</title>
                        <control id="x1"><title>Control X1</title></control>
                        <control id="y1"><title>Control Y1</title></control>
                        <control id="z1"><title>Control Z1</title></control>
                    </group>
                    <group id="g2">
                        <title>New Group 2</title>
                        <control id="x2"><title>Control X2</title></control>
                        <control id="y2"><title>Control Y2</title></control>
                        <control id="z2"><title>Control Z2</title></control>
                    </group>
                </x:expect>
            </x:scenario>
            <x:scenario label="Multiple imports with different group structure">
                <x:context mode="o:custom-merge" select="//o:custom">
                    <catalog uuid="xyz-tiny_catalog">
                        <selection uuid="x_selection">
                            <group id="x">
                                <title>Group X of XYZ</title>
                                <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                                <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                                <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                            </group>
                        </selection>
                        <selection uuid="y_selection">
                            <group id="parent">
                                <title>Parent of Group Y</title>
                                <group id="y">
                                    <title>Group Y of XYZ</title>
                                    <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                                    <control id="y2" opr:id="xyz-tiny_catalog#y2"><title>Control Y2</title></control>
                                    <control id="y3" opr:id="xyz-tiny_catalog#y3"><title>Control Y3</title></control>
                                </group>
                            </group>
                        </selection>
                        <selection uuid="z:selection">
                            <control id="z1" opr:id="xyz-tiny_catalog#z1"><title>Control Z1</title></control>
                            <control id="z2" opr:id="xyz-tiny_catalog#z2"><title>Control Z2</title></control>
                            <control id="z3" opr:id="xyz-tiny_catalog#z3"><title>Control Z3</title>
                                <control id="z3.a" opr:id="xyz-tiny_catalog#z3.a"><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="xyz-tiny_catalog#z3.a-1">
                                        <title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </selection>
                        <merge>
                            <custom>
                                <group id="g1">
                                    <title>New Group 1</title>
                                    <insert-controls>
                                        <include-controls>
                                            <with-id>x1</with-id>
                                            <with-id>y1</with-id>
                                            <with-id>z1</with-id>
                                        </include-controls>
                                    </insert-controls>
                                </group>
                                <group id="g2">
                                    <title>New Group 2</title>
                                    <insert-controls>
                                        <include-controls>
                                            <with-id>x2</with-id>
                                            <with-id>y2</with-id>
                                            <with-id>z2</with-id>
                                        </include-controls>
                                    </insert-controls>
                                </group>
                            </custom>
                        </merge>
                    </catalog>
                </x:context>
                <x:expect label="New groups for XYZ 1 and 2">
                    <group id="g1">
                        <title>New Group 1</title>
                        <control id="x1"><title>Control X1</title></control>
                        <control id="y1"><title>Control Y1</title></control>
                        <control id="z1"><title>Control Z1</title></control>
                    </group>
                    <group id="g2">
                        <title>New Group 2</title>
                        <control id="x2"><title>Control X2</title></control>
                        <control id="y2"><title>Control Y2</title></control>
                        <control id="z2"><title>Control Z2</title></control>
                    </group>
                </x:expect>
            </x:scenario>
            <x:scenario label="Custom groups using include-all, exclude-controls, and insert-controls">
                <x:context mode="o:custom-merge" select="//o:custom">
                    <catalog uuid="xyz-tiny_catalog">
                        <selection uuid="xyz-tiny_catalog_selection">
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                            <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                        </selection>
                        <merge>
                            <custom>
                                <group>
                                    <title>Group A</title>
                                    <insert-controls>
                                        <include-all/>
                                        <exclude-controls>
                                            <with-id>x2</with-id>
                                        </exclude-controls>
                                    </insert-controls>
                                </group>
                                <group>
                                    <title>Group B</title>
                                    <insert-controls>
                                        <include-controls>
                                            <with-id>x2</with-id>
                                        </include-controls>
                                    </insert-controls>
                                </group>
                            </custom>
                        </merge>
                    </catalog>
                </x:context>
                <x:expect label="Group A with controls x1 and x3" test="/o:group[1]">
                    <group>
                        <title>Group A</title>
                        <control id="x1"><title>Control X1</title></control>
                        <control id="x3"><title>Control X3</title></control>
                    </group>
                </x:expect>
                <x:expect label="Group B with control x2" test="/o:group[2]">
                    <group>
                        <title>Group B</title>
                        <control id="x2"><title>Control X2</title></control>
                    </group>
                </x:expect>
            </x:scenario>
            <x:scenario label="Nested custom groups">
                <x:context mode="o:custom-merge" select="//o:custom">
                    <catalog uuid="xyz-tiny_catalog">
                        <selection uuid="xyz-tiny_catalog_selection">
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                            <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                        </selection>
                        <merge>
                            <custom>
                                <group id="a">
                                    <title>Group A</title>
                                    <group id="a.1">
                                        <title>Group A.1</title>
                                        <insert-controls>
                                            <include-controls>
                                                <with-id>x2</with-id>
                                                <with-id>nonexistent</with-id>
                                            </include-controls>
                                        </insert-controls>
                                    </group>
                                </group>
                                <group id="b">
                                    <title>Group B</title>
                                    <group id="b.1">
                                        <title>Group B.1</title>
                                        <insert-controls>
                                            <include-controls>
                                                <matching>q*</matching>
                                            </include-controls>
                                        </insert-controls>
                                    </group>
                                </group>
                            </custom>
                        </merge>
                    </catalog>
                </x:context>
                <x:expect label="Group A containing group A.1 containing control x2" test="/o:group[1]">
                    <group id="a">
                        <title>Group A</title>
                        <group id="a.1">
                            <title>Group A.1</title>
                            <control id="x2"><title>Control X2</title></control>
                        </group>
                    </group>
                </x:expect>
                <x:expect label="Group B containing group B.1 containing no controls" test="/o:group[2]">
                    <group id="b">
                        <title>Group B</title>
                        <group id="b.1">
                            <title>Group B.1</title>
                        </group>
                    </group>
                </x:expect>
            </x:scenario>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=insert-controls mode=o:custom-merge template">
        <x:scenario label="include-all followed by exclude-controls">
            <x:context mode="o:custom-merge" select="//o:insert-controls">
                <catalog uuid="xyz-tiny_catalog">
                    <selection uuid="xyz-tiny_catalog">
                        <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                        <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                        <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-all/>
                                <exclude-controls>
                                    <with-id>x2</with-id>
                                    <matching pattern="*1"/>
                                </exclude-controls>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Control x3 because x1 and x2 were excluded">
                <control id="x3"><title>Control X3</title></control>                
            </x:expect>
        </x:scenario>
        <x:scenario label="insert-controls looking for controls not in catalog/selection">
            <x:context mode="o:custom-merge" select="//o:custom">
                <catalog uuid="xyz-tiny_catalog">
                    <selection uuid="xyz-tiny_catalog_selection">
                        <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                        <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                        <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-controls>
                                    <matching pattern="nonexistent*"/>
                                    <with-id>nonexistent</with-id>
                                </include-controls>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
        <x:scenario label="Descending order by control ID">
            <x:variable name="ov:order" select="'descending'"/>
            <x:like label="SHARED: Context with placeholder for insert-controls order"/>
            <x:expect label="Controls x3, x1, and ax2 in that order">
                <control id="x3"><title>Control X3</title></control>
                <control id="x1"><title>Control X1</title></control>
                <control id="ax2"><title>Control X2</title></control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Ascending by control ID">
            <x:variable name="ov:order" select="'ascending'"/>
            <x:like label="SHARED: Context with placeholder for insert-controls order"/>
            <x:expect label="Controls ax2, x1, and x3 in that order">
                <control id="ax2"><title>Control X2</title></control>
                <control id="x1"><title>Control X1</title></control>
                <control id="x3"><title>Control X3</title></control>                
            </x:expect>
        </x:scenario>
        <x:scenario label="Keep order from catalog">
            <!-- Note: Output of selection phase XSLT has catalog/selection that
                reflects order of controls in input catalog. For tests that confirm
                this behavior, search select.xspec for "Order of controls in output". -->
            <x:variable name="ov:order" select="'keep'"/>
            <x:like label="SHARED: Context with placeholder for insert-controls order"/>
            <x:expect label="Controls x1, ax2, and x3 in that order">
                <control id="x1"><title>Control X1</title></control>
                <control id="ax2"><title>Control X2</title></control>
                <control id="x3"><title>Control X3</title></control>                
            </x:expect>
        </x:scenario>
        <x:scenario label="Empty string for order attribute (behaves like order=keep)">
            <x:variable name="ov:order" select="''"/>
            <x:like label="SHARED: Context with placeholder for insert-controls order"/>
            <x:expect label="Controls x1, ax2, and x3 in that order">
                <control id="x1"><title>Control X1</title></control>
                <control id="ax2"><title>Control X2</title></control>
                <control id="x3"><title>Control X3</title></control>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario shared="yes" label="SHARED: Context with placeholder for insert-controls order">
        <x:context mode="o:custom-merge" select="//o:insert-controls">
            <catalog uuid="xyz-tiny_catalog">
                <selection uuid="xyz-tiny_catalog_selection">
                    <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                    <control id="ax2" opr:id="xyz-tiny_catalog#ax2"><title>Control X2</title></control>
                    <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                </selection>
                <merge>
                    <custom>
                        <insert-controls order="{$ov:order}">
                            <include-controls><!-- Order of with-id elements does not matter. -->
                                <with-id>x1</with-id>
                                <with-id>x3</with-id>
                                <with-id>ax2</with-id>
                            </include-controls>
                        </insert-controls>                            
                    </custom>
                </merge>
            </catalog>
        </x:context>
    </x:scenario>

    <x:scenario label="Tests for match=include-all | include-controls mode=o:custom-merge template">
        <!-- Template shares code with selection phase, which is tested in select.xspec.
            These scenarios merely spot-check. -->
        <x:scenario label="include-controls matches something">
            <x:context mode="o:custom-merge" select="//o:include-controls">
                <catalog uuid="xyz-tiny_catalog">
                    <selection>
                        <control id="a1"/>
                        <control id="a2"/>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-controls>
                                    <with-id>a1</with-id>
                                </include-controls>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Specified controls">
                <control id="a1"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="include-controls does not match anything">
            <x:context mode="o:custom-merge" select="//o:include-controls">
                <catalog uuid="xyz-tiny_catalog">
                    <selection>
                        <control id="a1"/>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-controls>
                                    <with-id>nonexistent</with-id>
                                </include-controls>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
        <x:scenario label="include-all with no exclusions">
            <x:context mode="o:custom-merge" select="//o:include-all">
                <catalog uuid="xyz-tiny_catalog">
                    <selection>
                        <control id="a1"/>
                        <control id="a2"/>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-all/>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="All controls">
                <control id="a1"/>
                <control id="a2"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="include-all with exclusions">
            <x:context mode="o:custom-merge" select="//o:include-all">
                <catalog uuid="xyz-tiny_catalog">
                    <selection>
                        <control id="a1"/>
                        <control id="a2"/>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-all/>
                                <exclude-controls>
                                    <matching pattern="a*"/>
                                </exclude-controls>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="All controls not excluded - in this case, nothing"
                select="()"/>
        </x:scenario>
        <x:scenario label="include-controls without child controls (default choice)">
            <x:context mode="o:custom-merge" select="//o:include-controls">
                <catalog uuid="xyz-tiny_catalog">
                    <selection>
                        <control id="a1">
                            <control id="a1.1"/>
                        </control>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-controls with-child-controls="no">
                                    <with-id>a1</with-id>
                                </include-controls>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Parent control without child control">
                <control id="a1"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="include-controls with child controls (nondefault choice)">
            <x:context mode="o:custom-merge" select="//o:include-controls">
                <catalog uuid="xyz-tiny_catalog">
                    <selection>
                        <control id="a1">
                            <control id="a1.1"/>
                        </control>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-controls with-child-controls="yes">
                                    <with-id>a1</with-id>
                                </include-controls>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Parent control with child control">
                <control id="a1">
                    <control id="a1.1"/>
                </control>
            </x:expect>
        </x:scenario>
        <x:scenario label="include-controls with parent controls (default choice)"
          pending="Needs confirmation about latest expected result">
            <x:context mode="o:custom-merge" select="//o:include-controls">
                <catalog uuid="xyz-tiny_catalog">
                    <selection>
                        <control id="a1">
                            <control id="a1.1"/>
                        </control>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-controls with-parent-controls="yes">
                                    <with-id>a1.1</with-id>
                                </include-controls>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Parent control with child">
                <control id="a1">
                    <control id="a1.1"/>
                </control>
            </x:expect>
        </x:scenario>
        <x:scenario label="include-controls without parent controls (nondefault choice)">
            <x:context mode="o:custom-merge" select="//o:include-controls">
                <catalog uuid="xyz-tiny_catalog">
                    <selection>
                        <control id="a1">
                            <control id="a1.1"/>
                        </control>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-controls with-parent-controls="no">
                                    <with-id>a1.1</with-id>
                                </include-controls>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:context>
            <x:expect label="Child control without parent">
                <control id="a1.1"/>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=exclude-controls mode=o:custom-merge template">
        <x:context mode="o:custom-merge">
            <exclude-controls>
                <with-id>x1</with-id>
            </exclude-controls>
        </x:context>
        <x:expect label="Nothing" select="()"/>
    </x:scenario>
</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/3_merged/merge.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/xspec/variable"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    stylesheet="../../oscal-profile-resolve-merge.xsl">

    <x:scenario label="Tests for match='/ | * | @*' template for all modes">
        <!-- Include wrapper in $ov:arbitrary-element to bypass match="/*" template. -->
        <x:variable name="ov:arbitrary-element" as="element(arbitrary-element)" select="//arbitrary-element">
            <some-wrapper>
                <arbitrary-element xmlns="" arbitrary-attribute="val">text<child/></arbitrary-element>
            </some-wrapper>
        </x:variable>
        <x:scenario label="Element">
            <x:context select="$ov:arbitrary-element"/>
            <x:expect label="Copy" select="$ov:arbitrary-element"/>
        </x:scenario>
        <x:scenario label="Attribute">
            <x:context select="$ov:arbitrary-element/@arbitrary-attribute"/>
            <x:expect label="Copy"
                test="$x:result instance of attribute(arbitrary-attribute) and $x:result/string()='val'"/>
        </x:scenario>
    </x:scenario>


    <x:scenario label="Test for match=/* priority=1 template, which should not be reached in practice">
        <x:context>
            <not-a-catalog/>
        </x:context>
        <x:expect label="Nothing" select="()"/>
    </x:scenario>

    <x:scenario label="Test for match=catalog priority=2 template">
        <!-- Context is a catalog with neither selection nor merge. -->
        <x:context>
            <catalog uuid="zzz">
                <metadata/>
            </catalog>
        </x:context>
        <x:expect label="Copy of catalog">
            <catalog uuid="zzz">
                <metadata/>
            </catalog>
        </x:expect>
    </x:scenario>

    <x:scenario label="Tests for match=catalog[exists(selection)] priority=10 template">
        <!-- Context is a catalog with at least one selection child but no merge child. -->
        <x:scenario label="Single import, no merge (flat)">
            <x:context>
                <catalog>
                    <selection uuid="xyz-tiny_catalog">
                        <group id="x">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                            <control id="x3" opr:id="xyz-tiny_catalog#x3"><title>Control X3</title></control>
                        </group>
                        <group id="y">
                            <title>Group Y of XYZ</title>
                            <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                            <control id="y2" opr:id="xyz-tiny_catalog#y2"><title>Control Y2</title></control>
                            <control id="y3" opr:id="xyz-tiny_catalog#y3"><title>Control Y3</title></control>
                        </group>
                        <group id="z">
                            <title>Group Z of XYZ</title>
                            <control id="z1" opr:id="xyz-tiny_catalog#z1"><title>Control Z1</title></control>
                            <control id="z2" opr:id="xyz-tiny_catalog#z2"><title>Control Z2</title></control>
                            <control id="z3" opr:id="xyz-tiny_catalog#z3"><title>Control Z3</title>
                                <control id="z3.a" opr:id="xyz-tiny_catalog#z3.a"><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="xyz-tiny_catalog#z3.a-1">
                                        <title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                    <!-- no merge -->
                </catalog>
            </x:context>
            <x:expect label="All XYZ controls, ungrouped">
                <catalog>
                    <control id="x1"><title>Control X1</title></control>
                    <control id="x2"><title>Control X2</title></control>
                    <control id="x3"><title>Control X3</title></control>
                    <control id="y1"><title>Control Y1</title></control>
                    <control id="y2"><title>Control Y2</title></control>
                    <control id="y3"><title>Control Y3</title></control>
                    <control id="z1"><title>Control Z1</title></control>
                    <control id="z2"><title>Control Z2</title></control>
                    <control id="z3"><title>Control Z3</title>
                        <control id="z3.a"><title>Control Z3-A</title>
                            <control id="z3.a-1"><title>Control Z3-A-1</title></control>
                        </control>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Parallel imports, no merge, keeping all">
            <x:context>
                <catalog>
                    <selection uuid="xyz-tiny_catalog">
                        <group id="x">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                        </group>
                        <group id="z">
                            <title>Group Z of XYZ</title>
                            <control id="z1" opr:id="xyz-tiny_catalog#z1"><title>Control Z1</title></control>
                            <control id="z3" opr:id="xyz-tiny_catalog#z3"><title>Control Z3</title>
                                <control id="z3.a" opr:id="xyz-tiny_catalog#z3.a"><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="xyz-tiny_catalog#z3.a-1"><title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                    <selection uuid="xyz-tiny_catalog">
                        <group id="x">
                            <title>Group X of XYZ</title>
                            <control id="x1" opr:id="xyz-tiny_catalog#x1">
                                <title>Control X1</title>
                                <prop value="modified property" name="mod"/>
                            </control>
                            <control id="x2" opr:id="xyz-tiny_catalog#x2"><title>Control X2</title></control>
                        </group>
                        <group id="y">
                            <title>Group Y of XYZ</title>
                            <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                            <control id="y2" opr:id="xyz-tiny_catalog#y2"><title>Control Y2</title></control>
                            <control id="y3" opr:id="xyz-tiny_catalog#y3"><title>Control Y3</title></control>
                        </group>
                        <group id="z">
                            <title>Group Z of XYZ</title>
                            <control id="z3" opr:id="xyz-tiny_catalog#z3"><title>Control Z3</title>
                                <control id="z3.a" opr:id="xyz-tiny_catalog#z3.a"><title>Control Z3-A</title>
                                    <control id="z3.a-1" opr:id="xyz-tiny_catalog#z3.a-1"><title>Control Z3-A-1</title></control>
                                </control>
                            </control>
                        </group>
                    </selection>
                    <!-- no merge -->
                </catalog>
            </x:context>
            <x:expect label="XYZ catalog twice, flat, with clashing controls">
                <catalog>
                    <control id="x1"><title>Control X1</title></control>
                    <control id="z1"><title>Control Z1</title></control>
                    <control id="z3"><title>Control Z3</title>
                        <control id="z3.a"><title>Control Z3-A</title>
                            <control id="z3.a-1"><title>Control Z3-A-1</title></control>
                        </control>
                    </control>
                    <control id="x1">
                        <title>Control X1</title>
                        <prop value="modified property" name="mod"/>
                    </control>
                    <control id="x2"><title>Control X2</title></control>
                    <control id="y1"><title>Control Y1</title></control>
                    <control id="y2"><title>Control Y2</title></control>
                    <control id="y3"><title>Control Y3</title></control>
                    <control id="z3"><title>Control Z3</title>
                        <control id="z3.a"><title>Control Z3-A</title>
                            <control id="z3.a-1"><title>Control Z3-A-1</title></control>
                        </control>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Catalog with attribute, metadata, and modify child">
            <x:context>
                <catalog uuid="zzz">
                    <metadata>
                        <title>Test Profile</title>
                        <last-modified>2019-11-13T12:41:07.061-05:00</last-modified>
                        <version>1.3</version>
                        <oscal-version>1.0.2</oscal-version>
                        <prop name="resolution-tool" value="OSCAL Profile Resolver XSLT Pipeline OPRXP" />
                        <link href="urn:UNKNOWN" rel="source-profile" />
                    </metadata>
                    <selection uuid="xyz-tiny_catalog">
                        <control id="x1"><title>Control X1</title></control>
                    </selection>
                    <!-- no merge -->
                    <modify>
                        <set-parameter param-id="a1_prm1">
                            <constraint>
                                <description>
                                    <p>at least every 3 years</p>
                                </description>
                            </constraint>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="Output includes catalog attribute, metadata, and modify child">
                <catalog uuid="zzz">
                    <metadata>
                        <title>Test Profile</title>
                        <last-modified>2019-11-13T12:41:07.061-05:00</last-modified>
                        <version>1.3</version>
                        <oscal-version>1.0.2</oscal-version>
                        <prop name="resolution-tool" value="OSCAL Profile Resolver XSLT Pipeline OPRXP" />
                        <link href="urn:UNKNOWN" rel="source-profile" />
                    </metadata>
                    <control id="x1"><title>Control X1</title></control>
                    <modify>
                        <set-parameter param-id="a1_prm1">
                            <constraint>
                                <description>
                                    <p>at least every 3 years</p>
                                </description>
                            </constraint>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Catalog with back matter inside and outside selection">
            <x:context>
                <catalog uuid="zzz">
                    <selection uuid="xyz-tiny_catalog">
                        <control id="x1"><title>Control X1</title></control>
                        <back-matter>
                            <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                <title>Ref BBB</title>
                                <citation>
                                    <text>Bbb bbbbb Bbb b.</text>
                                </citation>
                                <rlink href="bbb.html"/>
                            </resource>
                        </back-matter>
                    </selection>
                    <!-- no merge -->
                    <back-matter>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e1">
                            <title>Ref AAA</title>
                            <citation>
                                <text>Aaaa aaaa aaaa</text>
                            </citation>
                            <rlink href="aaa.html"/>
                        </resource>
                    </back-matter>
                </catalog>
            </x:context>
            <x:expect label="Output includes consolidated back matter">
                <catalog uuid="zzz">
                    <control id="x1"><title>Control X1</title></control>
                    <back-matter>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                            <title>Ref BBB</title>
                            <citation>
                                <text>Bbb bbbbb Bbb b.</text>
                            </citation>
                            <rlink href="bbb.html"/>
                        </resource>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e1">
                            <title>Ref AAA</title>
                            <citation>
                                <text>Aaaa aaaa aaaa</text>
                            </citation>
                            <rlink href="aaa.html"/>
                        </resource>
                    </back-matter>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="as-is element appears but content is not true">
            <x:variable name="ov:as-is-content">0</x:variable>
            <x:like label="SHARED: as-is element with placeholder for content"/>
        </x:scenario>
        <x:scenario label="as-is element appears but has no content">
            <x:variable name="ov:as-is-content"/>
            <x:like label="SHARED: as-is element with placeholder for content"/>
        </x:scenario>
    </x:scenario>

    <x:scenario shared="yes" label="SHARED: as-is element with placeholder for content">
        <x:context>
            <catalog>
                <selection uuid="xyz-tiny_catalog">
                    <group id="x">
                        <title>Group X of XYZ</title>
                        <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                    </group>
                    <group id="y">
                        <title>Group Y of XYZ</title>
                        <control id="y1" opr:id="xyz-tiny_catalog#y1"><title>Control Y1</title></control>
                    </group>
                </selection>
                <merge>
                    <as-is x:expand-text="true">{$ov:as-is-content}</as-is>
                </merge>
            </catalog>
        </x:context>
        <x:expect label="Flat structure, not grouped">
            <catalog>
                <control id="x1"><title>Control X1</title></control>
                <control id="y1"><title>Control Y1</title></control>
            </catalog>
        </x:expect>
    </x:scenario>

    <!-- Tests for match=catalog[merge/as-is=$true-content] priority=12 template are in merge-as-is.xspec -->
    <!-- Tests for match=catalog[exists(merge/custom)] priority=13 template are in merge-custom.xspec -->

    <x:scenario label="Tests for detect-multiple-structuring-directives template">
        <x:scenario label="Error case: custom appears and as-is is true" catch="yes">
            <x:context>
                <catalog uuid="xyz-tiny_catalog">
                    <merge>
                        <custom/>
                        <as-is>1</as-is>
                    </merge>
                </catalog>
            </x:context>
            <x:call template="detect-multiple-structuring-directives"/>
            <x:expect label="Fatal XSLT error"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>            
        </x:scenario>
        <x:scenario label="Error case: custom appears and flat is true" catch="yes">
            <x:context>
                <catalog uuid="xyz-tiny_catalog">
                    <merge>
                        <custom/>
                        <flat>true</flat>
                    </merge>
                </catalog>
            </x:context>
            <x:call template="detect-multiple-structuring-directives"/>
            <x:expect label="Fatal XSLT error"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>            
        </x:scenario>
        <x:scenario label="Error case: as-is and flat are both true" catch="yes">  
            <x:context>
                <catalog>
                    <merge>
                        <flat>true</flat>
                        <as-is>1</as-is>
                    </merge>
                </catalog>
            </x:context>
            <x:call template="detect-multiple-structuring-directives"/>
            <x:expect label="Fatal XSLT error"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>            
        </x:scenario>
        <x:scenario label="Non-error case: as-is and flat both appear but flat is not true" catch="no">  
            <x:context>
                <catalog>
                    <merge>
                        <flat/>
                        <as-is>1</as-is>
                    </merge>
                </catalog>
            </x:context>
            <x:call template="detect-multiple-structuring-directives"/>
            <x:expect label="No XSLT error" select="()"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for combine-back-matter template">
        <x:scenario label="Back matter as child of catalog">
            <x:context>
                <catalog>
                    <back-matter>
                        <resource>
                            <title>Ref CCC</title>
                        </resource>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                            <title>Ref BBB</title>
                        </resource>
                        <resource opr:id="ref001">
                            <title>Ref AAA</title>
                        </resource>
                    </back-matter>
                </catalog>
            </x:context>
            <x:call template="combine-back-matter"/>
            <x:expect label="back-matter with items, @opr:id omitted">
                <back-matter>
                    <resource>
                        <title>Ref CCC</title>
                    </resource>
                    <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                        <title>Ref BBB</title>
                    </resource>
                    <resource>
                        <title>Ref AAA</title>
                    </resource>
                </back-matter>
            </x:expect>
        </x:scenario>
        <x:scenario label="Back matter as child of selection">
            <x:context>
                <catalog>
                    <selection uuid="xyz-tiny_catalog">
                        <control id="x1"><title>Control X1</title></control>
                        <back-matter>
                            <resource>
                                <title>Ref CCC</title>
                            </resource>
                            <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                <title>Ref BBB</title>
                            </resource>
                        </back-matter>
                    </selection>
                    <selection uuid="xyz-tiny_catalog2">
                        <control id="x2"><title>Control X2</title></control>
                        <back-matter>
                            <resource opr:id="ref001">
                                <title>Ref AAA</title>
                            </resource>
                        </back-matter>
                    </selection>
                </catalog>
            </x:context>
            <x:call template="combine-back-matter"/>
            <x:expect label="back-matter with items, @opr:id omitted">
                <back-matter>
                    <resource>
                        <title>Ref CCC</title>
                    </resource>
                    <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                        <title>Ref BBB</title>
                    </resource>
                    <resource>
                        <title>Ref AAA</title>
                    </resource>
                </back-matter>
            </x:expect>
        </x:scenario>
        <x:scenario label="Back matter in multiple places with duplication">
            <x:context>
                <catalog>
                    <selection uuid="xyz-tiny_catalog">
                        <control id="x1"><title>Control X1</title></control>
                        <back-matter>
                            <resource>
                                <title>Ref CCC</title>
                            </resource>
                            <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                <title>Ref BBB, first</title>
                            </resource>
                            <resource opr:id="ref001">
                                <title>Ref AAA</title>
                            </resource>
                        </back-matter>
                    </selection>
                    <selection uuid="xyz-tiny_catalog2">
                        <control id="x2"><title>Control X2</title></control>
                        <back-matter>
                            <resource>
                                <title>Ref CCC</title>
                            </resource>
                            <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                <title>Ref BBB, second</title>
                            </resource>
                            <resource opr:id="ref001">
                                <title>Ref AAA</title>
                            </resource>
                        </back-matter>
                    </selection>
                    <back-matter>
                        <resource>
                            <title>Ref CCC</title>
                        </resource>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                            <title>Ref BBB, third</title>
                        </resource>
                        <resource opr:id="ref001">
                            <title>Ref AAA</title>
                        </resource>
                    </back-matter>
                </catalog>
            </x:context>
            <x:call template="combine-back-matter"/>
            <x:expect label="back-matter with last item for each distinct uuid or distinct opr:id.">
                <back-matter>
                    <resource>
                        <title>Ref CCC</title>
                    </resource>
                    <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                        <title>Ref BBB, third</title>
                    </resource>
                    <resource>
                        <title>Ref AAA</title>
                    </resource>
                    <resource>
                        <title>Ref CCC</title>
                    </resource>
                    <resource>
                        <title>Ref CCC</title>
                    </resource>
                </back-matter>
            </x:expect>
        </x:scenario>
        <x:scenario label="Testing keep instructions: Three resources with same uuid, where">
            <x:scenario label="1st has keep instruction and others do not">
                <x:context>
                    <catalog>
                        <selection uuid="xyz-tiny_catalog">
                            <control id="x1"><title>Control X1</title></control>
                            <back-matter>
                                <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                    <title>Ref BBB, first</title>
                                    <prop name="keep" value="always"/>
                                </resource>
                            </back-matter>
                        </selection>
                        <selection uuid="xyz-tiny_catalog2">
                            <control id="x2"><title>Control X2</title></control>
                            <back-matter>
                                <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                    <title>Ref BBB, second</title>
                                </resource>
                            </back-matter>
                        </selection>
                        <back-matter>
                            <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                <title>Ref BBB, third</title>
                            </resource>
                        </back-matter>
                    </catalog>
                </x:context>
                <x:call template="combine-back-matter"/>
                <x:expect label="back-matter with 1st and 3rd items. 2nd item was superseded by 3rd item.">
                    <back-matter>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                            <title>Ref BBB, first</title>
                            <prop name="keep" value="always"/>
                        </resource>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                            <title>Ref BBB, third</title>
                        </resource>
                    </back-matter>
                </x:expect>
            </x:scenario>
            <x:scenario label="1st and 3rd have keep instruction and 2nd does not">
                <x:context>
                    <catalog>
                        <selection uuid="xyz-tiny_catalog">
                            <control id="x1"><title>Control X1</title></control>
                            <back-matter>
                                <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                    <title>Ref BBB, first</title>
                                    <prop name="keep" value="always"/>
                                </resource>
                            </back-matter>
                        </selection>
                        <selection uuid="xyz-tiny_catalog2">
                            <control id="x2"><title>Control X2</title></control>
                            <back-matter>
                                <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                    <title>Ref BBB, second</title>
                                </resource>
                            </back-matter>
                        </selection>
                        <back-matter>
                            <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                <title>Ref BBB, third</title>
                                <prop name="keep" value="always"/>
                            </resource>
                        </back-matter>
                    </catalog>
                </x:context>
                <x:call template="combine-back-matter"/>
                <x:expect label="back-matter with last item only.">
                    <back-matter>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                            <title>Ref BBB, third</title>
                            <prop name="keep" value="always"/>
                        </resource>
                    </back-matter>
                </x:expect>
            </x:scenario>
            <x:scenario label="1st and 2nd have keep instruction and 3rd does not">
                <x:context>
                    <catalog>
                        <selection uuid="xyz-tiny_catalog">
                            <control id="x1"><title>Control X1</title></control>
                            <back-matter>
                                <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                    <title>Ref BBB, first</title>
                                    <prop name="keep" value="always"/>
                                </resource>
                            </back-matter>
                        </selection>
                        <selection uuid="xyz-tiny_catalog2">
                            <control id="x2"><title>Control X2</title></control>
                            <back-matter>
                                <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                    <title>Ref BBB, second</title>
                                    <prop name="keep" value="always"/>
                                </resource>
                            </back-matter>
                        </selection>
                        <back-matter>
                            <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                                <title>Ref BBB, third</title>
                            </resource>
                        </back-matter>
                    </catalog>
                </x:context>
                <x:call template="combine-back-matter"/>
                <x:expect label="back-matter with 2nd and 3rd items. 1st item was superseded by 2nd item.">
                    <back-matter>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                            <title>Ref BBB, second</title>
                            <prop name="keep" value="always"/>
                        </resource>
                        <resource uuid="0050231f-4fd0-43d6-8fa0-431367cd83e2">
                            <title>Ref BBB, third</title>
                        </resource>
                    </back-matter>
                </x:expect>
            </x:scenario>
        </x:scenario>
        <x:scenario label="No back matter in input context">
            <x:context>
                <catalog>
                    <selection>
                        <back-matter/>
                    </selection>
                    <back-matter/>
                </catalog>
            </x:context>
            <x:call template="combine-back-matter"/>
            <x:expect label="Nothing (in particular, no empty back-matter wrapper)" select="()"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=selection template">
        <!-- In <x:context>, <selection> must have a parent element.
            Otherwise, we reach the match="/*" template instead of the
            match="selection" template. -->
        <x:scenario label="Parameters grouped and ungrouped">
            <x:context select="//o:selection">
                <catalog>
                    <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                        <param id="param-a">
                            <label>Param A</label>
                            <constraint>no control</constraint>
                        </param>
                        <group>
                            <title>Group X of XYZ</title>
                            <param id="param-x">
                                <label>Param X</label>
                                <constraint>no control</constraint>
                            </param>
                            <param id="param-y">
                                <label>Param Y</label>
                                <constraint>no control</constraint>
                            </param>
                            <group>
                                <title>Group X2</title>
                                <param id="param-x2">
                                    <label>Param X2</label>
                                    <constraint>no control</constraint>
                                </param>
                                <param id="param-y2">
                                    <label>Param Y2</label>
                                    <constraint>no control</constraint>
                                </param>
                            </group>
                        </group>
                    </selection>
                </catalog>
            </x:context>
            <x:expect label="All parameters in document order at all group levels">
                <param id="param-a">
                    <label>Param A</label>
                    <constraint>no control</constraint>
                </param>
                <param id="param-x">
                    <label>Param X</label>
                    <constraint>no control</constraint>
                </param>
                <param id="param-y">
                    <label>Param Y</label>
                    <constraint>no control</constraint>
                </param>
                <param id="param-x2">
                    <label>Param X2</label>
                    <constraint>no control</constraint>
                </param>
                <param id="param-y2">
                    <label>Param Y2</label>
                    <constraint>no control</constraint>
                </param>
            </x:expect>
        </x:scenario>
        <x:scenario label="Controls grouped and ungrouped">
            <x:context select="//o:selection">
                <catalog>
                    <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                        <control id="a"><title>Control A</title></control>
                        <group>
                            <title>Group X of XYZ</title>
                            <control id="x1"><title>Control X1</title></control>
                            <control id="y1"><title>Control Y1</title></control>
                            <group>
                                <title>Group X2</title>
                                <control id="x2"><title>Control X2</title></control>
                                <control id="y2"><title>Control Y2</title></control>
                            </group>
                        </group>
                    </selection>
                </catalog>
            </x:context>
            <x:expect label="All controls in document order at all group levels">
                <control id="a"><title>Control A</title></control>
                <control id="x1"><title>Control X1</title></control>
                <control id="y1"><title>Control Y1</title></control>
                <control id="x2"><title>Control X2</title></control>
                <control id="y2"><title>Control Y2</title></control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Parameters and controls">
            <x:context select="//o:selection">
                <catalog>
                    <selection id="xyz-tiny_catalog" opr:id="xyz-tiny_catalog#xyz-tiny_catalog">
                        <param id="param-a">
                            <label>Param A</label>
                            <constraint>no control</constraint>
                        </param>
                        <control id="a"><title>Control A</title></control>
                        <group>
                            <title>Group X of XYZ</title>
                            <param id="param-x1">
                                <label>Param X1</label>
                                <constraint>no control</constraint>
                            </param>
                            <control id="x1"><title>Control X1</title></control>
                        </group>
                    </selection>
                </catalog>
            </x:context>
            <x:expect label="All parameters followed by all controls">
                <param id="param-a">...</param>
                <param id="param-x1">...</param>
                <control id="a">...</control>
                <control id="x1">...</control>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- Tests for all mode=o:custom-merge templates are in merge-custom.xspec -->
    
    <x:scenario label="Tests for match=selection|selection//group mode=o:select template">
        <x:variable name="ov:control">
            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>            
        </x:variable>
        <x:scenario label="Context is selection with child control">
            <x:variable name="ov:context">
                <catalog uuid="zzz">
                    <selection>
                        <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-all/>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:variable>
            <x:context mode="o:select" select="$ov:context//o:selection">
                <x:param name="import-instruction" tunnel="yes" select="$ov:context//o:insert-controls"/>
            </x:context>
            <x:expect label="Child control" select="$ov:control"/>
        </x:scenario>
        <x:scenario label="Context is selection with child group">
            <x:variable name="ov:context">
                <catalog uuid="zzz">
                    <selection>
                        <group id="parent">
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                        </group>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-all/>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:variable>
            <x:context mode="o:select" select="$ov:context//o:selection">
                <x:param name="import-instruction" tunnel="yes" select="$ov:context//o:insert-controls"/>
            </x:context>
            <x:expect label="Descendant control" select="$ov:control"/>
        </x:scenario>
        <x:scenario label="Context is group with nested group">
            <x:variable name="ov:context">
                <catalog uuid="zzz">
                    <selection>
                        <group id="parent">
                            <group id="child">
                                <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                            </group>
                        </group>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-all/>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:variable>
            <x:context mode="o:select" select="$ov:context//o:group[@id='parent']">
                <x:param name="import-instruction" tunnel="yes" select="$ov:context//o:insert-controls"/>
            </x:context>
            <x:expect label="Descendant control" select="$ov:control"/>
        </x:scenario>
        <x:scenario label="Context is group with child control">
            <x:variable name="ov:context">
                <catalog uuid="zzz">
                    <selection>
                        <group id="parent">
                            <control id="x1" opr:id="xyz-tiny_catalog#x1"><title>Control X1</title></control>
                        </group>
                    </selection>
                    <merge>
                        <custom>
                            <insert-controls>
                                <include-all/>
                            </insert-controls>
                        </custom>
                    </merge>
                </catalog>
            </x:variable>
            <x:context mode="o:select" select="$ov:context//o:group">
                <x:param name="import-instruction" tunnel="yes" select="$ov:context//o:insert-controls"/>
            </x:context>
            <x:expect label="Child control" select="$ov:control"/>
        </x:scenario>
    </x:scenario>

    <!-- Tests for o:merge-groups-as-is template are in merge-as-is.xspec -->
    <!-- Tests for combine-elements template are in merge-combine.xspec -->
    <!-- Tests for all mode="o:combine-elements" templates are in merge-combine.xspec -->

    <x:scenario label="Tests for match=@opr:id template">
        <x:context select="@opr:id">
            <foo opr:id="intermediate-value-id"/>
        </x:context>
        <x:expect label="Nothing" select="()"/>
    </x:scenario>
</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/4_modified/modify.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:oscal="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/xspec/variable"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    stylesheet="../../oscal-profile-resolve-modify.xsl"
    xslt-version="3.0">

    <x:variable name="ov:catalog1" as="element(o:catalog)">
        <catalog id="abc">
            <control id="a123">
                <title>Control A</title>
                <prop value="AAA" name="rating"/>
                <prop value="hd" name="display"/>
                <part name="context"><title>Context to consider</title></part>
            </control>
            <modify>
                <alter control-id="a123">
                    <remove by-name="display"/>
                    <remove by-name="context"/>
                </alter>
            </modify>
        </catalog>
    </x:variable>

    <x:scenario label="Tests for match=node() | @* template">
        <x:variable name="ov:arbitrary-element" as="element(arbitrary-element)">
            <arbitrary-element xmlns="" arbitrary-attribute="val">text<child/></arbitrary-element>
        </x:variable>
        <x:scenario label="Element">
            <x:context select="$ov:arbitrary-element"/>
            <x:expect label="Copy" select="$ov:arbitrary-element"/>
        </x:scenario>
        <x:scenario label="Attribute">
            <x:context select="$ov:arbitrary-element/@arbitrary-attribute"/>
            <x:expect label="Copy"
                test="$x:result instance of attribute(arbitrary-attribute) and $x:result/string()='val'"/>
        </x:scenario>
        <x:scenario label="Text">
            <x:context select="$ov:arbitrary-element/text()"/>
            <x:expect label="Copy"
                test="$x:result instance of text() and $x:result/string()='text'"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=catalog template">
        <x:scenario label="Modify Base">
            <x:context>
                <catalog id="abc">
                    <modify/>
                </catalog>
            </x:context>
            <x:expect label="Catalog element and attributes are copied; modify child element is processed (but dropped by match=modify template)">
                <catalog id="abc"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="Setting some parameters">
            <x:context>
                <catalog id="abc">
                    <param id="abc-1">
                        <label>ABC Parameter</label>
                    </param>
                    <param id="abc-select">
                        <select>
                            <choice>choice 1</choice>
                            <choice>choice 2</choice>
                            <choice>choice 3</choice>
                        </select>
                    </param>
                    <control id="a123">
                        <title>Control A</title>
                        <param id="a123-1">
                            <label>A 123 Parameter</label>
                        </param>
                        <param id="a123-select">
                            <select>
                                <choice>choice 1</choice>
                                <choice>choice 2</choice>
                                <choice>choice 3</choice>
                            </select>
                        </param>
                        <prop value="AAA" name="rating"/>
                    </control>
                    <modify>
                        <set-parameter param-id="a123-1">
                            <value>New a123-1</value>
                        </set-parameter>
                        <set-parameter param-id="a123-select">
                            <select>
                                <choice>choice 1</choice>
                            </select>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="Insert a123-1 param value and include only the specified choice for a123-select param">
                <catalog id="abc">
                    <param id="abc-1">
                        <label>ABC Parameter</label>
                    </param>
                    <param id="abc-select">
                        <select>
                            <choice>choice 1</choice>
                            <choice>choice 2</choice>
                            <choice>choice 3</choice>
                        </select>
                    </param>
                    <control id="a123">
                        <title>Control A</title>
                        <param id="a123-1">
                            <label>A 123 Parameter</label>
                            <value>New a123-1</value>
                        </param>
                        <param id="a123-select">
                            <select>
                                <choice>choice 1</choice>
                            </select>
                        </param>
                        <prop value="AAA" name="rating"/>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
        
        <x:scenario label="Simple property addition to a control, solo">
            <x:context>
                <catalog id="abc">
                    <control id="a123"><title>Control A</title></control>
                    <modify>
                        <alter control-id="a123">
                            <add>
                                <prop value="2020-02-20" name="due_date"/>
                            </add>
                        </alter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="Adding the property">
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="2020-02-20" name="due_date"/>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Simple property addition to a control, starting position">
            <x:context>
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                    </control>
                    <modify>
                        <alter control-id="a123">
                            <add position="starting">
                                <prop value="2020-02-20" name="due_date"/>
                            </add>
                        </alter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="Adding the new property at the front">
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="2020-02-20" name="due_date"/>
                        <prop value="AAA" name="rating"/>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Simple property addition to a control, ending position - implicit">
            <x:context>
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                    </control>
                    <modify>
                        <alter control-id="a123">
                            <add>
                                <prop value="2020-02-20" name="due_date"/>
                            </add>
                        </alter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="Adding the new property at the end">
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                        <prop value="2020-02-20" name="due_date"/>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
        
        <x:scenario label="Add a part and a prop, explicit ending position">
            <x:context>
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                    </control>
                    <modify>
                        <alter control-id="a123">
                            <add position="ending">
                                <prop value="2020-02-20" name="due_date"/>
                                <part name="statement"><p>Statement</p></part>
                            </add>
                        </alter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="Adding the new prop and part at the end">
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                        <prop value="2020-02-20" name="due_date"/>
                        <part name="statement"><p>Statement</p></part>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Remove a part and a prop">
            <x:context select="$ov:catalog1"/>
            <x:expect label="Keeping one prop, removing another">
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Remove a prop by name and a part by namespace and name">
            <x:context>
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                        <prop value="hd" name="display"/>
                        <part name="context"><title>Context to consider</title></part>
                        <part name="context" ns="http://none.org"><title>No context</title></part>
                    </control>
                    <modify>
                        <alter control-id="a123">
                            <remove by-name="display"/>
                            <remove by-name="context" by-ns="http://none.org"/>
                        </alter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="Not removing a part without a given namespace">
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                        <part name="context"><title>Context to consider</title></part>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Remove a prop by name and a part that implicitly has OSCAL namespace">
            <x:context>
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                        <prop value="hd" name="display"/>
                        <part name="context"><title>Context to consider</title></part>
                    </control>
                    <modify>
                        <alter control-id="a123">
                            <remove by-name="display"/>
                            <remove by-name="context" by-ns="http://csrc.nist.gov/ns/oscal"/>
                        </alter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="Keeping one prop, removing another; removing a part implicitly assigned the OSCAL namespace">
                <catalog id="abc">
                    <control id="a123">
                        <title>Control A</title>
                        <prop value="AAA" name="rating"/>
                    </control>
                </catalog>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=modify template">
        <x:context select="$ov:catalog1//o:modify"/>
        <x:expect label="Nothing" select="()"/>
    </x:scenario>
        
    <x:scenario label="Tests for match=set-parameter template">
        <x:scenario label="set-param child does not match anything">
            <x:context select="//o:set-parameter">
                <catalog id="abc">
                    <param id="p1">
                        <label>Parameter #1</label>
                    </param>
                    <modify>
                        <set-parameter param-id="nonexistent">
                            <constraint>at least every 3 years</constraint>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:context>
            <x:expect label="No result; there is a nonfatal warning message but we don't catch it"
                select="()"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=param priority=2 template">
        <x:scenario label="Basic case: Add a constraint to a parameter that doesn't have one">
            <x:variable name="ov:context">
                <catalog id="abc">
                    <param id="p1">
                        <label>Parameter #1</label>
                    </param>
                    <modify>
                        <set-parameter param-id="p1">
                            <constraint>at least every 3 years</constraint>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:variable>
            <x:context select="$ov:context//o:param">
                <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
            </x:context>
            <x:expect label="Copy of parameter with constraint inserted">
                <param id="p1">
                    <label>Parameter #1</label>
                    <constraint>at least every 3 years</constraint>
                </param>                
            </x:expect>
        </x:scenario>        
        <x:scenario label="Add constraint, guideline, and link to a parameter that has these items">
            <x:variable name="ov:context">
                <catalog id="abc">
                    <param id="p1">
                        <link href="ORIGINAL"/>
                        <label>Parameter #1</label>
                        <constraint>ORIGINAL constraint</constraint>
                        <guideline><p>ORIGINAL guideline</p></guideline>
                        <remarks><p>ORIGINAL remarks</p></remarks>
                    </param>
                    <modify>
                        <set-parameter param-id="p1">
                            <link href="NEW"/>
                            <constraint>NEW constraint</constraint>
                            <guideline><p>NEW guideline</p></guideline>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:variable>
            <x:context select="$ov:context//o:param">
                <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
            </x:context>
            <x:expect label="Parameter with link, constraint, and guideline inserted after existing ones; remarks preserved">
                <param id="p1">
                    <link href="ORIGINAL"/>
                    <link href="NEW"/>
                    <label>Parameter #1</label>
                    <constraint>ORIGINAL constraint</constraint>
                    <constraint>NEW constraint</constraint>
                    <guideline><p>ORIGINAL guideline</p></guideline>
                    <guideline><p>NEW guideline</p></guideline>
                    <remarks><p>ORIGINAL remarks</p></remarks>
                </param>                
            </x:expect>
        </x:scenario>        
        <x:scenario label="Override label, usage, and value, keeping the last one of each element">
            <x:variable name="ov:context">
                <catalog id="abc">
                    <param id="p1">
                        <label>Parameter #1</label>
                        <usage><h1>Usage</h1></usage>
                        <constraint>in the first quarter</constraint>
                        <value>ORIGINAL</value>
                    </param>
                    <modify>
                        <set-parameter param-id="p1">
                            <label>Modified Parameter #1</label>
                            <constraint>at least every 3 years</constraint>
                            <value>NEW</value>
                        </set-parameter>
                        <set-parameter param-id="p1">
                            <usage><h1>NEW Usage</h1></usage>
                        </set-parameter>
                        <set-parameter param-id="p1">
                            <label>Further Modified Parameter #1</label>
                            <usage><h1>NEWER Usage</h1></usage>
                            <value>NEWER</value>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:variable>
            <x:context select="$ov:context//o:param">
                <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
            </x:context>
            <x:expect label="Newer label, usage, and value; original constraint plus new one">
                <param id="p1">
                    <label>Further Modified Parameter #1</label>
                    <usage><h1>NEWER Usage</h1></usage>
                    <constraint>in the first quarter</constraint>
                    <constraint>at least every 3 years</constraint>
                    <value>NEWER</value>
                </param>                
            </x:expect>
        </x:scenario>
        <x:scenario label="select and value are mutually exclusive; keep the last one in document order">
            <x:variable name="ov:context">
                <catalog id="abc">
                    <param id="p1">
                        <label>Parameter #1</label>
                        <value>ORIGINAL</value>
                    </param>
                    <param id="p2">
                        <label>Parameter #2</label>
                        <value>ORIGINAL</value>
                    </param>
                    <modify>
                        <set-parameter param-id="p1">
                            <value>NEW</value>
                        </set-parameter>
                        <set-parameter param-id="p1">
                            <select><choice>1</choice></select>
                        </set-parameter>
                        <set-parameter param-id="p2">
                            <select><choice>1</choice></select>
                        </set-parameter>
                        <set-parameter param-id="p2">
                            <value>NEW</value>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:variable>
            <x:context select="$ov:context//o:param">
                <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
            </x:context>
            <x:expect label="p1 has select, while p2 has NEW value">
                <param id="p1">
                    <label>Parameter #1</label>
                    <select><choice>1</choice></select>
                </param>                
                <param id="p2">
                    <label>Parameter #2</label>
                    <value>NEW</value>
                </param>                
            </x:expect>
        </x:scenario>
        <x:scenario label="Override prop with same uuid, and insert prop with distinct uuid">
            <x:variable name="ov:context">
                <catalog id="abc">
                    <param id="p1">
                        <label>Parameter #1</label>
                        <prop value="1" name="pr1"/>
                        <prop value="ORIGINAL-A" name="aaa" uuid="309deb03-491b-4677-9148-bc1b79a21c9c"/>
                        <prop value="ORIGINAL-B" name="bbb" uuid="409deb03-491b-4677-9148-bc1b79a21c9c"/>
                        <prop value="2" name="pr2"/>
                    </param>
                    <modify>
                        <set-parameter param-id="p1">
                            <prop value="3" name="pr3"/>
                            <prop value="NEW-A" name="aaa" uuid="309deb03-491b-4677-9148-bc1b79a21c9c"/>
                            <prop value="NEW-C" name="ccc" uuid="509deb03-491b-4677-9148-bc1b79a21c9c"/>
                            <prop value="4" name="pr4"/>
                        </set-parameter>
                        <set-parameter param-id="p1">
                            <prop value="5" name="pr5"/>
                            <prop value="NEWER-A" name="aaa" uuid="309deb03-491b-4677-9148-bc1b79a21c9c"/>
                            <prop value="NEWER-C" name="ccc" uuid="509deb03-491b-4677-9148-bc1b79a21c9c"/>
                            <prop value="6" name="pr6"/>
                        </set-parameter>
                        <set-parameter param-id="p1">
                            <prop value="7" name="pr7"/>
                            <prop value="NEWEST-A" name="aaa" uuid="309deb03-491b-4677-9148-bc1b79a21c9c"/>
                            <prop value="8" name="pr8"/>
                        </set-parameter>
                    </modify>
                </catalog>
            </x:variable>
            <x:context select="$ov:context//o:param">
                <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
            </x:context>
            <x:expect label="All uuid-lacking props in order. Among uuid-bearing props, the survivors are original bbb, newer ccc, and newest aaa">
                <param id="p1">
                    <prop value="1" name="pr1"/>
                    <prop value="ORIGINAL-B" name="bbb" uuid="409deb03-491b-4677-9148-bc1b79a21c9c"/>
                    <prop value="2" name="pr2"/>
                    <prop value="3" name="pr3"/>
                    <prop value="4" name="pr4"/>
                    <prop value="5" name="pr5"/>
                    <prop value="NEWER-C" name="ccc" uuid="509deb03-491b-4677-9148-bc1b79a21c9c"/>
                    <prop value="6" name="pr6"/>
                    <prop value="7" name="pr7"/>
                    <prop value="NEWEST-A" name="aaa" uuid="309deb03-491b-4677-9148-bc1b79a21c9c"/>
                    <prop value="8" name="pr8"/>
                    <label>Parameter #1</label>
                </param>                
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=control priority=2 template">
        <x:variable name="ov:add-position" select="'starting'"/>
        <x:scenario label="Implicit binding to this control as a whole, ">
            <x:scenario label="with position=starting">
                <x:variable name="ov:add-position" select="'starting'"/>
                <x:like label="SHARED_add-parameterized-position"/>
                <x:expect label="Props added inside control after title">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="10" name="add1"/>
                        <prop value="20" name="add2"/>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                    </control>                    
                </x:expect>
            </x:scenario>
            <x:scenario label="with position=ending">
                <x:variable name="ov:add-position" select="'ending'"/>
                <x:like label="SHARED_add-parameterized-position"/>
                <x:expect label="Props added inside control after other content">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                        <prop value="10" name="add1"/>
                        <prop value="20" name="add2"/>
                    </control>                    
                </x:expect>
            </x:scenario>
            <x:scenario label="with no valid position">
                <x:variable name="ov:add-position" select="''"/>
                <x:like label="SHARED_add-parameterized-position"/>
                <x:expect label="Props added inside control after other content (same as position=ending)">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                        <prop value="10" name="add1"/>
                        <prop value="20" name="add2"/>
                    </control>                    
                </x:expect>
            </x:scenario>
            <x:scenario label="with position=before">
                <x:variable name="ov:add-position" select="'before'"/>
                <x:like label="SHARED_add-parameterized-position"/>
                <x:expect label="Props added inside control after title (same as position=starting)">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="10" name="add1"/>
                        <prop value="20" name="add2"/>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                    </control>                    
                </x:expect>
            </x:scenario>
            <x:scenario label="with position=after">
                <x:variable name="ov:add-position" select="'after'"/>
                <x:like label="SHARED_add-parameterized-position"/>
                <x:expect label="Props added inside control after other content (same as position=ending)">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                        <prop value="10" name="add1"/>
                        <prop value="20" name="add2"/>
                    </control>                    
                </x:expect>
            </x:scenario>
            <x:scenario label="adding title to this control">
                <x:variable name="ov:context">
                    <catalog id="abc">
                        <control id="a1">
                            <title>Control A</title>
                            <prop value="1" name="source1"/>
                        </control>
                        <modify>
                            <alter control-id="a1">
                                <add position="starting">
                                    <title>New Title</title>
                                </add>
                            </alter>
                        </modify>
                    </catalog>
                </x:variable>
                <x:context select="$ov:context//o:control">
                    <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
                </x:context>
                <x:expect label="Old and new titles (next pipeline phase will keep exactly one)">
                    <control id="a1">
                        <title>Control A</title>
                        <title>New Title</title>
                        <prop value="1" name="source1"/>
                    </control>                    
                </x:expect>
            </x:scenario>
            <x:scenario label="with a child control marked as removed">
                <x:variable name="ov:context">
                    <catalog id="abc">
                        <control id="a1">
                            <title>Control A</title>
                            <prop value="1" name="source1"/>
                            <control id="a1.1">
                                <title>Control A.1</title>
                                <prop value="3" name="source3"/>
                                <prop value="4" name="source4"/>
                                <part name="statement" id="a1.1-stmt">
                                    <p>Text</p>
                                </part>
                            </control>
                        </control>
                        <modify>
                            <alter control-id="a1">
                                <remove by-id="a1.1"/>
                            </alter>
                            <alter control-id="a1.1">
                                <add position="starting">
                                    <title>New Title</title>
                                </add>
                            </alter>
                        </modify>
                    </catalog>
                </x:variable>
                <x:context select="$ov:context//o:control[@id='a1.1']">
                    <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
                </x:context>
                <x:expect label="Nothing, because the control was removed" select="()"/>
            </x:scenario>
            <x:scenario label="with multiple identically configured alter directives">
                <x:variable name="ov:context">
                    <catalog id="abc">
                        <control id="a1">
                            <title>Control A</title>
                            <prop value="1" name="source1"/>
                            <prop value="2" name="source2"/>
                        </control>
                        <modify>
                            <alter control-id="a1">
                                <add>
                                    <prop value="10" name="add1"/>
                                    <prop value="20" name="add2"/>
                                </add>
                            </alter>
                            <alter control-id="a1">
                                <add>
                                    <prop value="30" name="add3"/>
                                    <prop value="40" name="add4"/>
                                </add>
                            </alter>
                        </modify>
                    </catalog>
                </x:variable>
                <x:context select="$ov:context//o:control">
                    <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
                </x:context>
                <x:expect label="Props from both alter/add elements added">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                        <prop value="10" name="add1"/>
                        <prop value="20" name="add2"/>
                        <prop value="30" name="add3"/>
                        <prop value="40" name="add4"/>
                    </control>                    
                </x:expect>
            </x:scenario>
            <x:scenario label="with multiple alter directives and different positions">
                <x:variable name="ov:context">
                    <catalog id="abc">
                        <control id="a1">
                            <title>Control A</title>
                            <prop value="1" name="source1"/>
                            <prop value="2" name="source2"/>
                        </control>
                        <modify>
                            <alter control-id="a1">
                                <add>
                                    <prop value="10" name="add1"/>
                                    <prop value="20" name="add2"/>
                                </add>
                            </alter>
                            <alter control-id="a1">
                                <add position="starting">
                                    <prop value="30" name="add3"/>
                                    <prop value="40" name="add4"/>
                                </add>
                            </alter>
                        </modify>
                    </catalog>
                </x:variable>
                <x:context select="$ov:context//o:control">
                    <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
                </x:context>
                <x:expect label="Props from both alter/add elements added in correct position">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="30" name="add3"/>
                        <prop value="40" name="add4"/>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                        <prop value="10" name="add1"/>
                        <prop value="20" name="add2"/>
                    </control>                    
                </x:expect>
            </x:scenario>
            <x:scenario label="with multiple identically configured add directives in one alter">
                <x:variable name="ov:context">
                    <catalog id="abc">
                        <control id="a1">
                            <title>Control A</title>
                            <prop value="1" name="source1"/>
                            <prop value="2" name="source2"/>
                        </control>
                        <modify>
                            <alter control-id="a1">
                                <add>
                                    <prop value="10" name="add1"/>
                                    <prop value="20" name="add2"/>
                                </add>
                                <add>
                                    <prop value="30" name="add3"/>
                                    <prop value="40" name="add4"/>
                                </add>
                            </alter>
                        </modify>
                    </catalog>
                </x:variable>
                <x:context select="$ov:context//o:control">
                    <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
                </x:context>
                <x:expect label="Props from both alter/add elements added">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                        <prop value="10" name="add1"/>
                        <prop value="20" name="add2"/>
                        <prop value="30" name="add3"/>
                        <prop value="40" name="add4"/>
                    </control>                    
                </x:expect>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Explicit binding to this control as a descendant of another control, ">
            <x:scenario label="with position=starting">
                <x:variable name="ov:add-position" select="'starting'"/>
                <x:variable name="ov:by-id" select="'a1.1'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added inside control A.1 before other content">
                    <control id="a1.1">
                        <title>Control A.1</title>
                        <part name="statement" id="new-stmt">
                            <p>New text</p>
                        </part>                            
                        <prop value="3" name="source3"/>
                        <prop value="4" name="source4"/>
                        <part name="statement" id="a1.1-stmt">
                            <p>Text</p>
                        </part>
                    </control>
                </x:expect>
            </x:scenario>
            <x:scenario label="with position=ending">
                <x:variable name="ov:add-position" select="'ending'"/>
                <x:variable name="ov:by-id" select="'a1.1'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added inside control A.1 after other content">
                    <control id="a1.1">
                        <title>Control A.1</title>
                        <prop value="3" name="source3"/>
                        <prop value="4" name="source4"/>
                        <part name="statement" id="a1.1-stmt">
                            <p>Text</p>
                        </part>
                        <part name="statement" id="new-stmt">
                            <p>New text</p>
                        </part>                            
                    </control>
                </x:expect>
            </x:scenario>
            <x:scenario label="with no valid position">
                <x:variable name="ov:add-position" select="''"/>
                <x:variable name="ov:by-id" select="'a1.1'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added inside control A.1 after other content (same as position=ending)">
                    <control id="a1.1">
                        <title>Control A.1</title>
                        <prop value="3" name="source3"/>
                        <prop value="4" name="source4"/>
                        <part name="statement" id="a1.1-stmt">
                            <p>Text</p>
                        </part>
                        <part name="statement" id="new-stmt">
                            <p>New text</p>
                        </part>                            
                    </control>
                </x:expect>
            </x:scenario>
            <x:scenario label="with position=before">
                <x:variable name="ov:add-position" select="'before'"/>
                <x:variable name="ov:by-id" select="'a1.1'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added outside and before control A.1">
                    <part name="statement" id="new-stmt">
                        <p>New text</p>
                    </part>                            
                    <control id="a1.1">
                        <title>Control A.1</title>
                        <prop value="3" name="source3"/>
                        <prop value="4" name="source4"/>
                        <part name="statement" id="a1.1-stmt">
                            <p>Text</p>
                        </part>
                    </control>
                </x:expect>
            </x:scenario>
            <x:scenario label="with position=after">
                <x:variable name="ov:add-position" select="'after'"/>
                <x:variable name="ov:by-id" select="'a1.1'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added outside and after control A.1">
                    <control id="a1.1">
                        <title>Control A.1</title>
                        <prop value="3" name="source3"/>
                        <prop value="4" name="source4"/>
                        <part name="statement" id="a1.1-stmt">
                            <p>Text</p>
                        </part>
                    </control>
                    <part name="statement" id="new-stmt">
                        <p>New text</p>
                    </part>                            
                </x:expect>
            </x:scenario>
            <x:scenario label="adding title to this control">
                <x:variable name="ov:context">
                    <catalog id="abc">
                        <control id="a1">
                            <title>Control A</title>
                            <control id="a1.1">
                                <title>Control A.1</title>
                                <prop value="3" name="source3"/>
                            </control>
                        </control>
                        <modify>
                            <alter control-id="a1">
                                <add position="starting" by-id="a1.1">
                                    <title>New Title</title>
                                </add>
                            </alter>
                        </modify>
                    </catalog>
                </x:variable>
                <x:context select="$ov:context//o:control[@id='a1.1']">
                    <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
                </x:context>
                <x:expect label="Old and new titles (next pipeline phase will keep exactly one)">
                    <control id="a1.1">
                        <title>Control A.1</title>
                        <title>New Title</title>
                        <prop value="3" name="source3"/>
                    </control>                    
                </x:expect>
            </x:scenario>
            <x:scenario label="with a child control marked as removed">
                <x:variable name="ov:context">
                    <catalog id="abc">
                        <control id="a1">
                            <title>Control A</title>
                            <prop value="1" name="source1"/>
                            <control id="a1.1">
                                <title>Control A.1</title>
                                <prop value="3" name="source3"/>
                                <prop value="4" name="source4"/>
                                <part name="statement" id="a1.1-stmt">
                                    <p>Text</p>
                                </part>
                            </control>
                        </control>
                        <modify>
                            <alter control-id="a1">
                                <remove by-id="a1.1"/>
                                <add position="starting" by-id="a1.1">
                                    <title>New Title</title>
                                </add>
                            </alter>
                        </modify>
                    </catalog>
                </x:variable>
                <x:context select="$ov:context//o:control[@id='a1.1']">
                    <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
                </x:context>
                <x:expect label="Nothing, because the control was removed" select="()"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Inoperative case: Explicit binding to control identified in alter, rather than object inside" pending="Supported? See https://github.com/usnistgov/OSCAL/discussions/1305">
            <x:variable name="ov:by-id" select="'a1'"/>
            <x:like label="SHARED_add-explicit-parameterized-position"/>
            <x:expect label="No change">
                <control id="a1">
                    <title>Control A</title>
                    <prop value="1" name="source1"/>
                    <prop value="2" name="source2"/>
                    <part name="statement" id="a1-stmt">
                        <p>Text</p>
                    </part>
                    <control id="a1.1">
                        <title>Control A.1</title>
                        <prop value="3" name="source3"/>
                        <prop value="4" name="source4"/>
                        <part name="statement" id="a1.1-stmt">
                            <p>Text</p>
                        </part>
                    </control>
                </control>
            </x:expect>
        </x:scenario>
        <x:scenario label="Inoperative case: Explicit binding with no matching id">
            <x:variable name="ov:context">
                <catalog id="abc">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                        <part name="statement" id="a1-stmt">
                            <p>Text</p>
                        </part>
                    </control>
                    <modify>
                        <alter control-id="a1">
                            <add by-id="nonexistent">
                                <part name="statement" id="new-stmt">
                                    <p>New text</p>
                                </part>
                            </add>
                        </alter>
                    </modify>
                </catalog>
            </x:variable>
            <x:context select="$ov:context//*[@id='a1']">
                <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
            </x:context>
            <x:expect label="No change">
                <control id="a1">
                    <title>Control A</title>
                    <prop value="1" name="source1"/>
                    <prop value="2" name="source2"/>
                    <part name="statement" id="a1-stmt">
                        <p>Text</p>
                    </part>
                </control>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for oscal:patches-to-id-targeting-ancestor function">
        <!-- In practice, $here and $modifications are part of the same catalog,
        but these tests have them disconnected to show there is no hidden
        assumption that they are in the same tree. -->
        <x:scenario label="One matching add element">
            <x:call function="oscal:patches-to-id-targeting-ancestor">
                <x:param name="here" select="//*[@id='a1-stmt']">
                    <control id="a1">
                        <title>Control A</title>
                        <part name="statement" id="a1-stmt"/>
                    </control>
                </x:param>
                <x:param name="modifications">
                    <modify>
                        <alter control-id="a1">
                            <add by-id="a1-stmt">
                                <part name="statement" id="new-stmt"/>
                            </add>
                        </alter>
                    </modify>
                </x:param>
            </x:call>
            <x:expect label="The add element">
                <add by-id="a1-stmt">
                    <part name="statement" id="new-stmt"/>
                </add>                
            </x:expect>
        </x:scenario>
        <x:scenario label="Multiple matching add elements in multiple alter elements">
            <x:call function="oscal:patches-to-id-targeting-ancestor">
                <x:param name="here" select="//*[@id='a1-stmt']">
                    <control id="a1">
                        <title>Control A</title>
                        <part name="statement" id="a1-stmt"/>
                        <part name="extra-part" id="a1-extra"/>
                    </control>
                </x:param>
                <x:param name="modifications">
                    <modify>
                        <alter control-id="a1">
                            <add by-id="a1-stmt">
                                <part name="statement" id="new-stmt"/>
                            </add>
                            <add by-id="a1-extra">
                                <part name="extra" id="new-extra"/>
                            </add>
                        </alter>
                        <alter control-id="a1">
                            <add by-id="a1-stmt">
                                <part name="another-statement" id="new-stmt-2"/>
                            </add>
                            <add by-id="a1-stmt">
                                <part name="yet-another-statement" id="new-stmt-3"/>
                            </add>
                        </alter>
                    </modify>
                </x:param>
            </x:call>
            <x:expect label="All matching add elements">
                <add by-id="a1-stmt">
                    <part name="statement" id="new-stmt"/>
                </add>
                <add by-id="a1-stmt">
                    <part name="another-statement" id="new-stmt-2"/>
                </add>
                <add by-id="a1-stmt">
                    <part name="yet-another-statement" id="new-stmt-3"/>
                </add>
            </x:expect>
            <x:expect label="No nonmatching add element"
                test="empty(//*[@by-id='a1-extra'])"/>
        </x:scenario>
        <x:scenario label="No matching add elements">
            <x:call function="oscal:patches-to-id-targeting-ancestor">
                <x:param name="here" select="//*[@id='a1-stmt']">
                    <control id="a1">
                        <title>Control A</title>
                        <part name="statement" id="a1-stmt"/>
                    </control>
                </x:param>
                <x:param name="modifications">
                    <modify>
                        <alter control-id="a1">
                            <add by-id="nonexistent">
                                <part name="statement" id="new-stmt"/>
                            </add>
                        </alter>
                    </modify>
                </x:param>
            </x:call>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
        <x:scenario label="Match is inside descendant control compared to the control to which 'alter' points">
            <x:call function="oscal:patches-to-id-targeting-ancestor">
                <x:param name="here" select="//*[@id='a1-stmt']">
                    <control id="a1">
                        <title>Control A</title>
                        <control id="a1.1">
                            <title>Control A1</title>
                            <control id="a1.1.1">
                                <title>Control A1-1</title>
                                <part name="statement" id="a1-stmt"/>
                            </control>
                        </control>
                    </control>
                </x:param>
                <x:param name="modifications">
                    <modify>
                        <alter control-id="a1">
                            <add by-id="a1-stmt">
                                <part name="statement" id="new-stmt"/>
                            </add>
                        </alter>
                    </modify>
                </x:param>
            </x:call>
            <x:expect label="The add element">
                <add by-id="a1-stmt">
                    <part name="statement" id="new-stmt"/>
                </add>                
            </x:expect>
        </x:scenario>
        <x:scenario label="Match is the same control to which 'alter' points">
            <!-- Question: Is this case supposed to work? If not, then in the function, change
            <xsl:variable name="controls" select="$here/ancestor-or-self::control" as="element(control)*"/>
            back to
            <xsl:variable name="controls" select="$here/ancestor::control" as="element(control)*"/>
            -->
            <x:call function="oscal:patches-to-id-targeting-ancestor">
                <x:param name="here" select="//*[@id='a1.1']">
                    <control id="a1">
                        <title>Control A</title>
                        <control id="a1.1">
                            <title>Control A1</title>
                            <control id="a1.1.1">
                                <title>Control A1-1</title>
                                <part name="statement" id="a1-stmt"/>
                            </control>
                        </control>
                    </control>
                </x:param>
                <x:param name="modifications">
                    <modify>
                        <alter control-id="a1.1">
                            <add by-id="a1.1">
                                <part name="statement" id="new-stmt"/>
                            </add>
                        </alter>
                    </modify>
                </x:param>
            </x:call>
            <x:expect label="The add element">
                <add by-id="a1.1">
                    <part name="statement" id="new-stmt"/>
                </add>                
            </x:expect>
        </x:scenario>
        <x:scenario label="Match is a descendant control compared to the control to which 'alter' points">
            <!-- Question: Is this case supposed to work? If not, then in the function, change
            <xsl:variable name="controls" select="$here/ancestor-or-self::control" as="element(control)*"/>
            back to
            <xsl:variable name="controls" select="$here/ancestor::control" as="element(control)*"/>
            -->
            <x:call function="oscal:patches-to-id-targeting-ancestor">
                <x:param name="here" select="//*[@id='a1.1.1']">
                    <control id="a1">
                        <title>Control A</title>
                        <control id="a1.1">
                            <title>Control A1</title>
                            <control id="a1.1.1">
                                <title>Control A1-1</title>
                                <part name="statement" id="a1-stmt"/>
                            </control>
                        </control>
                    </control>
                </x:param>
                <x:param name="modifications">
                    <modify>
                        <alter control-id="a1.1">
                            <add position="before" by-id="a1.1.1">
                                <part name="statement" id="new-stmt"/>
                            </add>
                        </alter>
                    </modify>
                </x:param>
            </x:call>
            <x:expect label="The add element">
                <add position="before" by-id="a1.1.1">
                    <part name="statement" id="new-stmt"/>
                </add>                
            </x:expect>
        </x:scenario>
        <x:scenario label="Edge case: Empty $modifications param">
            <x:call function="oscal:patches-to-id-targeting-ancestor">
                <x:param name="here" select="//*[@id='a1-stmt']">
                    <catalog id="abc">
                        <control id="a1">
                            <title>Control A</title>
                            <part name="statement" id="a1-stmt"/>
                        </control>
                    </catalog>
                </x:param>
                <x:param name="modifications" select="()"/>
            </x:call>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=control//* template">
        <x:scenario label="Explicit binding to a child of a control, ">
            <x:scenario label="with position=starting">
                <x:variable name="ov:add-position" select="'starting'"/>
                <x:variable name="ov:by-id" select="'a1-stmt'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added inside a1-stmt part, before other content">
                    <part name="statement" id="a1-stmt">
                        <part name="statement" id="new-stmt">
                            <p>New text</p>
                        </part>
                        <p>Text</p>
                        <part name="statement" id="a1-substmt">
                            <p>Text</p>
                        </part>
                    </part>
                </x:expect>
            </x:scenario>
            <x:scenario label="with position=ending">
                <x:variable name="ov:add-position" select="'ending'"/>
                <x:variable name="ov:by-id" select="'a1-stmt'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added inside a1-stmt part, after other content">
                    <part name="statement" id="a1-stmt">
                        <p>Text</p>
                        <part name="statement" id="a1-substmt">
                            <p>Text</p>
                        </part>
                        <part name="statement" id="new-stmt">
                            <p>New text</p>
                        </part>
                    </part>
                </x:expect>
            </x:scenario>
            <x:scenario label="with no valid position">
                <x:variable name="ov:add-position" select="''"/>
                <x:variable name="ov:by-id" select="'a1-stmt'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added inside a1-stmt part, after other content (same as position=ending)">
                    <part name="statement" id="a1-stmt">
                        <p>Text</p>
                        <part name="statement" id="a1-substmt">
                            <p>Text</p>
                        </part>
                        <part name="statement" id="new-stmt">
                            <p>New text</p>
                        </part>
                    </part>
                </x:expect>
            </x:scenario>
            <x:scenario label="with position=before">
                <x:variable name="ov:add-position" select="'before'"/>
                <x:variable name="ov:by-id" select="'a1-stmt'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added outside and before a1-stmt part">
                    <part name="statement" id="new-stmt">
                        <p>New text</p>
                    </part>
                    <part name="statement" id="a1-stmt">
                        <p>Text</p>
                        <part name="statement" id="a1-substmt">
                            <p>Text</p>
                        </part>
                    </part>
                </x:expect>
            </x:scenario>
            <x:scenario label="with position=after">
                <x:variable name="ov:add-position" select="'after'"/>
                <x:variable name="ov:by-id" select="'a1-stmt'"/>
                <x:like label="SHARED_add-explicit-parameterized-position"/>
                <x:expect label="Part added outside and after a1-stmt part">
                    <part name="statement" id="a1-stmt">
                        <p>Text</p>
                        <part name="statement" id="a1-substmt">
                            <p>Text</p>
                        </part>
                    </part>
                    <part name="statement" id="new-stmt">
                        <p>New text</p>
                    </part>
                </x:expect>
            </x:scenario>
            <x:scenario label="adding title to a part object within this control">
                <x:variable name="ov:context">
                    <catalog id="abc">
                        <control id="a1">
                            <title>Control A</title>
                            <part name="statement" id="a1-stmt">
                                <title>Statement</title>
                            </part>
                        </control>
                        <modify>
                            <alter control-id="a1">
                                <add position="starting" by-id="a1-stmt">
                                    <title>New Title</title>
                                </add>
                            </alter>
                        </modify>
                    </catalog>
                </x:variable>
                <x:context select="$ov:context//o:part[@id='a1-stmt']">
                    <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
                </x:context>
                <x:expect label="Old and new titles (next pipeline phase will keep exactly one)">
                    <part name="statement" id="a1-stmt">
                        <title>Statement</title>
                        <title>New Title</title>
                    </part>
                </x:expect>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Explicit binding to a non-child descendant of a control">
            <x:variable name="ov:add-position" select="'starting'"/>
            <x:variable name="ov:by-id" select="'a1-substmt'"/>
            <x:like label="SHARED_add-explicit-parameterized-position"/>
            <x:expect label="Part added inside a1-substmt part, before other content">
                <part name="statement" id="a1-substmt">
                    <part name="statement" id="new-stmt">
                        <p>New text</p>
                    </part>
                    <p>Text</p>
                </part>
            </x:expect>
        </x:scenario>
        <x:scenario label="Explicit binding to a descendant that is inside a child control">
            <x:variable name="ov:add-position" select="'starting'"/>
            <x:variable name="ov:by-id" select="'a1.1-stmt'"/>
            <x:like label="SHARED_add-explicit-parameterized-position"/>
            <x:expect label="Part added inside a1.1-stmt part, before other content">
                <part name="statement" id="a1.1-stmt">
                    <part name="statement" id="new-stmt">
                        <p>New text</p>
                    </part>
                    <p>Text</p>
                </part>
            </x:expect>
        </x:scenario>
        <x:scenario label="Explicit binding to a control that a 'remove' element targets for removal">
            <x:variable name="ov:context">
                <catalog id="abc">
                    <control id="a1">
                        <title>Control A</title>
                        <prop value="1" name="source1"/>
                        <prop value="2" name="source2"/>
                        <part name="statement" id="a1-stmt">
                            <p>Text</p>
                        </part>
                        <part name="statement" id="a1-stmt2">
                            <p>Text</p>
                        </part>
                    </control>
                    <modify>
                        <alter control-id="a1">
                            <remove by-id="a1-stmt"/>
                            <add position="after" by-id="a1-stmt">
                                <prop value="0" name="after"/>
                            </add>
                            <add position="before" by-id="a1-stmt">
                                <prop value="0" name="before"/>
                            </add>
                            <add position="starting" by-id="a1-stmt">
                                <prop value="0" name="starting"/>
                            </add>
                            <add position="ending" by-id="a1-stmt">
                                <prop value="0" name="ending"/>
                            </add>
                            <add by-id="a1-stmt">
                                <prop value="0" name="default"/>
                            </add>
                        </alter>
                    </modify>
                </catalog>
            </x:variable>
            <x:context select="$ov:context//*[@id='a1-stmt']">
                <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
            </x:context>
            <x:expect label="Elements in 'add' that use 'before' and 'after'">
                <prop value="0" name="before"/>
                <prop value="0" name="after"/>
            </x:expect>
            <x:expect label="The target control does not appear" test="empty($x:result//*[@id='a1-stmt'])"/>
            <x:expect label="The 'starting' element does not appear" test="empty($x:result//*[@name='starting'])"/>
            <x:expect label="The 'ending' element does not appear" test="empty($x:result//*[@name='ending'])"/>
            <x:expect label="The element with no valid position does not appear" test="empty($x:result//*[@name='default'])"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for oscal:removable function">
        <x:scenario label="prop named in modify/alter/remove">
            <x:call function="oscal:removable">
                <x:param name="who" select="$ov:catalog1//o:prop[@name='display']"/>
                <x:param name="mods" select="$ov:catalog1//o:modify"/>
            </x:call>
            <x:expect label="True" select="true()"/>
        </x:scenario>
        <x:scenario label="prop not named in modify/alter/remove">
            <x:call function="oscal:removable">
                <x:param name="who" select="$ov:catalog1//o:prop[@name='rating']"/>
                <x:param name="mods" select="$ov:catalog1//o:modify"/>
            </x:call>
            <x:expect label="False" select="false()"/>
        </x:scenario>
        <x:scenario label="prop has multiple ancestors that are control">
            <x:scenario label="Alter directive points to outermost control id">
                <x:variable name="ov:alter-control-id" select="'z3'"/>
                <x:like label="SHARED_catalog-parameterized-control-id"/>
                <x:like label="SHARED_remove-prop-from-nested-controls"/>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Alter directive points to middle control id">
                <x:variable name="ov:alter-control-id" select="'z3.a'"/>
                <x:like label="SHARED_catalog-parameterized-control-id"/>
                <x:like label="SHARED_remove-prop-from-nested-controls"/>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Alter directive points to innermost control id">
                <x:variable name="ov:alter-control-id" select="'z3.a-1'"/>
                <x:like label="SHARED_catalog-parameterized-control-id"/>
                <x:like label="SHARED_remove-prop-from-nested-controls"/>
                <x:expect label="True" select="true()"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Check removability of control, z3.a, that has parent control">
            <x:scenario label="Alter directive points to parent of z3.a">
                <x:variable name="ov:alter-control-id" select="'z3'"/>
                <x:like label="SHARED_catalog-parameterized-control-id"/>
                <x:like label="SHARED_remove-nested-control"/>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Alter directive and removal element both point to z3.a">
                <x:variable name="ov:alter-control-id" select="'z3.a'"/>
                <x:like label="SHARED_catalog-parameterized-control-id"/>
                <x:like label="SHARED_remove-nested-control"/>
                <x:expect label="False because removal element must be strictly inside the element the alter directive targets"
                    select="false()"/>
            </x:scenario>
            <x:scenario label="Alter directive points to child of z3.a">
                <x:variable name="ov:alter-control-id" select="'z3.a-1'"/>
                <x:like label="SHARED_catalog-parameterized-control-id"/>
                <x:like label="SHARED_remove-nested-control"/>
                <x:expect label="False because $who is out of scope" select="false()"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Edge case: No ancestor is control" catch="yes">
            <!-- This case shouldn't happen because the function is called from
                the match="control//*" template. The purpose of this scenario is
                to catch mistakes if any code changes cause the function to be called
                for elements that have no control ancestor. If we want to support
                that case and return false instead of an error, the $home variable
                in the function should have data type element()* instead of element()+.
            -->
            <x:call function="oscal:removable">
                <x:param name="who" select="$ov:catalog1/self::o:catalog"/>
                <x:param name="mods" select="$ov:catalog1//o:modify"/>
            </x:call>
            <x:expect label="XSLT error because $home does not have data type element()+"
                test="$x:result instance of map(*) and $x:result('err') instance of map(*)"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for oscal:remove-match function">
        <x:variable name="ov:catalog" as="element(o:catalog)">
            <catalog>
                <group id="x">
                    <title>Group X</title>
                    <control id="x1">
                        <title>Control X1</title>
                        <prop value="AAA" name="aaa"/>
                        <prop value="hd" name="display"/>
                        <prop value="x" name="prop-with-class" class="c1"/>
                        <prop value="x" name="prop-with-no-ns-specified"/>
                        <prop value="x" name="prop-in-oscal-ns" ns="http://csrc.nist.gov/ns/oscal"/>
                        <prop value="x" name="prop-in-arbitrary-ns" ns="http://none.org"/>
                        <part name="context"><title>Context to consider</title></part>
                    </control>
                    <control id="x2"><title>Control X2</title></control>
                    <control id="x3"><title>Control X3</title></control>
                </group>
                <group id="z">
                    <title>Group Z</title>
                    <control id="z1"><title>Control Z1</title></control>
                    <control id="z2"><title>Control Z2</title></control>
                    <control id="z3"><title>Control Z3</title>
                        <control id="z3.a"><title>Control Z3-A</title>
                            <control id="z3.a-1"><title>Control Z3-A-1</title></control>
                        </control>
                    </control>
                </group>
            </catalog>
        </x:variable>
        <x:scenario label="Edge case: removal element has no attributes that specify how to match">
            <x:call function="oscal:remove-match">
                <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                <x:param name="removal"><remove/></x:param>
            </x:call>
            <x:expect label="False" select="false()"/>
        </x:scenario>
        <x:scenario label="Removal by element name: ">
            <x:scenario label="Removal matches the item">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-item-name="prop"/></x:param>
                </x:call>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Removal does not match the item's local name">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-item-name="o:prop"/></x:param>
                    <!-- Element name with a namespace prefix is not expected to work. -->
                </x:call>
                <x:expect label="False" select="false()"/>
            </x:scenario>
            <x:scenario label="Removal does not specify an element name but specifies other true conditions">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-class="c1"/></x:param>
                </x:call>
                <x:expect label="True" select="true()"/>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Removal by name attribute: ">
            <x:scenario label="Removal matches the name attribute of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-name="prop-with-class"/></x:param>
                </x:call>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Removal does not match the name attribute of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-name="prop*"/></x:param>
                    <!-- Wildcards are not expected to work. -->
                </x:call>
                <x:expect label="False" select="false()"/>
            </x:scenario>
            <x:scenario label="Removal does not match because $who has no name attribute">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:control[@id='z3.a']"/>
                    <x:param name="removal"><remove by-name="Control Z3-A"/></x:param>
                    <!-- title child of control and name attribute are different things,
                        so the above <remove> element is not expected to work. -->
                </x:call>
                <x:expect label="False" select="false()"/>
            </x:scenario>
            <!-- The case where removal does not specify a name but specifies other true conditions
                is covered by the "Removal matches the class of $who" scenario. -->
        </x:scenario>
        <x:scenario label="Removal by id: ">
            <x:scenario label="Removal matches the id of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-item-name="prop"/></x:param>
                </x:call>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Removal matches the id of $who, and $who is a child control">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:control[@id='z3.a']"/>
                    <x:param name="removal"><remove by-id="z3.a"/></x:param>
                </x:call>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Removal does not match the id of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-id="z3.*"/></x:param>
                    <!-- Wildcards using glob syntax or regexp syntax are not expected to work. -->
                </x:call>
                <x:expect label="False" select="false()"/>
            </x:scenario>
            <!-- The case where removal does not specify an id but specifies other true conditions
                is covered by the "Removal does not specify an element name but specifies other true conditions" scenario. -->
        </x:scenario>
        <x:scenario label="Removal by class: ">
            <x:scenario label="Removal matches the class of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-class="c1"/></x:param>
                </x:call>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Removal by-class is space-separated list of classes where one matches the class of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-class="c1 c2 c3"/></x:param>
                </x:call>
                <x:expect label="False, because by-class is must be a single class name" select="false()"/>
            </x:scenario>
            <x:scenario label="Removal does not match the class of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-class="c"/></x:param>
                    <!-- Partial matches are not expected to work. -->
                </x:call>
                <x:expect label="False" select="false()"/>
            </x:scenario>
            <!-- The case where removal does not specify a class but specifies other true conditions
                is covered by the "Removal does not specify an element name but specifies other true conditions" scenario. -->
        </x:scenario>
        <x:scenario label="Removal by namespace: ">
            <x:scenario label="Removal matches non-OSCAL ns attribute of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-in-arbitrary-ns']"/>
                    <x:param name="removal"><remove by-ns="http://none.org"/></x:param>
                </x:call>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Removal matches explicit OSCAL ns attribute of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-in-oscal-ns']"/>
                    <x:param name="removal"><remove by-ns="http://csrc.nist.gov/ns/oscal"/></x:param>
                </x:call>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Removal matches implicit OSCAL namespace of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-ns="http://csrc.nist.gov/ns/oscal"/></x:param>
                </x:call>
                <x:expect label="True" select="true()"/>
            </x:scenario>
            <x:scenario label="Removal does not match non-OSCAL ns attribute of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-in-arbitrary-ns']"/>
                    <x:param name="removal"><remove by-ns="http://none.org/"/></x:param>
                    <!-- Trailing slash in by-ns prevents matching. -->
                </x:call>
                <x:expect label="False" select="false()"/>
            </x:scenario>
            <x:scenario label="Removal does not match explicit OSCAL ns attribute of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-in-oscal-ns']"/>
                    <x:param name="removal"><remove by-ns="http://csrc.nist.gov"/></x:param>
                    <!-- Partial matches are not expected to work. -->
                </x:call>
                <x:expect label="False" select="false()"/>
            </x:scenario>
            <x:scenario label="Removal does not match implicit OSCAL namespace of $who">
                <x:call function="oscal:remove-match">
                    <x:param name="who" select="$ov:catalog//o:prop[@name='prop-with-class']"/>
                    <x:param name="removal"><remove by-ns="http://csrc.nist.gov"/></x:param>
                    <!-- Partial matches are not expected to work. -->
                </x:call>
                <x:expect label="False" select="false()"/>
            </x:scenario>
            <!-- The case where removal does not specify a namespace but specifies other true conditions
                is covered by the "Removal does not specify an element name but specifies other true conditions" scenario. -->
        </x:scenario>
    </x:scenario>

    <x:scenario shared="yes" label="SHARED_catalog-parameterized-control-id">
        <x:variable name="ov:catalog-with-nested-controls" as="element(o:catalog)">
            <catalog id="abc">
                <control id="z3"><title>Control Z3</title>
                    <control id="z3.a"><title>Control Z3-A</title>
                        <control id="z3.a-1">
                            <title>Control Z3-A-1</title>
                            <prop value="hd" name="display"/>
                            <prop value="foo" name="bar"/>
                        </control>
                    </control>
                </control>
                <modify>
                    <alter control-id="{$ov:alter-control-id}">
                        <remove by-name="display"/>
                        <remove by-id="z3.a"/>
                    </alter>
                    <alter control-id="{$ov:alter-control-id}">
                        <remove by-name="bar"/>
                    </alter>
                </modify>
            </catalog>
        </x:variable>
    </x:scenario>
    <x:scenario shared="yes" label="SHARED_remove-prop-from-nested-controls">
        <x:call function="oscal:removable">
            <x:param name="who" select="$ov:catalog-with-nested-controls//o:prop[@name='display']"/>
            <x:param name="mods" select="$ov:catalog-with-nested-controls//o:modify"/>
        </x:call>
    </x:scenario>
    <x:scenario shared="yes" label="SHARED_remove-nested-control">
        <x:call function="oscal:removable">
            <x:param name="who" select="$ov:catalog-with-nested-controls//o:control[@id='z3.a']"/>
            <x:param name="mods" select="$ov:catalog-with-nested-controls//o:modify"/>
        </x:call>
    </x:scenario>
    <x:scenario shared="yes" label="SHARED_add-parameterized-position">
        <x:variable name="ov:context">
            <catalog id="abc">
                <control id="a1">
                    <title>Control A</title>
                    <prop value="1" name="source1"/>
                    <prop value="2" name="source2"/>
                </control>
                <modify>
                    <alter control-id="a1">
                        <add position="{$ov:add-position}">
                            <prop value="10" name="add1"/>
                            <prop value="20" name="add2"/>
                        </add>
                    </alter>
                </modify>
            </catalog>
        </x:variable>
        <x:context select="$ov:context//o:control">
            <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
        </x:context>
    </x:scenario>
    <x:scenario shared="yes" label="SHARED_add-explicit-parameterized-position">
        <x:variable name="ov:context">
            <catalog id="abc">
                <control id="a1">
                    <title>Control A</title>
                    <prop value="1" name="source1"/>
                    <prop value="2" name="source2"/>
                    <part name="statement" id="a1-stmt">
                        <p>Text</p>
                        <part name="statement" id="a1-substmt">
                            <p>Text</p>
                        </part>
                    </part>
                    <control id="a1.1">
                        <title>Control A.1</title>
                        <prop value="3" name="source3"/>
                        <prop value="4" name="source4"/>
                        <part name="statement" id="a1.1-stmt">
                            <p>Text</p>
                        </part>
                    </control>
                </control>
                <modify>
                    <alter control-id="a1">
                        <add position="{$ov:add-position}" by-id="{$ov:by-id}">
                            <part name="statement" id="new-stmt">
                                <p>New text</p>
                            </part>
                        </add>
                    </alter>
                </modify>
            </catalog>
        </x:variable>
        <x:context select="$ov:context//*[@id=$ov:by-id]">
            <x:param name="modifications" select="$ov:context//o:modify" tunnel="yes"/>
        </x:context>
    </x:scenario>

</x:description>



================================================
FILE: src/utils/resolver-pipeline/testing/5_finished/finish.xspec
================================================
<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:o="http://csrc.nist.gov/ns/oscal/1.0"
    xmlns:opr="http://csrc.nist.gov/ns/oscal/profile-resolution"
    xmlns:ov="http://csrc.nist.gov/ns/oscal/xspec/variable"
    xmlns:x="http://www.jenitennison.com/xslt/xspec"
    stylesheet="../../oscal-profile-resolve-finish.xsl">

    <x:scenario label="Tests for match=* | @* template in all modes">
        <x:variable name="ov:arbitrary-element" as="element(arbitrary-element)">
            <arbitrary-element xmlns="" arbitrary-attribute="val">text<child/></arbitrary-element>
        </x:variable>
        <x:scenario label="Element">
            <x:context select="$ov:arbitrary-element"/>
            <x:expect label="Copy" select="$ov:arbitrary-element"/>
        </x:scenario>
        <x:scenario label="Attribute">
            <x:context select="$ov:arbitrary-element/@arbitrary-attribute"/>
            <x:expect label="Copy"
                test="$x:result instance of attribute(arbitrary-attribute) and $x:result/string()='val'"/>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=catalog template">
        <x:scenario label="Base">
            <x:context>
                <catalog id="abc"/>
            </x:context>
            <x:expect label="profile becomes catalog">
                <catalog id="abc"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="Catalog with incorrectly sequenced children">
            <x:context>
                <catalog id="worksheet">
                    <back-matter>
                        <opr:foo/>
                    </back-matter>
                    <group>
                        <title>Group 1</title>
                    </group>
                    <control id="control_A">
                        <title>Control A</title>
                        <part>
                            <p><insert type="param" id-ref="loose"/> goes here.</p>
                        </part>
                    </control>
                    <param id="loose">
                        <label>Loose parameter</label>
                    </param>
                    <opr:foo/>
                    <metadata>
                        <title>Catalog</title>
                    </metadata>
                </catalog>                
            </x:context>
            <x:expect label="Catalog with correct sequence of children">
                <catalog id="worksheet">
                    <metadata>...</metadata>
                    <opr:foo/>
                    <param id="loose">...</param>
                    <control id="control_A">...</control>
                    <group>...</group>
                    <back-matter>...</back-matter>
                </catalog>
            </x:expect>
        </x:scenario>
        <x:scenario label="Catalog with multiple metadata and back-matter children">
            <x:context>
                <catalog id="worksheet">
                    <metadata>
                        <title>Catalog X</title>
                        <version>1.2</version>
                    </metadata>
                    <metadata>
                        <title>Catalog Y</title>
                        <version>1.3</version>
                    </metadata>
                    <back-matter>
                        <opr:foo/>
                    </back-matter>
                    <back-matter>
                        <opr:bar/>
                    </back-matter>
                </catalog>                
            </x:context>
            <x:expect label="Catalog with last metadata child and last back-matter child">
                <catalog id="worksheet">
                    <metadata>
                        <title>Catalog Y</title>
                        <version>1.3</version>
                    </metadata>
                    <back-matter>
                        <opr:bar/>
                    </back-matter>
                </catalog>                                
            </x:expect>
        </x:scenario>
        <x:scenario label="Catalog with loose parameter as child, ">
            <x:scenario label="unreferenced">
                <x:context>
                    <catalog id="worksheet">
                        <metadata>
                            <title>Catalog</title>
                        </metadata>
                        <param id="loose">
                            <label>Loose parameter</label>
                        </param>
                        <control id="control_A">
                            <title>Control A</title>
                        </control>
                    </catalog>
                </x:context>
                <x:expect label="orphan parameter is dropped">
                    <catalog id="worksheet">
                        <metadata>
                            <title>Catalog</title>
                        </metadata>
                        <control id="control_A">
                            <title>Control A</title>
                        </control>
                    </catalog>
                </x:expect>
            </x:scenario>
            <x:scenario label="referenced">
                <x:context>
                    <catalog id="worksheet">
                        <metadata>
                            <title>Catalog</title>
                        </metadata>
                        <param id="loose">
                            <label>Loose parameter</label>
                        </param>
                        <control id="control_A">
                            <title>Control A</title>
                            <part>
                                <p><insert type="param" id-ref="loose"/> goes here.</p>
                            </part>
                        </control>
                    </catalog>
                </x:context>
                <x:expect label="referenced loose parameter is kept">
                    <catalog id="worksheet">
                        <metadata>
                            <title>Catalog</title>
                        </metadata>
                        <param id="loose">
                            <label>Loose parameter</label>
                        </param>
                        <control id="control_A">
                            <title>Control A</title>
                            <part>
                                <p><insert type="param" id-ref="loose"/> goes here.</p>
                            </part>
                        </control>
                    </catalog>
                </x:expect>
            </x:scenario>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=metadata template">
        <x:scenario label="Metadata contents out of sequence">
            <x:context>
                <metadata>
                    <remarks/>
                    <responsible-party/>
                    <party/>
                    <location/>
                    <role/>
                    <link/>
                    <prop/>
                    <document-id/>
                    <revisions/>
                    <oscal-version/>
                    <version/>
                    <last-modified/>
                    <published/>
                    <title/>
                </metadata>
            </x:context>
            <x:expect label="Metadata with all children in correct sequence">
                <metadata>
                    <title/>
                    <published/>
                    <last-modified/>
                    <version/>
                    <oscal-version/>
                    <revisions/>
                    <document-id/>
                    <prop/>
                    <link/>
                    <role/>
                    <location/>
                    <party/>
                    <responsible-party/>
                    <remarks/>
                </metadata>                
            </x:expect>
        </x:scenario>
        <x:scenario label="Metadata with multiple elements of same type">
            <x:context>
                <metadata>
                    <title>Title 1</title>
                    <title>Title 2</title>
                    <published>2019-11-13T12:41:07.061-05:00</published>
                    <last-modified>2019-11-13T12:41:07.061-05:00</last-modified>
                    <published>2021-11-13T12:41:07.061-05:00</published>
                    <last-modified>2021-11-13T12:41:07.061-05:00</last-modified>
                    <version>1.0</version>
                    <oscal-version>1.0.1</oscal-version>
                    <version>1.1</version>
                    <oscal-version>1.0.2</oscal-version>
                    <revisions>
                        <revision>
                            <version>1.0</version>
                        </revision>
                    </revisions>
                    <revisions>
                        <revision>
                            <version>1.1</version>
                        </revision>
                    </revisions>
                    <remarks><p>Remark 1</p></remarks>
                    <remarks><p>Remark 2</p></remarks>
                </metadata>
            </x:context>
            <x:expect label="Metadata with last instance of each child type that cannot occur multiple times">
                <metadata>
                    <title>Title 2</title>
                    <published>2021-11-13T12:41:07.061-05:00</published>
                    <last-modified>2021-11-13T12:41:07.061-05:00</last-modified>
                    <version>1.1</version>
                    <oscal-version>1.0.2</oscal-version>
                    <revisions>
                        <revision>
                            <version>1.1</version>
                        </revision>
                    </revisions>
                    <remarks><p>Remark 2</p></remarks>
                </metadata>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=group template">
        <x:scenario label="Group contents out of sequence, ">
            <x:scenario label="link vs. prop">
                <x:context select="//o:group">
                    <catalog id="worksheet">
                        <metadata>
                            <title>Catalog</title>
                        </metadata>
                        <group id="group_A">
                            <title>Group A</title>
                            <link href="file.xml"><text>A link</text></link>
                            <prop name="somewhat">property</prop>
                        </group>
                    </catalog>
                </x:context>
                <x:expect label="in valid order: link after prop">
                    <group id="group_A">
                        <title>Group A</title>
                        <prop name="somewhat">property</prop>
                        <link href="file.xml"><text>A link</text></link>
                    </group>
                </x:expect>
            </x:scenario>
            <x:scenario label="prop vs. link and part">
                <x:context select="//o:group">
                    <catalog id="abc">
                        <group id="a123">
                            <title>Group A</title>
                            <link href="linkme.pdf"><text>Link Me</text></link>
                            <prop name="rating" value="AAA"/>
                            <part name="statement"><p>Statement</p></part>
                            <prop name="due_date" value="2020-02-20"/>
                        </group>
                    </catalog>
                </x:context>
                <x:expect label="Link and part after prop">
                    <group id="a123">
                        <title>Group A</title>
                        <prop name="rating" value="AAA"/>
                        <prop name="due_date" value="2020-02-20"></prop>
                        <link href="linkme.pdf"><text>Link Me</text></link>
                        <part name="statement"><p>Statement</p></part>
                    </group>
                </x:expect>
            </x:scenario>
            <x:scenario label="All children out of sequence">
                <x:context>
                    <group id="a123">
                        <group id="b456"/>
                        <control id="a123.1"/>
                        <part name="statement">
                            <p><insert type="param" id-ref="param-X"/> goes here.</p>
                        </part>
                        <link href="linkme.pdf"><text>Link Me</text></link>
                        <prop name="rating" value="AAA"/>
                        <param id="param-X"><label>X</label></param>
                        <title>Group A</title>
                    </group>
                </x:context>
                <x:expect label="Group with all children in correct sequence">
                    <group id="a123">
                        <title>Group A</title>
                        <param id="param-X">...</param>
                        <prop name="rating" value="AAA"/>
                        <link href="linkme.pdf">...</link>
                        <part name="statement">...</part>
                        <control id="a123.1"/>
                        <group id="b456"/>
                    </group>                    
                </x:expect>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Group with multiple titles">
            <x:context>
                <group id="a123">
                    <title>Original title</title>
                    <title>Revised title</title>
                </group>
            </x:context>
            <x:expect label="Group with last title">
                <group id="a123">
                    <title>Revised title</title>
                </group>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=control template">
        <x:scenario label="Control contents out of sequence, ">
            <x:scenario label="link vs. prop">
                <x:context select="//o:control">
                    <catalog id="worksheet">
                        <metadata>
                            <title>Catalog</title>
                        </metadata>
                        <control id="control_A">
                            <title>Control A</title>
                            <link href="file.xml"><text>A link</text></link>
                            <prop name="somewhat">property</prop>
                        </control>
                    </catalog>
                </x:context>
                <x:expect label="in valid order: link after prop">
                    <control id="control_A">
                        <title>Control A</title>
                        <prop name="somewhat">property</prop>
                        <link href="file.xml"><text>A link</text></link>
                    </control>
                </x:expect>
            </x:scenario>
            <x:scenario label="prop vs. link and part">
                <x:context select="//o:control">
                    <catalog id="abc">
                        <control id="a123">
                            <title>Control A</title>
                            <link href="linkme.pdf"><text>Link Me</text></link>
                            <prop name="rating" value="AAA"/>
                            <part name="statement"><p>Statement</p></part>
                            <prop name="due_date" value="2020-02-20"/>
                        </control>
                    </catalog>
                </x:context>
                <x:expect label="Link and part after prop">
                    <control id="a123">
                        <title>Control A</title>
                        <prop name="rating" value="AAA"/>
                        <prop name="due_date" value="2020-02-20"></prop>
                        <link href="linkme.pdf"><text>Link Me</text></link>
                        <part name="statement"><p>Statement</p></part>
                    </control>
                </x:expect>
            </x:scenario>
            <x:scenario label="All children out of sequence">
                <x:context>
                    <control id="a123">
                        <control id="a123.1"/>
                        <part name="statement"><p>Statement</p></part>
                        <link href="linkme.pdf"><text>Link Me</text></link>
                        <prop name="rating" value="AAA"/>
                        <param id="param-X"><label>X</label></param>
                        <title>Control A</title>
                    </control>
                </x:context>
                <x:expect label="Control with all children in correct sequence">
                    <control id="a123">
                        <title>Control A</title>
                        <param id="param-X"><label>X</label></param>
                        <prop name="rating" value="AAA"/>
                        <link href="linkme.pdf"><text>Link Me</text></link>
                        <part name="statement"><p>Statement</p></part>
                        <control id="a123.1"/>
                    </control>                    
                </x:expect>
            </x:scenario>
        </x:scenario>
        <x:scenario label="Control with multiple titles">
            <x:context>
                <control id="a123">
                    <title>Original title</title>
                    <title>First revision added during modify phase</title>
                    <title>Second revision added during modify phase</title>
                </control>
            </x:context>
            <x:expect label="Control with last title">
                <control id="a123">
                    <title>Second revision added during modify phase</title>
                </control>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for catalog/param[...] | group/param[...] template">
        <!-- The catalog/param case is tested at the catalog level in
            the scenario labeled "Catalog with loose parameter as child, " -->
        <x:scenario label="Unreferenced loose parameter as child of group">
            <x:context select="//o:param">
                <catalog id="worksheet">
                    <group id="group1">
                        <title>Group 1</title>
                        <param id="loose-in-group1">
                            <label>Loose parameter</label>
                        </param>
                        <control id="control_A">
                            <title>Control A</title>
                        </control>
                    </group>
                </catalog>
            </x:context>
            <x:expect label="Nothing because selected param is not referenced"
                select="()"/>
        </x:scenario>
        <x:scenario label="Unreferenced loose parameter, where XSLT key is nonempty">
            <x:context select="(//o:param)[1]">
                <catalog id="worksheet">
                    <group id="group1">
                        <title>Group 1</title>
                        <param id="loose1-in-group1">
                            <label>Unreferenced parameter being tested</label>
                        </param>
                        <param id="loose2-in-group1">
                            <label>Referenced parameter</label>
                        </param>
                        <control id="control_A">
                            <title>Control A</title>
                            <part>
                                <p><insert type="param" id-ref="loose2-in-group1"/> goes here.</p>
                            </part>
                        </control>
                    </group>
                </catalog>
            </x:context>
            <x:expect label="Nothing because selected param is not referenced"
                select="()"/>
        </x:scenario>
        <x:scenario label="Unreferenced loose parameter with prop name=keep value=always">
            <x:context select="//o:param">
                <catalog id="worksheet">
                    <group id="group1">
                        <title>Group 1</title>
                        <param id="loose-in-group1">
                            <prop name="keep" value="always"/>
                            <label>Loose parameter</label>
                        </param>
                        <control id="control_A">
                            <title>Control A</title>
                        </control>
                    </group>
                </catalog>
            </x:context>
            <x:expect label="Copy of param, even though it is unreferenced">
                <param id="loose-in-group1">
                    <prop name="keep" value="always"/>
                    <label>Loose parameter</label>
                </param>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <x:scenario label="Tests for match=back-matter template">
        <x:scenario label="Superfluous back matter discarded">
            <x:context select="//o:back-matter">
                <catalog id="worksheet">
                    <metadata>
                        <title>Catalog</title>
                    </metadata>
                    <back-matter>
                        <resource uuid="cit1">citation</resource>
                    </back-matter>
                </catalog>
            </x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
        <x:scenario label="Back matter retained ">
            <!-- This scenario relies on the combination of
                a) match=back-matter template
                b) nonmatching predicate expressions in the match=resource[...] template
                c) match="* | @*" template -->
            <x:scenario label="for cited resource">
                <x:context select="//o:back-matter">
                    <catalog id="worksheet">
                        <metadata>
                            <title>Catalog</title>
                        </metadata>
                        <control>
                            <title>Control A</title>
                            <link href="#citA"><text>link to good citation</text></link>
                        </control>
                        <back-matter>
                            <resource uuid="cit1">unclaimed citation</resource>
                            <resource uuid="citA">good citation</resource>
                        </back-matter>
                    </catalog>
                </x:context>
                <x:expect label="back-matter containing the cited resource">
                    <back-matter>
                        <resource uuid="citA">good citation</resource>
                    </back-matter>
                </x:expect>                
            </x:scenario>
            <x:scenario label="for resource with prop name=keep value=always">
                <x:context select="//o:back-matter">
                    <catalog id="worksheet">
                        <control>
                            <title>Control A</title>
                        </control>
                        <back-matter>
                            <resource uuid="cit1">
                                <prop name="keep" value="always"/>
                            </resource>
                            <resource uuid="cit2">unclaimed citation</resource>
                        </back-matter>
                    </catalog>
                </x:context>
                <x:expect label="back-matter containing the resource with special prop">
                    <back-matter>
                        <resource uuid="cit1">
                            <prop name="keep" value="always"/>
                        </resource>
                    </back-matter>
                </x:expect>
            </x:scenario>
        </x:scenario>
    </x:scenario>
    
    <x:scenario label="Tests for match=resource[...] template">
        <!-- A simple case is tested at the back-matter level in
            the scenario labeled "Superfluous back matter discarded" -->
        <x:scenario label="resource without citation or special prop, where XSLT key is nonempty">
            <x:context select="(//o:resource)[1]">
                <catalog id="worksheet">
                    <metadata>
                        <title>Catalog</title>
                    </metadata>
                    <control>
                        <title>Control A</title>
                        <link href="#citA"><text>link to good citation</text></link>
                    </control>
                    <back-matter>
                        <resource uuid="cit1"><prop name="keep" value=""/></resource>
                        <resource uuid="citA">good citation</resource>
                    </back-matter>
                </catalog>
            </x:context>
            <x:expect label="Nothing" select="()"/>
        </x:scenario>
    </x:scenario>
</x:description>



================================================
FILE: src/utils/schematron/readme.md
================================================
# OSCAL Schema XML Schematron

* [oscal-profile.sch](oscal-profile.sch): Checking a profile against its authority or source, the profile, catalog or framework that it references. (Limiitation: it only processes profiles that make reference to catalogs directly, not to profiles.)



================================================
FILE: src/utils/schematron/catalog.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<catalog xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         uuid="6c303ebb-4a36-4534-8d7f-dd91644b1d53">
   <metadata>
      <title>Catalog</title>
      <last-modified>2021-06-21T15:48:23.851-04:00</last-modified>
      <version>0/1</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <param id="p2"/>
   <control id="a1">
      <title>Control A1</title>
   </control>
   <control id="a2">
      <title>Control A1</title>
   </control>
   <control id="a3">
      <title>Control A1</title>
   </control>
</catalog>



================================================
FILE: src/utils/schematron/oscal-profile.sch
================================================
<?xml version="1.0" encoding="UTF-8"?>
<sch:schema xmlns:sch="http://purl.oclc.org/dsdl/schematron" queryBinding="xslt2"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:sqf="http://www.schematron-quickfix.com/validator/process"
  xmlns:oscal="http://csrc.nist.gov/ns/oscal/1.0">

<!-- Rough check OSCAL Profile link checker Schematron
  
  Assuming an OSCAL profile that imports catalogs, this Schematron performs a sanity check
  on the major links (for inclusion, exclusion, parameter settings).
  
  TODO:
  - more granularity in alter (targets add/remove)
  - extend to cover referenced profiles (resolving them)
  -->

  <sch:ns uri="http://csrc.nist.gov/ns/oscal/1.0" prefix="oscal"/>

  <xsl:key name="control-call-by-id"       match="oscal:import//oscal:with-id" use="string(.)"/>
  <xsl:key name="setting-by-id"       match="oscal:set-parameter" use="@param-id"/>
  <xsl:key name="alteration-by-id" match="oscal:alter"         use="@control-id"/>

  <xsl:key name="resource-fetch" match="oscal:resource" use="'#' || @uuid"/>
  
  <xsl:function name="oscal:get-import" as="document-node()?">
    <xsl:param name="import" as="element(oscal:import)"/>
    <xsl:variable name="source" select="($import/key('resource-fetch',@href)/oscal:rlink/@href,$import/@href[. castable as xs:anyURI])[1]"/>
    <xsl:sequence select="document($source, $import)"/>
  </xsl:function>
  
  <sch:pattern>
    <sch:rule context="oscal:import">
      <sch:let name="importing" value="oscal:get-import(.)"/>
      
      <sch:assert test="exists($importing)">Nothing found at <sch:value-of select="@href"/>...</sch:assert>
      <sch:assert role="warning" test="exists($importing/oscal:catalog)">Not importing a catalog.</sch:assert>
    </sch:rule>
  
    <sch:rule context="oscal:import/*/oscal:with-id">
      <sch:let name="importing" value="oscal:get-import(../parent::oscal:import)"/>
      <sch:let name="not-a-catalog" value="empty($importing/oscal:catalog)"/>
      
      <sch:assert test="$not-a-catalog or (string(.) = $importing//oscal:control/@id)">No control found with @id='<sch:value-of select="string(.)"/>'</sch:assert>
      
      <sch:assert test="count(key('control-call-by-id', string())) = 1">Control (<sch:value-of select="string(.)"/>) should not be referenced (either imported or excluded) more than once.</sch:assert>
      <!--<sch:assert test="empty(key('call-by-id', string(), ..) except key('call-by-id', string(), ..) )">Control (<sch:value-of select="."/>) should not be both included and excluded, or invoked more than once.</sch:assert>-->
    </sch:rule>
    
    <sch:rule context="oscal:set-parameter" >
      <sch:let name="param-ref" value="string(@param-id)"/>
      <sch:let name="importing" value="ancestor::oscal:profile/child::oscal:import/oscal:get-import(.)"/>
      <sch:assert test="count(key('setting-by-id', $param-ref)) = 1">Parameter (<sch:value-of select="@param-id"/>) may not be set more than once.</sch:assert>
      <sch:assert test="$importing//oscal:param/@id = $param-ref">) No parameter '<sch:value-of select="$param-ref"/>' is found among imported catalogs.</sch:assert>
    </sch:rule>
    
    <sch:rule context="oscal:alter" >
      <sch:let name="alter-ref" value="string(@control-id)"/>
      <sch:let name="importing" value="ancestor::oscal:profile/child::oscal:import/oscal:get-import(.)"/>
      <sch:assert test="count(key('alteration-by-id', @control-id)) = 1">Alteration should not be declared more than once (<sch:value-of select="@control-id"/>).</sch:assert>
      <!--<sch:report test="true()">boo</sch:report>-->
      <sch:assert test="($importing//oscal:control/@id = $alter-ref)">) No control '<sch:value-of select="$alter-ref"/>' is found among imported catalogs.</sch:assert>
    </sch:rule>
</sch:pattern>


</sch:schema>



================================================
FILE: src/utils/schematron/test-profile.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="oscal-profile.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<profile xmlns="http://csrc.nist.gov/ns/oscal/1.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/1.0 https://raw.githubusercontent.com/usnistgov/OSCAL/v1.0.0/xml/schema/oscal_profile_schema.xsd"
         uuid="7bb79729-781a-4034-85ef-a5c5c17d9daa">
   <metadata>
      <title/>
      <last-modified>2021-08-23T17:19:41.79-04:00</last-modified>
      <version>0.1</version>
      <oscal-version>1.0.0</oscal-version>
   </metadata>
   <import href="#a1c12452-39a8-49ec-a4dc-549955270ba6">
      <include-all/>
      <exclude-controls>
         <with-id>a1</with-id>
         <with-id>a2</with-id>
      </exclude-controls>
   </import>
   <modify>
      <set-parameter param-id="p2"/>
      <alter control-id="p2"/>
   </modify>
   <back-matter>
      <resource uuid="a1c12452-39a8-49ec-a4dc-549955270ba6">
         <rlink href="catalog.xml"/>
      </resource>
   </back-matter>
</profile>



================================================
FILE: .github/ABOUT.md
================================================
# OSCAL GitHub Supporting Files

This directory contains supporting files for OSCAL GitHub repository use. The structure and contents of the directory are as follows:

- [ISSUE_TEMPLATE](ISSUE_TEMPLATE/): This directory contains several templates for creating new issues in GitHub.
- [workflows](workflows): Contains the set of continuous integration (CI) and continuous deployment (CD) workflows supporting this repository.
- [CODEOWNERS](CODEOWNERS): Identifies owners of assets within this repository. Used to drive PR reviews.
- [PULL_REQUEST_TEMPLATE.md](issue_template.md): This file contains a template to be filled out by the person submitting a GitHub pull request.
- [issue_template.md](issue_template.md): This file contains a template for creating a new issue in GitHub that is not based on one of the [issue templates](ISSUE_TEMPLATE/).



================================================
FILE: .github/CODEOWNERS
================================================
# The OSCAL Admins team governs critical directories
.github/workflows/      @usnistgov/itl-oscal-admins
build/Makefile          @usnistgov/itl-oscal-admins
# The OSCAL Maintainers team governs source and build directories
src/                    @usnistgov/itl-oscal-maintainers
build/                  @usnistgov/itl-oscal-maintainers
# Otherwise governed by the OSCAL Team
*                       @usnistgov/itl-oscal



================================================
FILE: .github/dependabot.yml
================================================

version: 2
updates:

  - package-ecosystem: "gitsubmodule"
    directory: "/"
    schedule:
      interval: "daily"
    target-branch: "develop"

  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "daily"
    target-branch: "develop"

  - package-ecosystem: "docker"
    directory: "/build"
    schedule:
      interval: "daily"
    target-branch: "develop"

  - package-ecosystem: "gomod"
    directory: "/build"
    schedule:
      interval: "daily"
    target-branch: "develop"

  - package-ecosystem: "maven"
    directory: "/build"
    schedule:
      interval: "daily"
    target-branch: "develop"

  - package-ecosystem: "npm"
    directory: "/build"
    schedule:
      interval: "daily"
    target-branch: "develop"

  - package-ecosystem: "pip"
    directory: "/build/python"
    schedule:
      interval: "daily"
    target-branch: "develop"



================================================
FILE: .github/issue_template.md
================================================
{Please describe the nature of your issue}



================================================
FILE: .github/PULL_REQUEST_TEMPLATE.md
================================================
# Committer Notes

{Please provide a brief description of what this PR accomplishes. Be sure to reference any issues addressed. If the PR is a work-in-progress submitted for early review, please include [WIP] at the beginning of the title or mark the PR as DRAFT.}

### All Submissions:

- [ ] Have you selected the correct base branch per [Contributing](https://github.com/usnistgov/OSCAL/blob/main/CONTRIBUTING.md) guidance?
- [ ] Have you set "[Allow edits and access to secrets by maintainers](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/working-with-forks/allowing-changes-to-a-pull-request-branch-created-from-a-fork)"?
- [ ] Have you checked to ensure there aren't other open [Pull Requests](https://github.com/usnistgov/OSCAL/pulls) for the same update/change?
- [ ] Have you squashed any non-relevant commits and commit messages? \[[instructions](https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History)\]
- [ ] Do all automated CI/CD checks pass?

By submitting a pull request, you are agreeing to provide this contribution under the [CC0 1.0 Universal public domain](https://creativecommons.org/publicdomain/zero/1.0/) dedication.

(For reviewers: [The wiki has guidance](https://github.com/usnistgov/OSCAL/wiki/Issue-Review) on code review and overall issue review for completeness.)

### Changes to Core Features:

- [ ] Have you added an explanation of what your changes do and why you'd like us to include them?
- [ ] Have you written new tests for your core changes, as applicable?
- [ ] Have you included examples of how to use your new feature(s)?
- [ ] Have you updated the [OSCAL website](https://pages.nist.gov/OSCAL) and readme documentation affected by the changes you made? Changes to the OSCAL website can be made in the [OSCAL-Pages](https://github.com/usnistgov/OSCAL-Pages) and [OSCAL_Reference](https://github.com/usnistgov/OSCAL-Reference) repositories.



================================================
FILE: .github/ISSUE_TEMPLATE/README.md
================================================
# OSCAL GitHub Issue Template Files

This directory contains templates for creating new OSCAL issues in GitHub. The structure and contents of the directory are as follows:

- [bug_report.md](bug_report.yaml): This file contains a template for creating a new issue in GitHub to report a bug.
- [question.md](question.yaml): This file contains a template for creating a new issue in GitHub containing a general question about the project.
- [feature_request.md](feature_request.yaml): This file contains a template for creating a new issue in GitHub containing a user story.



================================================
FILE: .github/ISSUE_TEMPLATE/bug_report.yaml
================================================
name: Bug report
description: Create a report to help us improve
labels: ['bug']
body:
  # - type: checkboxes
  #   attributes:
  #     label: Is there an existing issue for this?
  #     description: Please search to see if an issue already exists for the bug you encountered.
  #     options:
  #       - label: I have searched the existing issues
  #         required: true
  - type: textarea
    id: bug-description
    attributes:
      label: Describe the bug
      description: A clear and concise description of what the bug is
    validations:
      required: true
  - type: textarea
    id: bug-affecting-who
    attributes:
      label: Who is the bug affecting
      description: Describe the stakeholders affected by this bug
    validations:
      required: true
  - type: dropdown
    id: bug-affecting-what
    attributes:
      label: What is affected by this bug
      description: Select the area(s) describing the scope of this bug
      options:
        - CI/CD
        - OSCAL Content
        - Documentation
        - Metaschema
        - Modeling
        - Tooling & API
        - Website
      multiple: true
    validations:
      required: true
  # - type: textarea
  #   id: bug-conditions
  #   attributes:
  #     label: When does this occur
  #     description: Describe the conditions under which the bug is occuring
  #   validations:
  #     required: true
  - type: textarea
    id: bug-replication
    attributes:
      label: How do we replicate this issue
      description: What are the steps to reproduce this behavior (use screenshots if applicable)
      placeholder: |
        1. Do this...
        2. Then this...
        3. See error...
    validations:
      required: true
  - type: textarea
    id: bug-solution
    attributes:
      label: Expected behavior (i.e. solution)
      description: A clear and concise description of what you expected to happen
    validations:
      required: true
  - type: textarea
    id: bug-comments
    attributes:
      label: Other comments
      description: |
        Add any other context about the problem here

        (For reviewers: [The wiki has guidance](https://github.com/usnistgov/OSCAL/wiki/Issue-Review) on code review and overall issue review for completeness.)
    validations:
      required: false
  - type: textarea
    id: revisions
    attributes:
      label: Revisions
      description: If you are creating the issue, this field is not required. When working on the issue, this field is for assigned developers to flag any important changes made to the description, goals, or acceptance criteria needed to complete the work.




================================================
FILE: .github/ISSUE_TEMPLATE/feature_request.yaml
================================================
name: Feature Request
description: Suggest an idea for this project
labels: ['User Story', 'enhancement']
body:
  - type: textarea
    id: story
    attributes:
      label: User Story
      description: Describe the feature from the user's perspective, e.g. "As a an OSCAL ..., I need to be able to..."
      placeholder: |
        As an OSCAL {stakeholder}, I {provide a clear and concise description of what the problem is. Ex. I need to be able to ...}
    validations:
      required: true
  - type: textarea
    id: goals
    attributes:
      label: Goals
      description: Describe what you want to happen. This should be outcome focused. Include descriptions of any alternative solutions or features you've considered. Feel free to include any screenshots or examples.
    validations:
      required: true
  - type: textarea
    id: dependencies
    attributes:
      label: Dependencies
      description: Describe any previous issues or related work that must be completed to start or complete this issue.
  - type: textarea
    id: acceptance_criteria
    attributes:
      label: Acceptance Criteria
      description: The items below are general acceptance criteria for all User Stories. Please describe anything else that must be completed for this issue to be considered resolved.
      value: |
        - [ ] All [OSCAL website](https://pages.nist.gov/OSCAL) and readme documentation affected by the changes in this issue have been updated. Changes to the OSCAL website can be made in the docs/content directory of your branch.
        - [ ] A Pull Request (PR) is submitted that fully addresses the goals of this User Story. This issue is referenced in the PR.
        - [ ] The CI-CD build process runs without any reported errors on the PR. This can be confirmed by reviewing that all checks have passed in the PR.

        (For reviewers: [The wiki has guidance](https://github.com/usnistgov/OSCAL/wiki/Issue-Review) on code review and overall issue review for completeness.)
    validations:
      required: true
  - type: textarea
    id: revisions
    attributes:
      label: Revisions
      description: If you are creating the issue, this field is not required. When working on the issue, this field is for assigned developers to flag any important changes made to the description, goals, or acceptance criteria needed to complete the work.



================================================
FILE: .github/ISSUE_TEMPLATE/question.yaml
================================================
name: Question
description: Ask your question
labels: ['question']
body:
  - type: markdown
    attributes:
      value: Please note, the OSCAL [Q&A discussion board](https://github.com/usnistgov/OSCAL/discussions/categories/q-a) is a more appropriate place for asking most questions.
  - type: textarea
    id: question-text
    attributes:
      label: Question
      description: Please enter your question
    validations:
      required: true



================================================
FILE: .github/workflows/issue-triage.yml
================================================
name: Triage Board Management

on:
  issues:
    types:
      - opened
      - reopened
      - transferred

jobs:
  add-to-project:
    name: Add issue to project
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/add-to-project@244f685bbc3b7adfa8466e08b698b5577571133e
        with:
          project-url: https://github.com/orgs/usnistgov/projects/25
          github-token: ${{ secrets.COMMIT_TOKEN }}



================================================
FILE: .github/workflows/periodic.yml
================================================
name: Periodic Checks
on:
  schedule:
    - cron: "0 0 * * MON"
    - cron: "0 0 * * THU"
  workflow_dispatch:
jobs:
  linkcheck:
    name: Validate Markdown Links
    runs-on: ubuntu-22.04
    permissions:
      # Needed to post comments and issues
      issues: write
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
        with:
          submodules: recursive
      - uses: actions/setup-node@39370e3970a6d050c480ffad4ff0ed4d3fdee5af
        with:
          node-version-file: "build/.nvmrc"
          cache: "npm"
          cache-dependency-path: "build/package-lock.json"
      - name: Perform link checking
        run: |
          make linkcheck
        working-directory: build
      - name: Create an issue or comment if bad links are detected
        if: failure()
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea
        with:
          script: |
            // Read the markdown linkcheck report
            const fs = require('fs');
            const body = fs.readFileSync('build/generated/mlc_report.log', 'utf8');

            const title = "Scheduled Check of Markdown Documents Found Bad Hyperlinks";
            const labels = ["bug", "Scope: Documentation"];

            // Find open linkchecker issues
            const query = `query($owner:String!, $name:String!, $labels:[String!], $user:String!) {
              repository(owner:$owner, name:$name) {
                issues(first: 100, orderBy: {
                  direction: DESC,
                  field: CREATED_AT
                }, filterBy: {
                  createdBy: $user,
                  labels: $labels,
                  states: OPEN
                }) {
                  nodes {
                    title
                    number
                  }
                }
              }
            }`;
            const result = await github.graphql(query, {
              owner: context.repo.owner,
              name: context.repo.repo,
              labels: labels,
              user: "github-actions[bot]"
            });

            // find the first issue with a matching title, and create a comment
            for (const issue of result.repository.issues.nodes) {
              if (issue.title !== title) {
                continue;
              }

              github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body
              });

              return;
            }

            // or, if none were found, create an issue
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title,
              body,
              labels
            });



================================================
FILE: .github/workflows/release.yml
================================================
name: Package Release
on:
  push:
    tags:
      - v*
jobs:
  package-release:
    name: Package Release
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
        with:
          submodules: recursive
      - uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"
      - name: Generate artifacts
        # RELEASE is set to the tag name (vX.X.X) without the first character
        run: |
          make -j2 artifacts archives RELEASE=${GITHUB_REF_NAME:1}
        working-directory: build
      - name: Create release
        uses: softprops/action-gh-release@v2
        with:
          token: ${{ secrets.COMMIT_TOKEN }}
          draft: true
          generate_release_notes: true
          fail_on_unmatched_files: true
          files: |
            build/generated/oscal*



================================================
FILE: .github/workflows/status.yml
================================================
name: OSCAL CI/CD
on:
  push:
    branches:
      - main
      - develop
      - "feature-*"
      - "release-*"
  pull_request:
    branches:
      - main
      - develop
      - "feature-*"
      - "release-*"
  workflow_dispatch:
jobs:
  checks:
    name: Status Checks
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
        with:
          submodules: recursive
      - uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"
      - uses: actions/setup-node@39370e3970a6d050c480ffad4ff0ed4d3fdee5af
        with:
          node-version-file: "build/.nvmrc"
          cache: "npm"
          cache-dependency-path: "build/package-lock.json"
      - name: Install xmllint
        run: sudo apt-get install -y libxml2-utils
      - name: Run all pipelines
        run: |
          make --keep-going all
        working-directory: build


